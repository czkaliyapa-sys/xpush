"use strict";(self.webpackChunkitsxtrapush=self.webpackChunkitsxtrapush||[]).push([[941],{27941(e,t,i){i.r(t),i.d(t,{default:()=>Yr});var r=i(89379),n=i(9950),s=i(35481),o=i(96195),a=i(7356),l=i(27532),d=i(92994),c=i(5332),u=i(79448),x=i(27321),h=i(97228),m=i(81393),p=i(98519),g=i(43711),b=i(16253),v=i(38796),A=i(82503),j=i(56690),y=i(5352),f=i(22403),w=i(55547),S=i(52036),k=i(11888),C=i(91724),P=i(82161),I=i(57559),W=i(66424),_=i(80975),D=i(90459),M=i(55884),z=i(5310),N=i(46167),B=i(6458),F=i(6468),E=i(89737),T=i(74106),R=i(62101),O=i(11403),U=i(13746),L=i(43405),q=i(44414);const G=(0,o.Ay)(h.A)(e=>{let{theme:t}=e;return{backgroundColor:"#0f172a",borderBottom:"1px solid #334155",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",backdropFilter:"blur(10px)",position:"fixed",top:0,left:0,right:0,zIndex:t.zIndex.drawer+1,[t.breakpoints.up("md")]:{marginLeft:320,width:"calc(100% - 320px)"}}}),V=(0,o.Ay)(P.A)(e=>{let{theme:t}=e;return{padding:t.spacing(1,1.5),minHeight:64,display:"flex",alignItems:"center",justifyContent:"space-between",gap:t.spacing(1),flexWrap:"nowrap",overflow:"hidden",[t.breakpoints.up("sm")]:{padding:t.spacing(1.5,2),minHeight:70,gap:t.spacing(2)}}}),H=(0,o.Ay)(x.A)(e=>{let{theme:t}=e;return{flex:"1 1 auto",minWidth:100,maxWidth:"100%",position:"relative",[t.breakpoints.up("sm")]:{minWidth:200,maxWidth:400}}}),K=(0,o.Ay)(A.A)(e=>{let{theme:t}=e;return{"& .MuiOutlinedInput-root":{backgroundColor:"#1e293b",borderRadius:8,border:"2px solid #334155",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)","&:hover":{borderColor:"#475569",backgroundColor:"#1e293b"},"&.Mui-focused":{borderColor:"#3b82f6",backgroundColor:"#1e293b",boxShadow:"0 0 0 3px rgba(59, 130, 246, 0.1)"}},"& .MuiOutlinedInput-input":{padding:"10px 12px",fontSize:14},"& .MuiOutlinedInput-input::placeholder":{color:"#64748b",opacity:.7}}}),Q=(0,o.Ay)(x.A)(e=>{let{theme:t}=e;return{position:"absolute",top:"100%",left:0,right:0,zIndex:1300,marginTop:8,maxHeight:400,overflowY:"auto",backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:8,boxShadow:"0 10px 40px rgba(0, 0, 0, 0.4)","&::-webkit-scrollbar":{width:6},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"#475569",borderRadius:3}}}),Y=(0,o.Ay)(x.A)(e=>{let{theme:t}=e;return{padding:t.spacing(1.5,2),cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"background-color 0.2s","&:hover":{backgroundColor:"#0f172a"},borderBottom:"1px solid #334155","&:last-child":{borderBottom:"none"}}}),X=(0,o.Ay)(x.A)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",gap:t.spacing(.5),cursor:"pointer",padding:t.spacing(.25,.5),borderRadius:8,transition:"all 0.3s","&:hover":{backgroundColor:"#1e293b"},[t.breakpoints.up("sm")]:{gap:t.spacing(1),padding:t.spacing(.5,1)}}}),J=(0,o.Ay)(x.A)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",gap:t.spacing(.5),[t.breakpoints.down("sm")]:{display:"none"}}}),Z=(0,o.Ay)(x.A)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",gap:t.spacing(.5),flexShrink:0,[t.breakpoints.up("sm")]:{gap:t.spacing(1)}}});function $(e){let{onDrawerToggle:t,dateLabel:i,headerSearch:r,onHeaderSearchChange:s,headerSearchResults:o,onResultClick:l,pendingInstallments:c,showHeaderSearchResults:u,onSearchFocus:h,onSearchBlur:m,onHeaderSearchKeyDown:g}=e;(0,a.A)();const b=(0,d.Zp)(),v=(0,d.zy)(),{user:A,logout:f}=(0,L.A)(),[w,S]=(0,n.useState)(null),[k,P]=(0,n.useState)(null),$=()=>{var e;const t=v.pathname||"",i=t.startsWith("/dashboard/")&&t.split("/")[2]||"";return null!==(e={"":"Home",analytics:"Analytics",clients:"Clients",gadgets:"Gadgets",users:"Users",settings:"Settings",about:"About",orders:"Orders",installments:"Installments",applications:"Installment Applications",receipts:"Receipts",verify:"Verify Listings",listings:"My Listings","add-listing":"Add Listing"}[i])&&void 0!==e?e:i?i.charAt(0).toUpperCase()+i.slice(1):"Home"},ee=()=>null!==A&&void 0!==A&&A.displayName?A.displayName:null!==A&&void 0!==A&&A.email?A.email.split("@")[0]:"User",te=()=>{S(null)},ie=()=>{P(null)},re=e=>{b(e),te()};return(0,q.jsx)(G,{position:"fixed",children:(0,q.jsxs)(V,{children:[(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:{xs:.5,sm:2},minWidth:0,flexShrink:0},children:[(0,q.jsx)(I.A,{title:"Toggle menu",children:(0,q.jsx)(W.A,{color:"inherit","aria-label":"toggle drawer",onClick:t,size:"small",sx:{display:{xs:"flex",md:"none"},p:{xs:.5,sm:1},"&:hover":{backgroundColor:"#1e293b"}},children:(0,q.jsx)(N.A,{sx:{fontSize:{xs:20,sm:24}}})})}),(0,q.jsxs)(J,{children:[(0,q.jsx)(B.A,{sx:{fontSize:18,color:"#3b82f6"}}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"#94a3b8",fontWeight:500},children:"Dashboard"}),(0,q.jsx)(p.A,{sx:{color:"#475569"},children:"/"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"#f8fafc",fontWeight:600},noWrap:!0,children:$()})]}),(0,q.jsx)(x.A,{sx:{display:{xs:"block",sm:"none"},maxWidth:{xs:80,sm:"none"}},children:(0,q.jsx)(p.A,{variant:"caption",sx:{color:"#f8fafc",fontWeight:600,fontSize:{xs:11,sm:14}},noWrap:!0,children:$()})})]}),(0,q.jsxs)(H,{children:[(0,q.jsx)(K,{fullWidth:!0,size:"small",placeholder:"Search gadgets, orders, clients...",value:r,onChange:s,onKeyDown:g,onFocus:h,onBlur:m,InputProps:{startAdornment:(0,q.jsx)(y.A,{position:"start",children:(0,q.jsx)(C.A,{sx:{color:"#64748b",fontSize:18}})})}}),u&&o.length>0&&(0,q.jsx)(Q,{children:o.map((e,t)=>(0,q.jsxs)(Y,{onClick:()=>l(e),children:[(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(C.A,{sx:{fontSize:16,color:"#64748b"}}),(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"body2",sx:{color:"#f8fafc"},children:"route"===e.type?e.label:e.name||e.label||"View item"}),e.brand&&(0,q.jsxs)(p.A,{variant:"caption",sx:{color:"#64748b"},children:[e.brand,e.category&&" \u2022 ".concat(e.category)]})]})]}),"route"===e.type&&(0,q.jsx)(F.A,{sx:{fontSize:16,color:"#475569"}})]},"".concat(e.type,"-").concat(e.id||e.to||e.label,"-").concat(t)))})]}),(0,q.jsxs)(Z,{children:[(0,q.jsxs)(x.A,{sx:{display:{xs:"none",sm:"flex"},alignItems:"center",gap:1,px:2,py:.75,backgroundColor:"#1e293b",borderRadius:"8px",border:"1px solid #334155",minWidth:"fit-content"},children:[(0,q.jsx)(E.A,{sx:{fontSize:16,color:"#64748b"}}),(0,q.jsx)(p.A,{variant:"body2",sx:{fontWeight:500,color:"#f8fafc",whiteSpace:"nowrap"},children:i})]}),(0,q.jsx)(I.A,{title:"Notifications",children:(0,q.jsx)(W.A,{color:"inherit",size:"small",onClick:e=>{P(e.currentTarget)},sx:{position:"relative",p:{xs:.5,sm:1},"&:hover":{backgroundColor:"#1e293b"}},children:(0,q.jsx)(_.A,{badgeContent:c,color:"error",overlap:"circular",sx:{"& .MuiBadge-badge":{fontSize:{xs:9,sm:10},height:{xs:16,sm:18},minWidth:{xs:16,sm:18}}},children:(0,q.jsx)(T.A,{sx:{fontSize:{xs:18,sm:22}}})})})}),(0,q.jsxs)(D.A,{anchorEl:k,open:Boolean(k),onClose:ie,PaperProps:{sx:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:1,minWidth:320}},children:[(0,q.jsx)(j.A,{disabled:!0,children:(0,q.jsx)(p.A,{variant:"body2",sx:{fontWeight:600},children:"Notifications"})}),(0,q.jsx)(M.A,{sx:{borderColor:"#334155",my:1}}),c>0?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(j.A,{onClick:()=>{re("/dashboard/installments"),ie()},sx:{backgroundColor:"rgba(239, 68, 68, 0.1)",borderLeft:"3px solid #ef4444"},children:(0,q.jsxs)(x.A,{children:[(0,q.jsxs)(p.A,{variant:"body2",children:[c," Pending Installment",1!==c?"s":""]}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"#94a3b8"},children:"Action required"})]})}),(0,q.jsx)(M.A,{sx:{borderColor:"#334155",my:1}})]}):(0,q.jsx)(j.A,{disabled:!0,children:(0,q.jsx)(p.A,{variant:"body2",sx:{color:"#94a3b8"},children:"No new notifications"})}),(0,q.jsx)(j.A,{onClick:()=>{re("/dashboard/orders"),ie()},children:(0,q.jsx)(p.A,{variant:"body2",children:"View all orders"})})]}),(0,q.jsx)(I.A,{title:"Settings",children:(0,q.jsx)(W.A,{color:"inherit",size:"small",onClick:()=>b("/dashboard/settings"),sx:{p:{xs:.5,sm:1},display:{xs:"none",sm:"inline-flex"},"&:hover":{backgroundColor:"#1e293b"}},children:(0,q.jsx)(R.A,{sx:{fontSize:{xs:18,sm:22}}})})}),(0,q.jsx)(I.A,{title:"Help & Support",children:(0,q.jsx)(W.A,{color:"inherit",size:"small",onClick:()=>b("/contact"),sx:{display:{xs:"none",md:"inline-flex"},p:{xs:.5,sm:1},"&:hover":{backgroundColor:"#1e293b"}},children:(0,q.jsx)(O.A,{sx:{fontSize:{xs:18,sm:22}}})})}),(0,q.jsx)(I.A,{title:"Profile menu",children:(0,q.jsxs)(X,{onClick:e=>{S(e.currentTarget)},children:[(0,q.jsx)(z.A,{sx:{width:{xs:28,sm:32},height:{xs:28,sm:32},backgroundColor:"#3b82f6",fontSize:{xs:12,sm:14},fontWeight:600,cursor:"pointer","&:hover":{backgroundColor:"#2563eb"}},children:ee().split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2)}),(0,q.jsxs)(x.A,{sx:{display:{xs:"none",md:"block"}},children:[(0,q.jsx)(p.A,{variant:"body2",sx:{color:"#f8fafc",fontWeight:600,fontSize:{sm:13,md:14}},noWrap:!0,children:ee()}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"#94a3b8"},children:(null===A||void 0===A?void 0:A.role)||"User"})]}),(0,q.jsx)(F.A,{sx:{display:{xs:"none",sm:"block"},fontSize:{xs:16,sm:18},color:"#94a3b8"}})]})}),(0,q.jsxs)(D.A,{anchorEl:w,open:Boolean(w),onClose:te,PaperProps:{sx:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:1,minWidth:280}},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[(0,q.jsx)(j.A,{disabled:!0,children:(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"body2",sx:{fontWeight:600},children:ee()}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"#94a3b8"},children:null===A||void 0===A?void 0:A.email})]})}),(0,q.jsx)(M.A,{sx:{borderColor:"#334155",my:1}}),(0,q.jsxs)(j.A,{onClick:()=>re("/dashboard/settings"),children:[(0,q.jsx)(R.A,{sx:{mr:1,fontSize:18}}),(0,q.jsx)(p.A,{variant:"body2",children:"Settings"})]}),(0,q.jsxs)(j.A,{onClick:()=>re("/dashboard"),children:[(0,q.jsx)(B.A,{sx:{mr:1,fontSize:18}}),(0,q.jsx)(p.A,{variant:"body2",children:"Dashboard Home"})]}),(0,q.jsx)(M.A,{sx:{borderColor:"#334155",my:1}}),(0,q.jsxs)(j.A,{onClick:async()=>{te(),await f(),b("/")},children:[(0,q.jsx)(U.A,{sx:{mr:1,fontSize:18,color:"#ef4444"}}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"#ef4444"},children:"Logout"})]})]})]})]})})}var ee=i(92860),te=i(10614),ie=i(61106),re=i(12414),ne=i(80727),se=i(80218),oe=i(6732),ae=i(65250),le=i(47371),de=i(81211),ce=i(46563),ue=i(10873),xe=i(6768),he=i(47445),me=i(71698),pe=i(60457),ge=i(38812),be=i(73064),ve=i(63186),Ae=i(92182),je=i(9013),ye=i(84453),fe=i(40131),we=i(65124),Se=i(5606);const ke=()=>{const e=(0,d.Zp)(),t=(0,d.zy)(),{logout:i,userRole:r}=(0,L.A)(),s=(e=>{const t="admin"===e?[]:[{text:"Home",icon:(0,q.jsx)(de.A,{}),path:"/dashboard",category:"navigation"}],i={admin:[{text:"Analytics",icon:(0,q.jsx)(ge.A,{}),path:"/dashboard/analytics",category:"admin"},{text:"Users",icon:(0,q.jsx)(ce.A,{}),path:"/dashboard/users",category:"admin"},{text:"Gadgets",icon:(0,q.jsx)(he.A,{}),path:"/dashboard/gadgets",category:"admin"},{text:"Trade-Ins Admin",icon:(0,q.jsx)(he.A,{}),path:"/dashboard/trade-ins-admin",category:"admin"},{text:"Applications",icon:(0,q.jsx)(be.A,{}),path:"/dashboard/applications",category:"admin"},{text:"Orders",icon:(0,q.jsx)(me.A,{}),path:"/dashboard/orders",category:"admin"},{text:"Installments",icon:(0,q.jsx)(pe.A,{}),path:"/dashboard/installments",category:"admin"},{text:"Subscriptions",icon:(0,q.jsx)(Ae.A,{}),path:"/dashboard/subscriptions",category:"admin"}],seller:[{text:"My Listings",icon:(0,q.jsx)(he.A,{}),path:"/dashboard/listings",category:"seller"},{text:"Add Listing",icon:(0,q.jsx)(ue.A,{}),path:"/dashboard/add-listing",category:"seller"},{text:"Orders",icon:(0,q.jsx)(me.A,{}),path:"/dashboard/orders",category:"seller"}],buyer:[{text:"Orders",icon:(0,q.jsx)(me.A,{}),path:"/dashboard/orders",category:"buyer"},{text:"Applications",icon:(0,q.jsx)(be.A,{}),path:"/dashboard/applications",category:"buyer"},{text:"Installments",icon:(0,q.jsx)(pe.A,{}),path:"/dashboard/installments",category:"buyer"},{text:"Receipts",icon:(0,q.jsx)(ve.A,{}),path:"/dashboard/receipts",category:"buyer"}]},r=[{text:"Settings",icon:(0,q.jsx)(R.A,{}),path:"/dashboard/settings",category:"account"},{text:"About",icon:(0,q.jsx)(xe.A,{}),path:"/dashboard/about",category:"account"},{text:"Sign Out",icon:(0,q.jsx)(U.A,{}),path:"/",category:"account"}],n=[...t];return i[e]&&n.push(...i[e]),n.push(...r),n})(r||"buyer"),o=s.reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{}),a=["navigation","admin","seller","buyer","account"],l=[...a.filter(e=>o[e]).map(e=>[e,o[e]]),...Object.entries(o).filter(e=>{let[t]=e;return!a.includes(t)})],c={navigation:"Navigation",admin:"Admin Tools",seller:"Seller Tools",buyer:"My Account",account:"Account"};return(0,q.jsxs)(n.Fragment,{children:[l.map(r=>{let[s,o]=r;return(0,q.jsxs)(n.Fragment,{children:["navigation"!==s&&(0,q.jsx)(re.A,{sx:{color:"#7b90b0",fontSize:"0.72rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.6px",pt:1.4,pb:.35,px:1.5,bgcolor:"transparent"},children:c[s]||s}),o.map(r=>{const n="Sign Out"===r.text,s=e=>{if(!e)return"/";const t=e.replace(/\/+$/,"");return""===t?"/":t},o=s(t.pathname),a=s(r.path),l="/"===a?"/"===o:"/dashboard"===a?"/dashboard"===o:o===a||o.startsWith(a+"/");return(0,q.jsxs)(ee.A,{sx:{mx:1,mb:.35,borderRadius:2,py:.95,px:1.2,alignItems:"center",background:l?"linear-gradient(90deg, rgba(72, 206, 219, 0.22), rgba(72, 206, 219, 0.05))":"transparent",border:l?"1px solid rgba(72, 206, 219, 0.45)":"1px solid rgba(255,255,255,0.04)",boxShadow:l?"0 4px 12px rgba(72, 206, 219, 0.15)":"none",transition:"all 0.2s ease","&:hover":{backgroundColor:n?"rgba(239, 68, 68, 0.12)":"rgba(72, 206, 219, 0.12)",border:n?"1px solid rgba(239, 68, 68, 0.3)":"1px solid rgba(72, 206, 219, 0.35)",transform:"translateY(-1px)"}},onClick:async()=>{"Sign Out"===r.text?(await i(),e("/")):e(r.path)},children:[(0,q.jsx)(te.A,{sx:{color:n?"#EF4444":l?"#48cedb":"#9ca9c4",minWidth:36,transition:"color 0.2s ease, transform 0.2s ease",fontSize:"1.1rem"},children:r.icon}),(0,q.jsx)(ie.A,{primary:r.text,sx:{"& .MuiListItemText-primary":{color:n?"#EF4444":l?"#e2f8fb":"#d0d7e4",fontWeight:l?700:500,fontSize:"0.92rem",letterSpacing:"0.01em"}}})]},r.text)}),"account"!==s&&(0,q.jsx)(M.A,{sx:{my:"navigation"===s?.5:.9,mx:1,bgcolor:"#243347",opacity:.5}})]},s)}),(0,q.jsx)(Ce,{})]})},Ce=()=>{const[e,t]=(0,n.useState)(!1),[i,r]=(0,n.useState)(null),[s,o]=(0,n.useState)(!1),a=[{id:"getting-started",title:"Getting Started",icon:(0,q.jsx)(we.A,{}),content:"Learn the basics of using XtraPush. Navigate your dashboard, place orders, and manage your devices."},{id:"orders-payments",title:"Orders & Payments",icon:(0,q.jsx)(me.A,{}),content:"Understand how to track your orders, manage payments, and set up installment plans."},{id:"devices-tradeins",title:"Devices & Trade-Ins",icon:(0,q.jsx)(he.A,{}),content:"Manage your device inventory and learn how to trade in your old gadgets for value."},{id:"subscriptions",title:"Subscriptions & Insurance",icon:(0,q.jsx)(me.A,{}),content:"Explore our XtraPush Plus and Premium plans with insurance coverage."},{id:"contact",title:"Contact Support",icon:(0,q.jsx)(fe.A,{}),content:"Reach out to our support team. Email: conrad@itsxtrapush.com | Call: +265-994-385706"},{id:"bugs",title:"Report an Issue",icon:(0,q.jsx)(Se.A,{}),content:"Found a bug or have a suggestion? Let us know so we can improve your experience."}];return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(M.A,{sx:{my:1.25,bgcolor:"#243347",opacity:.65}}),(0,q.jsxs)(x.A,{sx:{px:1},children:[(0,q.jsxs)(ee.A,{onClick:()=>o(!s),sx:{borderRadius:2,bgcolor:"rgba(72, 206, 219, 0.08)",border:"1px solid rgba(72, 206, 219, 0.25)",boxShadow:"0 8px 24px rgba(0,0,0,0.18)","&:hover":{bgcolor:"rgba(72, 206, 219, 0.15)",transform:"translateY(-1px)"},mb:1},children:[(0,q.jsx)(te.A,{sx:{color:"#48cedb",minWidth:40},children:(0,q.jsx)(O.A,{})}),(0,q.jsx)(ie.A,{primary:"Help & Support",sx:{"& .MuiListItemText-primary":{color:"#48cedb",fontWeight:600,fontSize:"0.95rem"}}}),s?(0,q.jsx)(je.A,{sx:{color:"#48cedb"}}):(0,q.jsx)(ye.A,{sx:{color:"#48cedb"}})]}),(0,q.jsx)(ne.A,{in:s,children:(0,q.jsx)(x.A,{sx:{pl:2,pr:1,py:1},children:a.map(e=>(0,q.jsxs)(ee.A,{onClick:()=>{r(e),t(!0)},sx:{py:1,px:1.25,borderRadius:1.5,bgcolor:"rgba(255,255,255,0.03)","&:hover":{bgcolor:"rgba(72, 206, 219, 0.15)"},mb:.5,border:"1px solid rgba(72, 206, 219, 0.18)"},children:[(0,q.jsx)(te.A,{sx:{color:"#48cedb",minWidth:32,fontSize:"1.1rem"},children:e.icon}),(0,q.jsx)(ie.A,{primary:e.title,primaryTypographyProps:{variant:"body2",sx:{color:"rgba(255,255,255,0.9)",fontWeight:500,fontSize:"0.85rem"}}})]},e.id))})})]}),(0,q.jsxs)(se.A,{open:e,onClose:()=>t(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{bgcolor:"rgba(5, 19, 35, 0.95)",border:"1px solid rgba(72, 206, 219, 0.3)"}},children:[(0,q.jsxs)(oe.A,{sx:{color:"#48cedb",fontWeight:700,display:"flex",alignItems:"center",gap:1},children:[null===i||void 0===i?void 0:i.icon,null===i||void 0===i?void 0:i.title]}),(0,q.jsxs)(ae.A,{sx:{py:2,color:"rgba(255,255,255,0.9)"},children:[(0,q.jsx)(p.A,{variant:"body2",sx:{mb:2},children:null===i||void 0===i?void 0:i.content}),"contact"===(null===i||void 0===i?void 0:i.id)&&(0,q.jsxs)(x.A,{sx:{bgcolor:"rgba(72, 206, 219, 0.12)",p:2,borderRadius:1,border:"1px solid rgba(72, 206, 219, 0.3)"},children:[(0,q.jsxs)(p.A,{variant:"caption",sx:{display:"block",mb:1},children:[(0,q.jsx)("strong",{children:"UK Support:"})," +44-7506-369609"]}),(0,q.jsxs)(p.A,{variant:"caption",sx:{display:"block",mb:1},children:[(0,q.jsx)("strong",{children:"Malawi Support:"})," +265-994-385706"]}),(0,q.jsxs)(p.A,{variant:"caption",children:[(0,q.jsx)("strong",{children:"Email:"})," conrad@itsxtrapush.com"]})]})]}),(0,q.jsxs)(le.A,{sx:{p:2},children:[(0,q.jsx)(f.A,{onClick:()=>t(!1),sx:{color:"#48cedb"},children:"Close"}),"bugs"===(null===i||void 0===i?void 0:i.id)&&(0,q.jsx)(f.A,{variant:"contained",sx:{bgcolor:"#48cedb",color:"#051323"},onClick:()=>window.location.href="mailto:conrad@itsxtrapush.com?subject=Bug Report",children:"Report Now"})]})]})]})};var Pe=i(86057),Ie=i(6503),We=i(25269),_e=i(87631),De=i(50943),Me=i(33588),ze=i(48767),Ne=i(39172),Be=i(94305),Fe=i(45774);const Ee=function(e){return(0,q.jsx)(p.A,{component:"h2",variant:"h6",color:"primary",gutterBottom:!0,children:e.children})};var Te=i(45530),Re=i(69335),Oe=i(86507),Ue=i(90641);function Le(){const{user:e,isAdmin:t}=(0,L.A)(),{currency:i,isInMalawi:r}=(0,Re.e)(),[s,o]=(0,n.useState)([]),[a,l]=(0,n.useState)(!1),[d,c]=(0,n.useState)(null),[u,h]=(0,n.useState)(null),[m,g]=(0,n.useState)(null),b=(0,n.useRef)(null),[A,j]=(0,n.useState)(!1),[y,w]=(0,n.useState)(null),S=e=>{const t=(e||"").toUpperCase();return"GBP"===t||"MWK"===t?t:r?"MWK":"GBP"},k=(e,t)=>{const i=S(t),r=((e,t)=>{const i=S(t),r=Number(e);return Number.isFinite(r)?"GBP"===i&&Math.abs(r)>=2e4?r/100:r:0})(e,i);return new Intl.NumberFormat("GBP"===i?"en-GB":"en-MW",{style:"currency",currency:i,maximumFractionDigits:"MWK"===i?0:2}).format(r)};return(0,n.useEffect)(()=>{(async()=>{const i=(null===e||void 0===e?void 0:e.uid)||(null===e||void 0===e?void 0:e.id)||null,r=t(),n="admin_system_default"===i,s=r||n;if(s||i){l(!0),c(null);try{const e=s?await Te.gH.getAllOrders():await Te.gH.getUserOrders(i);if(null===e||void 0===e||!e.success)throw new Error((null===e||void 0===e?void 0:e.error)||"Failed to fetch orders");o(e.orders||[])}catch(u){var a;const e=null===u||void 0===u||null===(a=u.response)||void 0===a?void 0:a.status,t=s?"/admin/orders":i?"/orders/user/".concat(i):"/orders/user/:uid";if(console.error("Orders fetch error:",{error:u,status:e,endpointPath:t}),r&&404===e&&i&&!n)try{const e=await Te.gH.getUserOrders(i);null!==e&&void 0!==e&&e.success?(o(e.orders||[]),h("Admin endpoint unavailable; showing your orders only."),c(null)):c((null===e||void 0===e?void 0:e.error)||"Orders API endpoint not found (404) for ".concat(t,"."))}catch(x){console.error("Fallback user orders fetch error:",x),c("Orders API endpoint not found (404) for ".concat(t,"."))}else{var d;let i;i=404===e?"Orders API endpoint not found (404) for ".concat(t,"."):401===e||403===e?"Access denied (".concat(e,"). Please ensure you are logged in with the correct permissions."):e>=500?"Server error (".concat(e,"). Please try again later."):!e&&null!==u&&void 0!==u&&null!==(d=u.message)&&void 0!==d&&d.includes("Network")?"Network error while contacting the API.":(null===u||void 0===u?void 0:u.message)||"Failed to fetch orders",c(i)}}finally{l(!1)}}})()},[e,t]),(0,q.jsxs)(n.Fragment,{children:[(0,q.jsx)(Ee,{children:t()?"All Orders":"My Orders"}),(0,q.jsxs)(v.A,{sx:{p:2},children:[u&&(0,q.jsx)(Pe.A,{severity:"warning",sx:{mb:2},children:u}),a&&(0,q.jsx)(x.A,{sx:{display:"flex",justifyContent:"center",p:2},children:(0,q.jsx)(Ie.A,{})}),d&&(0,q.jsx)(Pe.A,{severity:"error",sx:{mb:2},children:d}),!a&&!d&&(0,q.jsx)(We.A,{sx:{width:"100%",overflowX:"auto"},children:(0,q.jsxs)(_e.A,{size:"small",sx:{minWidth:720},children:[(0,q.jsx)(De.A,{children:(0,q.jsxs)(Me.A,{children:[(0,q.jsx)(ze.A,{children:"Order ID"}),t()&&(0,q.jsx)(ze.A,{children:"User"}),(0,q.jsx)(ze.A,{children:"Date"}),(0,q.jsx)(ze.A,{children:"Status"}),(0,q.jsx)(ze.A,{children:"Payment"}),(0,q.jsx)(ze.A,{children:"Items"}),(0,q.jsx)(ze.A,{align:"right",children:"Total"}),(0,q.jsx)(ze.A,{align:"right",children:"Actions"})]})}),(0,q.jsx)(Ne.A,{children:0===s.length?(0,q.jsx)(Me.A,{children:(0,q.jsx)(ze.A,{colSpan:t()?8:7,align:"center",children:"No orders yet."})}):s.map(e=>{var r;return(0,q.jsxs)(Me.A,{children:[(0,q.jsxs)(ze.A,{children:["#",e.id]}),t()&&(0,q.jsxs)(ze.A,{children:[(0,q.jsx)(p.A,{variant:"body2",children:e.userEmail||"\u2014"}),e.userName&&(0,q.jsx)(p.A,{variant:"caption",color:"text.secondary",children:e.userName})]}),(0,q.jsx)(ze.A,{children:new Date(e.createdAt).toLocaleString()}),(0,q.jsx)(ze.A,{children:(0,q.jsx)(Be.A,{label:"pre_order"===e.status?"PRE-ORDER":e.status||"pending",size:"small",sx:{bgcolor:"pre_order"===e.status?"#f59e0b":void 0,color:"pre_order"===e.status?"white":void 0,fontWeight:"pre_order"===e.status?700:void 0}})}),(0,q.jsx)(ze.A,{children:(0,q.jsx)(Be.A,{label:e.paymentStatus||"unpaid",color:"paid"===e.paymentStatus?"success":"default",size:"small"})}),(0,q.jsx)(ze.A,{children:Array.isArray(e.items)&&e.items.map((t,r)=>(0,q.jsxs)(x.A,{sx:{display:"flex",gap:1,alignItems:"center",mb:.5},children:[(0,q.jsx)("img",{src:t.image,alt:t.name,style:{width:32,height:32,borderRadius:4}}),(0,q.jsxs)(x.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,q.jsxs)(p.A,{variant:"body2",children:[t.name," x",t.quantity," (",t.brand," ",t.model,")"]}),(0,q.jsxs)(p.A,{variant:"caption",color:"text.secondary",children:[t.storage?"Storage: ".concat(t.storage):"Storage: \u2014","undefined"!==typeof t.variantId&&null!==t.variantId?" \u2022 Variant #".concat(t.variantId):"","undefined"!==typeof t.unitPrice?" \u2022 Unit: ".concat(k(t.unitPrice,t.currency||e.currency||i)):""]})]})]},r))}),(0,q.jsx)(ze.A,{align:"right",children:k(null!==(r=e.totalAmount)&&void 0!==r?r:e.total_amount,e.currency||i)}),(0,q.jsxs)(ze.A,{align:"right",children:[(0,q.jsx)(f.A,{variant:"outlined",size:"small",onClick:async()=>{g(e),setTimeout(async()=>{b.current&&await(0,Ue.i)(b.current,"Order-".concat(e.id,".pdf"))},0)},children:"Download PDF"}),(0,q.jsx)(f.A,{variant:"contained",size:"small",sx:{ml:1},onClick:async()=>{g(e),setTimeout(async()=>{if(b.current){const e=await(0,Ue.$)(b.current);w(e),j(!0)}},0)},children:"View PDF"})]})]},e.id)})})]})}),(0,q.jsx)(x.A,{sx:{position:"absolute",left:-9999,top:-9999},children:m&&(0,q.jsx)(Oe.A,{ref:b,order:m})})]}),(0,q.jsxs)(se.A,{open:A,onClose:()=>{if(j(!1),y){try{URL.revokeObjectURL(y)}catch(e){}w(null)}},fullWidth:!0,maxWidth:"md",children:[(0,q.jsxs)(oe.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:["Order PDF Preview",(0,q.jsx)(W.A,{"aria-label":"close",onClick:()=>{if(j(!1),y){try{URL.revokeObjectURL(y)}catch(e){}w(null)}},children:(0,q.jsx)(Fe.A,{})})]}),(0,q.jsx)(ae.A,{dividers:!0,children:y?(0,q.jsx)("iframe",{title:"Order PDF",src:y,style:{width:"100%",height:"80vh",border:"none"}}):(0,q.jsx)(x.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,q.jsx)(Ie.A,{})})})]})]})}var qe=i(98506),Ge=i(20744),Ve=i(20615),He=i(87209),Ke=i(65812),Qe=i(85935),Ye=i(31760);function Xe(e){var t,i,r,n,s,o,a,l,d,c,u,x;const h=function(e){if(!e)return null;if("object"===typeof e)return e;try{return JSON.parse(e)}catch(t){return null}}(null===e||void 0===e?void 0:e.notes),m=(null===h||void 0===h?void 0:h.installmentPlan)||h||null,p=(null===e||void 0===e?void 0:e.createdAt)||(null===e||void 0===e?void 0:e.created_at),g=(null===e||void 0===e?void 0:e.paidAt)||(null===e||void 0===e?void 0:e.paid_at),b=Number(null!==(t=null!==(i=null===e||void 0===e?void 0:e.totalAmount)&&void 0!==i?i:null===e||void 0===e?void 0:e.total_amount)&&void 0!==t?t:0),v=Number(null!==(r=null!==(n=null===m||void 0===m?void 0:m.depositAmount)&&void 0!==n?n:null===m||void 0===m?void 0:m.deposit)&&void 0!==r?r:0),A=Number(null!==(s=null!==(o=null!==(a=null===m||void 0===m?void 0:m.weeks)&&void 0!==a?a:null===m||void 0===m?void 0:m.durationWeeks)&&void 0!==o?o:null===m||void 0===m?void 0:m.duration)&&void 0!==s?s:0),j=Number(null!==(l=null!==(d=null===m||void 0===m?void 0:m.weeklyAmount)&&void 0!==d?d:null===m||void 0===m?void 0:m.weekly)&&void 0!==l?l:Math.ceil(Math.max(b-v,0)/(A||1))),y=Number(null!==(c=null===m||void 0===m?void 0:m.amountPaid)&&void 0!==c?c:null!==m&&void 0!==m&&m.partials?m.partials.reduce((e,t)=>e+Number((null===t||void 0===t?void 0:t.amount)||0),0)+v:v),f=Math.max(Number(null!==(u=null===m||void 0===m?void 0:m.totalAmount)&&void 0!==u?u:b)-y,0),w=g||p,S=w?new Date(new Date(w).getTime()+7*A*24*60*60*1e3):null,k=f<=0?"paid":"ongoing";return{raw:m,weeks:A,weeklyAmount:j,depositAmount:v,amountPaid:y,remainingAmount:f,totalAmount:Number(null!==(x=null===m||void 0===m?void 0:m.totalAmount)&&void 0!==x?x:b),startDate:w,expiryDate:S,status:k}}const Je=e=>{let{open:t,onClose:i,order:r,customerEmail:s,initialPayMode:o="weekly",initialCustomAmount:a=null}=e;const[l,c]=(0,n.useState)(!1),[u,h]=(0,n.useState)(""),[m,g]=(0,n.useState)(o),[b,v]=(0,n.useState)(()=>"number"===typeof a&&a>0?Math.round(a):0),{userProfile:y}=(0,L.A)(),{currency:w}=(0,Re.e)(),S=(0,d.Zp)(),k=(0,Ve.A)("(max-width:600px)"),C=(0,n.useMemo)(()=>Xe(r||{}),[r]),P=Math.round(Number((null===C||void 0===C?void 0:C.weeklyAmount)||0)),I=Math.round(Number((null===C||void 0===C?void 0:C.remainingAmount)||0)),W="paid"===(null===C||void 0===C?void 0:C.status)||P<=0&&I<=0,_="weekly"===m?P:"remaining"===m?I:Math.round(Number(b||0));return t?(0,q.jsxs)(se.A,{open:t,onClose:i,maxWidth:"sm",fullWidth:!0,disableEscapeKeyDown:!0,ModalProps:{keepMounted:!0,disableEnforceFocus:!0,disableRestoreFocus:!0},PaperProps:{sx:{bgcolor:"#1565c0",color:"white",borderRadius:"20px",maxHeight:"90vh"}},children:[(0,q.jsxs)(oe.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(Ye.A,{}),"Pay Installment"]}),(0,q.jsxs)(ae.A,{sx:{color:"rgba(255,255,255,0.92)"},children:[(0,q.jsxs)(x.A,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,mb:2},children:[(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"caption",sx:{opacity:.8},children:"Weekly amount"}),(0,q.jsxs)(p.A,{variant:"body1",children:["MWK ",P.toLocaleString()]})]}),(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"caption",sx:{opacity:.8},children:"Remaining balance"}),(0,q.jsxs)(p.A,{variant:"body1",children:["MWK ",I.toLocaleString()]})]})]}),(0,q.jsxs)(He.A,{size:"small",sx:{minWidth:180},children:[(0,q.jsx)(Ke.A,{sx:{color:"white"},children:"Payment amount"}),(0,q.jsx)(Qe.A,{value:m,label:"Payment amount",onChange:e=>g(e.target.value),native:k,sx:k?{bgcolor:"white",color:"#111",borderRadius:1}:{color:"white","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.5)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"white"}},MenuProps:{disablePortal:!0,disableScrollLock:!0,PaperProps:{sx:{bgcolor:"#1565c0",color:"white"}}},children:k?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("option",{value:"weekly",children:["Weekly installment (MWK ",P.toLocaleString(),")"]}),(0,q.jsxs)("option",{value:"remaining",children:["Pay remaining balance (MWK ",I.toLocaleString(),")"]}),(0,q.jsx)("option",{value:"custom",children:"Pay custom amount"})]}):(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(j.A,{value:"weekly",children:["Weekly installment (MWK ",P.toLocaleString(),")"]}),(0,q.jsxs)(j.A,{value:"remaining",children:["Pay remaining balance (MWK ",I.toLocaleString(),")"]}),(0,q.jsx)(j.A,{value:"custom",children:"Pay custom amount"})]})})]}),"custom"===m&&(0,q.jsxs)(x.A,{sx:{mt:2},children:[(0,q.jsx)(p.A,{variant:"caption",sx:{opacity:.8},children:"Enter amount (MWK)"}),(0,q.jsx)(A.A,{type:"number",value:b,onChange:e=>v(e.target.value),size:"small",fullWidth:!0,inputProps:{min:0,step:100},sx:{mt:.5,bgcolor:"white",borderRadius:1}}),(0,q.jsxs)(p.A,{variant:"caption",sx:{mt:.5,display:"block"},children:["Max: MWK ",I.toLocaleString()]})]}),u?(0,q.jsx)(p.A,{color:"error",variant:"body2",sx:{mt:2},children:u}):null]}),(0,q.jsxs)(le.A,{sx:{p:2},children:[(0,q.jsx)(f.A,{onClick:i,variant:"contained",disabled:l,sx:{bgcolor:"#000",color:"white","&:hover":{bgcolor:"#111"}},children:"Cancel"}),(0,q.jsx)(f.A,{variant:"contained",onClick:async()=>{const e=((null===y||void 0===y?void 0:y.phone)||"").trim();if(/^\+265\d{9}$/.test(e)){if("custom"===m){const e=Math.round(Number(b||0));if(!Number.isFinite(e)||e<=0)return void h("Enter a valid custom amount greater than 0.");if(I>0&&e>I)return void h("Custom amount cannot exceed remaining balance.")}try{c(!0),h("");const e=[{id:"order:".concat(null===r||void 0===r?void 0:r.id),name:"weekly"===m?"Weekly Installment Payment":"remaining"===m?"Final Installment Payment":"Custom Installment Payment",price:Math.round(_),quantity:1}],t={enabled:!0,paymentType:"installment_payment",orderId:null===r||void 0===r?void 0:r.id,weeks:Number((null===C||void 0===C?void 0:C.weeks)||0),weeklyAmount:P,remainingAmount:I,totalAmount:Math.round(Number((null===C||void 0===C?void 0:C.totalAmount)||0)),payAmount:Math.round(_),payMode:m},n={customerEmail:s||null,successUrl:"https://itsxtrapush.com/payment/success",cancelUrl:"https://itsxtrapush.com/payment/cancel",installmentPlan:t,currency:w},o=await Te.a5.createCheckoutSession(e,n);if(null!==o&&void 0!==o&&o.success&&null!==o&&void 0!==o&&o.url){try{localStorage.setItem("xp_lastCheckout",JSON.stringify({items:e,installmentPlan:t,customerEmail:s||null}))}catch(i){}window.location.href=o.url}else if(null!==o&&void 0!==o&&o.url){try{localStorage.setItem("xp_lastCheckout",JSON.stringify({items:e,installmentPlan:t,customerEmail:s||null}))}catch(i){}window.location.href=o.url}else h((null===o||void 0===o?void 0:o.error)||"Failed to create checkout session")}catch(n){var t;console.error("Installment payment checkout failed:",n);const e=null===n||void 0===n||null===(t=n.response)||void 0===t?void 0:t.data;h((null===e||void 0===e?void 0:e.details)||(null===e||void 0===e?void 0:e.error)||(null===n||void 0===n?void 0:n.message)||"Unexpected error")}finally{c(!1)}}else{h("Please add an active phone number (+265 followed by 9 digits) in Profile Settings before making an installment payment.");try{S("/dashboard/settings")}catch(i){}}},disabled:l||W||_<=0,sx:{bgcolor:"#000",color:"white","&:hover":{bgcolor:"#111"}},children:"Proceed"})]})]}):null};var Ze=i(45418);function $e(e){if(!e)return null;if("object"===typeof e)return e;try{return JSON.parse(e)}catch(t){return null}}function et(){const{user:e,isAdmin:t,userProfile:i}=(0,L.A)(),{currency:s,isInMalawi:o}=(0,Re.e)(),[a,l]=(0,n.useState)([]),[c,u]=(0,n.useState)(!1),[h,m]=(0,n.useState)(null),[g,b]=(0,n.useState)(null),A=(0,d.Zp)(),[j,y]=(0,n.useState)(!1),[w,S]=(0,n.useState)(null),[k,C]=(0,n.useState)(!1),[P,W]=(0,n.useState)({}),[_,D]=(0,n.useState)(null),M=(0,n.useRef)(null),z=(0,Ze.useReactToPrint)({content:()=>M.current});(0,n.useEffect)(()=>{(async()=>{const i=(null===e||void 0===e?void 0:e.uid)||(null===e||void 0===e?void 0:e.id)||null,r=t(),n="admin_system_default"===i,s=r||n;if(s||i){u(!0),m(null),b(null);try{const e=s?await Te.gH.getAllOrders():await Te.gH.getUserOrders(i);if(null===e||void 0===e||!e.success)throw new Error((null===e||void 0===e?void 0:e.error)||"Failed to fetch installments");{const t=(e.orders||[]).filter(e=>{const t=$e(null===e||void 0===e?void 0:e.notes);return!!(null!==t&&void 0!==t&&t.installmentPlan||"installment_deposit"===(null===t||void 0===t?void 0:t.paymentType)||"installment_payment"===(null===t||void 0===t?void 0:t.paymentType))});l(t);try{const e={};for(const i of t){var o;const t=await Te.hf.getPlanByOrder(i.id);null!==t&&void 0!==t&&t.success&&null!==t&&void 0!==t&&null!==(o=t.data)&&void 0!==o&&o.plan&&(e[i.id]=t.data)}W(e)}catch(c){}}}catch(x){var a;const e=null===x||void 0===x||null===(a=x.response)||void 0===a?void 0:a.status,t=s?"/admin/orders":i?"/orders/user/".concat(i):"/orders/user/:uid";if(console.error("Installments fetch error:",{error:x,status:e,endpointPath:t}),r&&404===e&&i&&!n)try{const e=await Te.gH.getUserOrders(i);if(null!==e&&void 0!==e&&e.success){const t=(e.orders||[]).filter(e=>{const t=$e(null===e||void 0===e?void 0:e.notes);return!!(null!==t&&void 0!==t&&t.installmentPlan||"installment_deposit"===(null===t||void 0===t?void 0:t.paymentType)||"installment_payment"===(null===t||void 0===t?void 0:t.paymentType))});l(t),b("Admin endpoint unavailable; showing your installments only."),m(null)}else m((null===e||void 0===e?void 0:e.error)||"Orders API endpoint not found (404) for ".concat(t,"."))}catch(h){console.error("Fallback installments fetch error:",h),m("Orders API endpoint not found (404) for ".concat(t,"."))}else{var d;let i;i=404===e?"Orders API endpoint not found (404) for ".concat(t,"."):401===e||403===e?"Access denied (".concat(e,"). Please ensure you are logged in with the correct permissions."):e>=500?"Server error (".concat(e,"). Please try again later."):!e&&null!==x&&void 0!==x&&null!==(d=x.message)&&void 0!==d&&d.includes("Network")?"Network error while contacting the API.":(null===x||void 0===x?void 0:x.message)||"Failed to fetch installments",m(i)}}finally{u(!1)}}})()},[e,t]);const N=e=>{const t=(e||"").toUpperCase();return"GBP"===t||"MWK"===t?t:o?"MWK":"GBP"},B=(e,t)=>{const i=N(t),r=((e,t)=>{const i=N(t),r=Number(e);return Number.isFinite(r)?"GBP"===i&&Math.abs(r)>=2e4?r/100:r:0})(e,i),n="MWK"!==i||o?r:(0,Ge.FX)(r),s="MWK"!==i||o?i:"GBP";return new Intl.NumberFormat("GBP"===s?"en-GB":"en-MW",{style:"currency",currency:s,maximumFractionDigits:"MWK"===s?0:2}).format(n)},F=(0,n.useMemo)(()=>a.map(e=>{const t=function(e){var t,i,r,n,s,o,a,l,d,c,u,x;const h=$e(null===e||void 0===e?void 0:e.notes),m=(null===h||void 0===h?void 0:h.installmentPlan)||h||null,p=(null===e||void 0===e?void 0:e.createdAt)||(null===e||void 0===e?void 0:e.created_at),g=(null===e||void 0===e?void 0:e.paidAt)||(null===e||void 0===e?void 0:e.paid_at),b=Number(null!==(t=null!==(i=null===e||void 0===e?void 0:e.totalAmount)&&void 0!==i?i:null===e||void 0===e?void 0:e.total_amount)&&void 0!==t?t:0),v=Number(null!==(r=null!==(n=null===m||void 0===m?void 0:m.depositAmount)&&void 0!==n?n:null===m||void 0===m?void 0:m.deposit)&&void 0!==r?r:0),A=Number(null!==(s=null!==(o=null!==(a=null===m||void 0===m?void 0:m.weeks)&&void 0!==a?a:null===m||void 0===m?void 0:m.durationWeeks)&&void 0!==o?o:null===m||void 0===m?void 0:m.duration)&&void 0!==s?s:0),j=Number(null!==(l=null!==(d=null===m||void 0===m?void 0:m.weeklyAmount)&&void 0!==d?d:null===m||void 0===m?void 0:m.weekly)&&void 0!==l?l:Math.ceil(Math.max(b-v,0)/(A||1))),y=Number(null!==(c=null===m||void 0===m?void 0:m.amountPaid)&&void 0!==c?c:null!==m&&void 0!==m&&m.partials?m.partials.reduce((e,t)=>e+Number((null===t||void 0===t?void 0:t.amount)||0),0)+v:v),f=Math.max(Number(null!==(u=null===m||void 0===m?void 0:m.totalAmount)&&void 0!==u?u:b)-y,0),w=g||p,S=w?new Date(new Date(w).getTime()+7*A*24*60*60*1e3):null,k=f<=0?"paid":"ongoing";let C=null,P=null,I="unknown",W=0;if("paid"!==k&&w&&A>0){const e=Math.max(0,y-v),t=j>0?j:1;W=Math.min(A,Math.floor(e/t));const i=W+1,r=new Date(w);C=new Date(r.getTime()+7*i*24*60*60*1e3);const n=new Date;P=Math.ceil((C-n)/864e5),I=P<0?"overdue":0===P?"due_today":P<=3?"due_soon":"upcoming"}else"paid"===k&&(I="paid",P=0);return{raw:m,weeks:A,weeklyAmount:j,depositAmount:v,amountPaid:y,remainingAmount:f,totalAmount:Number(null!==(x=null===m||void 0===m?void 0:m.totalAmount)&&void 0!==x?x:b),startDate:w,expiryDate:S,status:k,nextDueDate:C,daysUntilDue:P,dueState:I,paymentsMade:W}}(e),i=P[e.id],r=null===i||void 0===i?void 0:i.plan;var n,o,a,l,d,c;if(r&&(t.startDate=r.start_at||t.startDate,t.expiryDate=r.expiry_at||t.expiryDate,t.nextDueDate=r.next_due_at||t.nextDueDate,t.weeks=Number(null!==(n=r.weeks)&&void 0!==n?n:t.weeks),t.weeklyAmount=Number(null!==(o=r.weekly_amount)&&void 0!==o?o:t.weeklyAmount),t.depositAmount=Number(null!==(a=r.deposit_amount)&&void 0!==a?a:t.depositAmount),t.amountPaid=Number(null!==(l=r.amount_paid)&&void 0!==l?l:t.amountPaid),t.totalAmount=Number(null!==(d=r.total_amount)&&void 0!==d?d:t.totalAmount),t.status=r.status||t.status,t.paymentsMade=Number(null!==(c=r.payments_made)&&void 0!==c?c:t.paymentsMade),t.remainingAmount=Math.max(t.totalAmount-t.amountPaid,0),"paid"!==t.status&&t.nextDueDate)){const e=new Date,i=new Date(t.nextDueDate),r=Math.ceil((i-e)/864e5);t.daysUntilDue=r,t.dueState=r<0?"overdue":0===r?"due_today":r<=3?"due_soon":"upcoming"}return{id:e.id,currency:e.currency||s,userEmail:e.userEmail,userName:e.userName,createdAt:e.createdAt,startDate:t.startDate,expiryDate:t.expiryDate,weeks:t.weeks,weeklyAmount:t.weeklyAmount,depositAmount:t.depositAmount,amountPaid:t.amountPaid,remainingAmount:t.remainingAmount,totalAmount:t.totalAmount,status:t.status,nextDueDate:t.nextDueDate,daysUntilDue:t.daysUntilDue,dueState:t.dueState,order:e}}),[a,P]);return(0,q.jsxs)(n.Fragment,{children:[(0,q.jsx)(Ee,{children:t()?"All Installments":"My Installments"}),(0,q.jsxs)(v.A,{sx:{p:2},children:[g&&(0,q.jsx)(Pe.A,{severity:"warning",sx:{mb:2},children:g}),c&&(0,q.jsx)(x.A,{sx:{display:"flex",justifyContent:"center",p:2},children:(0,q.jsx)(Ie.A,{})}),h&&(0,q.jsx)(Pe.A,{severity:"error",sx:{mb:2},children:h}),!c&&!h&&(0,q.jsx)(We.A,{sx:{width:"100%",overflowX:"auto"},children:(0,q.jsxs)(_e.A,{size:"small",sx:{minWidth:720},children:[(0,q.jsx)(De.A,{children:(0,q.jsxs)(Me.A,{children:[(0,q.jsx)(ze.A,{children:"Order ID"}),t()&&(0,q.jsx)(ze.A,{children:"User"}),(0,q.jsx)(ze.A,{children:"Start"}),(0,q.jsx)(ze.A,{children:"Expires"}),(0,q.jsx)(ze.A,{children:"Periods"}),(0,q.jsx)(ze.A,{align:"right",children:"Paid"}),(0,q.jsx)(ze.A,{align:"right",children:"Remaining"}),(0,q.jsx)(ze.A,{children:"Next Due"}),(0,q.jsx)(ze.A,{children:"Indicator"}),(0,q.jsx)(ze.A,{align:"right",children:"Progress"}),(0,q.jsx)(ze.A,{align:"right",children:"Time Left"}),(0,q.jsx)(ze.A,{children:"Status"}),(0,q.jsx)(ze.A,{align:"right",children:"Actions"})]})}),(0,q.jsx)(Ne.A,{children:0===F.length?(0,q.jsx)(Me.A,{children:(0,q.jsx)(ze.A,{colSpan:t()?11:10,align:"center",children:"No installments yet."})}):F.map(n=>{var o;return(0,q.jsxs)(Me.A,{children:[(0,q.jsxs)(ze.A,{children:["#",n.id]}),t()&&(0,q.jsxs)(ze.A,{children:[(0,q.jsx)(p.A,{variant:"body2",children:n.userEmail||"\u2014"}),n.userName&&(0,q.jsx)(p.A,{variant:"caption",color:"text.secondary",children:n.userName})]}),(0,q.jsx)(ze.A,{children:n.startDate?new Date(n.startDate).toLocaleDateString():"\u2014"}),(0,q.jsx)(ze.A,{children:n.expiryDate?new Date(n.expiryDate).toLocaleDateString():"\u2014"}),(0,q.jsxs)(ze.A,{children:[n.weeks||"\u2014"," weeks"]}),(0,q.jsx)(ze.A,{align:"right",children:B(n.amountPaid||0,n.currency)}),(0,q.jsx)(ze.A,{align:"right",children:B(n.remainingAmount||0,n.currency)}),(0,q.jsx)(ze.A,{children:n.nextDueDate?new Date(n.nextDueDate).toLocaleDateString():"\u2014"}),(0,q.jsx)(ze.A,{children:"paid"===n.status?(0,q.jsx)(Be.A,{label:"Completed",color:"success",size:"small"}):"overdue"===n.dueState?(0,q.jsx)(Be.A,{label:"Overdue by ".concat(Math.abs(n.daysUntilDue||0),"d"),color:"error",size:"small"}):"due_today"===n.dueState?(0,q.jsx)(Be.A,{label:"Due today",color:"warning",size:"small"}):(0,q.jsx)(Be.A,{label:"Due in ".concat(null!==(o=n.daysUntilDue)&&void 0!==o?o:"\u2014","d"),color:"due_soon"===n.dueState?"info":"primary",size:"small"})}),(0,q.jsx)(ze.A,{align:"right",sx:{minWidth:160},children:(()=>{const e=Number(n.totalAmount||0),t=Number(n.amountPaid||0),i=e>0?Math.min(100,Math.max(0,Math.round(t/e*100))):0,r=Number(n.paymentsMade||0),s=Number(n.weeks||0);return(0,q.jsx)(I.A,{title:"Payments: ".concat(r," of ").concat(s," | ").concat(i,"% paid"),arrow:!0,children:(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(x.A,{sx:{flexGrow:1},children:(0,q.jsx)(qe.A,{variant:"determinate",value:i,sx:{height:8,borderRadius:999}})}),(0,q.jsxs)(p.A,{variant:"caption",sx:{minWidth:40,textAlign:"right"},children:[i,"%"]})]})})})()}),(0,q.jsx)(ze.A,{align:"right",children:(()=>{if("paid"===n.status)return"\u2014";const e=new Date,t=n.expiryDate?new Date(n.expiryDate):null;if(!t||isNaN(t.getTime()))return"\u2014";const i=Math.ceil((t-e)/864e5);return i>=0?"".concat(i,"d"):"Expired"})()}),(0,q.jsx)(ze.A,{children:"paid"===n.status?(0,q.jsx)(Be.A,{label:"Completed",color:"success",size:"small"}):"cancelled"===n.status?(0,q.jsx)(Be.A,{label:"Cancelled",color:"error",size:"small"}):(0,q.jsx)(Be.A,{label:n.status||"ongoing",color:"warning",size:"small"})}),(0,q.jsx)(ze.A,{align:"right",children:(0,q.jsxs)(x.A,{sx:{display:"flex",gap:1,justifyContent:"flex-end",flexWrap:"wrap"},children:[(0,q.jsx)(f.A,{variant:"contained",size:"small",disabled:"paid"===n.status,onClick:()=>(e=>{S(e.order),y(!0)})(n),children:"Pay weekly"}),(0,q.jsx)(f.A,{variant:"contained",color:"success",size:"small",disabled:"paid"===n.status||Number(n.remainingAmount||0)<=0,onClick:()=>(async t=>{if("paid"!==t.status)try{const r=/^\+265\d{9}$/,o=((null===i||void 0===i?void 0:i.phone)||"").trim();if(!r.test(o)){m("Please add an active phone number (+265 followed by 9 digits) in Profile Settings before making an installment payment.");try{A("/dashboard/settings")}catch(n){}return}const a=Math.round(Number(t.remainingAmount||0));if(!a||a<=0)return void b("No remaining balance to pay.");const l=[{id:"order:".concat(t.id),name:"Final Installment Payment",price:a,quantity:1}],d={enabled:!0,paymentType:"installment_payment",orderId:t.id,weeks:Number(t.weeks||0),weeklyAmount:Math.round(Number(t.weeklyAmount||0)),remainingAmount:a,totalAmount:Math.round(Number(t.totalAmount||0)),payAmount:a,payMode:"remaining"},c={customerEmail:(null===e||void 0===e?void 0:e.email)||null,successUrl:"https://itsxtrapush.com/payment/success",cancelUrl:"https://itsxtrapush.com/payment/cancel",installmentPlan:d,currency:s},u=await Te.a5.createCheckoutSession(l,c);if(null!==u&&void 0!==u&&u.success&&null!==u&&void 0!==u&&u.url){try{localStorage.setItem("xp_lastCheckout",JSON.stringify({items:l,installmentPlan:d,customerEmail:(null===e||void 0===e?void 0:e.email)||null}))}catch(n){}window.location.href=u.url}else if(null!==u&&void 0!==u&&u.url){try{localStorage.setItem("xp_lastCheckout",JSON.stringify({items:l,installmentPlan:d,customerEmail:(null===e||void 0===e?void 0:e.email)||null}))}catch(n){}window.location.href=u.url}else m((null===u||void 0===u?void 0:u.error)||"Failed to create checkout session")}catch(o){var r;console.error("Pay remaining checkout failed:",o);const e=null===o||void 0===o||null===(r=o.response)||void 0===r?void 0:r.data;m((null===e||void 0===e?void 0:e.details)||(null===e||void 0===e?void 0:e.error)||(null===o||void 0===o?void 0:o.message)||"Unexpected error")}})(n),children:"Pay remaining"}),(0,q.jsx)(f.A,{variant:"outlined",size:"small",disabled:"paid"===n.status,onClick:()=>(e=>{S(e.order),y(!0)})(n),children:"Pay custom"}),t()&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(f.A,{variant:"outlined",color:"error",size:"small",disabled:k||"paid"===n.status,onClick:()=>(async i=>{if(!t())return;const n=window.prompt("Enter cancellation reason (optional):","Missed payments / revoked by admin");if(null!==n)try{C(!0);const t=(null===e||void 0===e?void 0:e.uid)||(null===e||void 0===e?void 0:e.id)||"admin_system_default",s=await Te.Er.cancelInstallment({orderId:i.id,adminUid:t,reason:n});null!==s&&void 0!==s&&s.success?(b("Installment cancelled and stock restored."),l(e=>e.map(e=>e.id===i.id?(0,r.A)((0,r.A)({},e),{},{status:"cancelled"}):e))):m((null===s||void 0===s?void 0:s.error)||"Failed to cancel installment")}catch(o){var s;const e=null===o||void 0===o||null===(s=o.response)||void 0===s?void 0:s.status;m(403===e?"Admin privileges required to cancel installments.":(null===o||void 0===o?void 0:o.message)||"Failed to cancel installment")}finally{C(!1)}})(n),children:k?"Cancelling\u2026":"Cancel"}),(0,q.jsx)(f.A,{variant:"outlined",color:"primary",size:"small",sx:{ml:1},onClick:()=>(e=>{D(e),setTimeout(()=>{try{z()}catch(e){}},50)})(n),children:"Print"})]})]})})]},n.id)})})]})})]}),(0,q.jsx)(Je,{open:j,onClose:()=>{S(null),y(!1)},order:w,customerEmail:null===e||void 0===e?void 0:e.email,initialPayMode:"custom"}),(0,q.jsx)(x.A,{sx:{display:"none"},children:_&&(0,q.jsx)(Oe.A,{ref:M,order:_.order,plan:{weeks:_.weeks,weeklyAmount:_.weeklyAmount,totalAmount:_.totalAmount,amountPaid:_.amountPaid,remainingAmount:_.remainingAmount,nextDueDate:_.nextDueDate}})})]})}var tt=i(85105),it=i(82024),rt=i(55948),nt=i(35118),st=i(13285),ot=i(89470),at=i(24184),lt=i(28637),dt=i(61908),ct=i(11481),ut=i(21815),xt=i(72716),ht=i(93570),mt=i(20795),pt=i(81095),gt=i(68354),bt=i(93245),vt=i(60158),At=i(44813),jt=i(16335),yt=i(25102),ft=i(10734),wt=i(67360),St=i(54203),kt=i(72528);function Ct(){var e,t;const{user:i,isAdmin:s}=(0,L.A)(),[o,a]=(0,n.useState)([]),[l,d]=(0,n.useState)(!1),[c,h]=(0,n.useState)(null),[g,y]=(0,n.useState)(null),[C,_]=(0,n.useState)({role:"",active:"",verifiedSeller:""}),[D,N]=(0,n.useState)(null),[B,F]=(0,n.useState)(!1),[E,T]=(0,n.useState)(0),[R,O]=(0,n.useState)(null),U=(null===i||void 0===i?void 0:i.uid)||(null===i||void 0===i?void 0:i.id)||null,G=(0,n.useMemo)(()=>({role:C.role||void 0,active:""===C.active?void 0:"true"===C.active,verifiedSeller:""===C.verifiedSeller?void 0:"true"===C.verifiedSeller,adminUid:U}),[C,U]);(0,n.useEffect)(()=>{if(!s())return;(async()=>{try{const e=o.reduce((e,t)=>{var i,r;return e.total++,null===(i=null!==(r=t.active)&&void 0!==r?r:t.isActive)||void 0===i||i?e.active++:e.inactive++,"admin"===t.userRole?e.admin++:"seller"===t.userRole?(e.seller++,t.verifiedSeller&&e.verifiedSeller++):"buyer"===t.userRole&&e.buyer++,e},{total:0,active:0,inactive:0,admin:0,seller:0,verifiedSeller:0,buyer:0}),t=[{date:"2024-01",newUsers:12,activeUsers:45},{date:"2024-02",newUsers:19,activeUsers:52},{date:"2024-03",newUsers:15,activeUsers:48},{date:"2024-04",newUsers:22,activeUsers:60},{date:"2024-05",newUsers:18,activeUsers:55},{date:"2024-06",newUsers:25,activeUsers:68}],i=[{name:"Buyers",value:e.buyer},{name:"Sellers",value:e.seller},{name:"Admins",value:e.admin}];O({userStats:e,activityData:t,roleDistribution:i})}catch(e){console.error("Error calculating analytics:",e)}})()},[o,s]),(0,n.useEffect)(()=>{if(!s())return;(async()=>{d(!0),h(null),y(null);try{const e=await Te.lu.getAllUsers(G);if(null===e||void 0===e||!e.success)throw new Error((null===e||void 0===e?void 0:e.error)||"Failed to fetch users");a(e.users||e.data||[])}catch(i){var e,t;const r=null===i||void 0===i||null===(e=i.response)||void 0===e?void 0:e.status,n="/admin/users";let s;console.error("Admin users fetch error:",{error:i,status:r,endpointPath:n}),s=404===r?"Users API endpoint not found (404) for ".concat(n,"."):401===r||403===r?"Access denied (".concat(r,"). Please ensure you are logged in with admin permissions."):r>=500?"Server error (".concat(r,"). Please try again later."):!r&&null!==i&&void 0!==i&&null!==(t=i.message)&&void 0!==t&&t.includes("Network")?"Network error while contacting the API.":(null===i||void 0===i?void 0:i.message)||"Failed to fetch users",h(s)}finally{d(!1)}})()},[G,s]);const V=async(e,t)=>{d(!0),h(null);try{var i;let n;if("deactivate"===t)n=await Te.lu.deactivate(e,U,"Admin deactivation");else if("reactivate"===t)n=await Te.lu.reactivate(e,U);else{if("close"!==t)throw new Error("Unknown action");n=await Te.lu.close(e,U,"Account closure by admin")}var r;if(null===(i=n)||void 0===i||!i.success)throw new Error((null===(r=n)||void 0===r?void 0:r.error)||"Action failed");{const e=await Te.lu.getAllUsers(G);a(e.users||e.data||[])}}catch(n){console.error("Admin action error:",n),h((null===n||void 0===n?void 0:n.message)||"Failed to perform action")}finally{d(!1)}},H=["#0088FE","#00C49F","#FFBB28","#FF8042"],K=e=>{let{title:t,value:i,icon:r,color:n,subtitle:s}=e;return(0,q.jsx)(w.A,{sx:{height:"100%",boxShadow:2,borderRadius:2},children:(0,q.jsx)(S.A,{children:(0,q.jsxs)(tt.A,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:2,children:[(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"h6",color:"textSecondary",gutterBottom:!0,children:t}),(0,q.jsx)(p.A,{variant:"h4",fontWeight:"bold",color:n||"primary.main",children:i}),s&&(0,q.jsx)(p.A,{variant:"caption",color:"textSecondary",children:s})]}),(0,q.jsx)(z.A,{sx:{bgcolor:n||"primary.main",width:56,height:56},children:r})]})})})};return(0,q.jsxs)(n.Fragment,{children:[(0,q.jsx)(Ee,{children:"Admin Dashboard - Users"}),R&&(0,q.jsxs)(b.A,{container:!0,spacing:3,sx:{mb:3},children:[(0,q.jsx)(b.A,{item:!0,xs:12,md:3,children:(0,q.jsx)(K,{title:"Total Users",value:R.userStats.total,icon:(0,q.jsx)(st.A,{}),color:"primary.main",subtitle:"All registered users"})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:3,children:(0,q.jsx)(K,{title:"Active Users",value:R.userStats.active,icon:(0,q.jsx)(ot.A,{}),color:"success.main",subtitle:"Currently active accounts"})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:3,children:(0,q.jsx)(K,{title:"Verified Sellers",value:R.userStats.verifiedSeller,icon:(0,q.jsx)(at.A,{}),color:"info.main",subtitle:"Verified seller accounts"})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:3,children:(0,q.jsx)(K,{title:"User Growth",value:"+15%",icon:(0,q.jsx)(ge.A,{}),color:"secondary.main",subtitle:"From last month"})}),(0,q.jsx)(b.A,{item:!0,xs:12,lg:8,children:(0,q.jsxs)(w.A,{sx:{height:300,p:2},children:[(0,q.jsx)(k.A,{title:"User Activity Overview"}),(0,q.jsx)(pt.u,{width:"100%",height:"80%",children:(0,q.jsxs)(gt.Q,{data:R.activityData,children:[(0,q.jsx)(bt.d,{strokeDasharray:"3 3"}),(0,q.jsx)(vt.W,{dataKey:"date"}),(0,q.jsx)(At.h,{}),(0,q.jsx)(jt.m,{}),(0,q.jsx)(yt.s,{}),(0,q.jsx)(ft.G,{type:"monotone",dataKey:"newUsers",stackId:"1",stroke:"#8884d8",fill:"#8884d8",name:"New Users"}),(0,q.jsx)(ft.G,{type:"monotone",dataKey:"activeUsers",stackId:"2",stroke:"#82ca9d",fill:"#82ca9d",name:"Active Users"})]})})]})}),(0,q.jsx)(b.A,{item:!0,xs:12,lg:4,children:(0,q.jsxs)(w.A,{sx:{height:300,p:2},children:[(0,q.jsx)(k.A,{title:"User Roles Distribution"}),(0,q.jsx)(pt.u,{width:"100%",height:"80%",children:(0,q.jsxs)(wt.r,{children:[(0,q.jsx)(St.F,{data:R.roleDistribution,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"value",label:e=>{let{name:t,percent:i}=e;return"".concat(t,": ").concat((100*i).toFixed(0),"%")},children:R.roleDistribution.map((e,t)=>(0,q.jsx)(kt.f,{fill:H[t%H.length]},"cell-".concat(t)))}),(0,q.jsx)(jt.m,{}),(0,q.jsx)(yt.s,{})]})})]})})]}),(0,q.jsx)(v.A,{sx:{p:0,mb:2},children:(0,q.jsxs)(it.A,{value:E,onChange:(e,t)=>{T(t)},"aria-label":"admin tools tabs",children:[(0,q.jsx)(rt.A,{icon:(0,q.jsx)(ue.A,{}),iconPosition:"start",label:"User Management"}),(0,q.jsx)(rt.A,{icon:(0,q.jsx)(lt.A,{}),iconPosition:"start",label:"User Analytics"}),(0,q.jsx)(rt.A,{icon:(0,q.jsx)(pe.A,{}),iconPosition:"start",label:"Account Actions"}),(0,q.jsx)(rt.A,{icon:(0,q.jsx)(dt.A,{}),iconPosition:"start",label:"Installment Management"})]})}),0===E&&(0,q.jsxs)(v.A,{sx:{p:2},children:[(0,q.jsxs)(P.A,{sx:{px:0},children:[(0,q.jsx)(A.A,{select:!0,size:"small",label:"Role",value:C.role,onChange:e=>_(t=>(0,r.A)((0,r.A)({},t),{},{role:e.target.value})),sx:{mr:2,minWidth:180},children:[{value:"",label:"All roles"},{value:"admin",label:"Admin"},{value:"seller",label:"Seller"},{value:"buyer",label:"Buyer"}].map(e=>(0,q.jsx)(j.A,{value:e.value,children:e.label},e.value))}),(0,q.jsx)(A.A,{select:!0,size:"small",label:"Status",value:C.active,onChange:e=>_(t=>(0,r.A)((0,r.A)({},t),{},{active:e.target.value})),sx:{mr:2,minWidth:180},children:[{value:"",label:"All statuses"},{value:"true",label:"Active"},{value:"false",label:"Inactive"}].map(e=>(0,q.jsx)(j.A,{value:e.value,children:e.label},e.value))}),(0,q.jsx)(A.A,{select:!0,size:"small",label:"Seller Verification",value:C.verifiedSeller,onChange:e=>_(t=>(0,r.A)((0,r.A)({},t),{},{verifiedSeller:e.target.value})),sx:{mr:2,minWidth:220},children:[{value:"",label:"All sellers"},{value:"true",label:"Verified sellers only"},{value:"false",label:"Unverified sellers only"}].map(e=>(0,q.jsx)(j.A,{value:e.value,children:e.label},e.value))})]}),(0,q.jsx)(M.A,{sx:{my:1}}),l&&(0,q.jsx)(x.A,{sx:{display:"flex",justifyContent:"center",p:2},children:(0,q.jsx)(Ie.A,{})}),c&&(0,q.jsx)(Pe.A,{severity:"error",sx:{mb:2},children:c}),!l&&!c&&(0,q.jsx)(We.A,{sx:{width:"100%",overflowX:"auto"},children:(0,q.jsxs)(_e.A,{size:"small",sx:{minWidth:720},children:[(0,q.jsx)(De.A,{children:(0,q.jsxs)(Me.A,{children:[(0,q.jsx)(ze.A,{children:"UID"}),(0,q.jsx)(ze.A,{children:"Name"}),(0,q.jsx)(ze.A,{children:"Email"}),(0,q.jsx)(ze.A,{children:"Phone"}),(0,q.jsx)(ze.A,{children:"Role"}),(0,q.jsx)(ze.A,{children:"Status"}),(0,q.jsx)(ze.A,{children:"Seller"}),(0,q.jsx)(ze.A,{align:"right",children:"Actions"})]})}),(0,q.jsx)(Ne.A,{children:0===o.length?(0,q.jsx)(Me.A,{children:(0,q.jsx)(ze.A,{colSpan:8,align:"center",children:"No users found."})}):o.map(e=>{var t,i,r,n,s,o,a,l;return(0,q.jsxs)(Me.A,{hover:!0,children:[(0,q.jsx)(ze.A,{children:e.uid||e.id}),(0,q.jsx)(ze.A,{children:(0,q.jsxs)(tt.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,q.jsx)(p.A,{variant:"body2",children:e.fullName||e.displayName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"\u2014"}),(0,q.jsx)(I.A,{title:"View info",children:(0,q.jsx)(W.A,{size:"small",onClick:()=>(async e=>{N(null),F(!0);try{const t=await Te.lu.getUserDetail(e.uid||e.id,U);null!==t&&void 0!==t&&t.success?N(t.user||t.data||e):(N(e),y("Could not load full details from API; showing list data."))}catch(t){console.error("User detail load error:",t),N(e),y("Could not load full details from API; showing list data.")}})(e),children:(0,q.jsx)(xe.A,{fontSize:"inherit"})})})]})}),(0,q.jsx)(ze.A,{children:e.email||"\u2014"}),(0,q.jsx)(ze.A,{children:e.phone||e.phoneNumber||e.mobile||"\u2014"}),(0,q.jsx)(ze.A,{children:(0,q.jsx)(Be.A,{label:e.userRole||e.role||"buyer",size:"small"})}),(0,q.jsx)(ze.A,{children:(0,q.jsx)(Be.A,{label:null===(t=null!==(i=e.active)&&void 0!==i?i:e.isActive)||void 0===t||t?"active":"inactive",color:null===(r=null!==(n=e.active)&&void 0!==n?n:e.isActive)||void 0===r||r?"success":"default",size:"small"})}),(0,q.jsx)(ze.A,{children:(0,q.jsx)(Be.A,{label:e.isSeller?e.verifiedSeller?"verified":"seller":"\u2014",size:"small"})}),(0,q.jsxs)(ze.A,{align:"right",children:[(0,q.jsx)(I.A,{title:"Deactivate",children:(0,q.jsx)("span",{children:(0,q.jsx)(W.A,{size:"small",onClick:()=>V(e.uid||e.id,"deactivate"),disabled:!1===(null===(s=null!==(o=e.active)&&void 0!==o?o:e.isActive)||void 0===s||s),children:(0,q.jsx)(ct.A,{fontSize:"inherit"})})})}),(0,q.jsx)(I.A,{title:"Reactivate",children:(0,q.jsx)("span",{children:(0,q.jsx)(W.A,{size:"small",onClick:()=>V(e.uid||e.id,"reactivate"),disabled:!0===(null===(a=null!==(l=e.active)&&void 0!==l?l:e.isActive)||void 0===a||a),children:(0,q.jsx)(ut.A,{fontSize:"inherit"})})})}),(0,q.jsx)(I.A,{title:"Close account",children:(0,q.jsx)(W.A,{size:"small",color:"error",onClick:()=>V(e.uid||e.id,"close"),children:(0,q.jsx)(xt.A,{fontSize:"inherit"})})})]})]},e.uid||e.id)})})]})})]}),1===E&&(0,q.jsxs)(v.A,{sx:{p:2},children:[(0,q.jsx)(p.A,{variant:"h6",gutterBottom:!0,children:"Advanced User Analytics"}),(0,q.jsxs)(b.A,{container:!0,spacing:3,children:[(0,q.jsx)(b.A,{item:!0,xs:12,md:6,children:(0,q.jsx)(w.A,{children:(0,q.jsxs)(S.A,{children:[(0,q.jsx)(p.A,{variant:"h6",gutterBottom:!0,children:"User Engagement"}),(0,q.jsx)(p.A,{variant:"body2",color:"textSecondary",paragraph:!0,children:"Detailed analytics on user activity, session duration, and engagement metrics."}),(0,q.jsx)(qe.A,{variant:"determinate",value:75}),(0,q.jsx)(p.A,{variant:"caption",children:"75% engagement rate"})]})})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:6,children:(0,q.jsx)(w.A,{children:(0,q.jsxs)(S.A,{children:[(0,q.jsx)(p.A,{variant:"h6",gutterBottom:!0,children:"Account Verification"}),(0,q.jsx)(p.A,{variant:"body2",color:"textSecondary",paragraph:!0,children:"Verification status and seller approval rates across different user segments."}),(0,q.jsx)(qe.A,{variant:"determinate",value:60}),(0,q.jsx)(p.A,{variant:"caption",children:"60% verification rate"})]})})})]})]}),2===E&&(0,q.jsxs)(v.A,{sx:{p:2},children:[(0,q.jsx)(p.A,{variant:"h6",gutterBottom:!0,children:"Account Management Actions"}),(0,q.jsxs)(b.A,{container:!0,spacing:3,children:[(0,q.jsx)(b.A,{item:!0,xs:12,md:4,children:(0,q.jsx)(w.A,{children:(0,q.jsxs)(S.A,{children:[(0,q.jsxs)(tt.A,{direction:"row",alignItems:"center",spacing:2,children:[(0,q.jsx)(z.A,{sx:{bgcolor:"error.main"},children:(0,q.jsx)(ht.A,{})}),(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"h6",children:"Account Closures"}),(0,q.jsx)(p.A,{variant:"body2",color:"textSecondary",children:"Manage account closure requests"})]})]}),(0,q.jsx)(f.A,{variant:"outlined",color:"error",sx:{mt:2},children:"Review Closures"})]})})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:4,children:(0,q.jsx)(w.A,{children:(0,q.jsxs)(S.A,{children:[(0,q.jsxs)(tt.A,{direction:"row",alignItems:"center",spacing:2,children:[(0,q.jsx)(z.A,{sx:{bgcolor:"warning.main"},children:(0,q.jsx)(mt.A,{})}),(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"h6",children:"Pending Approvals"}),(0,q.jsx)(p.A,{variant:"body2",color:"textSecondary",children:"Seller and content approvals"})]})]}),(0,q.jsx)(f.A,{variant:"outlined",color:"warning",sx:{mt:2},children:"Review Approvals"})]})})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:4,children:(0,q.jsx)(w.A,{children:(0,q.jsxs)(S.A,{children:[(0,q.jsxs)(tt.A,{direction:"row",alignItems:"center",spacing:2,children:[(0,q.jsx)(z.A,{sx:{bgcolor:"success.main"},children:(0,q.jsx)(dt.A,{})}),(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"h6",children:"Financial Actions"}),(0,q.jsx)(p.A,{variant:"body2",color:"textSecondary",children:"Refunds, disputes, and billing"})]})]}),(0,q.jsx)(f.A,{variant:"outlined",color:"success",sx:{mt:2},children:"Manage Finances"})]})})})]})]}),3===E&&(0,q.jsxs)(v.A,{sx:{p:2},children:[(0,q.jsx)(p.A,{variant:"h6",gutterBottom:!0,children:"Installment Management"}),(0,q.jsxs)(b.A,{container:!0,spacing:3,children:[(0,q.jsx)(b.A,{item:!0,xs:12,md:4,children:(0,q.jsx)(w.A,{children:(0,q.jsxs)(S.A,{children:[(0,q.jsxs)(tt.A,{direction:"row",alignItems:"center",spacing:2,children:[(0,q.jsx)(z.A,{sx:{bgcolor:"success.main"},children:(0,q.jsx)(dt.A,{})}),(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"h6",children:"Active Installments"}),(0,q.jsx)(p.A,{variant:"body2",color:"textSecondary",children:"Total ongoing payment plans"})]})]}),(0,q.jsx)(p.A,{variant:"h4",sx:{mt:1},children:"0"})]})})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:4,children:(0,q.jsx)(w.A,{children:(0,q.jsxs)(S.A,{children:[(0,q.jsxs)(tt.A,{direction:"row",alignItems:"center",spacing:2,children:[(0,q.jsx)(z.A,{sx:{bgcolor:"warning.main"},children:(0,q.jsx)(mt.A,{})}),(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"h6",children:"Overdue Payments"}),(0,q.jsx)(p.A,{variant:"body2",color:"textSecondary",children:"Installments past due date"})]})]}),(0,q.jsx)(p.A,{variant:"h4",sx:{mt:1},children:"0"})]})})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:4,children:(0,q.jsx)(w.A,{children:(0,q.jsxs)(S.A,{children:[(0,q.jsxs)(tt.A,{direction:"row",alignItems:"center",spacing:2,children:[(0,q.jsx)(z.A,{sx:{bgcolor:"info.main"},children:(0,q.jsx)(ge.A,{})}),(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"h6",children:"Completed Plans"}),(0,q.jsx)(p.A,{variant:"body2",color:"textSecondary",children:"Successfully completed installments"})]})]}),(0,q.jsx)(p.A,{variant:"h4",sx:{mt:1},children:"0"})]})})})]}),(0,q.jsxs)(w.A,{sx:{mt:3},children:[(0,q.jsx)(k.A,{title:"Recent Installment Activity"}),(0,q.jsxs)(S.A,{children:[(0,q.jsx)(Pe.A,{severity:"info",sx:{mb:2},children:"Installment management features coming soon. Currently managed through the Installments section."}),(0,q.jsx)(p.A,{variant:"body2",color:"textSecondary",children:"Admins can manage installment plans, track payments, and send notifications to users about due payments."})]})]})]}),(0,q.jsx)(u.Ay,{anchor:"right",open:B,onClose:()=>F(!1),children:(0,q.jsxs)(x.A,{sx:{width:380,p:2},role:"presentation",children:[(0,q.jsx)(p.A,{variant:"h6",sx:{mb:1},children:"User Details"}),(0,q.jsx)(M.A,{sx:{mb:2}}),D?(0,q.jsxs)(m.A,{dense:!0,children:[(0,q.jsx)(nt.Ay,{children:(0,q.jsx)(ie.A,{primary:"UID",secondary:D.uid||D.id})}),(D.fullName||D.displayName||D.firstName||D.lastName)&&(0,q.jsx)(nt.Ay,{children:(0,q.jsx)(ie.A,{primary:"Name",secondary:D.fullName||D.displayName||"".concat(D.firstName||""," ").concat(D.lastName||"").trim()})}),D.email&&(0,q.jsx)(nt.Ay,{children:(0,q.jsx)(ie.A,{primary:"Email",secondary:D.email})}),D.phone&&(0,q.jsx)(nt.Ay,{children:(0,q.jsx)(ie.A,{primary:"Phone",secondary:D.phone})}),(D.address||D.location)&&(0,q.jsx)(nt.Ay,{children:(0,q.jsx)(ie.A,{primary:"Address",secondary:D.address||D.location})}),D.town&&(0,q.jsx)(nt.Ay,{children:(0,q.jsx)(ie.A,{primary:"Town/City",secondary:D.town})}),D.postcode&&(0,q.jsx)(nt.Ay,{children:(0,q.jsx)(ie.A,{primary:"Postcode",secondary:D.postcode})}),(D.userRole||D.role)&&(0,q.jsx)(nt.Ay,{children:(0,q.jsx)(ie.A,{primary:"Role",secondary:D.userRole||D.role})}),"undefined"!==typeof(null!==(e=D.active)&&void 0!==e?e:D.isActive)&&(0,q.jsx)(nt.Ay,{children:(0,q.jsx)(ie.A,{primary:"Status",secondary:(null!==(t=D.active)&&void 0!==t?t:D.isActive)?"Active":"Inactive"})}),D.isSeller&&(0,q.jsx)(nt.Ay,{children:(0,q.jsx)(ie.A,{primary:"Seller",secondary:D.verifiedSeller?"Verified":"Unverified"})}),D.createdAt&&(0,q.jsx)(nt.Ay,{children:(0,q.jsx)(ie.A,{primary:"Created",secondary:new Date(D.createdAt).toLocaleString()})}),D.updatedAt&&(0,q.jsx)(nt.Ay,{children:(0,q.jsx)(ie.A,{primary:"Updated",secondary:new Date(D.updatedAt).toLocaleString()})}),D.lastLogin&&(0,q.jsx)(nt.Ay,{children:(0,q.jsx)(ie.A,{primary:"Last Login",secondary:new Date(D.lastLogin).toLocaleString()})}),D.notes&&(0,q.jsx)(nt.Ay,{children:(0,q.jsx)(ie.A,{primary:"Notes",secondary:D.notes})}),(0,q.jsx)(M.A,{sx:{my:1}}),(0,q.jsxs)(tt.A,{direction:"row",spacing:1,children:[(0,q.jsx)(f.A,{size:"small",variant:"outlined",onClick:()=>V(D.uid||D.id,"deactivate"),children:"Deactivate"}),(0,q.jsx)(f.A,{size:"small",variant:"outlined",onClick:()=>V(D.uid||D.id,"reactivate"),children:"Reactivate"}),(0,q.jsx)(f.A,{size:"small",color:"error",variant:"contained",onClick:()=>V(D.uid||D.id,"close"),children:"Close Account"})]})]}):(0,q.jsx)(x.A,{sx:{display:"flex",justifyContent:"center",p:2},children:(0,q.jsx)(Ie.A,{})})]})})]})}var Pt=i(375);var It=i(80045);const Wt=["idDocument","selfiePhoto","addressProof"],_t=["proofOfPurchase","productPhotos","warrantyInfo"];const Dt=new class{constructor(){this.baseURL="https://sparkle-pro.co.uk/api",this.token=localStorage.getItem("authToken")}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i="".concat(this.baseURL).concat(e),n=(0,r.A)({headers:(0,r.A)((0,r.A)({"Content-Type":"application/json"},this.token&&{Authorization:"Bearer ".concat(this.token)}),t.headers)},t);try{const e=await fetch(i,n);if(!e.ok){const t=await e.json().catch(()=>({}));throw new Error(t.message||"HTTP error! status: ".concat(e.status))}return await e.json()}catch(s){throw console.error("API request failed: ".concat(e),s),s}}async uploadFile(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=new FormData;return n.append("file",t),Object.keys(i).forEach(e=>{n.append(e,i[e])}),this.request(e,{method:"POST",headers:(0,r.A)({},this.token&&{Authorization:"Bearer ".concat(this.token)}),body:n})}async submitSellerVerification(e){const{idDocument:t,selfiePhoto:i,addressProof:n}=e,s=(0,It.A)(e,Wt),o=[];t&&o.push(this.uploadFile("/verification/upload-id",t,{type:"id_document"})),i&&o.push(this.uploadFile("/verification/upload-selfie",i,{type:"selfie"})),n&&o.push(this.uploadFile("/verification/upload-address",n,{type:"address_proof"}));const a=await Promise.all(o);return this.request("/verification/seller",{method:"POST",body:JSON.stringify((0,r.A)((0,r.A)({},s),{},{documents:a.map(e=>e.data)}))})}async getSellerVerificationStatus(e){return this.request("/verification/seller/".concat(e))}async updateVerificationStatus(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return this.request("/verification/seller/".concat(e,"/status"),{method:"PUT",body:JSON.stringify({status:t,notes:i})})}async verifyPhone(e){return this.request("/verification/phone/send-code",{method:"POST",body:JSON.stringify({phoneNumber:e})})}async confirmPhoneVerification(e,t){return this.request("/verification/phone/verify-code",{method:"POST",body:JSON.stringify({phoneNumber:e,code:t})})}async verifyEmail(e){return this.request("/verification/email/send-verification",{method:"POST",body:JSON.stringify({email:e})})}async confirmEmailVerification(e){return this.request("/verification/email/confirm",{method:"POST",body:JSON.stringify({token:e})})}async getSellerTier(e){return this.request("/sellers/".concat(e,"/tier"))}async updateSellerTier(e){return this.request("/sellers/".concat(e,"/tier/calculate"),{method:"POST"})}async getTierRequirements(){return this.request("/sellers/tier-requirements")}async getTrustScore(e){return this.request("/sellers/".concat(e,"/trust-score"))}async submitProductAuthenticity(e,t){const{proofOfPurchase:i,productPhotos:n,warrantyInfo:s}=t,o=(0,It.A)(t,_t),a=[];i&&a.push(this.uploadFile("/products/upload-proof",i,{productId:e,type:"proof_of_purchase"})),s&&a.push(this.uploadFile("/products/upload-warranty",s,{productId:e,type:"warranty"})),n&&n.length>0&&n.forEach((t,i)=>{a.push(this.uploadFile("/products/upload-photo",t,{productId:e,type:"product_photo",index:i}))});const l=await Promise.all(a);return this.request("/products/".concat(e,"/authenticity"),{method:"POST",body:JSON.stringify((0,r.A)((0,r.A)({},o),{},{documents:l.map(e=>e.data)}))})}async checkIMEI(e){return this.request("/verification/imei-check",{method:"POST",body:JSON.stringify({imeiNumber:e})})}async verifySerialNumber(e,t,i){return this.request("/verification/serial-check",{method:"POST",body:JSON.stringify({serialNumber:e,brand:t,model:i})})}async getProductAuthenticity(e){return this.request("/products/".concat(e,"/authenticity"))}async createEscrowTransaction(e){return this.request("/escrow/create",{method:"POST",body:JSON.stringify(e)})}async getEscrowTransaction(e){return this.request("/escrow/".concat(e))}async updateEscrowStatus(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("/escrow/".concat(e,"/status"),{method:"PUT",body:JSON.stringify((0,r.A)({status:t},i))})}async confirmReceipt(e){return this.request("/escrow/".concat(e,"/confirm-receipt"),{method:"POST"})}async releaseFunds(e){return this.request("/escrow/".concat(e,"/release-funds"),{method:"POST"})}async createDispute(e,t){const i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:[]).map(t=>this.uploadFile("/disputes/upload-evidence",t,{transactionId:e})),r=await Promise.all(i);return this.request("/disputes/create",{method:"POST",body:JSON.stringify({transactionId:e,reason:t,evidence:r.map(e=>e.data)})})}async getUserEscrowTransactions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=new URLSearchParams;return t&&i.append("status",t),this.request("/escrow/user/".concat(e,"?").concat(i.toString()))}async submitSellerReview(e,t,i){return this.request("/reviews/seller",{method:"POST",body:JSON.stringify((0,r.A)({sellerId:e,transactionId:t},i))})}async getSellerReviews(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return this.request("/reviews/seller/".concat(e,"?page=").concat(t,"&limit=").concat(i))}async reportSeller(e,t){const i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:[]).map(t=>this.uploadFile("/reports/upload-evidence",t,{sellerId:e})),r=await Promise.all(i);return this.request("/reports/seller",{method:"POST",body:JSON.stringify({sellerId:e,reason:t,evidence:r.map(e=>e.data)})})}async getSellerStats(e){return this.request("/sellers/".concat(e,"/stats"))}async getPendingVerifications(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";return this.request("/admin/verifications/pending?type=".concat(e))}async getDispute(e){return this.request("/admin/disputes/".concat(e))}async resolveDispute(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.request("/admin/disputes/".concat(e,"/resolve"),{method:"POST",body:JSON.stringify({resolution:t,refundAmount:i})})}async getPlatformStats(){return this.request("/admin/stats")}updateAuthToken(e){this.token=e,localStorage.setItem("authToken",e)}clearAuthToken(){this.token=null,localStorage.removeItem("authToken")}async getSupportedDocumentTypes(){return this.request("/verification/document-types")}async getVerificationRequirements(e){return this.request("/verification/requirements/".concat(e))}async checkFeatureAvailability(e,t){return this.request("/features/availability?feature=".concat(e,"&country=").concat(t))}},{submitSellerVerification:Mt,getSellerVerificationStatus:zt,updateVerificationStatus:Nt,verifyPhone:Bt,confirmPhoneVerification:Ft,verifyEmail:Et,confirmEmailVerification:Tt,getSellerTier:Rt,updateSellerTier:Ot,getTierRequirements:Ut,getTrustScore:Lt,submitProductAuthenticity:qt,checkIMEI:Gt,verifySerialNumber:Vt,getProductAuthenticity:Ht,createEscrowTransaction:Kt,getEscrowTransaction:Qt,updateEscrowStatus:Yt,confirmReceipt:Xt,releaseFunds:Jt,createDispute:Zt,getUserEscrowTransactions:$t,submitSellerReview:ei,getSellerReviews:ti,reportSeller:ii,getSellerStats:ri,getPendingVerifications:ni,getDispute:si,resolveDispute:oi,getPlatformStats:ai,updateAuthToken:li,clearAuthToken:di,getSupportedDocumentTypes:ci,getVerificationRequirements:ui,checkFeatureAvailability:xi}=Dt;var hi=i(86633),mi=i(71672),pi=i(26309),gi=i(41530),bi=i(53574),vi=i(23670);const Ai=(0,o.Ay)(w.A)(e=>{let{theme:t}=e;return{width:"100%",maxWidth:"none",margin:"16px auto",background:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:16,color:"white",[t.breakpoints.down("md")]:{width:"100%"}}}),ji=(0,o.Ay)(v.A)(e=>{let{theme:t}=e;return{background:"rgba(255, 255, 255, 0.03)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.08)",borderRadius:12,padding:t.spacing(3),marginBottom:t.spacing(2)}}),yi=(0,o.Ay)(x.A)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",marginBottom:t.spacing(3),gap:t.spacing(2)}}),fi=()=>{const{user:e,userProfile:t,updateUserProfile:i}=(0,L.A)(),[s,o]=(0,n.useState)(!0),[a,l]=(0,n.useState)(!1),[d,c]=(0,n.useState)(null),[u,h]=(0,n.useState)(!1),[m,g]=(0,n.useState)({fullName:"",email:"",town:"",address:"",postcode:"",phone:""});(0,n.useEffect)(()=>{var i,r,n,s,o,a,l,d;g({fullName:null!==(i=null!==(r=null===t||void 0===t?void 0:t.fullName)&&void 0!==r?r:null===e||void 0===e?void 0:e.displayName)&&void 0!==i?i:"",email:null!==(n=null!==(s=null===t||void 0===t?void 0:t.email)&&void 0!==s?s:null===e||void 0===e?void 0:e.email)&&void 0!==n?n:"",town:null!==(o=null===t||void 0===t?void 0:t.town)&&void 0!==o?o:"",address:null!==(a=null===t||void 0===t?void 0:t.address)&&void 0!==a?a:"",postcode:null!==(l=null===t||void 0===t?void 0:t.postcode)&&void 0!==l?l:"",phone:null!==(d=null===t||void 0===t?void 0:t.phone)&&void 0!==d?d:""})},[t,e]);const v=e=>t=>{g(i=>(0,r.A)((0,r.A)({},i),{},{[e]:t.target.value})),c(null),h(!1)},j=()=>{t&&g({fullName:t.fullName||(null===e||void 0===e?void 0:e.displayName)||"",email:t.email||(null===e||void 0===e?void 0:e.email)||"",town:t.town||"",address:t.address||"",postcode:t.postcode||"",phone:t.phone||""}),o(!1),c(null),h(!1)};return(0,q.jsx)(Ai,{elevation:0,children:(0,q.jsxs)(S.A,{sx:{p:4},children:[(0,q.jsxs)(yi,{children:[(0,q.jsx)(z.A,{src:null===e||void 0===e?void 0:e.photoURL,sx:{width:100,height:100,border:"3px solid #48CEDB",boxShadow:"0 4px 20px rgba(72, 206, 219, 0.3)"},children:!(null!==e&&void 0!==e&&e.photoURL)&&(0,q.jsx)(st.A,{sx:{fontSize:50}})}),(0,q.jsxs)(x.A,{sx:{flex:1},children:[(0,q.jsx)(p.A,{variant:"h4",gutterBottom:!0,sx:{fontWeight:700,color:"#48CEDB"},children:"Profile Settings"}),(0,q.jsx)(p.A,{variant:"body1",sx:{color:"rgba(255,255,255,0.7)"},children:"Manage your personal information and account preferences"})]}),(0,q.jsx)(W.A,{onClick:()=>s?j():o(!0),disabled:a,sx:{bgcolor:s?"rgba(244, 67, 54, 0.1)":"rgba(72, 206, 219, 0.1)",color:s?"#f44336":"#48CEDB",border:s?"1px solid rgba(244, 67, 54, 0.3)":"1px solid rgba(72, 206, 219, 0.3)","&:hover":{bgcolor:s?"rgba(244, 67, 54, 0.2)":"rgba(72, 206, 219, 0.2)"}},children:s?(0,q.jsx)(ht.A,{}):(0,q.jsx)(mi.A,{})})]}),(0,q.jsx)(M.A,{sx:{mb:4,borderColor:"rgba(255,255,255,0.1)"}}),d&&(0,q.jsx)(Pe.A,{severity:"error",sx:{mb:3,bgcolor:"rgba(244, 67, 54, 0.1)",color:"white",border:"1px solid rgba(244, 67, 54, 0.3)"},children:d}),u&&(0,q.jsx)(Pe.A,{severity:"success",sx:{mb:3,bgcolor:"rgba(76, 175, 80, 0.1)",color:"white",border:"1px solid rgba(76, 175, 80, 0.3)"},children:"Profile updated successfully!"}),(0,q.jsxs)(ji,{elevation:0,children:[(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:3},children:[(0,q.jsx)(st.A,{sx:{color:"#48CEDB"}}),(0,q.jsx)(p.A,{variant:"h6",sx:{fontWeight:600,color:"white"},children:"Personal Information"})]}),(0,q.jsxs)(b.A,{container:!0,spacing:2,children:[(0,q.jsx)(b.A,{item:!0,xs:12,md:6,children:(0,q.jsx)(A.A,{fullWidth:!0,label:"Full Name *",value:m.fullName,onChange:v("fullName"),disabled:!s||a,variant:"outlined",required:!0,sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255,255,255,0.2)"},"&:hover fieldset":{borderColor:"rgba(72, 206, 219, 0.5)"},"&.Mui-focused fieldset":{borderColor:"#48CEDB"},"&.Mui-disabled":{opacity:.6}},"& .MuiInputLabel-root":{color:"rgba(255,255,255,0.7)"},"& .MuiInputLabel-root.Mui-focused":{color:"#48CEDB"}}})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:6,children:(0,q.jsx)(A.A,{fullWidth:!0,label:"Email Address *",value:m.email,onChange:v("email"),disabled:!0,variant:"outlined",required:!0,helperText:"Email cannot be changed",InputProps:{startAdornment:(0,q.jsx)(vi.A,{sx:{mr:1,color:"rgba(255,255,255,0.5)"}})},sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255,255,255,0.2)"},"&.Mui-disabled":{opacity:.6}},"& .MuiInputLabel-root":{color:"rgba(255,255,255,0.7)"},"& .MuiFormHelperText-root":{color:"rgba(255,255,255,0.5)"}}})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:6,children:(0,q.jsx)(A.A,{fullWidth:!0,label:"Phone Number",value:m.phone,onChange:v("phone"),disabled:!s||a,variant:"outlined",placeholder:"e.g., +265 999 123 456",helperText:"Include country code (e.g., +265 for Malawi, +44 for UK)",InputProps:{startAdornment:(0,q.jsx)(bi.A,{sx:{mr:1,color:"rgba(255,255,255,0.5)"}})},sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255,255,255,0.2)"},"&:hover fieldset":{borderColor:"rgba(72, 206, 219, 0.5)"},"&.Mui-focused fieldset":{borderColor:"#48CEDB"},"&.Mui-disabled":{opacity:.6}},"& .MuiInputLabel-root":{color:"rgba(255,255,255,0.7)"},"& .MuiInputLabel-root.Mui-focused":{color:"#48CEDB"},"& .MuiFormHelperText-root":{color:"rgba(255,255,255,0.5)"}}})})]})]}),(0,q.jsxs)(ji,{elevation:0,children:[(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:3},children:[(0,q.jsx)(gi.A,{sx:{color:"#48CEDB"}}),(0,q.jsx)(p.A,{variant:"h6",sx:{fontWeight:600,color:"white"},children:"Address Information"})]}),(0,q.jsxs)(b.A,{container:!0,spacing:2,children:[(0,q.jsx)(b.A,{item:!0,xs:12,children:(0,q.jsx)(A.A,{fullWidth:!0,label:"Street Address *",value:m.address,onChange:v("address"),disabled:!s||a,variant:"outlined",required:!0,multiline:!0,rows:2,sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255,255,255,0.2)"},"&:hover fieldset":{borderColor:"rgba(72, 206, 219, 0.5)"},"&.Mui-focused fieldset":{borderColor:"#48CEDB"},"&.Mui-disabled":{opacity:.6}},"& .MuiInputLabel-root":{color:"rgba(255,255,255,0.7)"},"& .MuiInputLabel-root.Mui-focused":{color:"#48CEDB"}}})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:6,children:(0,q.jsx)(A.A,{fullWidth:!0,label:"Town/City",value:m.town,onChange:v("town"),disabled:!s||a,variant:"outlined",sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255,255,255,0.2)"},"&:hover fieldset":{borderColor:"rgba(72, 206, 219, 0.5)"},"&.Mui-focused fieldset":{borderColor:"#48CEDB"},"&.Mui-disabled":{opacity:.6}},"& .MuiInputLabel-root":{color:"rgba(255,255,255,0.7)"},"& .MuiInputLabel-root.Mui-focused":{color:"#48CEDB"}}})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:6,children:(0,q.jsx)(A.A,{fullWidth:!0,label:"Postcode",value:m.postcode,onChange:v("postcode"),disabled:!s||a,variant:"outlined",sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255,255,255,0.2)"},"&:hover fieldset":{borderColor:"rgba(72, 206, 219, 0.5)"},"&.Mui-focused fieldset":{borderColor:"#48CEDB"},"&.Mui-disabled":{opacity:.6}},"& .MuiInputLabel-root":{color:"rgba(255,255,255,0.7)"},"& .MuiInputLabel-root.Mui-focused":{color:"#48CEDB"}}})})]})]}),s&&(0,q.jsxs)(x.A,{sx:{display:"flex",gap:2,mt:4,justifyContent:"flex-end"},children:[(0,q.jsx)(f.A,{onClick:j,disabled:a,variant:"outlined",sx:{color:"rgba(255,255,255,0.8)",borderColor:"rgba(255,255,255,0.3)","&:hover":{borderColor:"rgba(255,255,255,0.5)",bgcolor:"rgba(255,255,255,0.05)"}},children:"Cancel"}),(0,q.jsx)(f.A,{onClick:async()=>{l(!0),c(null),h(!1);try{var e,t,r;const n=[];if(null!==(e=m.email)&&void 0!==e&&e.trim()||n.push("Email"),null!==(t=m.fullName)&&void 0!==t&&t.trim()||n.push("Full Name"),null!==(r=m.address)&&void 0!==r&&r.trim()||n.push("Address"),n.length>0)return c("Please fill in all required fields: ".concat(n.join(", "))),void l(!1);const s=await i(m);s.success?(h(!0),o(!1),setTimeout(()=>h(!1),3e3)):c(s.error||"Failed to update profile")}catch(n){c("An unexpected error occurred")}finally{l(!1)}},disabled:a,variant:"contained",startIcon:a?(0,q.jsx)(Ie.A,{size:20}):(0,q.jsx)(pi.A,{}),sx:{bgcolor:"#48CEDB",color:"#0f172a",fontWeight:600,px:4,"&:hover":{bgcolor:"#3ab9c7"},"&:disabled":{bgcolor:"rgba(72, 206, 219, 0.3)"}},children:a?"Saving...":"Save Changes"})]})]})})};var wi=i(8679),Si=i(80294),ki=i(85706),Ci=i(2847),Pi=i(56473),Ii=i(39872),Wi=i(27982),_i=i(66427),Di=i(11962),Mi=i(50861);const zi=e=>{let{title:t,value:i,change:n,changeType:s,period:o,icon:l,color:d,chartData:c,chartType:u="line"}=e;const h=(0,a.A)(),m=(0,Ve.A)(h.breakpoints.down("sm")),g="positive"===s?"#22c55e":"negative"===s?"#ef4444":"#94a3b8",b=d||"#3b82f6",v=()=>{if(!c||!Array.isArray(c)||0===c.length)return null;const e=c.filter(e=>e&&"object"===typeof e);if(0===e.length)return null;const t={data:e,margin:{top:5,right:5,left:5,bottom:5}};switch(u){case"bar":return(0,q.jsx)(Si.E,(0,r.A)((0,r.A)({},t),{},{children:(0,q.jsx)(ki.y,{dataKey:"value",fill:b,radius:[4,4,0,0]})}));case"area":return(0,q.jsxs)(gt.Q,(0,r.A)((0,r.A)({},t),{},{children:[(0,q.jsx)("defs",{children:(0,q.jsxs)("linearGradient",{id:"colorGradient-".concat(b.replace("#","")),x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,q.jsx)("stop",{offset:"5%",stopColor:b,stopOpacity:.3}),(0,q.jsx)("stop",{offset:"95%",stopColor:b,stopOpacity:.1})]})}),(0,q.jsx)(ft.G,{type:"monotone",dataKey:"value",stroke:b,fill:"url(#colorGradient-".concat(b.replace("#",""),")"),strokeWidth:2})]}));default:return(0,q.jsx)(Ci.b,(0,r.A)((0,r.A)({},t),{},{children:(0,q.jsx)(Pi.N,{type:"monotone",dataKey:"value",stroke:b,strokeWidth:2,dot:!1,activeDot:!1})}))}};return(0,q.jsx)(w.A,{sx:{height:"100%",background:"linear-gradient(145deg, #1e293b, #0f172a)",border:"1px solid #334155",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.25)",transition:"transform 0.3s ease, box-shadow 0.3s ease","&:hover":{transform:"translateY(-5px)",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.4)"}},children:(0,q.jsxs)(S.A,{sx:{p:3,height:"100%"},children:[(0,q.jsx)(x.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[(0,q.jsx)(x.A,{sx:{p:1.5,borderRadius:"12px",bgcolor:"".concat(b,"20"),display:"flex",alignItems:"center",justifyContent:"center"},children:l}),(0,q.jsx)(p.A,{variant:"body2",color:"text.secondary",children:t})]})}),(0,q.jsxs)(x.A,{sx:{mb:2},children:[(0,q.jsx)(p.A,{variant:m?"h5":"h4",fontWeight:"bold",color:"white",children:i}),n&&(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[(0,q.jsxs)(p.A,{variant:"body2",sx:{color:g,fontWeight:500,display:"flex",alignItems:"center",gap:.5},children:["positive"===s&&"\u2197","negative"===s&&"\u2198","neutral"===s&&"\u2014"," ",n]}),o&&(0,q.jsx)(p.A,{variant:"caption",color:"text.secondary",children:o})]})]}),(0,q.jsx)(x.A,{sx:{height:60,mt:1},"aria-hidden":"true",children:v()&&(0,q.jsx)(pt.u,{width:"100%",height:"100%",children:v()})})]})})},Ni=e=>{let{title:t,children:i,height:r=400}=e;return(0,q.jsx)(w.A,{sx:{height:"100%",background:"linear-gradient(145deg, #1e293b, #0f172a)",border:"1px solid #334155",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.25)"},children:(0,q.jsxs)(S.A,{sx:{p:3,height:"100%"},children:[(0,q.jsx)(p.A,{variant:"h6",fontWeight:"bold",color:"white",gutterBottom:!0,children:t}),(0,q.jsx)(x.A,{sx:{height:r,mt:2},children:i})]})})},Bi=e=>{let{data:t,title:i}=e;const r=["#3b82f6","#06b6d4","#8b5cf6","#ec4899","#f59e0b","#10b981","#ef4444","#f97316"];return(0,q.jsx)(Ni,{title:i,children:(0,q.jsx)(pt.u,{width:"100%",height:"100%",children:(0,q.jsxs)(wt.r,{children:[(0,q.jsx)(St.F,{data:t,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"value",label:e=>{let{name:t,percent:i}=e;return"".concat(t,": ").concat((100*i).toFixed(0),"%")},children:t.map((e,t)=>(0,q.jsx)(kt.f,{fill:r[t%r.length]},"cell-".concat(t)))}),(0,q.jsx)(jt.m,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"white"}}),(0,q.jsx)(yt.s,{})]})})})};function Fi(){var e,t,i,s,o;const{user:a}=(0,L.A)(),[l,d]=(0,n.useState)(null),[c,u]=(0,n.useState)(!0),[h,m]=(0,n.useState)(null),[v,A]=(0,n.useState)("30d"),[j,y]=(0,n.useState)(null),[w,S]=(0,n.useState)([]),[k,C]=(0,n.useState)([]),P=async()=>{u(!0),m(null);try{const t=await Te.rh.getDashboardStats(v);t&&t.data&&(d(t.data),y(new Date));try{const e=null===a||void 0===a?void 0:a.uid,t=await Te.lu.getAllUsers({adminUid:e});null!==t&&void 0!==t&&t.success?S(t.users||[]):Array.isArray(t)&&S(t)}catch(e){console.warn("Users fetch failed:",null===e||void 0===e?void 0:e.message)}try{const e=await Te.gH.getAllOrders();null!==e&&void 0!==e&&e.success?C(e.orders||[]):Array.isArray(e)&&C(e)}catch(e){console.warn("Orders fetch failed:",null===e||void 0===e?void 0:e.message)}}catch(e){console.error("\u274c Error loading analytics:",e),m(e.message||"Failed to load analytics data"),d(null)}finally{u(!1)}};(0,n.useEffect)(()=>{P()},[v]);const I=n.useMemo(()=>{if(null===l||void 0===l||!l.visitor_stats||c)return[];return[{name:"Today",value:l.visitor_stats.visitors_today||0},{name:"This Week",value:l.visitor_stats.visitors_this_week||0},{name:"This Month",value:l.visitor_stats.visitors_this_month||0}]},[l,c]),W=n.useMemo(()=>null!==l&&void 0!==l&&l.visitor_stats&&null!==l&&void 0!==l&&l.order_stats&&!c?[{name:"Analytics",pageViews:l.visitor_stats.page_views_month||0,completedOrders:l.order_stats.completed_orders||0}]:[],[l,c]),_=n.useMemo(()=>{var e,t,i,r;if(null===l||void 0===l||!l.order_stats||null===l||void 0===l||!l.revenue_stats||c)return[];const n=(null===(e=l.revenue_stats)||void 0===e||null===(t=e.mwk)||void 0===t?void 0:t.total)||0,s=(null===(i=l.revenue_stats)||void 0===i||null===(r=i.gbp)||void 0===r?void 0:r.total)||0;return[{name:"Total",orders:l.order_stats.total_orders||0,revenueMWK:n,revenueGBP:1800*s}]},[l,c]),D=n.useMemo(()=>{if(null===l||void 0===l||!l.gadget_stats||c)return[];const e=l.gadget_stats;return[{name:"Smartphones",value:e.smartphones_count||0},{name:"Laptops",value:e.laptops_count||0},{name:"Tablets",value:e.tablets_count||0},{name:"Accessories",value:e.accessories_count||0}].filter(e=>e.value>0)},[l,c]),M=n.useMemo(()=>{const e={admin:0,seller:0,buyer:0};return(w||[]).forEach(t=>{const i=((null===t||void 0===t?void 0:t.userRole)||(null===t||void 0===t?void 0:t.role)||"").toLowerCase();i.includes("admin")?e.admin+=1:i.includes("seller")?e.seller+=1:e.buyer+=1}),[{name:"Admins",value:e.admin},{name:"Sellers",value:e.seller},{name:"Buyers",value:e.buyer}]},[w]),z=n.useMemo(()=>{const e=new Map;k.forEach(t=>{(t.items||[]).forEach(t=>{const i=(null===t||void 0===t?void 0:t.name)||"".concat((null===t||void 0===t?void 0:t.brand)||""," ").concat((null===t||void 0===t?void 0:t.model)||"").trim(),r=Number((null===t||void 0===t?void 0:t.quantity)||1);i&&e.set(i,(e.get(i)||0)+r)})});const t=Array.from(e.entries()).map(e=>{let[t,i]=e;return{name:t,value:i}});return t.sort((e,t)=>t.value-e.value),t.slice(0,5)},[k]),N=(e,t)=>{if(!t||0===t)return{change:null,changeType:"neutral"};const i=e-t,r=(i/t*100).toFixed(1),n=i>=0;return{change:"".concat(n?"+":"").concat(r,"%"),changeType:n?"positive":"negative"}},B=n.useMemo(()=>{var e,t,i,r,n,s,o,a,d,c,u,x,h,m,p,g,b,v,A,j,y,f,w,S,k,C,P,W,M,z;if(!l)return[];const B=N((null===l||void 0===l||null===(e=l.visitor_stats)||void 0===e?void 0:e.visitors_this_month)||0,(null===l||void 0===l||null===(t=l.visitor_stats)||void 0===t?void 0:t.visitors_previous_month)||0),F=N((null===l||void 0===l||null===(i=l.visitor_stats)||void 0===i?void 0:i.page_views_month)||0,(null===l||void 0===l||null===(r=l.visitor_stats)||void 0===r?void 0:r.page_views_previous_month)||0),E=N((null===l||void 0===l||null===(n=l.visitor_stats)||void 0===n?void 0:n.product_views_month)||0,(null===l||void 0===l||null===(s=l.visitor_stats)||void 0===s?void 0:s.product_views_previous_month)||0),T=N((null===l||void 0===l||null===(o=l.order_stats)||void 0===o?void 0:o.orders_this_month)||0,(null===l||void 0===l||null===(a=l.order_stats)||void 0===a?void 0:a.orders_previous_month)||0),R=N((null===l||void 0===l||null===(d=l.revenue_stats)||void 0===d||null===(c=d.mwk)||void 0===c?void 0:c.this_month)||0,(null===l||void 0===l||null===(u=l.revenue_stats)||void 0===u||null===(x=u.mwk)||void 0===x?void 0:x.previous_month)||0),O=N((null===l||void 0===l||null===(h=l.revenue_stats)||void 0===h||null===(m=h.gbp)||void 0===m?void 0:m.this_month)||0,(null===l||void 0===l||null===(p=l.revenue_stats)||void 0===p||null===(g=p.gbp)||void 0===g?void 0:g.previous_month)||0),U=N((null===l||void 0===l||null===(b=l.order_stats)||void 0===b?void 0:b.dispatched_this_month)||0,(null===l||void 0===l||null===(v=l.order_stats)||void 0===v?void 0:v.dispatched_previous_month)||0),L=N((null===l||void 0===l||null===(A=l.gadget_stats)||void 0===A?void 0:A.total_stock_units)||0,(null===l||void 0===l||null===(j=l.gadget_stats)||void 0===j?void 0:j.total_stock_units_previous)||0);return[{title:"Total Visitors",value:(null===l||void 0===l||null===(y=l.visitor_stats)||void 0===y?void 0:y.total_unique_visitors)||0,change:B.change||"No data",changeType:B.changeType,period:B.change?"vs last month":"",icon:(0,q.jsx)(ce.A,{sx:{fontSize:24,color:"#3b82f6"}}),color:"#3b82f6",chartData:I,chartType:"area"},{title:"Page Views",value:(null===l||void 0===l||null===(f=l.visitor_stats)||void 0===f?void 0:f.page_views_month)||0,change:F.change||"No data",changeType:F.changeType,period:F.change?"vs last month":"",icon:(0,q.jsx)(Ii.A,{sx:{fontSize:24,color:"#10b981"}}),color:"#10b981",chartData:I,chartType:"line"},{title:"Product Views",value:(null===l||void 0===l||null===(w=l.visitor_stats)||void 0===w?void 0:w.product_views_month)||0,change:E.change||"No data",changeType:E.changeType,period:E.change?"vs last month":"",icon:(0,q.jsx)(Wi.A,{sx:{fontSize:24,color:"#ec4899"}}),color:"#ec4899",chartData:I,chartType:"area"},{title:"Total Orders",value:(null===l||void 0===l||null===(S=l.order_stats)||void 0===S?void 0:S.total_orders)||0,change:T.change||"No data",changeType:T.changeType,period:T.change?"vs last month":"",icon:(0,q.jsx)(me.A,{sx:{fontSize:24,color:"#06b6d4"}}),color:"#06b6d4",chartData:_.map(e=>({name:e.name,value:e.orders})),chartType:"line"},{title:"Revenue (MWK)",value:null!==l&&void 0!==l&&null!==(k=l.revenue_stats)&&void 0!==k&&null!==(C=k.mwk)&&void 0!==C&&C.total?"MWK ".concat(l.revenue_stats.mwk.total.toLocaleString()):"MWK 0",change:R.change||"No data",changeType:R.changeType,period:R.change?"vs last month":"",icon:(0,q.jsx)(pe.A,{sx:{fontSize:24,color:"#8b5cf6"}}),color:"#8b5cf6",chartData:_.map(e=>({name:e.name,value:e.revenue})),chartType:"area"},{title:"Revenue (GBP)",value:null!==l&&void 0!==l&&null!==(P=l.revenue_stats)&&void 0!==P&&null!==(W=P.gbp)&&void 0!==W&&W.total?"GBP ".concat(l.revenue_stats.gbp.total.toFixed(2)):"GBP 0.00",change:O.change||"No data",changeType:O.changeType,period:O.change?"vs last month":"",icon:(0,q.jsx)(pe.A,{sx:{fontSize:24,color:"#f59e0b"}}),color:"#f59e0b",chartData:I,chartType:"line"},{title:"Orders Dispatched",value:(null===l||void 0===l||null===(M=l.order_stats)||void 0===M?void 0:M.dispatched_orders)||0,change:U.change||"No data",changeType:U.changeType,period:U.change?"vs last month":"",icon:(0,q.jsx)(_i.A,{sx:{fontSize:24,color:"#14b8a6"}}),color:"#14b8a6",chartData:_.map(e=>({name:e.name,value:e.orders})),chartType:"bar"},{title:"Stock Units",value:(null===l||void 0===l||null===(z=l.gadget_stats)||void 0===z?void 0:z.total_stock_units)||0,change:L.change||"No data",changeType:L.changeType,period:L.change?"vs last month":"",icon:(0,q.jsx)(Di.A,{sx:{fontSize:24,color:"#f97316"}}),color:"#f97316",chartData:D.map(e=>({name:e.name,value:e.value})),chartType:"bar"}]},[c,l,I,_,D]);return c?(0,q.jsx)(g.A,{maxWidth:"xl",children:(0,q.jsx)(p.A,{variant:"h4",fontWeight:"bold",gutterBottom:!0,color:"white",children:"Loading Analytics..."})}):(0,q.jsxs)(g.A,{maxWidth:"xl",sx:{py:4},children:[(0,q.jsxs)(x.A,{sx:{mb:4},children:[(0,q.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"h4",fontWeight:"bold",color:"white",gutterBottom:!0,children:"Analytics Dashboard"}),(0,q.jsx)(p.A,{variant:"body1",color:"text.secondary",children:"Comprehensive insights and metrics for your platform"}),j&&(0,q.jsxs)(p.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:["Last updated: ",j.toLocaleTimeString()]})]}),(0,q.jsx)(f.A,{variant:"outlined",startIcon:(0,q.jsx)(Mi.A,{}),onClick:P,disabled:c,sx:{borderColor:"#3b82f6",color:"#3b82f6","&:hover":{borderColor:"#2563eb",backgroundColor:"rgba(59, 130, 246, 0.1)"}},children:"Refresh Data"})]}),h&&(0,q.jsx)(Pe.A,{severity:"error",sx:{mt:2},children:h}),(0,q.jsxs)(x.A,{sx:{display:"flex",gap:1,mt:3,flexWrap:"wrap",alignItems:"center"},children:[(0,q.jsx)(p.A,{variant:"body2",color:"text.secondary",sx:{mr:1},children:"Time Range:"}),(0,q.jsx)(wi.A,{variant:"outlined",size:"small",children:["7d","30d","90d","1y"].map(e=>(0,q.jsx)(f.A,{onClick:()=>A(e),sx:{borderColor:v===e?"#3b82f6":"#334155",backgroundColor:v===e?"rgba(59, 130, 246, 0.2)":"transparent",color:v===e?"#3b82f6":"#94a3b8","&:hover":{borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)"}},children:e},e))}),(null===l||void 0===l?void 0:l.cache_status)&&(0,q.jsx)(Be.A,{label:"Cache: ".concat(l.cache_status),size:"small",color:"fresh"===l.cache_status?"success":"warning",sx:{ml:2}})]})]}),(0,q.jsxs)(x.A,{sx:{mb:4},children:[(0,q.jsx)(p.A,{variant:"h6",fontWeight:"bold",color:"white",gutterBottom:!0,sx:{mb:2},children:"Visitor & Engagement"}),(0,q.jsx)(b.A,{container:!0,spacing:3,sx:{mb:4},children:B.slice(0,3).map((e,t)=>(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:4,children:(0,q.jsx)(zi,(0,r.A)({},e))},t))}),(0,q.jsx)(p.A,{variant:"h6",fontWeight:"bold",color:"white",gutterBottom:!0,sx:{mb:2},children:"Sales & Revenue"}),(0,q.jsx)(b.A,{container:!0,spacing:3,sx:{mb:4},children:B.slice(3,6).map((e,t)=>(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:4,children:(0,q.jsx)(zi,(0,r.A)({},e))},t))}),(0,q.jsx)(p.A,{variant:"h6",fontWeight:"bold",color:"white",gutterBottom:!0,sx:{mb:2},children:"Operations & Inventory"}),(0,q.jsx)(b.A,{container:!0,spacing:3,sx:{mb:4},children:B.slice(6).map((e,t)=>(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:4,children:(0,q.jsx)(zi,(0,r.A)({},e))},t))})]}),(0,q.jsxs)(b.A,{container:!0,spacing:3,sx:{mb:4},children:[(0,q.jsx)(b.A,{item:!0,xs:12,md:8,children:(0,q.jsx)(Ni,{title:"Visitors Overview",height:350,children:!c&&I&&I.length>0&&l?(0,q.jsx)(pt.u,{width:"100%",height:"100%",children:(0,q.jsxs)(gt.Q,{data:I,children:[(0,q.jsx)("defs",{children:(0,q.jsxs)("linearGradient",{id:"colorUv",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,q.jsx)("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.3}),(0,q.jsx)("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.1})]})}),(0,q.jsx)(bt.d,{strokeDasharray:"3 3",stroke:"#334155"}),(0,q.jsx)(vt.W,{dataKey:"name",stroke:"#94a3b8"}),(0,q.jsx)(At.h,{stroke:"#94a3b8"}),(0,q.jsx)(jt.m,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"white"}}),(0,q.jsx)(ft.G,{type:"monotone",dataKey:"value",stroke:"#3b82f6",fill:"url(#colorUv)",strokeWidth:2})]})}):(0,q.jsx)(x.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:"No visitor data available"})})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:4,children:(0,q.jsx)(Bi,{data:D,title:"Product Categories"})})]}),(0,q.jsxs)(b.A,{container:!0,spacing:3,sx:{mb:4},children:[(0,q.jsx)(b.A,{item:!0,xs:12,md:6,children:(0,q.jsx)(Ni,{title:"Page Views & Completed Orders",height:350,children:!c&&W&&W.length>0&&l?(0,q.jsx)(pt.u,{width:"100%",height:"100%",children:(0,q.jsxs)(Si.E,{data:W,children:[(0,q.jsx)(bt.d,{strokeDasharray:"3 3",stroke:"#334155"}),(0,q.jsx)(vt.W,{dataKey:"name",stroke:"#94a3b8"}),(0,q.jsx)(At.h,{stroke:"#94a3b8"}),(0,q.jsx)(jt.m,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"white"}}),(0,q.jsx)(yt.s,{}),(0,q.jsx)(ki.y,{dataKey:"pageViews",fill:"#3b82f6",name:"Page Views",radius:[4,4,0,0]}),(0,q.jsx)(ki.y,{dataKey:"completedOrders",fill:"#10b981",name:"Completed Orders",radius:[4,4,0,0]})]})}):(0,q.jsx)(x.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:"No data available"})})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:6,children:(0,q.jsx)(Ni,{title:"Orders & Revenue (MWK)",height:350,children:!c&&_&&_.length>0&&l?(0,q.jsx)(pt.u,{width:"100%",height:"100%",children:(0,q.jsxs)(Ci.b,{data:_,children:[(0,q.jsx)(bt.d,{strokeDasharray:"3 3",stroke:"#334155"}),(0,q.jsx)(vt.W,{dataKey:"name",stroke:"#94a3b8"}),(0,q.jsx)(At.h,{yAxisId:"left",stroke:"#94a3b8",label:{value:"Orders",angle:-90,position:"insideLeft",fill:"#94a3b8"}}),(0,q.jsx)(At.h,{yAxisId:"right",orientation:"right",stroke:"#8b5cf6",label:{value:"Revenue (MWK)",angle:90,position:"insideRight",fill:"#8b5cf6"}}),(0,q.jsx)(jt.m,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"white"},formatter:(e,t)=>"Revenue (MWK)"===t||"Revenue (GBP equiv)"===t?"MWK ".concat(e.toLocaleString()):e}),(0,q.jsx)(yt.s,{}),(0,q.jsx)(Pi.N,{yAxisId:"left",type:"monotone",dataKey:"orders",stroke:"#06b6d4",name:"Orders",strokeWidth:2,dot:{r:4}}),(0,q.jsx)(Pi.N,{yAxisId:"right",type:"monotone",dataKey:"revenueMWK",stroke:"#8b5cf6",name:"Revenue (MWK)",strokeWidth:2,dot:{r:4}})]})}):(0,q.jsx)(x.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:"No data available"})})})]}),"      ",(0,q.jsxs)(b.A,{container:!0,spacing:3,children:[(0,q.jsx)(b.A,{item:!0,xs:12,md:4,children:(0,q.jsx)(Ni,{title:"Conversion Rate",height:300,children:null!==l&&void 0!==l&&l.conversion_stats?(0,q.jsxs)(x.A,{sx:{p:2},children:[(0,q.jsxs)(p.A,{variant:"h4",sx:{color:"#10b981",mb:2,fontWeight:"bold"},children:[l.conversion_stats.overall_conversion_rate,"%"]}),(0,q.jsx)(p.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:2},children:"Overall Conversion Rate"}),(0,q.jsxs)(x.A,{sx:{mb:2},children:[(0,q.jsx)(p.A,{variant:"body2",sx:{fontWeight:600,color:"#94a3b8",mb:1},children:"Conversion Funnel (Last 30 Days)"}),(0,q.jsxs)(p.A,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:["\ud83d\udc41\ufe0f Page Viewers: ",(0,q.jsx)("strong",{children:(null===(e=l.conversion_stats.total_page_viewers)||void 0===e?void 0:e.toLocaleString())||0})]}),(0,q.jsxs)(p.A,{variant:"body2",color:"text.secondary",sx:{mb:.5,pl:1},children:["\u21b3 Product Viewers: ",(0,q.jsx)("strong",{children:(null===(t=l.conversion_stats.total_product_viewers)||void 0===t?void 0:t.toLocaleString())||0}),(0,q.jsxs)("span",{style:{color:"#10b981",marginLeft:"8px"},children:["(",l.conversion_stats.view_to_product_rate||0,"%)"]})]}),(0,q.jsxs)(p.A,{variant:"body2",color:"text.secondary",sx:{mb:.5,pl:2},children:["\u21b3 Added to Cart: ",(0,q.jsx)("strong",{children:(null===(i=l.conversion_stats.cart_users)||void 0===i?void 0:i.toLocaleString())||0}),(0,q.jsxs)("span",{style:{color:"#10b981",marginLeft:"8px"},children:["(",l.conversion_stats.product_to_cart_rate||0,"%)"]})]}),(0,q.jsxs)(p.A,{variant:"body2",color:"text.secondary",sx:{mb:.5,pl:3},children:["\u21b3 Started Checkout: ",(0,q.jsx)("strong",{children:(null===(s=l.conversion_stats.checkout_users)||void 0===s?void 0:s.toLocaleString())||0}),(0,q.jsxs)("span",{style:{color:"#10b981",marginLeft:"8px"},children:["(",l.conversion_stats.cart_to_checkout_rate||0,"%)"]})]}),(0,q.jsxs)(p.A,{variant:"body2",color:"text.secondary",sx:{pl:4},children:["\u2705 Completed Orders: ",(0,q.jsx)("strong",{children:(null===(o=l.conversion_stats.completed_orders)||void 0===o?void 0:o.toLocaleString())||0}),(0,q.jsxs)("span",{style:{color:"#10b981",marginLeft:"8px"},children:["(",l.conversion_stats.checkout_to_order_rate||0,"%)"]})]})]})]}):(0,q.jsx)(x.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:"No conversion data available"})})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:4,children:(0,q.jsx)(Ni,{title:"Stock Status",height:300,children:null!==l&&void 0!==l&&l.gadget_stats?(0,q.jsxs)(x.A,{sx:{p:2},children:[(0,q.jsxs)(p.A,{variant:"h6",sx:{mb:2,color:"#10b981",fontWeight:"bold"},children:[l.gadget_stats.active_gadgets||0," / ",l.gadget_stats.total_gadgets||0," Active"]}),(0,q.jsxs)(x.A,{sx:{mb:2},children:[(0,q.jsxs)(p.A,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:["In Stock: ",l.gadget_stats.in_stock_gadgets||0]}),(0,q.jsxs)(p.A,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:["Low Stock: ",l.gadget_stats.low_stock_gadgets||0]}),(0,q.jsxs)(p.A,{variant:"body2",color:"text.secondary",children:["Out of Stock: ",l.gadget_stats.out_of_stock_gadgets||0]})]}),(0,q.jsxs)(p.A,{variant:"body2",color:"text.secondary",children:["Total Units: ",l.gadget_stats.total_stock_units||0]})]}):(0,q.jsx)(x.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:"No stock data available"})})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:4,children:(0,q.jsx)(Ni,{title:"Subscription Status",height:300,children:null!==l&&void 0!==l&&l.subscription_stats?(0,q.jsxs)(x.A,{sx:{p:2},children:[(0,q.jsxs)(p.A,{variant:"h6",sx:{mb:2,color:"#ec4899",fontWeight:"bold"},children:[l.subscription_stats.active_subscriptions||0," Active"]}),(0,q.jsxs)(x.A,{sx:{mb:2},children:[(0,q.jsxs)(p.A,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:["Plus Subscribers: ",l.subscription_stats.plus_subscribers||0]}),(0,q.jsxs)(p.A,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:["Premium Subscribers: ",l.subscription_stats.premium_subscribers||0]}),(0,q.jsxs)(p.A,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:["Pending: ",l.subscription_stats.pending_subscriptions||0]}),(0,q.jsxs)(p.A,{variant:"body2",color:"text.secondary",children:["Suspended: ",l.subscription_stats.suspended_subscriptions||0]})]})]}):(0,q.jsx)(x.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:"No subscription data available"})})})]}),(0,q.jsx)(p.A,{variant:"h6",fontWeight:"bold",color:"white",sx:{mt:4,mb:2},children:"Users & Trending"}),(0,q.jsxs)(b.A,{container:!0,spacing:3,sx:{mb:4},children:[(0,q.jsx)(b.A,{item:!0,xs:12,md:6,children:(0,q.jsx)(Ni,{title:"Users by Role",height:280,children:M&&M.length>0?(0,q.jsx)(pt.u,{width:"100%",height:"100%",children:(0,q.jsxs)(Si.E,{data:M,children:[(0,q.jsx)(bt.d,{strokeDasharray:"3 3",stroke:"#334155"}),(0,q.jsx)(vt.W,{dataKey:"name",stroke:"#94a3b8"}),(0,q.jsx)(At.h,{stroke:"#94a3b8"}),(0,q.jsx)(jt.m,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"white"}}),(0,q.jsx)(ki.y,{dataKey:"value",fill:"#3b82f6",radius:[4,4,0,0]})]})}):(0,q.jsx)(x.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:"No users data available"})})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:6,children:(0,q.jsx)(Ni,{title:"Trending Gadgets",height:280,children:z&&z.length>0?(0,q.jsx)(pt.u,{width:"100%",height:"100%",children:(0,q.jsxs)(Si.E,{data:z,layout:"vertical",children:[(0,q.jsx)(bt.d,{strokeDasharray:"3 3",stroke:"#334155"}),(0,q.jsx)(vt.W,{type:"number",stroke:"#94a3b8"}),(0,q.jsx)(At.h,{dataKey:"name",type:"category",stroke:"#94a3b8",width:120,tick:{fontSize:12}}),(0,q.jsx)(jt.m,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"white"}}),(0,q.jsx)(ki.y,{dataKey:"value",fill:"#0ea5e9",radius:[0,4,4,0]})]})}):(0,q.jsx)(x.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#94a3b8"},children:"No trending gadgets data available"})})})]})]})}var Ei=i(53291),Ti=i(38006),Ri=i(23644),Oi=i(66455),Ui=i(4628),Li=i(83733),qi=i(79973),Gi=i(93934),Vi=i(38370),Hi=i(99896),Ki=i(15672),Qi=i(54048),Yi=i(87757),Xi=i(63577),Ji=i(3298),Zi=i(51593);const $i=e=>{let{subscription:t,user:i,onPaymentInitiated:r}=e;const[s,o]=(0,n.useState)(!1),[a,l]=(0,n.useState)(null);if(!t||"paychangu"!==t.gateway||!t.requiresPayment)return null;const d=(()=>{if(!t.gracePeriodEnd)return null;const e=new Date,i=new Date(t.gracePeriodEnd)-e,r=Math.ceil(i/864e5);return r>0?r:0})(),c=null!==d&&d<=3,u=t.price||"MWK 10,000/month";return(0,q.jsx)(w.A,{elevation:c?8:3,sx:{mb:3,border:c?"2px solid":"1px solid",borderColor:c?"error.main":"warning.main",backgroundColor:c?"error.light":"warning.light",animation:c?"pulse 2s ease-in-out infinite":"none","@keyframes pulse":{"0%, 100%":{transform:"scale(1)"},"50%":{transform:"scale(1.02)"}}},children:(0,q.jsx)(S.A,{children:(0,q.jsxs)(x.A,{display:"flex",alignItems:"flex-start",gap:2,children:[(0,q.jsx)(Ji.A,{sx:{fontSize:48,color:c?"error.main":"warning.main",animation:c?"shake 0.5s ease-in-out infinite":"none","@keyframes shake":{"0%, 100%":{transform:"rotate(0deg)"},"25%":{transform:"rotate(-5deg)"},"75%":{transform:"rotate(5deg)"}}}}),(0,q.jsxs)(x.A,{flex:1,children:[(0,q.jsxs)(x.A,{display:"flex",alignItems:"center",gap:1,mb:1,children:[(0,q.jsx)(Xi.A,{sx:{m:0,fontWeight:"bold",fontSize:"1.25rem"},children:c?"\ud83d\udea8 URGENT: Payment Required!":"\u26a0\ufe0f Subscription Payment Due"}),null!==d&&(0,q.jsx)(Be.A,{icon:(0,q.jsx)(Zi.A,{}),label:0===d?"Due Today":"".concat(d," day").concat(1!==d?"s":""," left"),color:c?"error":"warning",size:"small",sx:{fontWeight:"bold"}})]}),(0,q.jsxs)(p.A,{variant:"body1",gutterBottom:!0,children:["Your ",(0,q.jsx)("strong",{children:"premium"===t.tier?"Xtrapush Premium":"Xtrapush Plus"})," subscription renewal payment is due. Complete your payment now to continue enjoying:"]}),(0,q.jsxs)(x.A,{component:"ul",sx:{my:2,pl:3,"& li":{mb:.5}},children:[(0,q.jsx)("li",{children:"\u2728 Free gadget insurance"}),(0,q.jsx)("li",{children:"\ud83d\ude9a Free delivery on all orders"}),"premium"===t.tier&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)("li",{children:"\ud83d\udcf1 Multiple gadget coverage"}),(0,q.jsx)("li",{children:"\u26a1 Priority customer support"})]})]}),(0,q.jsxs)(x.A,{sx:{p:2,bgcolor:"background.paper",borderRadius:1,mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"body2",color:"text.secondary",children:"Amount Due:"}),(0,q.jsx)(p.A,{variant:"h5",fontWeight:"bold",children:u.split("/")[0]})]}),null!==d&&d<=0&&(0,q.jsx)(p.A,{variant:"caption",color:"error",fontWeight:"bold",children:"Grace period ending soon!"})]}),a&&(0,q.jsx)(Pe.A,{severity:"error",sx:{mb:2},children:a}),(0,q.jsxs)(x.A,{display:"flex",gap:2,flexWrap:"wrap",children:[(0,q.jsx)(f.A,{variant:"contained",size:"large",startIcon:s?(0,q.jsx)(Ie.A,{size:20,color:"inherit"}):(0,q.jsx)(Ye.A,{}),onClick:async()=>{if(null!==i&&void 0!==i&&i.uid){o(!0),l(null);try{const e=await Te.Ho.renewWithPaychangu({userUid:i.uid,tier:t.tier||"plus"});null!==e&&void 0!==e&&e.checkout_url?(r&&r(e),window.location.href=e.checkout_url):l((null===e||void 0===e?void 0:e.error)||"Failed to create checkout. Please try again.")}catch(s){var e,n;console.error("Renewal checkout error:",s),l((null===s||void 0===s||null===(e=s.response)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.error)||(null===s||void 0===s?void 0:s.message)||"Failed to process payment. Please try again.")}finally{o(!1)}}else l("Please log in to continue your subscription")},disabled:s,sx:{backgroundColor:c?"error.main":"warning.dark","&:hover":{backgroundColor:c?"error.dark":"warning.main"},fontWeight:"bold",fontSize:"1.1rem",px:4,py:1.5},children:s?"Processing...":"Continue Plan - Pay Now"}),(0,q.jsx)(p.A,{variant:"caption",color:"text.secondary",alignSelf:"center",children:"Secure payment via PayChangu"})]}),null!==d&&d>0&&(0,q.jsxs)(p.A,{variant:"caption",color:"text.secondary",sx:{mt:2,display:"block"},children:["\ud83d\udca1 ",(0,q.jsx)("strong",{children:"Note:"})," If payment is not received within ",d," day",1!==d?"s":"",", your subscription will be suspended and benefits will be temporarily unavailable."]})]})]})})})};var er=i(39779),tr=i(5096),ir=i(35163),rr=i(75026),nr=i(41680),sr=i(18643),or=i(23904),ar=i(60904),lr=i(74946);const dr=e=>{let{open:t=!1,onClose:i=()=>{},onLinkSuccess:r=()=>{},deviceIdToLink:s=null,linkedBy:o="MANUAL"}=e;const{user:a}=(0,L.A)(),[l,d]=(0,n.useState)(null),[c,u]=(0,n.useState)([]),[h,m]=(0,n.useState)(!0),[g,b]=(0,n.useState)(!1),[A,j]=(0,n.useState)(null),[y,w]=(0,n.useState)(null);(0,n.useEffect)(()=>{t&&null!==a&&void 0!==a&&a.uid&&S()},[t,null===a||void 0===a?void 0:a.uid]),(0,n.useEffect)(()=>{if(s&&c.length>0){c.find(e=>e.id===s)&&d(s)}},[s,c]);const S=async()=>{try{m(!0),j(null);const e=await(0,Yi.oX)(a.uid);null!==e&&void 0!==e&&e.linkedDevice&&w(e.linkedDevice);const t=await(0,Yi.Am)(a.uid);null!==t&&void 0!==t&&t.devices&&(u(t.devices),s&&t.devices.some(e=>e.id===s)&&d(s))}catch(e){console.error("Failed to load device info:",e),j("Failed to load devices. Please try again.")}finally{m(!1)}},k=e=>{if(!e)return(0,q.jsx)(er.A,{});const t=e.toLowerCase();return t.includes("phone")||t.includes("smartphone")?(0,q.jsx)(er.A,{}):t.includes("laptop")||t.includes("computer")?(0,q.jsx)(tr.A,{}):t.includes("tablet")?(0,q.jsx)(ir.A,{}):(0,q.jsx)(er.A,{})};return(0,q.jsxs)(se.A,{open:t,onClose:i,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{background:"linear-gradient(135deg, rgba(5, 19, 35, 0.95) 0%, rgba(16, 56, 82, 0.9) 100%)",border:"2px solid rgba(72, 206, 219, 0.2)"}},children:[(0,q.jsxs)(oe.A,{sx:{background:"linear-gradient(135deg, #48cedb 0%, #10B981 100%)",color:"white",display:"flex",alignItems:"center",gap:1,fontWeight:"bold"},children:[(0,q.jsx)(or.A,{})," Link Device to Your Subscription"]}),(0,q.jsx)(ae.A,{sx:{pt:3,pb:2},children:h?(0,q.jsx)(x.A,{sx:{display:"flex",justifyContent:"center",py:4},children:(0,q.jsx)(Ie.A,{sx:{color:"#48cedb"}})}):(0,q.jsxs)(tt.A,{spacing:3,children:[A&&(0,q.jsx)(Pe.A,{severity:"error",icon:(0,q.jsx)(ar.A,{}),sx:{bgcolor:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",color:"#FCA5A5"},children:A}),y&&(0,q.jsxs)(Pe.A,{severity:"info",icon:(0,q.jsx)(lr.A,{}),sx:{bgcolor:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.3)",color:"#86EFAC"},children:["Currently linked: ",(0,q.jsx)("strong",{children:y.name})]}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)",mb:1},children:"AUTO_CHECKOUT"===o?"\ud83c\udf89 Your new purchase will be protected by your subscription":"Select a device from your order history to protect with your subscription"}),c.length>0?(0,q.jsx)(rr.A,{value:(null===l||void 0===l?void 0:l.toString())||"",onChange:e=>d(parseInt(e.target.value)),children:(0,q.jsx)(tt.A,{spacing:1.5,children:c.map(e=>(0,q.jsx)(v.A,{sx:{p:2,cursor:"pointer",bgcolor:l===e.id?"rgba(72, 206, 219, 0.15)":"rgba(5, 19, 35, 0.6)",border:l===e.id?"2px solid #48cedb":"2px solid rgba(72, 206, 219, 0.2)",transition:"all 0.3s ease","&:hover":{bgcolor:"rgba(72, 206, 219, 0.1)",border:"2px solid rgba(72, 206, 219, 0.4)"}},children:(0,q.jsx)(nr.A,{value:e.id,control:(0,q.jsx)(sr.A,{sx:{color:"#48cedb"}}),label:(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:2,flex:1},children:[(0,q.jsx)(z.A,{sx:{width:48,height:48,bgcolor:"rgba(72, 206, 219, 0.2)",color:"#48cedb"},children:k(e.category)}),(0,q.jsxs)(x.A,{sx:{flex:1},children:[(0,q.jsx)(p.A,{variant:"subtitle1",sx:{color:"white",fontWeight:600,mb:.5},children:e.name}),(0,q.jsxs)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)",display:"flex",alignItems:"center",gap:.5},children:[(0,q.jsx)(mt.A,{sx:{fontSize:14}}),new Date(e.orderDate).toLocaleDateString()]})]}),(0,q.jsx)(Be.A,{label:e.category,size:"small",sx:{bgcolor:"rgba(72, 206, 219, 0.2)",color:"#48cedb"}})]}),sx:{width:"100%",ml:0}})},e.id))})}):(0,q.jsxs)(v.A,{sx:{p:3,textAlign:"center",bgcolor:"rgba(245, 158, 11, 0.08)",border:"2px dashed rgba(245, 158, 11, 0.4)",borderRadius:2},children:[(0,q.jsx)(mt.A,{sx:{fontSize:48,color:"rgba(245, 158, 11, 0.5)",mb:1}}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)",mb:2},children:"No recent purchases found"}),(0,q.jsx)(f.A,{variant:"outlined",href:"/gadgets",sx:{color:"#48cedb",borderColor:"#48cedb","&:hover":{bgcolor:"rgba(72, 206, 219, 0.1)"}},children:"Browse Gadgets"})]}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)",display:"block",pt:2,borderTop:"1px solid rgba(72, 206, 219, 0.2)"},children:"\ud83d\udca1 Your subscription covers device insurance, free delivery, and member discounts."})]})}),(0,q.jsxs)(le.A,{sx:{p:2,gap:1},children:[(0,q.jsx)(f.A,{onClick:i,sx:{color:"rgba(255, 255, 255, 0.7)","&:hover":{bgcolor:"rgba(255, 255, 255, 0.1)"}},children:"Cancel"}),(0,q.jsx)(f.A,{onClick:async()=>{if(l)try{b(!0),j(null);const e=await(0,Yi.RF)(a.uid,l,o);null!==e&&void 0!==e&&e.success&&(w(e.linkedDevice),r(e.linkedDevice),setTimeout(()=>{i()},1500))}catch(e){console.error("Failed to link device:",e),j(e.message||"Failed to link device. Please try again.")}finally{b(!1)}else j("Please select a device to link")},disabled:!l||g||h,variant:"contained",sx:{bgcolor:"#48cedb",color:"#051323",fontWeight:"bold","&:hover":{bgcolor:"#3aa6b8"},"&:disabled":{bgcolor:"rgba(72, 206, 219, 0.3)"}},children:g?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(Ie.A,{size:16,sx:{mr:1,color:"inherit"}}),"Linking..."]}):"Link Device"})]})]})},cr=e=>{let{subscription:t=null,onDeviceChanged:i=()=>{}}=e;const{user:r}=(0,L.A)(),[s,o]=(0,n.useState)(null),[a,l]=(0,n.useState)(!0),[d,c]=(0,n.useState)(!1),[u,h]=(0,n.useState)(!1);(0,n.useEffect)(()=>{null!==r&&void 0!==r&&r.uid&&null!==t&&void 0!==t&&t.isActive?m():l(!1)},[null===r||void 0===r?void 0:r.uid,null===t||void 0===t?void 0:t.isActive]);const m=async()=>{try{l(!0);const e=await(0,Yi.oX)(r.uid);o((null===e||void 0===e?void 0:e.linkedDevice)||null)}catch(e){console.error("Failed to load linked device:",e)}finally{l(!1)}},g=e=>{o(e),i(e)};return null!==t&&void 0!==t&&t.isActive?a?(0,q.jsx)(v.A,{sx:{p:3,bgcolor:"rgba(5, 19, 35, 0.6)",border:"1px solid rgba(72, 206, 219, 0.2)",display:"flex",justifyContent:"center",alignItems:"center",minHeight:120},children:(0,q.jsx)(Ie.A,{sx:{color:"#48cedb"},size:32})}):"plus"!==t.tier||s?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(v.A,{sx:{p:3,background:"linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(72, 206, 219, 0.05) 100%)",border:"2px solid rgba(16, 185, 129, 0.3)",borderRadius:2},children:(0,q.jsxs)(tt.A,{spacing:2.5,children:[(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(ot.A,{sx:{color:"#10B981",fontSize:24}}),(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"h6",sx:{color:"#10B981",fontWeight:700,mb:.25},children:"Device Protection Active"}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"premium"===t.tier?"All your devices are covered":"Protection active on this device"})]})]}),"plus"===t.tier&&s&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(x.A,{sx:{p:2,bgcolor:"rgba(5, 19, 35, 0.6)",border:"1px solid rgba(16, 185, 129, 0.2)",borderRadius:1.5,display:"flex",alignItems:"center",gap:2},children:[(0,q.jsx)(z.A,{sx:{width:56,height:56,bgcolor:"rgba(16, 185, 129, 0.2)",color:"#10B981",flexShrink:0},children:(e=>{if(!e)return(0,q.jsx)(er.A,{});const t=e.toLowerCase();return t.includes("phone")||t.includes("smartphone")?(0,q.jsx)(er.A,{}):t.includes("laptop")||t.includes("computer")?(0,q.jsx)(tr.A,{}):t.includes("tablet")?(0,q.jsx)(ir.A,{}):(0,q.jsx)(er.A,{})})(s.category)}),(0,q.jsxs)(x.A,{sx:{flex:1,minWidth:0},children:[(0,q.jsx)(p.A,{variant:"subtitle2",sx:{color:"white",fontWeight:600,mb:.5,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.name}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)"},children:s.category})]}),(0,q.jsx)(Be.A,{icon:(0,q.jsx)(ot.A,{}),label:"Protected",size:"small",sx:{bgcolor:"rgba(16, 185, 129, 0.2)",color:"#10B981",fontWeight:600,flexShrink:0}})]}),(0,q.jsx)(f.A,{variant:"outlined",size:"small",startIcon:(0,q.jsx)(Li.A,{}),onClick:()=>h(!0),sx:{color:"#48cedb",borderColor:"#48cedb",borderWidth:2,fontWeight:600,"&:hover":{borderColor:"#48cedb",backgroundColor:"rgba(72, 206, 219, 0.1)",borderWidth:2}},children:"Change Device"})]}),"premium"===t.tier&&(0,q.jsxs)(x.A,{sx:{p:2,bgcolor:"rgba(124, 58, 237, 0.1)",border:"1px solid rgba(124, 58, 237, 0.2)",borderRadius:1.5},children:[(0,q.jsx)(p.A,{variant:"body2",sx:{color:"white",mb:1},children:(0,q.jsx)("strong",{children:"\ud83c\udf89 All Your Devices Are Protected"})}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Your XtraPush Premium covers every device in your account. Coverage includes device insurance, free delivery, and exclusive discounts."})]}),(0,q.jsxs)(x.A,{sx:{p:2,bgcolor:"rgba(5, 19, 35, 0.4)",border:"1px solid rgba(72, 206, 219, 0.1)",borderRadius:1.5},children:[(0,q.jsx)(p.A,{variant:"subtitle2",sx:{color:"white",fontWeight:600,mb:1},children:"What's Included:"}),(0,q.jsxs)(tt.A,{spacing:.75,children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.8)",display:"flex",alignItems:"center",gap:.75},children:"\u2713 Device insurance (1 year)"}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.8)",display:"flex",alignItems:"center",gap:.75},children:"\u2713 Free unlimited delivery"}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.8)",display:"flex",alignItems:"center",gap:.75},children:"\u2713 Member-exclusive discounts"}),"premium"===t.tier&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.8)",display:"flex",alignItems:"center",gap:.75},children:"\u2713 Priority support"}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.8)",display:"flex",alignItems:"center",gap:.75},children:"\u2713 Early access to new gadgets"})]})]})]})]})}),(0,q.jsxs)(se.A,{open:u,onClose:()=>h(!1),maxWidth:"xs",fullWidth:!0,PaperProps:{sx:{background:"linear-gradient(135deg, rgba(5, 19, 35, 0.95) 0%, rgba(16, 56, 82, 0.9) 100%)",border:"2px solid rgba(72, 206, 219, 0.2)"}},children:[(0,q.jsx)(oe.A,{sx:{color:"white",fontWeight:"bold"},children:"Change Protected Device?"}),(0,q.jsxs)(ae.A,{sx:{pt:3},children:[(0,q.jsxs)(p.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)",mb:2},children:["Switching to a different device will move coverage from ",(0,q.jsx)("strong",{children:null===s||void 0===s?void 0:s.name})," to your new selection."]}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Make sure the device is from your purchase history."})]}),(0,q.jsxs)(le.A,{sx:{p:2,gap:1},children:[(0,q.jsx)(f.A,{onClick:()=>h(!1),sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Cancel"}),(0,q.jsx)(f.A,{onClick:()=>{h(!1),c(!0)},variant:"contained",sx:{bgcolor:"#48cedb",color:"#051323",fontWeight:"bold"},children:"Change Device"})]})]}),(0,q.jsx)(dr,{open:d,onClose:()=>c(!1),onLinkSuccess:g,linkedBy:"MANUAL"})]}):(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(Pe.A,{severity:"warning",icon:(0,q.jsx)(Ji.A,{}),action:(0,q.jsx)(f.A,{color:"inherit",size:"small",onClick:()=>c(!0),sx:{fontWeight:600},children:"Link Now"}),sx:{bgcolor:"rgba(245, 158, 11, 0.1)",border:"2px solid rgba(245, 158, 11, 0.3)",color:"#FECACA",mb:2},children:(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"subtitle2",sx:{fontWeight:700,mb:.5},children:"Link a device to activate protection"}),(0,q.jsx)(p.A,{variant:"caption",children:"Your XtraPush Plus is ready to protect your device from damage and accidental drops."})]})}),(0,q.jsx)(dr,{open:d,onClose:()=>c(!1),onLinkSuccess:g,linkedBy:"MANUAL"})]}):null};var ur=i(77667),xr=i(43529),hr=i(29920),mr=i(5227);const pr=e=>{let{open:t,onClose:i,onSuccess:r,tier:s,amount:o,currency:a="GBP"}=e;const[l,d]=(0,n.useState)(!1),[c,u]=(0,n.useState)(!1),[h,m]=(0,n.useState)(""),[g,b]=(0,n.useState)(null),[v,A]=(0,n.useState)(null);(0,n.useEffect)(()=>{if(!t)return;const e=async()=>{if(window.Square)try{const e="sq0idp-DEaaRhZiolzBXU8jJ2WA1A",t="LH1ZRTHXWWT5J";if(!e||!t)throw new Error("Square credentials not configured. Please add REACT_APP_SQUARE_APP_ID and REACT_APP_SQUARE_LOCATION_ID to your .env file.");const i=window.Square.payments(e,t);b(i);const r=await i.card();await r.attach("#card-container"),A(r)}catch(e){console.error("Square initialization error:",e),m("Failed to initialize payment form: "+e.message)}else m("Square SDK not loaded")};return(async()=>{if(window.Square)return void e();const t=document.createElement("script");t.src="https://web.squarecdn.com/v1/square.js",t.async=!0,t.onload=()=>e(),t.onerror=()=>m("Failed to load Square payment system"),document.body.appendChild(t)})(),()=>{v&&v.destroy()}},[t]);const j="premium"===s?"Premium":"Plus",y="GBP"===a?"\xa3".concat((o/100).toFixed(2)):"".concat(a," ").concat(o);return(0,q.jsxs)(se.A,{open:t,onClose:i,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2,boxShadow:24,bgcolor:"#fff",color:"#333"}},children:[(0,q.jsxs)(oe.A,{sx:{borderBottom:"1px solid #e0e0e0",display:"flex",alignItems:"center",gap:1,bgcolor:"#fff",color:"#333"},children:[(0,q.jsx)(mr.A,{sx:{color:"#48cedb"}}),(0,q.jsx)(x.A,{component:"span",children:"Setup Payment Method"})]}),(0,q.jsxs)(ae.A,{sx:{pt:3,bgcolor:"#fff"},children:[(0,q.jsxs)(x.A,{sx:{mb:3},children:[(0,q.jsxs)(p.A,{variant:"body1",sx:{mb:1,fontWeight:600,color:"#333"},children:["Xtrapush ",j," Subscription"]}),(0,q.jsxs)(p.A,{variant:"h4",sx:{color:"#48cedb",fontWeight:700},children:[y,(0,q.jsx)(p.A,{component:"span",variant:"body2",sx:{color:"#666"},children:"/month"})]})]}),(0,q.jsxs)(x.A,{sx:{mb:3,p:2,bgcolor:"#f0f7f8",borderRadius:1,border:"1px solid #e0e0e0"},children:[(0,q.jsx)(p.A,{variant:"body2",sx:{mb:1,color:"#333"},children:"\u2705 Free unlimited delivery"}),(0,q.jsxs)(p.A,{variant:"body2",sx:{mb:1,color:"#333"},children:["\u2705 ","premium"===s?"Multiple":"Single"," device insurance"]}),(0,q.jsx)(p.A,{variant:"body2",sx:{mb:1,color:"#333"},children:"\u2705 Member discounts"}),"premium"===s&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(p.A,{variant:"body2",sx:{mb:1,color:"#333"},children:"\u2705 Priority support"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"#333"},children:"\u2705 Early access to new gadgets"})]})]}),h&&(0,q.jsx)(Pe.A,{severity:"error",sx:{mb:2},children:h}),(0,q.jsxs)(x.A,{sx:{mb:3},children:[(0,q.jsx)(p.A,{variant:"body2",sx:{mb:1,fontWeight:600,color:"#333"},children:"Card Details"}),(0,q.jsx)(x.A,{id:"card-container",sx:{border:"1px solid #ccc",borderRadius:1,padding:2,minHeight:100,bgcolor:"#fff"}})]}),(0,q.jsx)(nr.A,{control:(0,q.jsx)(hr.A,{checked:c,onChange:e=>u(e.target.checked),sx:{color:"#48cedb","&.Mui-checked":{color:"#48cedb"}}}),label:(0,q.jsxs)(p.A,{variant:"body2",sx:{color:"#333"},children:["I confirm my subscription to Xtrapush ",j," for ",y,"/month. My card will be charged automatically each month. I can cancel anytime."]})})]}),(0,q.jsxs)(le.A,{sx:{p:2,borderTop:"1px solid #e0e0e0",bgcolor:"#fff"},children:[(0,q.jsx)(f.A,{onClick:i,disabled:l,sx:{color:"#666"},children:"Cancel"}),(0,q.jsx)(f.A,{onClick:async()=>{if(c)if(v){d(!0),m("");try{const e=await v.tokenize();if("OK"===e.status)r(e.token);else{let t="Card verification failed";e.errors&&(t=e.errors.map(e=>e.message).join(", ")),m(t),d(!1)}}catch(e){console.error("Tokenization error:",e),m("Failed to process card: "+e.message),d(!1)}}else m("Payment form not ready");else m("Please confirm you agree to the subscription terms")},disabled:!c||l||!v,variant:"contained",startIcon:l&&(0,q.jsx)(Ie.A,{size:20}),sx:{bgcolor:"#48cedb","&:hover":{bgcolor:"#3aa6b8"},"&:disabled":{bgcolor:"#ccc"}},children:l?"Processing...":"Subscribe for ".concat(y,"/month")})]})]})},gr=["children","sx","gradient"],br=()=>{var e,t,i,s,o,a,l,d,c,u,h,m,g,A,y,C,P,I,N,B,F,E,T,R,O,U,G,V,H,K,Q,Y,X,J,Z,$;const{user:ee,userRole:ie,isAdmin:re,isSeller:ne,isBuyer:ce,userProfile:pe,updateUserProfile:ge}=(0,L.A)(),{currency:be="GBP"}=(0,Ki.z)(),{currency:ve,formatLocalPrice:Ae,formatLocalPriceCompact:je}=(0,Re.e)(),{items:ye}=(0,Qi.n)(),we=ve||be||"GBP",Se=[{name:"XtraPush Plus",priceLabel:"GBP"===we?"\xa36/mo":"MWK 6,000/mo",color:"#48cedb",perks:["Free unlimited delivery","Single gadget insurance (1 year)","Member discounts"],cta:"Activate Plus"},{name:"XtraPush Premium",priceLabel:"GBP"===we?"\xa39.99/mo":"MWK 10,000/mo",color:"#7c3aed",perks:["Everything in Plus","Multiple gadget insurance (1 year each)","Priority support & early access"],cta:"Upgrade to Premium"}],[ke,Ce]=(0,n.useState)(!1),[Ie,We]=(0,n.useState)(!1),[_e,De]=(0,n.useState)(null),[Me,ze]=(0,n.useState)(!1),[Ne,Fe]=(0,n.useState)({fullName:"",email:"",town:"",address:"",postcode:"",phone:""}),Ee=e=>{if(!e)return 0;if("GBP"===we){var t,i;const r=null!==(t=null!==(i=null===e||void 0===e?void 0:e.price_gbp)&&void 0!==i?i:null===e||void 0===e?void 0:e.priceGbp)&&void 0!==t?t:null===e||void 0===e?void 0:e.price;return"string"===typeof r?Number(r.replace(/[^0-9.]/g,"")):Number(r)||0}const r=null===e||void 0===e?void 0:e.price;return"string"===typeof r?Number(r.replace(/[^0-9.]/g,"")):Number(r)||0},Oe=e=>{if(!e&&0!==e)return"".concat(we," N/A");const t=Number(e);return Number.isFinite(t)?Ae?Ae(t):"".concat(we," ").concat(Math.round(t).toLocaleString()):"".concat(we," N/A")},[Ue,Le]=(0,n.useState)({orders:[],wishlist:[],recentActivity:[],stats:{totalSpent:0,totalOrders:0,pendingOrders:0,completedOrders:0},recommendations:[],userPreferences:{},installments:[],notifications:[],subscription:null,tradeIns:[],variantsSummary:{totalVariants:0,lowStock:0,attributes:{}},allGadgets:[]}),[Ge,Ve]=(0,n.useState)(null),He=Boolean(Ge),[Ke,Qe]=(0,n.useState)(null),[Ye,Xe]=(0,n.useState)(""),[Je,Ze]=(0,n.useState)([]),[$e,et]=(Boolean(Ke),(0,n.useState)(!0)),[nt,st]=(0,n.useState)(null),[lt,ct]=(0,n.useState)(0),[ut,xt]=(0,n.useState)(!1),[pt,gt]=(0,n.useState)(!1),[bt,vt]=(0,n.useState)(!1),[At,jt]=(0,n.useState)(!1),[yt,ft]=(0,n.useState)(null),[wt,St]=(0,n.useState)(0),[kt,Ct]=(0,n.useState)(!1),[Pt,Wt]=(0,n.useState)(!1),[_t,Dt]=(0,n.useState)(null),[Mt,zt]=(0,n.useState)([]),[Nt,Bt]=(0,n.useState)(!1),[Ft,Et]=(0,n.useState)(null),[Tt,Rt]=(0,n.useState)(!1),[Ot,Ut]=(0,n.useState)(null),[Lt,qt]=(0,n.useState)(!1),Gt=null===(e=Ue.installments)||void 0===e?void 0:e[0],Vt=(null===Gt||void 0===Gt?void 0:Gt.progress)||0;(0,n.useEffect)(()=>{var e,t,i,r,n,s,o,a;Fe({fullName:null!==(e=null!==(t=null===pe||void 0===pe?void 0:pe.fullName)&&void 0!==t?t:null===ee||void 0===ee?void 0:ee.displayName)&&void 0!==e?e:"",email:null!==(i=null!==(r=null===pe||void 0===pe?void 0:pe.email)&&void 0!==r?r:null===ee||void 0===ee?void 0:ee.email)&&void 0!==i?i:"",town:null!==(n=null===pe||void 0===pe?void 0:pe.town)&&void 0!==n?n:"",address:null!==(s=null===pe||void 0===pe?void 0:pe.address)&&void 0!==s?s:"",postcode:null!==(o=null===pe||void 0===pe?void 0:pe.postcode)&&void 0!==o?o:"",phone:null!==(a=null===pe||void 0===pe?void 0:pe.phone)&&void 0!==a?a:""})},[pe,ee]);const Ht=e=>{Dt(e),Ct(!0)},Kt=e=>{Dt(e),Wt(!0)},Qt=async e=>{var t;if(null!==ee&&void 0!==ee&&ee.uid&&null!==ee&&void 0!==ee&&ee.email){if(null!==Ue&&void 0!==Ue&&null!==(t=Ue.subscription)&&void 0!==t&&t.isActive){const t=Ue.subscription.tier;if(t===e)return void alert("You already have an active ".concat("premium"===e?"Premium":"Plus"," subscription"));const i="plus"===t&&"premium"===e?"Upgrade to Premium? Your Plus subscription will be replaced.":"Downgrade to Plus? Your Premium subscription will be replaced.";if(!window.confirm(i))return}try{const t="MWK"===be,i=t?"MW":"GB";console.log("\ud83c\udf0d Location Detection:",{locationCurrency:be,isMalawi:t,countryCode:i,userCurrency:we}),console.log("Creating subscription with params:",{userUid:ee.uid,customerEmail:ee.email,tier:e,currency:t?"MWK":"GBP",countryCode:i});const r=await(0,Yi.Ky)({userUid:ee.uid,customerEmail:ee.email,successUrl:window.location.origin+"/dashboard?subscription=success",currency:t?"MWK":"GBP",tier:e,countryCode:i});console.log("Subscription result:",r),null!==r&&void 0!==r&&r.checkout_url?(console.log("Redirecting to PayChangu checkout:",r.checkout_url),window.location.href=r.checkout_url):null!==r&&void 0!==r&&r.requires_card?(console.log("Square requires card - opening modal"),Et({tier:e,amount:"premium"===e?999:600,currency:"GBP",customerId:r.customer_id}),Bt(!0)):null!==r&&void 0!==r&&r.success?(alert(r.message||"Subscription created successfully!"),window.location.reload()):(console.error("Unexpected result:",r),alert("Failed to start subscription. Please try again."))}catch(i){console.error("Subscription error:",i);const e=(null===i||void 0===i?void 0:i.message)||(null===i||void 0===i?void 0:i.error)||"Unknown error";alert("Failed to start subscription: ".concat(e))}}else alert("Please log in to subscribe")},Yt=async e=>{if(window.confirm("Are you sure you want to cancel trade-in application #".concat(e.reference,"?"))){qt(!0);try{const t=await Te._H.cancel(e.reference,null===ee||void 0===ee?void 0:ee.uid);if(null===t||void 0===t||!t.success)throw new Error((null===t||void 0===t?void 0:t.error)||"Failed to cancel trade-in");alert("Trade-in application cancelled successfully"),window.location.reload()}catch(t){console.error("Cancel trade-in error:",t),alert("Failed to cancel trade-in: ".concat((null===t||void 0===t?void 0:t.message)||"Unknown error"))}finally{qt(!1)}}};(0,n.useEffect)(()=>{ee&&(async()=>{try{var e,t,i;et(!0);const n=(null===ee||void 0===ee?void 0:ee.uid)||(null===ee||void 0===ee?void 0:ee.id)||null;if(!n)throw new Error("User not authenticated");const[s,o,a,l]=await Promise.allSettled([Te.gH.getUserOrders(n),Te.QO.getAll({limit:20}),Te.Ho.getStatus(n),Te._H.getHistory(n)]),d="fulfilled"===s.status&&null!==(e=s.value)&&void 0!==e&&e.orders?s.value.orders:[],c="fulfilled"===o.status&&null!==(t=o.value)&&void 0!==t&&t.data?o.value.data:"fulfilled"===o.status&&Array.isArray(o.value)?o.value:[],u="fulfilled"===a.status?a.value:null,x="fulfilled"===l.status&&null!==(i=l.value)&&void 0!==i&&i.tradeIns?l.value.tradeIns:[],h=ye||[],m={};let p=[];if(d.length>0){const e=[];if(d.forEach(t=>{t.items&&t.items.forEach(t=>{t.category&&!e.includes(t.category)&&e.push(t.category)})}),p=c.filter(t=>e.includes(t.category)).slice(0,12),p.length<12){const e=c.filter(e=>!p.some(t=>t.id===e.id)).sort((e,t)=>(t.views||0)-(e.views||0)).slice(0,12-p.length);p=[...p,...e]}}else p=c.sort((e,t)=>(t.views||0)-(e.views||0)).slice(0,12);const g={totalSpent:d.reduce((e,t)=>e+(t.totalAmount||0),0),totalOrders:d.length,pendingOrders:d.filter(e=>{var t,i;return!(null!==(t=e.status)&&void 0!==t&&t.includes("complete"))&&!(null!==(i=e.status)&&void 0!==i&&i.includes("delivered"))}).length,completedOrders:d.filter(e=>{var t,i;return(null===(t=e.status)||void 0===t?void 0:t.includes("complete"))||(null===(i=e.status)||void 0===i?void 0:i.includes("delivered"))}).length},b=[];for(const e of d){const t=null!==e&&void 0!==e&&e.notes?"string"===typeof e.notes?JSON.parse(e.notes):e.notes:{};if(null!==t&&void 0!==t&&t.installmentPlan){const i=t.installmentPlan;b.push({id:e.id,orderId:e.id,totalAmount:i.totalAmount||e.totalAmount||0,amountPaid:i.amountPaid||0,remaining:(i.totalAmount||e.totalAmount||0)-(i.amountPaid||0),weeks:i.weeks||0,weeklyAmount:i.weeklyAmount||0,startDate:i.startDate||e.createdAt,nextDueDate:i.nextDueDate||null,status:i.status||"pending",progress:i.amountPaid&&i.totalAmount?i.amountPaid/i.totalAmount*100:0})}}const v=[];v.push(...d.slice(0,3).map((e,t)=>{var i;return{id:"order-".concat(e.id||t),title:"Order #".concat(e.id||t+1),description:"Purchased ".concat((null===(i=e.items)||void 0===i?void 0:i.length)||1," item(s)"),date:e.createdAt||new Date(Date.now()-864e5*t).toISOString(),status:e.status||"pending",amount:e.totalAmount||0,type:"order"}})),b.forEach((e,t)=>{v.push({id:"installment-".concat(e.id||t),title:"Installment Payment",description:"Payment for Order #".concat(e.orderId),date:e.nextDueDate||(new Date).toISOString(),status:e.status,amount:e.weeklyAmount||0,type:"installment",progress:e.progress})}),v.sort((e,t)=>new Date(t.date)-new Date(e.date));const A=[];b.forEach(e=>{"overdue"===e.status?A.push({id:"notification-".concat(e.id,"-overdue"),title:"Installment Payment Overdue",message:"Payment for Order #".concat(e.orderId," is overdue. Please make payment as soon as possible."),date:(new Date).toISOString(),type:"warning",priority:"high"}):e.remaining>0&&A.push({id:"notification-".concat(e.id,"-upcoming"),title:"Upcoming Payment Due",message:"Next installment payment of ".concat(Oe(e.weeklyAmount)," due soon for Order #").concat(e.orderId,"."),date:e.nextDueDate||(new Date).toISOString(),type:"info",priority:"medium"})}),d.forEach(e=>{var t;null!==(t=e.status)&&void 0!==t&&t.includes("shipped")&&A.push({id:"notification-".concat(e.id,"-shipped"),title:"Order Shipped",message:"Your order #".concat(e.id," has been shipped and is on its way."),date:e.updatedAt||(new Date).toISOString(),type:"info",priority:"low"})});const j=(()=>{const e={totalVariants:0,lowStock:0,attributes:{}};try{c.forEach(t=>{const i=Array.isArray(t.variants)?t.variants:[];e.totalVariants+=i.length,i.forEach(t=>{"number"===typeof t.stock&&t.stock<=3&&(e.lowStock+=1),Object.keys(t||{}).forEach(i=>{if(["id","sku","price","stock"].includes(i))return;const r=t[i];null!=r&&(e.attributes[i]=e.attributes[i]||new Set,e.attributes[i].add(String(r)))})})}),Object.keys(e.attributes).forEach(t=>{e.attributes[t]=e.attributes[t].size})}catch(t){}return e})();let y=null;if(re())try{const e=await Te.rh.getDashboardStats();e&&(y=e)}catch(r){console.warn("Failed to fetch admin analytics:",r)}Le({orders:d,wishlist:h,recentActivity:v,stats:g,recommendations:p||[],userPreferences:m,installments:b,notifications:A,subscription:u,tradeIns:x,variantsSummary:j,allGadgets:c,adminAnalytics:y})}catch(n){console.error("Error fetching user dashboard data:",n),st(n.message||"Failed to load dashboard data")}finally{et(!1)}})()},[ee,ne,ye]),(0,n.useEffect)(()=>{(async()=>{try{if(!Gt||At)return;await(0,Yi.VQ)({orderId:Gt.orderId||Gt.id,daysBefore:1}),jt(!0)}catch(e){console.warn("Failed to schedule reminder",e)}})()},[Gt,At]);const Xt=e=>{let{children:t,sx:i={},gradient:n=!1}=e,s=(0,It.A)(e,gr);return(0,q.jsx)(w.A,(0,r.A)((0,r.A)({sx:(0,r.A)({bgcolor:n?"transparent":"#1e293b",background:n?"linear-gradient(135deg, rgba(30,41,59,0.95), rgba(51,65,85,0.92))":void 0,border:"1px solid #334155",borderRadius:2,height:"100%",transition:"transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease","&:hover":{borderColor:"#3b82f6",transform:"translateY(-4px)",boxShadow:"0 12px 40px rgba(59, 130, 246, 0.2)"}},i)},s),{},{children:t}))},Jt=e=>{let{title:t,icon:i,description:r,onClick:n,count:s,badge:o}=e;return(0,q.jsx)(Xt,{onClick:n,sx:{cursor:"pointer","&:hover":{transform:"translateY(-6px)",borderColor:"#48cedb",boxShadow:"0 16px 48px rgba(72, 206, 219, 0.3)"}},children:(0,q.jsxs)(S.A,{sx:{textAlign:"center",py:3,"&:last-child":{pb:3}},children:[(0,q.jsx)(x.A,{sx:{mb:2,position:"relative",display:"inline-block"},children:o?(0,q.jsx)(_.A,{badgeContent:o,color:"error",children:i}):i}),(0,q.jsx)(p.A,{variant:"h6",sx:{color:"#f8fafc",fontWeight:600,mb:1,fontFamily:"Poppins, sans-serif",fontSize:"1rem"},children:t}),void 0!==s&&(0,q.jsx)(p.A,{variant:"h4",sx:{color:"#3b82f6",fontWeight:"bold",mb:1,fontSize:"1.75rem"},children:s}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"#94a3b8",fontFamily:"Poppins, sans-serif",fontSize:"0.85rem"},children:r})]})})},Zt=e=>{let{icon:t,title:i,description:r,color:s="#3b82f6"}=e;return(0,q.jsx)(w.A,{sx:{bgcolor:"#1e293b",border:"1px solid #334155",borderRadius:2,height:"100%",transition:"transform 0.3s ease, border-color 0.3s ease","&:hover":{transform:"translateY(-4px)",borderColor:s}},children:(0,q.jsxs)(S.A,{sx:{textAlign:"center",py:3},children:[(0,q.jsx)(x.A,{sx:{mb:2},children:n.cloneElement(t,{sx:{fontSize:40,color:s}})}),(0,q.jsx)(p.A,{variant:"h6",sx:{color:"#f8fafc",fontWeight:600,mb:1,fontFamily:"Poppins, sans-serif",fontSize:"1rem"},children:i}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"#94a3b8",fontFamily:"Poppins, sans-serif",fontSize:"0.85rem"},children:r})]})})},$t=e=>{let{title:t,value:i,subtitle:r,icon:s,color:o="#3b82f6"}=e;return(0,q.jsx)(Xt,{children:(0,q.jsx)(S.A,{children:(0,q.jsxs)(tt.A,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:2,children:[(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"body2",sx:{color:"#94a3b8",mb:.5,fontFamily:"Poppins"},children:t}),(0,q.jsx)(p.A,{variant:"h4",fontWeight:"bold",sx:{color:o,fontFamily:"Poppins"},children:i}),r&&(0,q.jsx)(p.A,{variant:"caption",sx:{color:"#64748b"},children:r})]}),(0,q.jsx)(z.A,{sx:{bgcolor:"".concat(o,"22"),width:56,height:56,border:"2px solid ".concat(o,"33")},children:n.cloneElement(s,{sx:{color:o,fontSize:28}})})]})})})};if($e)return(0,q.jsxs)(x.A,{sx:{p:3,textAlign:"center"},children:[(0,q.jsx)(p.A,{variant:"h6",sx:{color:"white"},children:"Loading your dashboard..."}),(0,q.jsx)(qe.A,{sx:{mt:2}})]});if(nt)return(0,q.jsx)(x.A,{sx:{p:3},children:(0,q.jsxs)(Pe.A,{severity:"error",children:["Error loading dashboard: ",nt]})});const ei=e=>{const t=Math.ceil(Ue.recommendations.length/1);ct(i=>{const r=i+e;return r<0?t-1:r>=t?0:r})};return(0,q.jsxs)(x.A,{sx:{width:"100%",minHeight:"100vh",overflowY:"auto",overflowX:"hidden",bgcolor:"transparent",p:0},children:[(0,q.jsxs)(x.A,{sx:{px:{xs:2,sm:3,md:4},py:3,minHeight:"100%",paddingBottom:8,maxWidth:1400,mx:"auto"},children:[(0,q.jsxs)(x.A,{sx:{mb:5},children:[(0,q.jsxs)(x.A,{sx:{position:"sticky",top:0,zIndex:9,display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:2,px:{xs:1,sm:0},py:1,bgcolor:"rgba(5, 19, 35, 0.8)",borderBottom:"1px solid rgba(72, 206, 219, 0.15)"},children:[(0,q.jsxs)(x.A,{sx:{textAlign:"left"},children:[(0,q.jsxs)(p.A,{variant:"h3",component:"h1",sx:{color:"white",fontWeight:"bold",fontFamily:"Poppins, sans-serif",fontSize:{xs:"1.75rem",sm:"2.25rem",md:"2.5rem"},mb:.5},children:["Welcome back, ",(0,q.jsx)("span",{style:{color:"#48cedb"},children:(null===ee||void 0===ee?void 0:ee.displayName)||(null===ee||void 0===ee||null===(t=ee.email)||void 0===t?void 0:t.split("@")[0])||"User"})]}),(0,q.jsx)(p.A,{variant:"subtitle1",sx:{color:"rgba(255, 255, 255, 0.75)",fontFamily:"Poppins, sans-serif",fontSize:{xs:"0.9rem",sm:"1rem"},maxWidth:600},children:"Your central hub for orders, payments, devices, and inventory."})]}),(0,q.jsx)(f.A,{variant:"outlined",startIcon:(0,q.jsx)(de.A,{}),onClick:()=>window.location.href="/",sx:{color:"#48cedb",borderColor:"#48cedb",fontFamily:"Poppins, sans-serif",fontWeight:600,textTransform:"none",px:3,py:1,borderRadius:2,transition:"all 0.3s ease","&:hover":{borderColor:"#48cedb",bgcolor:"rgba(72, 206, 219, 0.1)",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(72, 206, 219, 0.3)"}},children:"Go Home"}),(0,q.jsxs)(D.A,{anchorEl:Ge,open:He,onClose:()=>Ve(null),PaperProps:{sx:{bgcolor:"rgba(5, 19, 35, 0.95)",border:"1px solid rgba(72, 206, 219, 0.3)","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none",msOverflowStyle:"none",overflowY:"auto",overflowX:"hidden"}},children:[0===Ue.notifications.length?(0,q.jsx)(j.A,{sx:{color:"rgba(255,255,255,0.8)"},children:"No notifications"}):Ue.notifications.slice(0,8).map(e=>(0,q.jsxs)(j.A,{sx:{color:"rgba(255,255,255,0.9)",display:"flex",alignItems:"start",gap:1},children:[(0,q.jsx)(te.A,{sx:{minWidth:28},children:"warning"===e.type?(0,q.jsx)(ht.A,{sx:{color:"#F59E0B"}}):(0,q.jsx)(xe.A,{sx:{color:"#48cedb"}})}),(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"body2",sx:{fontWeight:600},children:e.title}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255,255,255,0.7)"},children:new Date(e.date).toLocaleString()}),(0,q.jsx)(p.A,{variant:"caption",sx:{display:"block"},children:e.message})]})]},e.id)),Ue.notifications.length>8&&(0,q.jsx)(j.A,{sx:{color:"#48cedb",fontWeight:600},onClick:()=>window.location.href="/dashboard/notifications",children:"View all notifications"})]})]}),Ue.subscription&&(0,q.jsx)($i,{subscription:Ue.subscription,user:ee,onPaymentInitiated:e=>{console.log("Payment initiated for subscription renewal",e)}}),(0,q.jsx)(b.A,{container:!0,spacing:2,sx:{mt:2},children:re()?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsx)($t,{title:"Total Revenue",value:null!==(i=Ue.adminAnalytics)&&void 0!==i&&null!==(s=i.revenue_stats)&&void 0!==s&&s.total_revenue_gbp?"\xa3".concat(Number(Ue.adminAnalytics.revenue_stats.total_revenue_gbp).toLocaleString()):Oe(Ue.stats.totalSpent),subtitle:null!==(o=Ue.adminAnalytics)&&void 0!==o&&null!==(a=o.revenue_stats)&&void 0!==a&&a.revenue_today_gbp?"\xa3".concat(Ue.adminAnalytics.revenue_stats.revenue_today_gbp," today"):"All time",icon:(0,q.jsx)(dt.A,{}),color:"#10B981"})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsx)($t,{title:"Orders",value:(null===(l=Ue.adminAnalytics)||void 0===l||null===(d=l.order_stats)||void 0===d?void 0:d.total_orders)||Ue.stats.totalOrders,subtitle:"".concat((null===(c=Ue.adminAnalytics)||void 0===c||null===(u=c.order_stats)||void 0===u?void 0:u.pending_orders)||Ue.stats.pendingOrders," pending"),icon:(0,q.jsx)(ue.A,{}),color:"#F59E0B"})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsx)($t,{title:"Subscriptions",value:(null===(h=Ue.adminAnalytics)||void 0===h||null===(m=h.subscription_stats)||void 0===m?void 0:m.active_subscriptions)||0,subtitle:"".concat((null===(g=Ue.adminAnalytics)||void 0===g||null===(A=g.subscription_stats)||void 0===A?void 0:A.plus_subscribers)||0," Plus / ").concat((null===(y=Ue.adminAnalytics)||void 0===y||null===(C=y.subscription_stats)||void 0===C?void 0:C.premium_subscribers)||0," Premium"),icon:(0,q.jsx)(at.A,{}),color:"#7c3aed"})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsx)($t,{title:"Inventory",value:(null===(P=Ue.adminAnalytics)||void 0===P||null===(I=P.gadget_stats)||void 0===I?void 0:I.total_gadgets)||Ue.allGadgets.length,subtitle:Ue.variantsSummary.lowStock>0?"".concat(Ue.variantsSummary.lowStock," low stock"):"All stocked",icon:(0,q.jsx)(he.A,{}),color:Ue.variantsSummary.lowStock>0?"#EF4444":"#48cedb"})})]}):(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsx)($t,{title:"My Orders",value:Ue.stats.totalOrders,subtitle:Ue.stats.pendingOrders>0?"".concat(Ue.stats.pendingOrders," pending"):"All delivered",icon:(0,q.jsx)(ue.A,{}),color:"#F59E0B"})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsx)($t,{title:"Active Installments",value:Ue.installments.filter(e=>e.remaining>0).length,subtitle:Ue.installments.filter(e=>e.remaining>0).length>0?"Payments due":"No payments due",icon:(0,q.jsx)(Ui.A,{}),color:"#48cedb"})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsx)($t,{title:"Trade-Ins",value:Ue.tradeIns.length,subtitle:Ue.tradeIns.filter(e=>"pending"===e.status).length>0?"".concat(Ue.tradeIns.filter(e=>"pending"===e.status).length," pending review"):"No active trade-ins",icon:(0,q.jsx)(Li.A,{}),color:"#F59E0B"})})]})})]}),(0,q.jsx)(v.A,{sx:{mb:4,bgcolor:"rgba(5, 19, 35, 0.6)",border:"1px solid rgba(72, 206, 219, 0.15)",borderRadius:2,overflow:"hidden"},children:(0,q.jsxs)(it.A,{value:wt,onChange:(e,t)=>{St(t)},variant:"scrollable",scrollButtons:"auto",allowScrollButtonsMobile:!0,sx:{"& .MuiTab-root":{color:"rgba(255, 255, 255, 0.7)",fontFamily:"Poppins, sans-serif",fontWeight:500,minHeight:56,px:{xs:2,sm:3},pr:{xs:3,sm:4},minWidth:{xs:"auto",sm:160},overflow:"visible"},"& .Mui-selected":{color:"#48cedb"},"& .MuiTabs-indicator":{backgroundColor:"#48cedb",height:3},"& .MuiTabs-scrollButtons":{color:"#48cedb","&.Mui-disabled":{opacity:.3}}},children:[(0,q.jsx)(rt.A,{icon:(0,q.jsx)(qi.A,{}),iconPosition:"start",label:"OVERVIEW"}),(0,q.jsx)(rt.A,{icon:(0,q.jsx)(Gi.A,{}),iconPosition:"start",label:"BILLING"}),(0,q.jsx)(rt.A,{icon:(0,q.jsx)(he.A,{}),iconPosition:"start",label:(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:1,pr:2},children:[(0,q.jsx)("span",{children:"GADGETS"}),(0,q.jsx)(_.A,{badgeContent:Ue.orders.length,color:"primary",sx:{"& .MuiBadge-badge":{position:"relative",transform:"none",fontSize:"0.7rem",minWidth:20,height:20,borderRadius:"10px"}}})]})}),(0,q.jsx)(rt.A,{icon:(0,q.jsx)(Li.A,{}),iconPosition:"start",label:(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:1,pr:2},children:[(0,q.jsx)("span",{children:"TRADE-INS"}),(0,q.jsx)(_.A,{badgeContent:Ue.tradeIns.filter(e=>"pending"===e.status).length,color:"warning",sx:{"& .MuiBadge-badge":{position:"relative",transform:"none",fontSize:"0.7rem",minWidth:20,height:20,borderRadius:"10px"}}})]})})]})}),0===wt&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(p.A,{variant:"h5",sx:{color:"#48cedb",fontWeight:600,mb:3,fontFamily:"Poppins, sans-serif",display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(qi.A,{})," Quick Actions"]}),(0,q.jsxs)(b.A,{container:!0,spacing:3,sx:{mb:4},children:[(0,q.jsx)(b.A,{item:!0,xs:6,sm:3,md:3,children:(0,q.jsx)(Jt,{title:"Orders",icon:(0,q.jsx)(ue.A,{sx:{fontSize:36,color:"#48cedb"}}),description:"View all orders",count:Ue.stats.totalOrders,onClick:()=>St(0)})}),(0,q.jsx)(b.A,{item:!0,xs:6,sm:3,md:3,children:(0,q.jsx)(Jt,{title:"Installments",icon:(0,q.jsx)(Ui.A,{sx:{fontSize:36,color:"#48cedb"}}),description:"Payment plans",count:Ue.installments.length,onClick:()=>St(1)})}),(0,q.jsx)(b.A,{item:!0,xs:6,sm:3,md:3,children:(0,q.jsx)(Jt,{title:"Trade-Ins",icon:(0,q.jsx)(Li.A,{sx:{fontSize:36,color:"#48cedb"}}),description:"Trade devices",count:Ue.tradeIns.length,badge:Ue.tradeIns.filter(e=>"pending"===e.status).length,onClick:()=>St(2)})}),(0,q.jsx)(b.A,{item:!0,xs:6,sm:3,md:3,children:(0,q.jsx)(Jt,{title:"Support",icon:(0,q.jsx)(fe.A,{sx:{fontSize:36,color:"#48cedb"}}),description:"Get help",onClick:()=>window.location.href="/support"})})]}),!re()&&(0,q.jsx)(b.A,{container:!0,spacing:3,sx:{mb:4},children:(0,q.jsx)(b.A,{item:!0,xs:12,children:(0,q.jsxs)(Xt,{sx:{background:"linear-gradient(135deg, rgba(72, 206, 219, 0.12) 0%, rgba(72, 206, 219, 0.05) 100%)",border:"2px solid #48cedb"},children:[(0,q.jsx)(k.A,{title:(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(Li.A,{sx:{color:"#48cedb"}}),(0,q.jsx)("span",{children:"My Trade-In Applications"})]}),subheader:Ue.tradeIns.length>0?"You have ".concat(Ue.tradeIns.length," trade-in application(s)"):"Trade in your old devices for instant credit",action:(0,q.jsx)(f.A,{variant:"contained",size:"small",onClick:()=>St(2),sx:{bgcolor:"#48cedb",color:"black",fontWeight:700},children:"New Trade-In"}),sx:{"& .MuiCardHeader-title":{color:"#48cedb",fontWeight:700,fontSize:"1.2rem"}}}),(0,q.jsx)(S.A,{children:Ue.tradeIns&&Ue.tradeIns.length>0?(0,q.jsx)(b.A,{container:!0,spacing:2,children:Ue.tradeIns.map((e,t)=>{var i,r;const n={pending:"#F59E0B",under_review:"#48cedb",approved:"#10B981",rejected:"#EF4444",completed:"#6B7280",cancelled:"#94A3B8"}[e.status]||"#F59E0B";return(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:4,lg:3,children:(0,q.jsx)(v.A,{sx:{p:2,bgcolor:"rgba(5, 19, 35, 0.5)",border:"1px solid ".concat(n,"40"),borderRadius:2,transition:"all 0.3s ease","&:hover":{boxShadow:"0 8px 24px ".concat(n,"30"),borderColor:n}},children:(0,q.jsxs)(tt.A,{spacing:1.5,children:[(0,q.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,q.jsx)(Be.A,{size:"small",label:(null===(i=e.status)||void 0===i?void 0:i.replace("_"," ").toUpperCase())||"PENDING",sx:{bgcolor:"".concat(n,"20"),color:n,fontWeight:700,textTransform:"uppercase"}}),(0,q.jsxs)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.5)"},children:["#",null===(r=e.reference)||void 0===r?void 0:r.slice(-8)]})]}),(0,q.jsx)(p.A,{variant:"subtitle2",sx:{color:"white",fontWeight:600},children:e.deviceModel||e.model||"Device"}),(0,q.jsxs)(p.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)",fontSize:"0.85rem"},children:[e.deviceBrand||e.brand," \u2022 ",e.deviceCondition||e.condition]}),e.estimatedValue?(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.5)"},children:"Estimated Value"}),(0,q.jsx)(p.A,{variant:"h6",sx:{color:n,fontWeight:700},children:Oe(e.estimatedValue)})]}):null,e.finalValue?(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.5)"},children:"Final Offer"}),(0,q.jsx)(p.A,{variant:"h6",sx:{color:"#10B981",fontWeight:700},children:Oe(e.finalValue)})]}):null,(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.4)"},children:new Date(e.createdAt).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})})]})})},e.reference||t)})}):(0,q.jsxs)(tt.A,{spacing:2,sx:{py:3,textAlign:"center"},children:[(0,q.jsx)(x.A,{sx:{fontSize:48,opacity:.5},children:"\ud83d\udcf1"}),(0,q.jsx)(p.A,{variant:"h6",sx:{color:"white",fontWeight:600},children:"No Trade-Ins Yet"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)",maxWidth:500,mx:"auto"},children:"Get instant value for your old devices. Trade in and upgrade to the latest gadgets with ease."}),(0,q.jsx)(f.A,{variant:"contained",size:"large",onClick:()=>St(2),sx:{bgcolor:"#48cedb",color:"black",fontWeight:700,mt:2,maxWidth:200,mx:"auto","&:hover":{bgcolor:"#36b8c7"}},children:"Start Trade-In"})]})})]})})}),(0,q.jsxs)(p.A,{variant:"h5",sx:{color:"#48cedb",fontWeight:600,mb:3,fontFamily:"Poppins, sans-serif",display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(Gi.A,{})," Subscription Plans"]}),(0,q.jsxs)(p.A,{variant:"h5",sx:{color:"#48cedb",fontWeight:600,mb:3,fontFamily:"Poppins, sans-serif",display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(at.A,{})," Why Choose Xtrapush"]}),(0,q.jsxs)(b.A,{container:!0,spacing:3,sx:{mb:4},children:[re()&&(0,q.jsx)(b.A,{item:!0,xs:12,children:(0,q.jsxs)(Xt,{children:[(0,q.jsx)(k.A,{title:"Variants & Inventory",subheader:"Diversity across attributes",sx:{"& .MuiCardHeader-title":{color:"#48cedb",fontWeight:700}}}),(0,q.jsx)(S.A,{children:(0,q.jsxs)(b.A,{container:!0,spacing:2,children:[(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsx)($t,{title:"Total Variants",value:Ue.variantsSummary.totalVariants,subtitle:"Across all gadgets",icon:(0,q.jsx)(he.A,{}),color:"#48cedb"})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsx)($t,{title:"Low Stock",value:Ue.variantsSummary.lowStock,subtitle:"\u22643 units",icon:(0,q.jsx)(Vi.A,{}),color:"#EF4444"})}),Object.entries(Ue.variantsSummary.attributes||{}).slice(0,4).map(e=>{let[t,i]=e;return(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsx)($t,{title:"".concat(t.charAt(0).toUpperCase()+t.slice(1)),value:i,subtitle:"distinct values",icon:(0,q.jsx)(at.A,{}),color:"#10B981"})},t)})]})})]})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsx)(Zt,{icon:(0,q.jsx)(Hi.A,{}),title:"Sustainable Tech",description:"Reduce e-waste with certified refurbished devices",color:"#10B981"})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsx)(Zt,{icon:(0,q.jsx)(Vi.A,{}),title:"1-Year Warranty",description:"Full protection with XtraPush Plus coverage",color:"#48cedb"})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsx)(Zt,{icon:(0,q.jsx)(Li.A,{}),title:"Easy Trade-In",description:"Upgrade and get value for your old device",color:"#F59E0B"})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsx)(Zt,{icon:(0,q.jsx)(qi.A,{}),title:"Free Delivery",description:"Fast free shipping with Plus or Premium plans",color:"#7c3aed"})})]}),!re()&&Ue.recommendations.length>0&&(0,q.jsxs)(x.A,{sx:{mt:4},children:[(0,q.jsxs)(p.A,{variant:"h5",sx:{color:"#48cedb",fontWeight:600,mb:3,fontFamily:"Poppins, sans-serif",display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(Gi.A,{})," Recommended For You"]}),(0,q.jsx)(Xt,{gradient:!0,sx:{overflow:"hidden",minHeight:500},children:(0,q.jsx)(S.A,{sx:{p:0,height:"100%"},children:(0,q.jsxs)(x.A,{sx:{position:"relative",height:"100%",background:"linear-gradient(135deg, rgba(5, 19, 35, 0.95), rgba(16, 56, 82, 0.9))"},children:[(0,q.jsx)(W.A,{onClick:()=>ei(-1),sx:{position:"absolute",left:16,top:"50%",transform:"translateY(-50%)",zIndex:10,bgcolor:"rgba(72, 206, 219, 0.2)",color:"#48cedb","&:hover":{bgcolor:"rgba(72, 206, 219, 0.4)"}},children:(0,q.jsx)(Ri.A,{sx:{fontSize:32}})}),(0,q.jsx)(W.A,{onClick:()=>ei(1),sx:{position:"absolute",right:16,top:"50%",transform:"translateY(-50%)",zIndex:10,bgcolor:"rgba(72, 206, 219, 0.2)",color:"#48cedb","&:hover":{bgcolor:"rgba(72, 206, 219, 0.4)"}},children:(0,q.jsx)(Oi.A,{sx:{fontSize:32}})}),(0,q.jsx)(x.A,{sx:{width:"100%",height:"100%",position:"relative",overflow:"hidden"},children:(0,q.jsx)(Ei.N,{initial:!1,custom:1,mode:"wait",children:(0,q.jsx)(Ti.P.div,{custom:1,variants:{enter:e=>({x:e>0?1e3:-1e3,opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:e=>({zIndex:0,x:e<0?1e3:-1e3,opacity:0})},initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.4}},drag:"x",dragElastic:.2,dragConstraints:{left:0,right:0},onDragEnd:(e,t)=>{let{offset:i,velocity:r}=t;const n=((e,t)=>Math.abs(e)*t)(i.x,r.x);n<-1e4?ei(1):n>1e4&&ei(-1)},style:{width:"100%",height:"100%"},children:(0,q.jsxs)(x.A,{sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:4,textAlign:"center"},children:[(0,q.jsx)(Ti.P.div,{initial:{opacity:0,scale:.85},animate:{opacity:1,scale:1},transition:{delay:.1,duration:.5},style:{width:"280px",height:"280px",marginBottom:"1.5rem",borderRadius:"20px",overflow:"hidden"},children:(0,q.jsx)("img",{src:(null===(N=Ue.recommendations[lt])||void 0===N?void 0:N.image)||"/placeholder.jpg",alt:null===(B=Ue.recommendations[lt])||void 0===B?void 0:B.name,style:{width:"100%",height:"100%",objectFit:"cover",backgroundColor:"rgba(5, 19, 35, 0.8)",boxShadow:"0 25px 65px rgba(72, 206, 219, 0.35)"}})}),(0,q.jsxs)(Ti.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},children:[(0,q.jsx)(p.A,{variant:"h5",sx:{color:"white",fontWeight:"bold",mb:1,fontFamily:"Poppins"},children:null===(F=Ue.recommendations[lt])||void 0===F?void 0:F.name}),(0,q.jsx)(p.A,{variant:"body1",sx:{color:"#48cedb",mb:2,fontFamily:"Poppins"},children:null===(E=Ue.recommendations[lt])||void 0===E?void 0:E.brand}),(0,q.jsx)(p.A,{variant:"h4",sx:{color:"#48cedb",fontWeight:"bold",mb:3,fontSize:"2rem",fontFamily:"Poppins"},children:Oe(Ee(Ue.recommendations[lt]))}),(0,q.jsx)(f.A,{variant:"contained",size:"large",onClick:()=>{var e;return window.location.href="/gadgets/".concat(null===(e=Ue.recommendations[lt])||void 0===e?void 0:e.id)},sx:{bgcolor:"#48cedb",color:"white",px:4,py:1.5,fontWeight:"bold","&:hover":{bgcolor:"#3aa6b8",boxShadow:"0 10px 30px rgba(72, 206, 219, 0.4)"}},children:"View Details"})]}),(0,q.jsx)(Ti.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},style:{marginTop:"1.5rem",display:"flex",gap:"8px",justifyContent:"center"},children:Ue.recommendations.map((e,t)=>(0,q.jsx)(Ti.P.button,{onClick:()=>ct(t),whileHover:{scale:1.2},whileTap:{scale:.95},style:{width:lt===t?"32px":"12px",height:"12px",borderRadius:"6px",backgroundColor:lt===t?"#48cedb":"rgba(255, 255, 255, 0.3)",border:"none",cursor:"pointer",transition:"all 0.3s ease"}},t))})]})},lt)})})]})})})]})]}),1===wt&&(0,q.jsx)(b.A,{container:!0,spacing:3,children:(0,q.jsx)(b.A,{item:!0,xs:12,children:(0,q.jsxs)(Xt,{gradient:!0,sx:{background:null!==(T=Ue.subscription)&&void 0!==T&&T.isActive?"linear-gradient(135deg, rgba(72, 206, 219, 0.15) 0%, rgba(16, 185, 129, 0.1) 100%)":"linear-gradient(135deg, rgba(5, 19, 35, 0.95), rgba(16, 56, 82, 0.9))",border:null!==(R=Ue.subscription)&&void 0!==R&&R.isActive?"2px solid #10B981":"1px solid rgba(72, 206, 219, 0.3)"},children:[(0,q.jsx)(k.A,{title:(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(Vi.A,{sx:{color:"#48cedb"}}),(0,q.jsx)("span",{children:"Subscription Management"})]}),subheader:null!==(O=Ue.subscription)&&void 0!==O&&O.isActive?"Active ".concat("premium"===Ue.subscription.tier?"Premium":"Plus"," Plan"):"Protect your devices with insurance coverage",sx:{"& .MuiCardHeader-title":{color:"#48cedb",fontWeight:"bold",fontSize:"1.1rem"},"& .MuiCardHeader-subheader":{color:"rgba(255, 255, 255, 0.7)"}}}),(0,q.jsx)(S.A,{children:null!==(U=Ue.subscription)&&void 0!==U&&U.isActive?(0,q.jsxs)(tt.A,{spacing:2.5,children:[(0,q.jsx)(cr,{subscription:Ue.subscription,onDeviceChanged:e=>{console.log("Device linked:",e),window.location.reload()}}),(0,q.jsxs)(v.A,{sx:{p:2.5,background:"linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(72, 206, 219, 0.1) 100%)",border:"2px solid #10B981",borderRadius:2},children:[(0,q.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"h6",sx:{color:"white",fontWeight:700,mb:.5},children:"premium"===Ue.subscription.tier?"XtraPush Premium":"XtraPush Plus"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"#10B981",fontWeight:600},children:"premium"===Ue.subscription.tier?"GBP"===we?"\xa39.99/mo":"MWK 10,000/mo":"GBP"===we?"\xa36/mo":"MWK 6,000/mo"})]}),(0,q.jsx)(Be.A,{icon:(0,q.jsx)(ot.A,{}),label:"ACTIVE",size:"small",sx:{bgcolor:"#10B981",color:"white",fontWeight:700}})]}),(0,q.jsx)(M.A,{sx:{mb:2,bgcolor:"rgba(16, 185, 129, 0.3)"}}),(0,q.jsxs)(x.A,{sx:{mb:2},children:[(0,q.jsx)(p.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.9)",fontWeight:600,mb:1},children:"\ud83d\udcf1 Device Coverage:"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)"},children:"premium"===Ue.subscription.tier?"\u2705 ALL your devices are covered (laptops, smartphones, tablets)":"\u2705 ONE device covered (laptop, smartphone, or tablet)"})]}),(0,q.jsxs)(tt.A,{spacing:.75,children:[(0,q.jsxs)(tt.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,q.jsx)(ot.A,{sx:{fontSize:16,color:"#10B981"}}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.85)"},children:"Free unlimited delivery"})]}),(0,q.jsxs)(tt.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,q.jsx)(ot.A,{sx:{fontSize:16,color:"#10B981"}}),(0,q.jsxs)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.85)"},children:["premium"===Ue.subscription.tier?"Multiple":"Single"," gadget insurance (1 year)"]})]}),(0,q.jsxs)(tt.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,q.jsx)(ot.A,{sx:{fontSize:16,color:"#10B981"}}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.85)"},children:"Member discounts"})]}),"premium"===Ue.subscription.tier&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(tt.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,q.jsx)(ot.A,{sx:{fontSize:16,color:"#10B981"}}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.85)"},children:"Priority support"})]}),(0,q.jsxs)(tt.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,q.jsx)(ot.A,{sx:{fontSize:16,color:"#10B981"}}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.85)"},children:"Early access to new gadgets"})]})]})]}),(0,q.jsx)(f.A,{fullWidth:!0,variant:"outlined",size:"small",href:"/dashboard/subscription",sx:{mt:2,color:"#10B981",borderColor:"#10B981",borderWidth:2,fontWeight:600,"&:hover":{borderColor:"#10B981",backgroundColor:"rgba(16, 185, 129, 0.1)",borderWidth:2}},children:"Manage Subscription"})]}),"plus"===Ue.subscription.tier&&(0,q.jsxs)(v.A,{sx:{p:2,bgcolor:"rgba(124, 58, 237, 0.1)",border:"1px solid rgba(124, 58, 237, 0.3)",borderRadius:2},children:[(0,q.jsx)(p.A,{variant:"body2",sx:{color:"white",fontWeight:600,mb:1},children:"\ud83d\ude80 Upgrade to Premium"}),(0,q.jsxs)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)",display:"block",mb:1.5},children:["Cover ALL devices + priority support for just ","GBP"===we?"\xa33.99":"MWK 4,000"," more/month"]}),(0,q.jsx)(f.A,{fullWidth:!0,variant:"contained",size:"small",onClick:()=>Qt("premium"),sx:{bgcolor:"#7c3aed",fontWeight:600,"&:hover":{bgcolor:"#6d28d9"}},children:"Upgrade Now"})]})]}):(0,q.jsxs)(tt.A,{spacing:2,children:[Se.map(e=>(0,q.jsxs)(v.A,{sx:{p:2,bgcolor:"rgba(5, 19, 35, 0.6)",border:"2px solid ".concat(e.color,"33"),borderRadius:2,transition:"all 0.3s ease","&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 24px ".concat(e.color,"44"),border:"2px solid ".concat(e.color)}},children:[(0,q.jsxs)(tt.A,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:2,mb:1.5,children:[(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"subtitle1",sx:{color:"white",fontWeight:700},children:e.name}),(0,q.jsx)(p.A,{variant:"h6",sx:{color:e.color,fontWeight:700},children:e.priceLabel})]}),(0,q.jsx)(f.A,{variant:"contained",size:"small",onClick:()=>Qt("XtraPush Plus"===e.name?"plus":"premium"),sx:{bgcolor:e.color,color:"white",fontWeight:700,"&:hover":{bgcolor:e.color,filter:"brightness(1.15)"}},children:e.cta})]}),(0,q.jsx)(tt.A,{spacing:.5,children:e.perks.map(t=>(0,q.jsxs)(tt.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,q.jsx)(ot.A,{sx:{fontSize:16,color:e.color}}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.85)"},children:t})]},t))})]},e.name)),(0,q.jsx)(Pe.A,{severity:"info",sx:{bgcolor:"rgba(72, 206, 219, 0.1)",border:"1px solid rgba(72, 206, 219, 0.3)","& .MuiAlert-message":{color:"rgba(255, 255, 255, 0.9)"}},children:(0,q.jsxs)(p.A,{variant:"caption",sx:{fontWeight:500},children:["\ud83d\udcb3 Payments via ","GBP"===we?"Square":"PayChangu"," \u2022 Auto-renewable monthly"]})})]})})]})})}),2===wt&&(0,q.jsxs)(b.A,{container:!0,spacing:3,children:[(0,q.jsx)(b.A,{item:!0,xs:12,children:(0,q.jsxs)(Xt,{gradient:!0,children:[(0,q.jsx)(k.A,{title:"My Devices",subheader:"Track your purchased gadgets and their status",sx:{"& .MuiCardHeader-title":{color:"#48cedb",fontWeight:"bold",fontFamily:"Poppins"},"& .MuiCardHeader-subheader":{color:"rgba(255, 255, 255, 0.7)"}}}),(0,q.jsx)(S.A,{children:Ue.orders.length>0?(0,q.jsx)(b.A,{container:!0,spacing:3,children:Ue.orders.map((e,t)=>{var i;return(0,q.jsx)(n.Fragment,{children:e.items&&e.items.length>0?e.items.map((t,i)=>(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:4,children:(0,q.jsx)(v.A,{sx:{p:2.5,bgcolor:"rgba(5, 19, 35, 0.5)",border:"1px solid rgba(72, 206, 219, 0.2)",borderRadius:2,transition:"all 0.3s ease",cursor:"pointer","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 24px rgba(72, 206, 219, 0.25)",border:"1px solid rgba(72, 206, 219, 0.4)"}},onClick:()=>(e=>{if(!e)return;const t={id:e.gadgetId||e.id,name:e.name||e.gadgetName||"Device",brand:e.brand||"",category:e.category||"",price:e.price||0,price_gbp:e.priceGbp||e.price_gbp,image:e.image||e.imageUrl||"/placeholder.jpg",condition:e.condition||"New",storage:e.storage||null,color:e.color||null,description:e.description||"",_isOrderView:!0,_orderId:e.orderId};Dt(t),Ct(!0)})((0,r.A)((0,r.A)({},t),{},{orderId:e.id})),children:(0,q.jsxs)(tt.A,{spacing:2,children:[t.image&&(0,q.jsx)(x.A,{sx:{width:"100%",height:160,borderRadius:1,overflow:"hidden",bgcolor:"rgba(0, 0, 0, 0.3)"},children:(0,q.jsx)("img",{src:t.image||t.imageUrl||"/placeholder.jpg",alt:t.name,style:{width:"100%",height:"100%",objectFit:"contain",padding:"10px"}})}),(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"#48cedb",fontWeight:700,textTransform:"uppercase"},children:t.brand||"Device"}),(0,q.jsx)(p.A,{variant:"subtitle1",sx:{color:"white",fontWeight:700,mb:.5},children:t.name||t.gadgetName||"Unknown Device"}),(0,q.jsxs)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.5)"},children:["Order #",e.id]})]}),(t.storage||t.color||t.condition)&&(0,q.jsxs)(tt.A,{direction:"row",spacing:1,flexWrap:"wrap",children:[t.storage&&(0,q.jsx)(Be.A,{label:t.storage,size:"small",sx:{bgcolor:"rgba(72, 206, 219, 0.15)",color:"#48cedb",fontSize:"0.7rem"}}),t.color&&(0,q.jsx)(Be.A,{label:t.color,size:"small",sx:{bgcolor:"rgba(124, 58, 237, 0.15)",color:"#7c3aed",fontSize:"0.7rem"}}),t.condition&&(0,q.jsx)(Be.A,{label:t.condition,size:"small",sx:{bgcolor:"rgba(16, 185, 129, 0.15)",color:"#10B981",fontSize:"0.7rem"}})]}),(0,q.jsx)(M.A,{sx:{bgcolor:"rgba(72, 206, 219, 0.2)"}}),(0,q.jsxs)(tt.A,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,q.jsx)(x.A,{children:(0,q.jsx)(p.A,{variant:"h6",sx:{color:"#48cedb",fontWeight:700},children:Oe(t.price||0)})}),(0,q.jsx)(Be.A,{label:e.status||"Processing",size:"small",icon:"delivered"===e.status?(0,q.jsx)(ot.A,{}):(0,q.jsx)(mt.A,{}),sx:{bgcolor:"delivered"===e.status?"rgba(16, 185, 129, 0.15)":"rgba(245, 158, 11, 0.15)",color:"delivered"===e.status?"#10B981":"#F59E0B",fontWeight:600,border:"1px solid ".concat("delivered"===e.status?"#10B981":"#F59E0B")}})]})]})})},"".concat(e.id,"-").concat(i))):(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:4,children:(0,q.jsx)(v.A,{sx:{p:2.5,bgcolor:"rgba(5, 19, 35, 0.5)",border:"1px solid rgba(72, 206, 219, 0.2)",borderRadius:2,transition:"all 0.3s ease","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 24px rgba(72, 206, 219, 0.25)",border:"1px solid rgba(72, 206, 219, 0.4)"}},children:(0,q.jsxs)(tt.A,{spacing:2,children:[(0,q.jsxs)(tt.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,q.jsx)(z.A,{sx:{bgcolor:"rgba(72, 206, 219, 0.15)",width:56,height:56},children:(0,q.jsx)(he.A,{sx:{color:"#48cedb",fontSize:28}})}),(0,q.jsxs)(x.A,{sx:{flexGrow:1},children:[(0,q.jsxs)(p.A,{variant:"subtitle1",sx:{color:"white",fontWeight:700,mb:.5},children:["Order #",e.id]}),(0,q.jsxs)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)"},children:[(null===(i=e.items)||void 0===i?void 0:i.length)||1," device(s)"]})]})]}),(0,q.jsx)(M.A,{sx:{bgcolor:"rgba(72, 206, 219, 0.2)"}}),(0,q.jsxs)(tt.A,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,q.jsx)(Be.A,{label:e.status||"Processing",size:"small",icon:"delivered"===e.status?(0,q.jsx)(ot.A,{}):(0,q.jsx)(mt.A,{}),sx:{bgcolor:"delivered"===e.status?"rgba(16, 185, 129, 0.15)":"rgba(245, 158, 11, 0.15)",color:"delivered"===e.status?"#10B981":"#F59E0B",fontWeight:600,border:"1px solid ".concat("delivered"===e.status?"#10B981":"#F59E0B")}}),(0,q.jsx)(f.A,{size:"small",variant:"outlined",onClick:()=>window.location.href="/dashboard/orders/".concat(e.id),sx:{color:"#48cedb",borderColor:"#48cedb","&:hover":{borderColor:"#48cedb",bgcolor:"rgba(72, 206, 219, 0.1)"}},children:"View Details"})]})]})})})},e.id||t)})}):(0,q.jsxs)(x.A,{children:[(0,q.jsxs)(x.A,{sx:{textAlign:"center",py:4,mb:4},children:[(0,q.jsx)(he.A,{sx:{fontSize:80,color:"rgba(255, 255, 255, 0.3)",mb:2}}),(0,q.jsx)(p.A,{variant:"h5",sx:{color:"white",fontWeight:700,mb:1},children:"Start Your Collection"}),(0,q.jsx)(p.A,{variant:"body1",sx:{color:"rgba(255, 255, 255, 0.7)",mb:2,maxWidth:500,mx:"auto"},children:"Browse quality gadgets and purchase instantly or start a flexible payment plan"})]}),(0,q.jsxs)(p.A,{variant:"h6",sx:{color:"#48cedb",fontWeight:700,mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(Gi.A,{})," Featured Gadgets"]}),(0,q.jsx)(b.A,{container:!0,spacing:3,children:(Ue.allGadgets||[]).slice(0,6).map(e=>(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:4,children:(0,q.jsx)(Ti.P.div,{whileHover:{y:-8},transition:{duration:.3},children:(0,q.jsxs)(v.A,{sx:{p:0,bgcolor:"rgba(5, 19, 35, 0.6)",border:"2px solid rgba(72, 206, 219, 0.2)",borderRadius:3,overflow:"hidden",transition:"all 0.3s ease",height:"100%",display:"flex",flexDirection:"column","&:hover":{boxShadow:"0 16px 48px rgba(72, 206, 219, 0.35)",border:"2px solid rgba(72, 206, 219, 0.6)",background:"linear-gradient(135deg, rgba(5, 19, 35, 0.9), rgba(16, 56, 82, 0.8))"}},children:[(0,q.jsxs)(x.A,{sx:{height:220,bgcolor:"rgba(5, 19, 35, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",position:"relative"},children:[(0,q.jsx)(x.A,{sx:{position:"absolute",inset:0,background:"linear-gradient(135deg, rgba(72, 206, 219, 0.1) 0%, transparent 100%)",pointerEvents:"none",zIndex:1}}),(0,q.jsx)("img",{src:e.image||"/placeholder.jpg",alt:e.name,style:{width:"100%",height:"100%",objectFit:"contain",padding:"20px",backgroundColor:"rgba(5, 19, 35, 0.95)"}})]}),(0,q.jsxs)(x.A,{sx:{p:2.5,flexGrow:1,display:"flex",flexDirection:"column"},children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"#48cedb",fontWeight:700,textTransform:"uppercase",letterSpacing:1},children:e.brand||"Brand"}),(0,q.jsx)(p.A,{variant:"subtitle1",sx:{color:"white",fontWeight:700,mb:1,height:"2.5em",overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2},children:e.name}),e.condition&&(0,q.jsx)(Be.A,{label:e.condition,size:"small",sx:{mb:1.5,width:"fit-content",bgcolor:"Like New"===e.condition?"rgba(16, 185, 129, 0.2)":"rgba(245, 158, 11, 0.2)",color:"Like New"===e.condition?"#10B981":"#F59E0B",fontWeight:600,fontSize:"0.7rem"}}),(0,q.jsx)(p.A,{variant:"h6",sx:{color:"#48cedb",fontWeight:800,mb:2,fontSize:"1.3rem"},children:Oe(Ee(e))}),(0,q.jsxs)(tt.A,{spacing:1.2,sx:{mt:"auto"},children:[(0,q.jsx)(f.A,{fullWidth:!0,variant:"contained",size:"small",startIcon:(0,q.jsx)(me.A,{}),onClick:()=>Ht(e),sx:{bgcolor:"#48cedb",color:"white",fontWeight:700,fontSize:"0.9rem",py:1.2,transition:"all 0.3s ease","&:hover":{bgcolor:"#3aa6b8",boxShadow:"0 8px 20px rgba(72, 206, 219, 0.4)",transform:"scale(1.02)"}},children:"Buy Now"}),(0,q.jsx)(f.A,{fullWidth:!0,variant:"outlined",size:"small",startIcon:(0,q.jsx)(Ui.A,{}),onClick:()=>Kt(e),sx:{color:"#F59E0B",borderColor:"#F59E0B",fontWeight:700,fontSize:"0.9rem",py:1.2,borderWidth:2,transition:"all 0.3s ease","&:hover":{borderColor:"#F59E0B",bgcolor:"rgba(245, 158, 11, 0.15)",borderWidth:2,boxShadow:"0 8px 20px rgba(245, 158, 11, 0.3)"}},children:"Get in Installments"})]})]})]})})},e.id))}),0===(null===(G=Ue.allGadgets)||void 0===G?void 0:G.length)&&(0,q.jsxs)(x.A,{sx:{textAlign:"center",py:4},children:[(0,q.jsx)(p.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)",mb:2},children:"No gadgets available at the moment"}),(0,q.jsx)(f.A,{variant:"contained",href:"/gadgets",sx:{bgcolor:"#48cedb","&:hover":{bgcolor:"#3aa6b8"}},children:"Browse All Gadgets"})]})]})})]})}),re()&&(0,q.jsx)(b.A,{item:!0,xs:12,children:(0,q.jsxs)(Xt,{sx:{background:"linear-gradient(135deg, rgba(124, 58, 237, 0.15) 0%, rgba(72, 206, 219, 0.1) 100%)",border:"2px solid rgba(124, 58, 237, 0.3)"},children:[(0,q.jsx)(k.A,{title:(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(at.A,{sx:{color:"#7c3aed"}}),(0,q.jsx)("span",{children:"Admin: All Installments"})]}),subheader:"Manage all user installment payments from one place",action:(0,q.jsx)(f.A,{variant:"contained",href:"/dashboard/installments",sx:{bgcolor:"#7c3aed",fontWeight:700,"&:hover":{bgcolor:"#6d28d9"}},children:"Manage All Installments"}),sx:{"& .MuiCardHeader-title":{color:"#7c3aed",fontWeight:"bold"},"& .MuiCardHeader-subheader":{color:"rgba(255, 255, 255, 0.7)"}}}),(0,q.jsx)(S.A,{children:(0,q.jsxs)(b.A,{container:!0,spacing:2,children:[(0,q.jsx)(b.A,{item:!0,xs:6,sm:3,children:(0,q.jsxs)(v.A,{sx:{p:2,bgcolor:"rgba(5, 19, 35, 0.5)",border:"1px solid rgba(124, 58, 237, 0.3)",textAlign:"center"},children:[(0,q.jsx)(p.A,{variant:"h4",sx:{color:"#7c3aed",fontWeight:700},children:(null===(V=Ue.adminAnalytics)||void 0===V||null===(H=V.installment_stats)||void 0===H?void 0:H.total_installment_orders)||Ue.installments.length||0}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Total Plans"})]})}),(0,q.jsx)(b.A,{item:!0,xs:6,sm:3,children:(0,q.jsxs)(v.A,{sx:{p:2,bgcolor:"rgba(5, 19, 35, 0.5)",border:"1px solid rgba(245, 158, 11, 0.3)",textAlign:"center"},children:[(0,q.jsx)(p.A,{variant:"h4",sx:{color:"#F59E0B",fontWeight:700},children:(null===(K=Ue.adminAnalytics)||void 0===K||null===(Q=K.installment_stats)||void 0===Q?void 0:Q.pending_installments)||Ue.installments.filter(e=>"completed"!==e.status).length||0}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Pending"})]})}),(0,q.jsx)(b.A,{item:!0,xs:6,sm:3,children:(0,q.jsxs)(v.A,{sx:{p:2,bgcolor:"rgba(5, 19, 35, 0.5)",border:"1px solid rgba(16, 185, 129, 0.3)",textAlign:"center"},children:[(0,q.jsx)(p.A,{variant:"h4",sx:{color:"#10B981",fontWeight:700},children:(null===(Y=Ue.adminAnalytics)||void 0===Y||null===(X=Y.installment_stats)||void 0===X?void 0:X.completed_installments)||Ue.installments.filter(e=>"completed"===e.status).length||0}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Completed"})]})}),(0,q.jsx)(b.A,{item:!0,xs:6,sm:3,children:(0,q.jsxs)(v.A,{sx:{p:2,bgcolor:"rgba(5, 19, 35, 0.5)",border:"1px solid rgba(72, 206, 219, 0.3)",textAlign:"center"},children:[(0,q.jsx)(p.A,{variant:"h4",sx:{color:"#48cedb",fontWeight:700},children:null!==(J=Ue.adminAnalytics)&&void 0!==J&&null!==(Z=J.installment_stats)&&void 0!==Z&&Z.total_installment_value_gbp?"\xa3".concat(Number(Ue.adminAnalytics.installment_stats.total_installment_value_gbp).toLocaleString()):Oe(Ue.installments.reduce((e,t)=>e+(t.totalAmount||0),0))}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Total Value"})]})})]})})]})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:7,children:(0,q.jsxs)(Xt,{gradient:!0,children:[(0,q.jsx)(k.A,{title:"Lease & Installment Snapshot",subheader:Gt?"Track your latest payment plan at a glance":"Set up installments for flexible payments",action:(0,q.jsx)(f.A,{size:"small",variant:"text",href:"/dashboard/installments",sx:{color:"#48cedb"},children:"Manage Installments"}),sx:{"& .MuiCardHeader-title":{color:"#48cedb",fontWeight:"bold"},"& .MuiCardHeader-subheader":{color:"rgba(255, 255, 255, 0.7)"}}}),(0,q.jsx)(S.A,{children:Gt?(0,q.jsxs)(tt.A,{spacing:2,children:[(0,q.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,q.jsxs)(p.A,{variant:"h6",sx:{color:"white",fontWeight:700},children:["Order #",Gt.orderId]}),(0,q.jsx)(Be.A,{label:Gt.status||"active",size:"small",sx:{bgcolor:"overdue"===Gt.status?"rgba(220, 38, 38, 0.2)":"rgba(72, 206, 219, 0.15)",color:"overdue"===Gt.status?"#ef4444":"#48cedb"}})]}),(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:.5},children:"Progress"}),(0,q.jsx)(qe.A,{variant:"determinate",value:Math.min(Vt,100),sx:{height:10,borderRadius:5,bgcolor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{bgcolor:"#48cedb"}}}),(0,q.jsxs)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)"},children:[Math.round(Vt),"% paid"]})]}),(0,q.jsxs)(b.A,{container:!0,spacing:2,children:[(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,children:(0,q.jsxs)(v.A,{sx:{p:2,bgcolor:"rgba(5, 19, 35, 0.5)",border:"1px solid rgba(72, 206, 219, 0.2)"},children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Remaining Balance"}),(0,q.jsx)(p.A,{variant:"h6",sx:{color:"#48cedb",fontWeight:700},children:Oe(Gt.remaining||0)})]})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,children:(0,q.jsxs)(v.A,{sx:{p:2,bgcolor:"rgba(5, 19, 35, 0.5)",border:"1px solid rgba(72, 206, 219, 0.2)"},children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Weekly Amount"}),(0,q.jsx)(p.A,{variant:"h6",sx:{color:"#48cedb",fontWeight:700},children:Oe(Gt.weeklyAmount||0)})]})})]}),(0,q.jsx)(v.A,{sx:{p:2,bgcolor:"rgba(5, 19, 35, 0.35)",border:"1px dashed rgba(72, 206, 219, 0.3)"},children:(0,q.jsxs)(tt.A,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:{xs:"flex-start",sm:"center"},justifyContent:"space-between",children:[(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"body1",sx:{color:"white",fontWeight:600},children:"Next due date"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:Gt.nextDueDate?new Date(Gt.nextDueDate).toLocaleDateString():"We will notify you"})]}),(0,q.jsxs)(tt.A,{direction:{xs:"column",sm:"row"},spacing:1.5,children:[(0,q.jsx)(f.A,{variant:"contained",size:"medium",onClick:async()=>{if(Gt){ft(null),xt(!0);try{const e=Number(Gt.weeklyAmount||Gt.remaining||Gt.totalAmount||0),t=await(0,Yi.oD)({orderId:Gt.orderId||Gt.id,amount:e,currency:we,countryCode:"MWK"===be?"MW":"GB",customerEmail:Ne.email||(null===ee||void 0===ee?void 0:ee.email),installmentPlan:Gt,successUrl:"".concat(window.location.origin,"/dashboard?installment=success&order=").concat(Gt.orderId||Gt.id),cancelUrl:"".concat(window.location.origin,"/dashboard?installment=cancel&order=").concat(Gt.orderId||Gt.id)});null!==t&&void 0!==t&&t.url?window.location.href=t.url:ft("Payment session created. Continue in the checkout window.")}catch(e){console.error("Failed to start installment payment",e),ft("Could not start installment payment. Please try again.")}finally{xt(!1)}}},disabled:ut,sx:{bgcolor:"#48cedb",fontWeight:700,"&:hover":{bgcolor:"#3aa6b8"}},children:ut?"Starting...":"Pay next installment"}),(0,q.jsx)(f.A,{variant:"outlined",size:"medium",onClick:async()=>{if(Gt){ft(null),gt(!0);try{const e=await(0,Yi.BV)(Gt.orderId||Gt.id),t=(null===e||void 0===e?void 0:e.receiptUrl)||(null===e||void 0===e?void 0:e.url);t?window.open(t,"_blank","noopener"):ft("Receipt not available yet.")}catch(e){console.error("Failed to fetch receipt",e),ft("Failed to fetch receipt.")}finally{gt(!1)}}},disabled:pt,sx:{color:"#48cedb",borderColor:"#48cedb",borderWidth:2,"&:hover":{borderColor:"#48cedb",backgroundColor:"rgba(72, 206, 219, 0.1)"}},children:pt?"Preparing\u2026":"Download receipt"}),(0,q.jsx)(f.A,{variant:"text",size:"medium",onClick:async()=>{if(Gt){vt(!0),ft(null);try{await(0,Yi.VQ)({orderId:Gt.orderId||Gt.id,daysBefore:1}),jt(!0),ft("Reminder scheduled \u2014 we will email you the day before.")}catch(e){console.error("Failed to schedule reminder",e),ft("Could not schedule reminder.")}finally{vt(!1)}}},disabled:bt||At,sx:{color:At?"#10B981":"#48cedb"},children:At?"Reminder set":bt?"Scheduling\u2026":"Email me a day before"})]})]})}),yt&&(0,q.jsx)(Pe.A,{severity:"info",sx:{bgcolor:"rgba(72, 206, 219, 0.08)",border:"1px solid rgba(72, 206, 219, 0.2)"},children:(0,q.jsx)(p.A,{variant:"body2",sx:{color:"white"},children:yt})})]}):(0,q.jsxs)(x.A,{sx:{textAlign:"center",py:3},children:[(0,q.jsx)(Ui.A,{sx:{fontSize:56,color:"rgba(255, 255, 255, 0.3)",mb:1}}),(0,q.jsx)(p.A,{variant:"h6",sx:{color:"white",fontWeight:700,mb:1},children:"No active installments"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:2},children:"Split payments over time with flexible weekly options."}),(0,q.jsx)(f.A,{variant:"contained",href:"/gadgets",sx:{bgcolor:"#48cedb",fontWeight:700,px:3,"&:hover":{bgcolor:"#3aa6b8"}},children:"Start a new plan"})]})})]})}),Ue.installments&&Ue.installments.length>1&&(0,q.jsx)(b.A,{item:!0,xs:12,children:(0,q.jsxs)(Xt,{children:[(0,q.jsx)(k.A,{title:"All Payment Plans",subheader:"Overview of all your active and completed installments",sx:{"& .MuiCardHeader-title":{color:"#48cedb",fontWeight:"bold"},"& .MuiCardHeader-subheader":{color:"rgba(255, 255, 255, 0.7)"}}}),(0,q.jsx)(S.A,{children:(0,q.jsx)(b.A,{container:!0,spacing:2,children:Ue.installments.map((e,t)=>{var i;return(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:4,children:(0,q.jsx)(Ti.P.div,{whileHover:{y:-4},transition:{duration:.2},children:(0,q.jsx)(v.A,{sx:{p:2.5,bgcolor:"rgba(5, 19, 35, 0.5)",border:"2px solid rgba(72, 206, 219, 0.2)",borderRadius:2,transition:"all 0.3s ease","&:hover":{boxShadow:"0 12px 32px rgba(72, 206, 219, 0.3)",border:"2px solid rgba(72, 206, 219, 0.5)"}},children:(0,q.jsxs)(tt.A,{spacing:1.5,children:[(0,q.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,q.jsx)(Be.A,{label:(null===(i=e.status)||void 0===i?void 0:i.toUpperCase())||"ACTIVE",size:"small",icon:"overdue"===e.status?(0,q.jsx)(ht.A,{}):"completed"===e.status?(0,q.jsx)(ot.A,{}):(0,q.jsx)(mt.A,{}),sx:{bgcolor:"overdue"===e.status?"rgba(239, 68, 68, 0.2)":"completed"===e.status?"rgba(16, 185, 129, 0.2)":"rgba(245, 158, 11, 0.2)",color:"overdue"===e.status?"#EF4444":"completed"===e.status?"#10B981":"#F59E0B",fontWeight:700,fontSize:"0.75rem"}}),(0,q.jsxs)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)"},children:["#",e.orderId||e.id]})]}),(0,q.jsxs)(x.A,{children:[(0,q.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.8)",fontWeight:600},children:"Progress"}),(0,q.jsxs)(p.A,{variant:"caption",sx:{color:"#48cedb",fontWeight:700},children:[Math.round(e.progress||0),"%"]})]}),(0,q.jsx)(qe.A,{variant:"determinate",value:e.progress||0,sx:{height:6,borderRadius:3,bgcolor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{bgcolor:e.progress>=100?"#10B981":"#48cedb",borderRadius:3}}})]}),(0,q.jsx)(M.A,{sx:{bgcolor:"rgba(72, 206, 219, 0.1)",my:1}}),(0,q.jsxs)(tt.A,{spacing:.75,children:[(0,q.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Total Amount"}),(0,q.jsx)(p.A,{variant:"subtitle2",sx:{color:"white",fontWeight:700},children:Oe(e.totalAmount||0)})]}),(0,q.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Remaining"}),(0,q.jsx)(p.A,{variant:"subtitle2",sx:{color:"#F59E0B",fontWeight:700},children:Oe(e.remaining||0)})]}),(0,q.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Weekly Payment"}),(0,q.jsx)(p.A,{variant:"subtitle2",sx:{color:"#48cedb",fontWeight:700},children:Oe(e.weeklyAmount||0)})]})]}),e.nextDueDate&&(0,q.jsxs)(x.A,{sx:{p:1.5,bgcolor:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:1},children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)",display:"block",mb:.5},children:"Next Due"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"#F59E0B",fontWeight:700},children:new Date(e.nextDueDate).toLocaleDateString()})]}),"completed"!==e.status&&(0,q.jsx)(f.A,{fullWidth:!0,variant:"contained",size:"small",sx:{bgcolor:"#48cedb",color:"white",fontWeight:700,mt:1,"&:hover":{bgcolor:"#3aa6b8"}},children:"Pay Now"})]})})})},e.id||t)})})})]})}),(0,q.jsx)(b.A,{item:!0,xs:12,children:(0,q.jsxs)(Xt,{children:[(0,q.jsx)(k.A,{title:(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(me.A,{sx:{color:"#48cedb"}}),(0,q.jsx)("span",{children:"Quick Shop"})]}),subheader:"Browse gadgets and start checkout or installments without leaving the dashboard",action:(0,q.jsx)(f.A,{size:"small",variant:"outlined",href:"/gadgets",sx:{color:"#48cedb",borderColor:"#48cedb"},children:"View All Gadgets"}),sx:{"& .MuiCardHeader-title":{color:"#48cedb",fontWeight:"bold"},"& .MuiCardHeader-subheader":{color:"rgba(255, 255, 255, 0.7)"}}}),(0,q.jsx)(S.A,{children:(0,q.jsx)(b.A,{container:!0,spacing:2,children:(Ue.allGadgets||[]).slice(0,6).map(e=>(0,q.jsx)(b.A,{item:!0,xs:6,sm:4,md:2,children:(0,q.jsx)(Ti.P.div,{whileHover:{y:-4,scale:1.02},transition:{duration:.2},children:(0,q.jsxs)(v.A,{sx:{p:1.5,bgcolor:"rgba(5, 19, 35, 0.5)",border:"1px solid rgba(72, 206, 219, 0.2)",borderRadius:2,cursor:"pointer",transition:"all 0.3s ease","&:hover":{border:"1px solid rgba(72, 206, 219, 0.5)",boxShadow:"0 8px 24px rgba(72, 206, 219, 0.15)"}},children:[(0,q.jsx)(x.A,{component:"img",src:e.image||"/placeholder.jpg",alt:e.name,sx:{width:"100%",height:100,objectFit:"contain",borderRadius:1,mb:1,bgcolor:"rgba(255,255,255,0.03)"}}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"white",fontWeight:600,display:"block",mb:.5,lineHeight:1.2},noWrap:!0,children:e.name}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"#48cedb",fontWeight:700,display:"block",mb:1},children:Oe(Ee(e))}),(0,q.jsxs)(tt.A,{direction:"row",spacing:.5,children:[(0,q.jsx)(f.A,{size:"small",variant:"contained",onClick:()=>Ht(e),sx:{flex:1,bgcolor:"#48cedb",fontSize:"0.65rem",py:.5,minWidth:0,"&:hover":{bgcolor:"#3aa6b8"}},children:"Buy"}),(0,q.jsx)(f.A,{size:"small",variant:"outlined",onClick:()=>Kt(e),sx:{flex:1,color:"#F59E0B",borderColor:"#F59E0B",fontSize:"0.65rem",py:.5,minWidth:0,"&:hover":{bgcolor:"rgba(245, 158, 11, 0.1)",borderColor:"#F59E0B"}},children:"Split"})]})]})})},e.id))})})]})})]}),3===wt&&(0,q.jsxs)(b.A,{container:!0,spacing:3,children:[(0,q.jsx)(b.A,{item:!0,xs:12,children:(0,q.jsxs)(tt.A,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[(0,q.jsxs)(x.A,{children:[(0,q.jsxs)(p.A,{variant:"h5",sx:{color:"#48cedb",fontWeight:700,mb:.5,display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(Li.A,{})," Trade-In Applications"]}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Manage your device trade-ins and track application status"})]}),(0,q.jsx)(f.A,{variant:"contained",href:"/trade-in",sx:{bgcolor:"#48cedb",color:"black",fontWeight:700,px:3,"&:hover":{bgcolor:"#36b8c7"}},children:"+ New Trade-In"})]})}),Ue.tradeIns&&Ue.tradeIns.length>0?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(b.A,{item:!0,xs:12,children:(0,q.jsxs)(b.A,{container:!0,spacing:2,children:[(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsx)(Xt,{children:(0,q.jsxs)(S.A,{sx:{textAlign:"center",py:2},children:[(0,q.jsx)(p.A,{variant:"h3",sx:{color:"#48cedb",fontWeight:"bold",mb:1},children:Ue.tradeIns.length}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Total Applications"})]})})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsx)(Xt,{children:(0,q.jsxs)(S.A,{sx:{textAlign:"center",py:2},children:[(0,q.jsx)(p.A,{variant:"h3",sx:{color:"#48cedb",fontWeight:"bold",mb:1},children:Ue.tradeIns.filter(e=>"pending"===e.status||"under_review"===e.status).length}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Under Review"})]})})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsx)(Xt,{children:(0,q.jsxs)(S.A,{sx:{textAlign:"center",py:2},children:[(0,q.jsx)(p.A,{variant:"h3",sx:{color:"#10B981",fontWeight:"bold",mb:1},children:Ue.tradeIns.filter(e=>"approved"===e.status).length}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Approved"})]})})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsx)(Xt,{children:(0,q.jsxs)(S.A,{sx:{textAlign:"center",py:2},children:[(0,q.jsx)(p.A,{variant:"h3",sx:{color:"#10B981",fontWeight:"bold",mb:1},children:Oe(Ue.tradeIns.filter(e=>"approved"===e.status||"completed"===e.status).reduce((e,t)=>e+(t.finalValue||t.estimatedValue||0),0))}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Total Value"})]})})})]})}),(0,q.jsx)(b.A,{item:!0,xs:12,children:(0,q.jsx)(b.A,{container:!0,spacing:3,children:Ue.tradeIns.map((e,t)=>{var i;const r={pending:"#F59E0B",under_review:"#48cedb",approved:"#10B981",rejected:"#EF4444",completed:"#6B7280",cancelled:"#94A3B8"}[e.status]||"#F59E0B",n={pending:"Pending Review",under_review:"Under Review",approved:"Approved",rejected:"Rejected",completed:"Completed",cancelled:"Cancelled"}[e.status]||"Pending";return(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:4,children:(0,q.jsx)(Ti.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.05*t},children:(0,q.jsx)(Xt,{sx:{background:"linear-gradient(135deg, ".concat(r,"15 0%, ").concat(r,"05 100%)"),border:"2px solid ".concat(r),transition:"all 0.3s ease","&:hover":{transform:"translateY(-4px)",boxShadow:"0 12px 32px ".concat(r,"40")}},children:(0,q.jsx)(S.A,{children:(0,q.jsxs)(tt.A,{spacing:2,children:[(0,q.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,q.jsx)(Be.A,{label:n,sx:{bgcolor:"".concat(r,"30"),color:r,fontWeight:700,borderRadius:1,textTransform:"uppercase",fontSize:"0.7rem"}}),(0,q.jsxs)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.5)",fontFamily:"monospace"},children:["#",null===(i=e.reference)||void 0===i?void 0:i.slice(-8)]})]}),(0,q.jsxs)(x.A,{children:[(0,q.jsxs)(p.A,{variant:"h6",sx:{color:"white",fontWeight:700,mb:.5},children:[e.deviceBrand||e.brand," ",e.deviceModel||e.model]}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)",display:"block",mb:.5},children:e.categoryName||e.category}),(0,q.jsxs)(tt.A,{direction:"row",spacing:1,flexWrap:"wrap",children:[e.deviceStorage&&(0,q.jsx)(Be.A,{label:e.deviceStorage,size:"small",sx:{bgcolor:"rgba(72, 206, 219, 0.2)",color:"#48cedb",height:20,fontSize:"0.7rem"}}),e.deviceCondition&&(0,q.jsx)(Be.A,{label:e.deviceCondition,size:"small",sx:{bgcolor:"rgba(16, 185, 129, 0.2)",color:"#10B981",height:20,fontSize:"0.7rem"}})]})]}),(0,q.jsx)(M.A,{sx:{borderColor:"rgba(255, 255, 255, 0.1)"}}),(0,q.jsxs)(x.A,{children:[e.estimatedValue&&(0,q.jsxs)(x.A,{sx:{mb:1.5},children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.5)",display:"block",mb:.5},children:"Estimated Value"}),(0,q.jsx)(p.A,{variant:"h5",sx:{color:r,fontWeight:700},children:Oe(e.estimatedValue)})]}),e.finalValue&&(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.5)",display:"block",mb:.5},children:"Final Offer"}),(0,q.jsx)(p.A,{variant:"h5",sx:{color:"#10B981",fontWeight:700},children:Oe(e.finalValue)})]})]}),(0,q.jsxs)(x.A,{sx:{pt:1},children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.5)",display:"block",mb:.5},children:"Contact"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"white",fontSize:"0.85rem"},children:e.customerName}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)",display:"block"},children:e.customerEmail}),e.customerPhone&&(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)",display:"block"},children:e.customerPhone})]}),(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.5)",display:"block",mb:.5},children:"Submitted"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",fontSize:"0.85rem"},children:new Date(e.createdAt).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}),e.reviewedAt&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.5)",display:"block",mb:.5,mt:1},children:"Reviewed"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",fontSize:"0.85rem"},children:new Date(e.reviewedAt).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})})]})]}),e.notes&&(0,q.jsx)(Pe.A,{severity:"approved"===e.status?"success":"rejected"===e.status?"error":"info",sx:{bgcolor:"".concat(r,"20"),border:"1px solid ".concat(r,"40"),"& .MuiAlert-message":{color:"white"}},children:(0,q.jsxs)(p.A,{variant:"caption",sx:{fontWeight:600},children:["Admin Note: ",e.notes]})}),(0,q.jsxs)(tt.A,{direction:"row",spacing:1,children:[(0,q.jsx)(f.A,{fullWidth:!0,variant:"outlined",size:"small",onClick:()=>(e=>{Ut(e),Rt(!0)})(e),sx:{borderColor:r,color:r,fontWeight:600,"&:hover":{borderColor:r,bgcolor:"".concat(r,"20")}},children:"View Details"}),("pending"===e.status||"under_review"===e.status)&&(0,q.jsx)(f.A,{fullWidth:!0,variant:"outlined",size:"small",onClick:()=>Yt(e),disabled:Lt,sx:{borderColor:"#EF4444",color:"#EF4444",fontWeight:600,"&:hover":{borderColor:"#DC2626",bgcolor:"rgba(239, 68, 68, 0.1)"}},children:Lt?"Cancelling...":"Cancel"})]})]})})})})},e.reference||t)})})}),(0,q.jsx)(b.A,{item:!0,xs:12,children:(0,q.jsx)(Xt,{sx:{background:"linear-gradient(135deg, rgba(72, 206, 219, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%)",border:"1px solid rgba(72, 206, 219, 0.3)"},children:(0,q.jsxs)(S.A,{children:[(0,q.jsx)(p.A,{variant:"h6",sx:{color:"#48cedb",fontWeight:700,mb:2},children:"\ud83d\udccb Trade-In Process"}),(0,q.jsxs)(b.A,{container:!0,spacing:3,children:[(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsxs)(tt.A,{alignItems:"center",spacing:1,children:[(0,q.jsx)(x.A,{sx:{width:48,height:48,borderRadius:"50%",bgcolor:"rgba(72, 206, 219, 0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,q.jsx)(p.A,{variant:"h6",sx:{color:"#48cedb",fontWeight:700},children:"1"})}),(0,q.jsx)(p.A,{variant:"subtitle2",sx:{color:"white",fontWeight:600,textAlign:"center"},children:"Submit Application"}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)",textAlign:"center"},children:"Fill in device details and get instant estimate"})]})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsxs)(tt.A,{alignItems:"center",spacing:1,children:[(0,q.jsx)(x.A,{sx:{width:48,height:48,borderRadius:"50%",bgcolor:"rgba(59, 130, 246, 0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,q.jsx)(p.A,{variant:"h6",sx:{color:"#3B82F6",fontWeight:700},children:"2"})}),(0,q.jsx)(p.A,{variant:"subtitle2",sx:{color:"white",fontWeight:600,textAlign:"center"},children:"Expert Review"}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)",textAlign:"center"},children:"Our team reviews and verifies your device info"})]})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsxs)(tt.A,{alignItems:"center",spacing:1,children:[(0,q.jsx)(x.A,{sx:{width:48,height:48,borderRadius:"50%",bgcolor:"rgba(16, 185, 129, 0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,q.jsx)(p.A,{variant:"h6",sx:{color:"#10B981",fontWeight:700},children:"3"})}),(0,q.jsx)(p.A,{variant:"subtitle2",sx:{color:"white",fontWeight:600,textAlign:"center"},children:"Get Final Offer"}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)",textAlign:"center"},children:"Receive confirmed value within 24 hours"})]})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,md:3,children:(0,q.jsxs)(tt.A,{alignItems:"center",spacing:1,children:[(0,q.jsx)(x.A,{sx:{width:48,height:48,borderRadius:"50%",bgcolor:"rgba(245, 158, 11, 0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,q.jsx)(p.A,{variant:"h6",sx:{color:"#F59E0B",fontWeight:700},children:"4"})}),(0,q.jsx)(p.A,{variant:"subtitle2",sx:{color:"white",fontWeight:600,textAlign:"center"},children:"Instant Credit"}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)",textAlign:"center"},children:"Use credit for new purchases immediately"})]})})]})]})})})]}):(0,q.jsx)(b.A,{item:!0,xs:12,children:(0,q.jsx)(Xt,{children:(0,q.jsxs)(S.A,{sx:{py:8,textAlign:"center"},children:[(0,q.jsx)(x.A,{sx:{fontSize:64,mb:2,opacity:.5},children:"\ud83d\udcf1\ud83d\udcb0"}),(0,q.jsx)(p.A,{variant:"h5",sx:{color:"white",fontWeight:700,mb:2},children:"No Trade-Ins Yet"}),(0,q.jsx)(p.A,{variant:"body1",sx:{color:"rgba(255, 255, 255, 0.6)",mb:4,maxWidth:600,mx:"auto"},children:"Turn your old devices into credit! Get instant value estimates and trade in your gadgets for cash or credit towards new purchases."}),(0,q.jsx)(f.A,{variant:"contained",size:"large",href:"/trade-in",sx:{bgcolor:"#48cedb",color:"black",fontWeight:700,px:4,py:1.5,fontSize:"1.1rem","&:hover":{bgcolor:"#36b8c7",transform:"translateY(-2px)",boxShadow:"0 8px 24px rgba(72, 206, 219, 0.4)"},transition:"all 0.3s ease"},children:"Start Your First Trade-In"}),(0,q.jsxs)(b.A,{container:!0,spacing:2,sx:{mt:4,maxWidth:900,mx:"auto"},children:[(0,q.jsx)(b.A,{item:!0,xs:12,sm:4,children:(0,q.jsxs)(tt.A,{alignItems:"center",spacing:1,children:[(0,q.jsx)(x.A,{sx:{fontSize:32},children:"\u26a1"}),(0,q.jsx)(p.A,{variant:"subtitle2",sx:{color:"white",fontWeight:600},children:"Instant Estimates"}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Get value quote in seconds"})]})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:4,children:(0,q.jsxs)(tt.A,{alignItems:"center",spacing:1,children:[(0,q.jsx)(x.A,{sx:{fontSize:32},children:"\u2705"}),(0,q.jsx)(p.A,{variant:"subtitle2",sx:{color:"white",fontWeight:600},children:"Fair Prices"}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Market-leading trade-in values"})]})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:4,children:(0,q.jsxs)(tt.A,{alignItems:"center",spacing:1,children:[(0,q.jsx)(x.A,{sx:{fontSize:32},children:"\ud83d\udd04"}),(0,q.jsx)(p.A,{variant:"subtitle2",sx:{color:"white",fontWeight:600},children:"Easy Process"}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Simple 4-step trade-in flow"})]})})]})]})})})]})]}),_t&&(0,q.jsx)(ur.A,{open:kt,onClose:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Ct(!1),Dt(null),e&&ee&&window.location.reload()},gadget:_t}),_t&&(0,q.jsx)(xr.A,{open:Pt,onClose:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Wt(!1),Dt(null),e&&ee&&window.location.reload()},item:_t}),Ft&&(0,q.jsx)(pr,{open:Nt,onClose:()=>{Bt(!1),Et(null)},onSuccess:async e=>{if(!Ft||null===ee||void 0===ee||!ee.uid||null===ee||void 0===ee||!ee.email)return alert("Session expired. Please try again."),void Bt(!1);try{const t="MWK"===be?"MW":"GB";console.log("Completing Square subscription with card nonce");const i=await(0,Yi.Ky)({userUid:ee.uid,customerEmail:ee.email,successUrl:window.location.origin+"/dashboard?subscription=success",currency:"GBP",tier:Ft.tier,countryCode:t,cardNonce:e});if(console.log("Square subscription with card result:",i),null===i||void 0===i||!i.success)throw new Error((null===i||void 0===i?void 0:i.message)||"Failed to create subscription");alert(i.message||"Subscription activated successfully!"),Bt(!1),Et(null),window.location.reload()}catch(t){console.error("Square card subscription error:",t),alert("Failed to complete subscription: ".concat((null===t||void 0===t?void 0:t.message)||"Unknown error"))}},tier:Ft.tier,amount:Ft.amount,currency:Ft.currency}),(0,q.jsxs)(se.A,{open:Tt,onClose:()=>{Rt(!1),Ut(null)},maxWidth:"sm",fullWidth:!0,children:[(0,q.jsx)(oe.A,{children:(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(Li.A,{sx:{color:"#48cedb"}}),(0,q.jsx)(p.A,{variant:"h6",sx:{color:"#48cedb",fontWeight:700},children:"Trade-In Details"})]})}),(0,q.jsx)(ae.A,{children:Ot&&(0,q.jsxs)(tt.A,{spacing:3,children:[(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"text.secondary",display:"block",mb:.5},children:"Status"}),(0,q.jsx)(Be.A,{label:(null===($=Ot.status)||void 0===$?void 0:$.replace("_"," ").toUpperCase())||"PENDING",sx:{bgcolor:"approved"===Ot.status?"#10B981":"rejected"===Ot.status?"#EF4444":"under_review"===Ot.status?"#48cedb":"#F59E0B",color:"white",fontWeight:700}})]}),(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"text.secondary",display:"block",mb:.5},children:"Device"}),(0,q.jsxs)(p.A,{variant:"h6",children:[Ot.deviceBrand||Ot.brand," ",Ot.deviceModel||Ot.model]}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"text.secondary"},children:Ot.categoryName||Ot.category}),(0,q.jsxs)(tt.A,{direction:"row",spacing:1,sx:{mt:1},children:[Ot.deviceStorage&&(0,q.jsx)(Be.A,{label:Ot.deviceStorage,size:"small"}),Ot.deviceCondition&&(0,q.jsx)(Be.A,{label:Ot.deviceCondition,size:"small"})]})]}),(0,q.jsxs)(x.A,{children:[Ot.estimatedValue&&(0,q.jsxs)(x.A,{sx:{mb:1},children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"text.secondary",display:"block",mb:.5},children:"Estimated Value"}),(0,q.jsx)(p.A,{variant:"h5",sx:{color:"#F59E0B"},children:Oe(Ot.estimatedValue)})]}),Ot.finalValue&&(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"text.secondary",display:"block",mb:.5},children:"Final Offer"}),(0,q.jsx)(p.A,{variant:"h5",sx:{color:"#10B981"},children:Oe(Ot.finalValue)})]})]}),(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"text.secondary",display:"block",mb:.5},children:"Contact Information"}),(0,q.jsx)(p.A,{variant:"body2",children:Ot.customerName}),(0,q.jsx)(p.A,{variant:"body2",children:Ot.customerEmail}),Ot.customerPhone&&(0,q.jsx)(p.A,{variant:"body2",children:Ot.customerPhone})]}),(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"text.secondary",display:"block",mb:.5},children:"Timeline"}),(0,q.jsxs)(p.A,{variant:"body2",children:["Submitted: ",new Date(Ot.createdAt).toLocaleString()]}),Ot.reviewedAt&&(0,q.jsxs)(p.A,{variant:"body2",children:["Reviewed: ",new Date(Ot.reviewedAt).toLocaleDateString()]}),Ot.completedAt&&(0,q.jsxs)(p.A,{variant:"body2",children:["Completed: ",new Date(Ot.completedAt).toLocaleDateString()]})]}),Ot.notes&&(0,q.jsx)(Pe.A,{severity:"approved"===Ot.status?"success":"rejected"===Ot.status?"error":"info",children:(0,q.jsxs)(p.A,{variant:"body2",children:[(0,q.jsx)("strong",{children:"Admin Note:"})," ",Ot.notes]})})]})}),(0,q.jsxs)(le.A,{children:[(0,q.jsx)(f.A,{onClick:()=>{Rt(!1),Ut(null)},children:"Close"}),("pending"===(null===Ot||void 0===Ot?void 0:Ot.status)||"under_review"===(null===Ot||void 0===Ot?void 0:Ot.status))&&(0,q.jsx)(f.A,{variant:"outlined",color:"error",onClick:()=>{Rt(!1),Yt(Ot)},children:"Cancel Application"})]})]})]})};var vr=i(28827);const Ar={pending:"warning",under_review:"info",documents_requested:"default",approved:"success",denied:"error",cancelled:"default"},jr=e=>{if(!e)return"\u2014";const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleDateString()},yr=e=>{var t,i,r;let{application:n}=e;if(!n)return null;const{gadget:s={},variant:o={},plan:a={},personal:l={},employment:d={}}=n;return(0,q.jsxs)(b.A,{container:!0,spacing:2,sx:{mt:1},children:[(0,q.jsxs)(b.A,{item:!0,xs:12,md:6,children:[(0,q.jsx)(p.A,{variant:"subtitle2",gutterBottom:!0,children:"Product"}),(0,q.jsx)(v.A,{variant:"outlined",sx:{p:2},children:(0,q.jsxs)(tt.A,{spacing:.5,children:[(0,q.jsxs)(p.A,{variant:"body2",children:[(0,q.jsx)("strong",{children:"Name:"})," ",s.name||"\u2014"]}),(0,q.jsxs)(p.A,{variant:"body2",children:[(0,q.jsx)("strong",{children:"Variant:"})," ",o.storage||"\u2014"," ",o.color?"\u2022 ".concat(o.color):""," ",o.condition?"\u2022 ".concat(o.condition):""]}),(0,q.jsxs)(p.A,{variant:"body2",children:[(0,q.jsx)("strong",{children:"Plan:"})," ",a.type," / ",a.weeks," weeks"]}),(0,q.jsxs)(p.A,{variant:"body2",children:[(0,q.jsx)("strong",{children:"Totals:"})," ",a.currency||"MWK"," ",(null===(t=a.totalAmount)||void 0===t||null===(i=t.toLocaleString)||void 0===i?void 0:i.call(t))||a.totalAmount]})]})})]}),(0,q.jsxs)(b.A,{item:!0,xs:12,md:6,children:[(0,q.jsx)(p.A,{variant:"subtitle2",gutterBottom:!0,children:"Personal"}),(0,q.jsx)(v.A,{variant:"outlined",sx:{p:2},children:(0,q.jsxs)(tt.A,{spacing:.5,children:[(0,q.jsxs)(p.A,{variant:"body2",children:[(0,q.jsx)("strong",{children:"Name:"})," ",l.fullName]}),(0,q.jsxs)(p.A,{variant:"body2",children:[(0,q.jsx)("strong",{children:"Email:"})," ",l.email]}),(0,q.jsxs)(p.A,{variant:"body2",children:[(0,q.jsx)("strong",{children:"Phone:"})," ",l.phone]}),(0,q.jsxs)(p.A,{variant:"body2",children:[(0,q.jsx)("strong",{children:"Address:"})," ",l.address||"\u2014"]}),(0,q.jsxs)(p.A,{variant:"body2",children:[(0,q.jsx)("strong",{children:"Town:"})," ",l.town||"\u2014"]})]})})]}),(0,q.jsxs)(b.A,{item:!0,xs:12,md:6,children:[(0,q.jsx)(p.A,{variant:"subtitle2",gutterBottom:!0,children:"Employment"}),(0,q.jsx)(v.A,{variant:"outlined",sx:{p:2},children:(0,q.jsxs)(tt.A,{spacing:.5,children:[(0,q.jsxs)(p.A,{variant:"body2",children:[(0,q.jsx)("strong",{children:"Status:"})," ",d.status||d.employmentStatus||"\u2014"]}),(0,q.jsxs)(p.A,{variant:"body2",children:[(0,q.jsx)("strong",{children:"Employer:"})," ",d.employerName||"\u2014"]}),(0,q.jsxs)(p.A,{variant:"body2",children:[(0,q.jsx)("strong",{children:"Income:"})," ",d.monthlyIncome||"\u2014"]}),(0,q.jsxs)(p.A,{variant:"body2",children:[(0,q.jsx)("strong",{children:"Duration:"})," ",d.duration||d.employmentDuration||"\u2014"]})]})})]}),(0,q.jsxs)(b.A,{item:!0,xs:12,md:6,children:[(0,q.jsx)(p.A,{variant:"subtitle2",gutterBottom:!0,children:"Status"}),(0,q.jsx)(v.A,{variant:"outlined",sx:{p:2},children:(0,q.jsxs)(tt.A,{spacing:.5,children:[(0,q.jsxs)(p.A,{variant:"body2",children:[(0,q.jsx)("strong",{children:"Reference:"})," ",n.reference]}),(0,q.jsxs)(p.A,{variant:"body2",children:[(0,q.jsx)("strong",{children:"Status:"})," ",n.status]}),(0,q.jsxs)(p.A,{variant:"body2",children:[(0,q.jsx)("strong",{children:"Documents:"})," ",(null===(r=n.documents)||void 0===r?void 0:r.length)||n.documentCount||0]}),(0,q.jsxs)(p.A,{variant:"body2",children:[(0,q.jsx)("strong",{children:"Updated:"})," ",jr(n.updatedAt)]})]})})]})]})},fr=()=>{var e,t;const{user:i,isAdmin:r}=(0,L.A)(),[s,o]=(0,n.useState)([]),[a,l]=(0,n.useState)(!1),[d,c]=(0,n.useState)(null),[u,h]=(0,n.useState)("all"),[m,g]=(0,n.useState)(null),[b,j]=(0,n.useState)(!1),[y,w]=(0,n.useState)(!1),[S,k]=(0,n.useState)(null),C=async()=>{const e=(null===i||void 0===i?void 0:i.uid)||(null===i||void 0===i?void 0:i.id);if(e||r()){l(!0),c(null),k(null);try{const t=r()?await Te.hf.getAdminApplications(u):await Te.hf.getApplications(e);if(null===t||void 0===t||!t.success)throw new Error((null===t||void 0===t?void 0:t.error)||"Failed to load applications");{const e=t.applications||t.data||t;o(Array.isArray(e)?e:[]),t.unreadNotifications&&r()&&k("".concat(t.unreadNotifications," new admin notifications"))}}catch(t){c(t.message||"Failed to load applications")}finally{l(!1)}}};(0,n.useEffect)(()=>{C()},[u]);const P=async(e,t,i)=>{w(!0),c(null);try{if("approve"===e)await Te.hf.approveApplication(t,i||"Approved");else if("deny"===e)await Te.hf.denyApplication(t,i||"Not approved");else if("request"===e){const e=(i||"").split(",").map(e=>e.trim()).filter(Boolean);await Te.hf.requestDocuments(t,e)}else"cancel"===e&&await Te.hf.cancelApplication(t);await C()}catch(r){c(r.message||"Failed to ".concat(e," application"))}finally{w(!1)}},_=(0,n.useMemo)(()=>[{key:"reference",label:"Reference",width:130},{key:"customer",label:r()?"Customer":"Product",width:180},{key:"plan",label:"Plan",width:120},{key:"amount",label:"Totals",align:"right",width:120},{key:"status",label:"Status",width:140},{key:"createdAt",label:"Submitted",width:140},{key:"actions",label:"Actions",align:"right",width:220}],[r]);return(0,q.jsxs)(x.A,{children:[(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,flexWrap:"wrap",gap:1},children:[(0,q.jsx)(p.A,{variant:"h5",fontWeight:700,color:"white",children:"Installment Applications"}),(0,q.jsxs)(tt.A,{direction:"row",spacing:1,alignItems:"center",children:[r()&&(0,q.jsxs)(A.A,{select:!0,size:"small",label:"Status",value:u,onChange:e=>h(e.target.value),SelectProps:{native:!0},sx:{minWidth:150,bgcolor:"white"},children:[(0,q.jsx)("option",{value:"all",children:"All"}),(0,q.jsx)("option",{value:"pending",children:"Pending"}),(0,q.jsx)("option",{value:"under_review",children:"Under Review"}),(0,q.jsx)("option",{value:"documents_requested",children:"Docs Requested"}),(0,q.jsx)("option",{value:"approved",children:"Approved"}),(0,q.jsx)("option",{value:"denied",children:"Denied"}),(0,q.jsx)("option",{value:"cancelled",children:"Cancelled"})]}),(0,q.jsx)(I.A,{title:"Refresh",children:(0,q.jsx)(W.A,{onClick:C,color:"primary",disabled:a,children:(0,q.jsx)(Mi.A,{})})})]})]}),S&&(0,q.jsx)(Pe.A,{severity:"info",sx:{mb:2},children:S}),d&&(0,q.jsx)(Pe.A,{severity:"error",sx:{mb:2},children:d}),a?(0,q.jsx)(x.A,{sx:{display:"flex",justifyContent:"center",py:6},children:(0,q.jsx)(Ie.A,{})}):(0,q.jsx)(v.A,{sx:{width:"100%",overflowX:"auto"},children:(0,q.jsx)(We.A,{children:(0,q.jsxs)(_e.A,{size:"small",stickyHeader:!0,children:[(0,q.jsx)(De.A,{children:(0,q.jsx)(Me.A,{children:_.map(e=>(0,q.jsx)(ze.A,{align:e.align||"left",sx:{minWidth:e.width},children:e.label},e.key))})}),(0,q.jsxs)(Ne.A,{children:[0===s.length&&(0,q.jsx)(Me.A,{children:(0,q.jsx)(ze.A,{colSpan:_.length,align:"center",sx:{py:3},children:"No applications yet."})}),s.map(e=>{var t,i,n,s,o,a,l,d,u,x,h,m,b;return(0,q.jsxs)(Me.A,{hover:!0,children:[(0,q.jsxs)(ze.A,{children:["#",e.reference||e.id]}),(0,q.jsx)(ze.A,{children:(0,q.jsxs)(tt.A,{spacing:.5,children:[(0,q.jsx)(p.A,{variant:"body2",fontWeight:600,children:r()?e.fullName||"Customer":e.gadgetName||(null===(t=e.gadget)||void 0===t?void 0:t.name)||"Gadget"}),(0,q.jsx)(p.A,{variant:"caption",color:"text.secondary",children:r()?e.email||"":null!==(i=e.variant)&&void 0!==i&&i.storage?"".concat(e.variant.storage," \u2022 ").concat(e.variant.color||""):""})]})}),(0,q.jsxs)(ze.A,{children:[(0,q.jsx)(p.A,{variant:"body2",children:(null===(n=e.plan)||void 0===n?void 0:n.type)||e.plan_type}),(0,q.jsxs)(p.A,{variant:"caption",color:"text.secondary",children:[(null===(s=e.plan)||void 0===s?void 0:s.weeks)||e.plan_weeks," weeks"]})]}),(0,q.jsxs)(ze.A,{align:"right",children:[(0,q.jsxs)(p.A,{variant:"body2",children:[(null===(o=e.plan)||void 0===o?void 0:o.currency)||e.currency||"MWK"," ",(null!==(a=null!==(l=null!==(d=null===(u=e.plan)||void 0===u?void 0:u.totalAmount)&&void 0!==d?d:e.total_amount)&&void 0!==l?l:null===(x=e.plan)||void 0===x?void 0:x.total_amount)&&void 0!==a?a:0).toLocaleString()]}),(0,q.jsxs)(p.A,{variant:"caption",color:"text.secondary",children:["Deposit ",(null!==(h=null!==(m=null===(b=e.plan)||void 0===b?void 0:b.depositAmount)&&void 0!==m?m:e.deposit_amount)&&void 0!==h?h:0).toLocaleString()]})]}),(0,q.jsx)(ze.A,{children:(0,q.jsx)(Be.A,{label:e.status,color:Ar[e.status]||"default",size:"small",sx:{textTransform:"capitalize"}})}),(0,q.jsx)(ze.A,{children:jr(e.createdAt||e.created_at)}),(0,q.jsx)(ze.A,{align:"right",children:(0,q.jsxs)(tt.A,{direction:"row",spacing:1,justifyContent:"flex-end",children:[(0,q.jsx)(I.A,{title:"View details",children:(0,q.jsx)("span",{children:(0,q.jsx)(W.A,{size:"small",onClick:()=>(async e=>{w(!0);try{const i=await Te.hf.getApplication(e);var t;null!==i&&void 0!==i&&i.success?(g(i.application||(null===(t=i.data)||void 0===t?void 0:t.application)||i.data||null),j(!0)):c((null===i||void 0===i?void 0:i.error)||"Failed to load application")}catch(i){c(i.message||"Failed to load application")}finally{w(!1)}})(e.id),disabled:y,children:(0,q.jsx)(Ii.A,{fontSize:"small"})})})}),r()?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(I.A,{title:"Approve",children:(0,q.jsx)("span",{children:(0,q.jsx)(W.A,{size:"small",disabled:y||"approved"===e.status,onClick:()=>P("approve",e.id),children:(0,q.jsx)(lr.A,{fontSize:"small"})})})}),(0,q.jsx)(I.A,{title:"Deny",children:(0,q.jsx)("span",{children:(0,q.jsx)(W.A,{size:"small",disabled:y||"denied"===e.status,onClick:()=>{const t=window.prompt("Reason for denial?","Incomplete documents");null!==t&&P("deny",e.id,t)},children:(0,q.jsx)(Fe.A,{fontSize:"small"})})})}),(0,q.jsx)(I.A,{title:"Request documents",children:(0,q.jsx)("span",{children:(0,q.jsx)(W.A,{size:"small",disabled:y,onClick:()=>{const t=window.prompt("List documents to request (comma-separated)","proof_of_income");null!==t&&P("request",e.id,t)},children:(0,q.jsx)(vr.A,{fontSize:"small"})})})})]}):(0,q.jsx)(q.Fragment,{children:["pending","under_review","documents_requested"].includes(e.status)&&(0,q.jsx)(f.A,{size:"small",color:"error",variant:"outlined",disabled:y,onClick:()=>P("cancel",e.id),children:"Cancel"})})]})})]},e.id)})]})]})})}),(0,q.jsxs)(se.A,{open:b,onClose:()=>j(!1),maxWidth:"md",fullWidth:!0,children:[(0,q.jsxs)(oe.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(we.A,{})," Application #",(null===m||void 0===m?void 0:m.reference)||(null===m||void 0===m?void 0:m.id)]}),(0,q.jsxs)(ae.A,{dividers:!0,children:[m?(0,q.jsx)(yr,{application:m}):(0,q.jsx)(p.A,{children:"Loading\u2026"}),null!==m&&void 0!==m&&null!==(e=m.documents)&&void 0!==e&&e.length?(0,q.jsxs)(x.A,{sx:{mt:2},children:[(0,q.jsx)(p.A,{variant:"subtitle2",gutterBottom:!0,children:"Documents"}),(0,q.jsx)(tt.A,{direction:"row",spacing:1,flexWrap:"wrap",children:m.documents.map(e=>(0,q.jsx)(Be.A,{label:"".concat(e.type," (").concat(e.verified?"verified":"pending",")"),size:"small"},e.id))})]}):null,null!==m&&void 0!==m&&null!==(t=m.history)&&void 0!==t&&t.length?(0,q.jsxs)(x.A,{sx:{mt:2},children:[(0,q.jsx)(p.A,{variant:"subtitle2",gutterBottom:!0,children:"History"}),(0,q.jsx)(tt.A,{spacing:.5,children:m.history.map((e,t)=>(0,q.jsxs)(p.A,{variant:"caption",color:"text.secondary",children:[jr(e.createdAt)," \u2014 ",e.previousStatus||"new"," \u279c ",e.newStatus," (",e.changedBy,") ",e.notes?"\u2013 ".concat(e.notes):""]},t))})]}):null]}),(0,q.jsx)(le.A,{children:(0,q.jsx)(f.A,{onClick:()=>j(!1),children:"Close"})})]})]})};(0,o.Ay)(w.A)(e=>{let{theme:t}=e;return{background:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(10px)",borderRadius:12,border:"1px solid rgba(255, 255, 255, 0.1)",color:"white"}});var wr=i(93360),Sr=i(6369);const kr=(0,o.Ay)(w.A)(e=>{let{theme:t}=e;return{background:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(10px)",borderRadius:12,border:"1px solid rgba(255, 255, 255, 0.1)",color:"white","&:hover":{borderColor:"rgba(72, 206, 219, 0.3)",boxShadow:"0 4px 20px rgba(72, 206, 219, 0.1)"},transition:"all 0.3s ease"}}),Cr=()=>{const{user:e}=(0,L.A)(),[t,i]=(0,n.useState)([]),[r,s]=(0,n.useState)(!0),[o,a]=(0,n.useState)(""),[l,d]=(0,n.useState)(null),[c,u]=(0,n.useState)(!1);(0,n.useEffect)(()=>{null!==e&&void 0!==e&&e.uid&&h()},[null===e||void 0===e?void 0:e.uid]);const h=async()=>{if(null!==e&&void 0!==e&&e.uid)try{s(!0),a("");const t=await Te.hf.listReceipts(e.uid);null!==t&&void 0!==t&&t.success&&Array.isArray(t.receipts)?i(t.receipts):i([])}catch(t){console.error("Failed to load receipts:",t),a("Failed to load receipts"),i([])}finally{s(!1)}},m=async e=>{try{const t=await Te.hf.generateReceipt(e);null!==t&&void 0!==t&&t.success&&t.pdfUrl?window.open(t.pdfUrl,"_blank"):alert("Receipt PDF not available")}catch(t){console.error("Failed to download receipt:",t),alert("Failed to download receipt")}},g=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"MWK";const i=parseFloat(e||0);return new Intl.NumberFormat("en-MW",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:2}).format(i)},v=e=>{if(!e)return"N/A";return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},A=e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"paid":case"completed":return"#4CAF50";case"pending":return"#ff9800";case"failed":case"cancelled":return"#f44336";default:return"#48CEDB"}};return r?(0,q.jsx)(x.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:4},children:(0,q.jsx)(Ie.A,{sx:{color:"#48CEDB"}})}):o?(0,q.jsx)(Pe.A,{severity:"error",sx:{m:2},children:o}):0===t.length?(0,q.jsxs)(x.A,{sx:{textAlign:"center",p:4},children:[(0,q.jsx)(ve.A,{sx:{fontSize:64,color:"rgba(255,255,255,0.3)",mb:2}}),(0,q.jsx)(p.A,{variant:"h6",sx:{color:"rgba(255,255,255,0.7)",mb:1},children:"No Receipts Yet"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"rgba(255,255,255,0.5)"},children:"Your payment receipts will appear here"})]}):(0,q.jsxs)(x.A,{sx:{p:{xs:2,md:3}},children:[(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[(0,q.jsx)(ve.A,{sx:{fontSize:32,color:"#48CEDB"}}),(0,q.jsx)(p.A,{variant:"h5",sx:{fontWeight:700,color:"white"},children:"Payment Receipts"})]}),(0,q.jsx)(b.A,{container:!0,spacing:2,children:t.map(e=>(0,q.jsx)(b.A,{item:!0,xs:12,md:6,children:(0,q.jsx)(kr,{children:(0,q.jsxs)(S.A,{children:[(0,q.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[(0,q.jsxs)(x.A,{children:[(0,q.jsxs)(p.A,{variant:"subtitle2",sx:{color:"rgba(255,255,255,0.7)",mb:.5},children:["Receipt #",e.id||e.reference]}),(0,q.jsx)(p.A,{variant:"h6",sx:{color:"#48CEDB",fontWeight:600},children:g(e.amount,e.currency)})]}),(0,q.jsx)(Be.A,{label:e.status||"Paid",size:"small",sx:{bgcolor:A(e.status),color:"white",fontWeight:600}})]}),(0,q.jsx)(M.A,{sx:{my:2,borderColor:"rgba(255,255,255,0.1)"}}),(0,q.jsxs)(x.A,{sx:{mb:2},children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255,255,255,0.6)",display:"block",mb:.5},children:"Product"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"white",fontWeight:500},children:e.product_name||e.gadget_name||"Installment Payment"})]}),(0,q.jsxs)(x.A,{sx:{mb:2},children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255,255,255,0.6)",display:"block",mb:.5},children:"Date"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"white"},children:v(e.payment_date||e.created_at)})]}),e.payment_method&&(0,q.jsxs)(x.A,{sx:{mb:2},children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255,255,255,0.6)",display:"block",mb:.5},children:"Payment Method"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"white",textTransform:"capitalize"},children:e.payment_method})]}),(0,q.jsxs)(x.A,{sx:{display:"flex",gap:1,mt:3},children:[(0,q.jsx)(f.A,{variant:"outlined",size:"small",startIcon:(0,q.jsx)(Ii.A,{}),onClick:()=>(e=>{d(e),u(!0)})(e),sx:{flex:1,color:"#48CEDB",borderColor:"rgba(72, 206, 219, 0.5)","&:hover":{borderColor:"#48CEDB",bgcolor:"rgba(72, 206, 219, 0.1)"}},children:"View"}),(0,q.jsx)(f.A,{variant:"contained",size:"small",startIcon:(0,q.jsx)(wr.A,{}),onClick:()=>m(e.id),sx:{flex:1,bgcolor:"#48CEDB",color:"#0f172a","&:hover":{bgcolor:"#3ab9c7"}},children:"Download"})]})]})})},e.id))}),(0,q.jsxs)(se.A,{open:c,onClose:()=>u(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{bgcolor:"#0d2137",color:"white",borderRadius:2}},children:[(0,q.jsx)(oe.A,{sx:{borderBottom:"1px solid rgba(255,255,255,0.1)"},children:(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(ve.A,{sx:{color:"#48CEDB"}}),"Receipt Details"]})}),(0,q.jsx)(ae.A,{sx:{pt:3},children:l&&(0,q.jsxs)(x.A,{children:[(0,q.jsxs)(x.A,{sx:{mb:3,textAlign:"center"},children:[(0,q.jsx)(p.A,{variant:"h4",sx:{color:"#48CEDB",fontWeight:700},children:g(l.amount,l.currency)}),(0,q.jsx)(Be.A,{label:l.status||"Paid",sx:{mt:1,bgcolor:A(l.status),color:"white",fontWeight:600}})]}),(0,q.jsx)(M.A,{sx:{my:2,borderColor:"rgba(255,255,255,0.1)"}}),(0,q.jsxs)(b.A,{container:!0,spacing:2,children:[(0,q.jsxs)(b.A,{item:!0,xs:6,children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255,255,255,0.6)"},children:"Receipt ID"}),(0,q.jsxs)(p.A,{variant:"body2",sx:{color:"white",fontWeight:500},children:["#",l.id||l.reference]})]}),(0,q.jsxs)(b.A,{item:!0,xs:6,children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255,255,255,0.6)"},children:"Date"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"white",fontWeight:500},children:v(l.payment_date||l.created_at)})]}),(0,q.jsxs)(b.A,{item:!0,xs:12,children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255,255,255,0.6)"},children:"Product"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"white",fontWeight:500},children:l.product_name||l.gadget_name||"Installment Payment"})]}),l.payment_method&&(0,q.jsxs)(b.A,{item:!0,xs:12,children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255,255,255,0.6)"},children:"Payment Method"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"white",fontWeight:500,textTransform:"capitalize"},children:l.payment_method})]}),l.transaction_id&&(0,q.jsxs)(b.A,{item:!0,xs:12,children:[(0,q.jsx)(p.A,{variant:"caption",sx:{color:"rgba(255,255,255,0.6)"},children:"Transaction ID"}),(0,q.jsx)(p.A,{variant:"body2",sx:{color:"white",fontWeight:500,wordBreak:"break-all"},children:l.transaction_id})]})]})]})}),(0,q.jsxs)(le.A,{sx:{borderTop:"1px solid rgba(255,255,255,0.1)",p:2},children:[(0,q.jsx)(f.A,{onClick:()=>u(!1),sx:{color:"rgba(255,255,255,0.7)"},children:"Close"}),(0,q.jsx)(f.A,{variant:"contained",startIcon:(0,q.jsx)(Sr.A,{}),onClick:()=>l&&m(l.id),sx:{bgcolor:"#48CEDB",color:"#0f172a","&:hover":{bgcolor:"#3ab9c7"}},children:"Print / Download"})]})]})]})};var Pr=i(90094),Ir=i(52479);const Wr=e=>{const t=(e||"").toLowerCase();return t.includes("active")?"success":t.includes("pending")?"warning":t.includes("suspend")?"error":"default"};function _r(){const{user:e,isAdmin:t}=(0,L.A)(),[i,r]=(0,n.useState)(!1),[s,o]=(0,n.useState)([]),[a,l]=(0,n.useState)({}),[d,c]=(0,n.useState)(null),[u,h]=(0,n.useState)(""),m=async()=>{r(!0),c(null);try{if(null===e||void 0===e||!e.uid)return c("Admin user not loaded. Please refresh."),void r(!1);const i=await Te.lu.getAllUsers({role:"buyer",adminUid:e.uid}),n=(null===i||void 0===i?void 0:i.data)||(null===i||void 0===i?void 0:i.users)||i||[];o(Array.isArray(n)?n:[]);const s={};for(const e of n){const i=e.uid||e.id||e.user_uid;if(i)try{const e=await Te.Ho.getStatus(i);s[i]=e}catch(t){console.error("Failed to get subscription status for ".concat(i,":"),t),s[i]={error:!0,message:t.message||"Failed to load"}}else s["unknown_".concat(Math.random())]={error:!0,message:"No UID"}}l(s)}catch(t){c(t.message||"Failed to load users")}finally{r(!1)}};(0,n.useEffect)(()=>{t()&&m()},[]);const g=(0,n.useMemo)(()=>{if(!u)return s;const e=u.toLowerCase();return s.filter(t=>(t.email||"").toLowerCase().includes(e)||(t.full_name||"").toLowerCase().includes(e)||String(t.uid||t.id||"").toLowerCase().includes(e))},[s,u]);return t()?(0,q.jsxs)(x.A,{children:[(0,q.jsxs)(tt.A,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:2,flexWrap:"wrap",gap:1},children:[(0,q.jsx)(p.A,{variant:"h5",fontWeight:700,color:"white",children:"Subscriptions (Admin)"}),(0,q.jsxs)(tt.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,q.jsx)(A.A,{size:"small",placeholder:"Search email or UID",value:u,onChange:e=>h(e.target.value),sx:{bgcolor:"white",minWidth:220}}),(0,q.jsx)(f.A,{variant:"outlined",startIcon:(0,q.jsx)(Mi.A,{}),onClick:m,disabled:i,sx:{color:"#48cedb",borderColor:"#48cedb"},children:"Refresh"})]})]}),d&&(0,q.jsx)(Pe.A,{severity:"error",sx:{mb:2},children:d}),i&&(0,q.jsx)(x.A,{sx:{display:"flex",justifyContent:"center",py:4},children:(0,q.jsx)(Ie.A,{})}),!i&&(0,q.jsx)(v.A,{sx:{p:0},children:(0,q.jsx)(We.A,{children:(0,q.jsxs)(_e.A,{size:"small",children:[(0,q.jsx)(De.A,{children:(0,q.jsxs)(Me.A,{children:[(0,q.jsx)(ze.A,{children:"Email"}),(0,q.jsx)(ze.A,{children:"UID"}),(0,q.jsx)(ze.A,{children:"Status"}),(0,q.jsx)(ze.A,{children:"Tier"}),(0,q.jsx)(ze.A,{children:"Gateway"}),(0,q.jsx)(ze.A,{children:"Renewal Date"}),(0,q.jsx)(ze.A,{align:"right",children:"Actions"})]})}),(0,q.jsx)(Ne.A,{children:g.map(e=>{const t=e.uid||e.id,i=a[t]||{},r=i.tier||i.subscription_tier,n=i.gateway||i.subscription_payment_gateway,s=i.renewal_date||i.subscription_renewal_date||"-";return(0,q.jsxs)(Me.A,{hover:!0,children:[(0,q.jsx)(ze.A,{children:e.email}),(0,q.jsx)(ze.A,{children:t}),(0,q.jsx)(ze.A,{children:i.error?(0,q.jsx)(Be.A,{label:i.message||"Error",color:"error",size:"small"}):(0,q.jsx)(Be.A,{label:i.status||i.subscription_status||"N/A",color:Wr(i.status||i.subscription_status),size:"small"})}),(0,q.jsx)(ze.A,{children:(r||"\u2014").toString().toUpperCase()}),(0,q.jsx)(ze.A,{children:(n||"\u2014").toString().toUpperCase()}),(0,q.jsx)(ze.A,{children:s?String(s).slice(0,10):"\u2014"}),(0,q.jsx)(ze.A,{align:"right",children:(0,q.jsxs)(tt.A,{direction:"row",spacing:1,justifyContent:"flex-end",children:[(0,q.jsx)(I.A,{title:i.error?"Cannot manage - error loading subscription":"Cancel subscription",children:(0,q.jsx)("span",{children:(0,q.jsx)(W.A,{size:"small",onClick:()=>(async e=>{try{await Te.Ho.cancel(e),await m()}catch(t){c(t.message||"Cancel failed")}})(t),disabled:i.error,children:(0,q.jsx)(ht.A,{fontSize:"small"})})})}),(0,q.jsx)(I.A,{title:i.error?"Cannot manage - error loading subscription":"Renew via PayChangu (manual invoice)",children:(0,q.jsx)("span",{children:(0,q.jsx)(W.A,{size:"small",onClick:()=>(async(e,t)=>{try{await Te.Ho.renewWithPaychangu({userUid:e,tier:t}),await m()}catch(i){c(i.message||"Renewal failed")}})(t,r||"plus"),disabled:i.error,children:(0,q.jsx)(Ir.A,{fontSize:"small"})})})})]})})]},t)})})]})})})]}):null}var Dr=i(9998);const Mr=e=>{const t=(e||"").toLowerCase();return"approved"===t||"completed"===t?"success":"pending"===t||"under_review"===t?"warning":"rejected"===t||"cancelled"===t?"error":"default"},zr=e=>{const t=(e||"").toLowerCase();return"cash_only"===t?"success":"swap_only"===t?"info":"both"===t?"secondary":"default"},Nr=e=>{const t=(e||"").toLowerCase();return"cash_only"===t?"\ud83d\udcb5 Cash Only":"swap_only"===t?"\ud83d\udd04 Swap Only":"both"===t?"\ud83d\udd04\ud83d\udcb5 Both":e},Br=["pending","under_review","approved","rejected","completed","cancelled"],Fr=[{value:"cash_only",label:"\ud83d\udcb5 Cash Only"},{value:"swap_only",label:"\ud83d\udd04 Swap Only"},{value:"both",label:"\ud83d\udd04\ud83d\udcb5 Both"}];function Er(){var e;const{isAdmin:t}=(0,L.A)(),{isInMalawi:i}=(0,Re.e)(),[s,o]=(0,n.useState)(!1),[a,l]=(0,n.useState)([]),[d,c]=(0,n.useState)(null),[u,h]=(0,n.useState)(""),[m,g]=(0,n.useState)(null),[b,y]=(0,n.useState)(!1),w=async()=>{o(!0),c(null);try{const e=await Te._H.adminList(),t=(null===e||void 0===e?void 0:e.tradeIns)||(null===e||void 0===e?void 0:e.data)||e||[];l(Array.isArray(t)?t:[])}catch(e){c(e.message||"Failed to load trade-ins")}finally{o(!1)}};(0,n.useEffect)(()=>{t()&&w()},[]);const S=e=>{const t=Number(e);if(!Number.isFinite(t))return"\u2014";if(i)return"MWK ".concat(Math.round(t).toLocaleString("en-MW"));const r=(0,Ge.FX)(t);return new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(r)},k=(0,n.useMemo)(()=>{if(!u)return a;const e=u.toLowerCase();return a.filter(t=>(t.customer_email||"").toLowerCase().includes(e)||(t.customer_name||"").toLowerCase().includes(e)||(t.reference||"").toLowerCase().includes(e))},[a,u]);return t()?(0,q.jsxs)(x.A,{children:[(0,q.jsxs)(tt.A,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:2,flexWrap:"wrap",gap:1},children:[(0,q.jsx)(p.A,{variant:"h5",fontWeight:700,color:"white",children:"Trade-Ins (Admin)"}),(0,q.jsxs)(tt.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,q.jsx)(A.A,{size:"small",placeholder:"Search reference, email, name",value:u,onChange:e=>h(e.target.value),sx:{bgcolor:"white",minWidth:240}}),(0,q.jsx)(f.A,{variant:"outlined",startIcon:(0,q.jsx)(Mi.A,{}),onClick:w,disabled:s,sx:{color:"#48cedb",borderColor:"#48cedb"},children:"Refresh"})]})]}),d&&(0,q.jsx)(Pe.A,{severity:"error",sx:{mb:2},children:d}),s&&(0,q.jsx)(x.A,{sx:{display:"flex",justifyContent:"center",py:4},children:(0,q.jsx)(Ie.A,{})}),!s&&(0,q.jsx)(v.A,{sx:{p:0},children:(0,q.jsx)(We.A,{children:(0,q.jsxs)(_e.A,{size:"small",children:[(0,q.jsx)(De.A,{children:(0,q.jsxs)(Me.A,{children:[(0,q.jsx)(ze.A,{children:"Reference"}),(0,q.jsx)(ze.A,{children:"Customer"}),(0,q.jsx)(ze.A,{children:"Email"}),(0,q.jsx)(ze.A,{children:"Device"}),(0,q.jsx)(ze.A,{children:"Offer Type"}),(0,q.jsx)(ze.A,{children:"Est."}),(0,q.jsx)(ze.A,{children:"Final"}),(0,q.jsx)(ze.A,{children:"Status"}),(0,q.jsx)(ze.A,{align:"right",children:"Actions"})]})}),(0,q.jsx)(Ne.A,{children:k.map(e=>(0,q.jsxs)(Me.A,{hover:!0,children:[(0,q.jsx)(ze.A,{children:e.reference}),(0,q.jsx)(ze.A,{children:e.customer_name}),(0,q.jsx)(ze.A,{children:e.customer_email}),(0,q.jsx)(ze.A,{children:"".concat(e.device_brand||""," ").concat(e.device_model||"")}),(0,q.jsx)(ze.A,{children:(0,q.jsx)(Be.A,{label:Nr(e.offer_type),color:zr(e.offer_type),size:"small"})}),(0,q.jsx)(ze.A,{children:e.estimated_value?S(e.estimated_value):"\u2014"}),(0,q.jsx)(ze.A,{children:e.final_value?S(e.final_value):"\u2014"}),(0,q.jsx)(ze.A,{children:(0,q.jsx)(Be.A,{label:e.status,color:Mr(e.status),size:"small"})}),(0,q.jsx)(ze.A,{align:"right",children:(0,q.jsx)(tt.A,{direction:"row",spacing:1,justifyContent:"flex-end",children:(0,q.jsx)(f.A,{size:"small",variant:"outlined",onClick:()=>{var t;g({reference:(t=e).reference,status:t.status,offerType:t.offer_type||"cash_only",finalValue:t.final_value,notes:""})},startIcon:(0,q.jsx)(Dr.A,{}),children:"Update"})})})]},e.reference))})]})})}),(0,q.jsxs)(se.A,{open:!!m,onClose:()=>g(null),maxWidth:"sm",fullWidth:!0,children:[(0,q.jsx)(oe.A,{children:"Update Trade-In"}),(0,q.jsxs)(ae.A,{sx:{display:"flex",flexDirection:"column",gap:2,pt:2},children:[(0,q.jsx)(A.A,{label:"Reference",value:(null===m||void 0===m?void 0:m.reference)||"",InputProps:{readOnly:!0}}),(0,q.jsx)(A.A,{select:!0,label:"Status",value:(null===m||void 0===m?void 0:m.status)||"",onChange:e=>g((0,r.A)((0,r.A)({},m),{},{status:e.target.value})),children:Br.map(e=>(0,q.jsx)(j.A,{value:e,children:e},e))}),(0,q.jsx)(A.A,{select:!0,label:"Offer Type",value:(null===m||void 0===m?void 0:m.offerType)||"cash_only",onChange:e=>g((0,r.A)((0,r.A)({},m),{},{offerType:e.target.value})),helperText:"Determines how customer receives value (cash, swap, or both)",children:Fr.map(e=>(0,q.jsx)(j.A,{value:e.value,children:e.label},e.value))}),(0,q.jsx)(A.A,{label:"Final Value (MWK)",type:"number",value:null!==(e=null===m||void 0===m?void 0:m.finalValue)&&void 0!==e?e:"",onChange:e=>g((0,r.A)((0,r.A)({},m),{},{finalValue:e.target.value}))}),(0,q.jsx)(A.A,{label:"Notes (append)",multiline:!0,minRows:3,value:(null===m||void 0===m?void 0:m.notes)||"",onChange:e=>g((0,r.A)((0,r.A)({},m),{},{notes:e.target.value}))})]}),(0,q.jsxs)(le.A,{children:[(0,q.jsx)(f.A,{onClick:()=>g(null),children:"Cancel"}),(0,q.jsx)(f.A,{variant:"contained",onClick:async()=>{if(m){y(!0);try{await Te._H.adminUpdate(m),g(null),await w()}catch(e){c(e.message||"Update failed")}finally{y(!1)}}},disabled:b,children:b?"Saving...":"Save"})]})]})]}):null}const Tr=264,Rr=(0,s.A)({palette:{mode:"dark",primary:{main:"#3b82f6"},background:{default:"#0f172a",paper:"#1e293b"},text:{primary:"#f8fafc",secondary:"#94a3b8"}},breakpoints:{values:{xs:0,sm:600,md:900,lg:1200,xl:1536}},components:{MuiPaper:{styleOverrides:{root:{backgroundColor:"#1e293b",border:"1px solid #334155"}}},MuiCard:{styleOverrides:{root:{backgroundColor:"#1e293b",border:"1px solid #334155"}}}}}),Or=((0,o.Ay)(h.A,{shouldForwardProp:e=>"open"!==e})(e=>{let{theme:t}=e;return{zIndex:t.zIndex.drawer+1,backgroundColor:"#0f172a",borderBottom:"1px solid #334155",boxShadow:"none",[t.breakpoints.up("md")]:{marginLeft:Tr,width:"calc(100% - ".concat(Tr,"px)")},"& .Mui-focused":{outline:"2px solid #3b82f6",outlineOffset:"2px"}}}),(0,o.Ay)(u.Ay)(e=>{let{theme:t}=e;return{[t.breakpoints.up("md")]:{"& .MuiDrawer-paper":{position:"fixed",whiteSpace:"nowrap",width:Tr,height:"100vh",top:0,left:0,maxHeight:"100vh",backgroundColor:"#0f172a",borderRight:"1px solid #334155",boxSizing:"border-box",overflowY:"auto",overflowX:"hidden",display:"flex",flexDirection:"column",zIndex:t.zIndex.drawer,scrollbarWidth:"thin",scrollbarColor:"#334155 #0f172a","&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{background:"#0f172a"},"&::-webkit-scrollbar-thumb":{background:"#334155",borderRadius:"3px","&:hover":{background:"#475569"}}}}}})),Ur=(0,o.Ay)(u.Ay)(e=>{let{theme:t}=e;return{[t.breakpoints.down("md")]:{"& .MuiDrawer-paper":{width:Tr,height:"100vh",backgroundColor:"#0f172a",borderRight:"1px solid #334155",boxSizing:"border-box",overflowY:"auto",overflowX:"hidden",display:"flex",flexDirection:"column",scrollbarWidth:"thin",scrollbarColor:"#334155 #0f172a","&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{background:"#0f172a"},"&::-webkit-scrollbar-thumb":{background:"#334155",borderRadius:"3px","&:hover":{background:"#475569"}}}}}}),Lr=((0,o.Ay)(w.A)(e=>{let{theme:t}=e;return{backgroundColor:"#1e293b",border:"1px solid #334155",margin:t.spacing(2),marginTop:"auto",[t.breakpoints.down("md")]:{margin:t.spacing(1)}}}),()=>(0,q.jsx)(Fi,{})),qr=()=>{const{isAdmin:e}=(0,L.A)();return e()?(0,q.jsx)(d.C5,{to:"/dashboard/analytics",replace:!0}):(0,q.jsx)(br,{})},Gr=()=>(0,q.jsxs)(g.A,{children:[(0,q.jsx)(p.A,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Clients Management"}),(0,q.jsx)(v.A,{sx:{p:3},children:(0,q.jsx)(p.A,{variant:"body1",children:"Client management dashboard content will appear here."})})]}),Vr=[{value:"smartphone",label:"Smartphones"},{value:"tablet",label:"Tablets"},{value:"laptop",label:"Laptops"},{value:"desktop",label:"Desktops"},{value:"gaming",label:"Gaming"},{value:"audio",label:"Audio"},{value:"wearable",label:"Wearables"},{value:"productivity",label:"Productivity"},{value:"accessories",label:"Accessories"}],Hr=()=>{const{user:e,isAdmin:t}=(0,L.A)(),[i,s]=(0,n.useState)({name:"",description:"",category:"",brand:"",model:"",image:"",inStock:!0,stockQuantity:0,condition:"new",more_img:[],specifications:""}),[o,a]=(0,n.useState)(null),[l,d]=(0,n.useState)(!1),[c,u]=(0,n.useState)(!1),[h,m]=(0,n.useState)(null),[w,S]=(0,n.useState)([]),[k,P]=(0,n.useState)(""),[I,W]=(0,n.useState)(!1),[_,D]=(0,n.useState)([]),[M,z]=(0,n.useState)([]),[N,B]=(0,n.useState)({color:"",colorHex:"",storage:"",condition:"new",price:"",priceGbp:"",stockQuantity:"",sku:""}),[F,E]=(0,n.useState)(!1),[T,R]=(0,n.useState)(null),[O,U]=(0,n.useState)(null),[G,V]=(0,n.useState)(!1),[H,K]=(0,n.useState)(!1),[Q]=(0,n.useState)(["64GB","128GB","256GB","512GB","1TB"]),[Y]=(0,n.useState)(["new","like_new","good","fair"]),X=n.useMemo(()=>[...new Set(M.map(e=>e.storage).filter(Boolean))],[M]),J=(n.useMemo(()=>[...new Set(M.map(e=>e.condition||e.condition_status).filter(Boolean))],[M]),n.useMemo(()=>M.reduce((e,t)=>e+parseInt(t.stock_quantity||t.stockQuantity||0,10),0),[M])),Z=async()=>{try{const e=await Te.QO.getAll({limit:50});e.success&&S(e.data||[])}catch(e){console.error(e)}};n.useEffect(()=>{Z()},[]);const $=e=>{const{name:t,value:i}=e.target;s(e=>(0,r.A)((0,r.A)({},e),{},{[t]:i}))};n.useEffect(()=>{let e;return e=setTimeout(async()=>{if(k.trim()){W(!0);try{const e=await Te.QO.search(k.trim());e.success&&D(Array.isArray(e.data)?e.data:[])}catch(e){console.error("Search error",e)}finally{W(!1)}}else D([])},300),()=>clearTimeout(e)},[k]);const ee=()=>s({name:"",description:"",category:"",brand:"",model:"",image:"",inStock:!0,stockQuantity:0,condition:"new",more_img:[],specifications:""}),te=e=>{if(!e||"string"!==typeof e)return{};const t={};return e.split("\n").forEach(e=>{const i=e.indexOf(":");if(i>0){const r=e.substring(0,i).trim(),n=e.substring(i+1).trim();r&&n&&(t[r]=n)}}),t},ie=["name","description","category","brand","model"],re=async i=>{if(t()&&null!==e&&void 0!==e&&e.uid){d(!0);try{const t=await Te.QO.adminDelete(i,e.uid);t.success?(a({type:"success",msg:"Deleted gadget successfully"}),await Z()):a({type:"error",msg:t.error||"Failed to delete gadget"})}catch(r){a({type:"error",msg:r.message||"Error deleting gadget"})}finally{d(!1)}}else a({type:"error",msg:"Admin permissions required"})},ne=async function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:G;if(i&&t()&&null!==e&&void 0!==e&&e.uid)try{E(!0);const t=await Te.QO.adminGetVariants(i,e.uid,{includeInactive:r});t.success?z(Array.isArray(t.data)?t.data:[]):R({type:"error",msg:t.error||"Failed to load variants"})}catch(n){R({type:"error",msg:n.message||"Error loading variants"})}finally{E(!1)}};n.useEffect(()=>{h&&ne(h,G)},[h,G]);const se=e=>{const{name:t,value:i}=e.target;B(e=>(0,r.A)((0,r.A)({},e),{},{[t]:i}))},oe=()=>{B({color:"",colorHex:"",storage:"",condition:"new",price:"",priceGbp:"",stockQuantity:"",sku:""}),U(null)},ae=async(i,r)=>{var n;if(!t()||null===e||void 0===e||!e.uid||!h)return void R({type:"error",msg:"Admin permissions required"});const s=M.find(e=>e.id===i);let o=(null!==(n="undefined"!==typeof(null===s||void 0===s?void 0:s.stock_quantity)?s.stock_quantity:null===s||void 0===s?void 0:s.stockQuantity)&&void 0!==n?n:0)+r;o<0&&(o=0),E(!0);try{const t=await Te.QO.adminUpdateVariant(h,i,e.uid,{stockQuantity:o});t.success?(R({type:"success",msg:"Stock updated to ".concat(o)}),await ne()):R({type:"error",msg:t.error||"Failed to update stock"})}catch(a){R({type:"error",msg:a.message||"Error updating stock"})}finally{E(!1)}};return(0,q.jsxs)(g.A,{sx:{height:"100%"},children:[(0,q.jsx)(p.A,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Gadgets Management"}),(0,q.jsxs)(v.A,{sx:{p:3,mb:3,height:"100%"},children:[!t()&&(0,q.jsx)(p.A,{color:"error",sx:{mb:2},children:"Admin permissions required to manage gadgets."}),(0,q.jsxs)(b.A,{container:!0,spacing:2,sx:{height:"100%"},children:[(0,q.jsxs)(b.A,{item:!0,xs:12,md:6,children:[(0,q.jsx)(A.A,{fullWidth:!0,label:"Name",name:"name",value:i.name,onChange:$,required:!0,sx:{mb:2,"& .MuiInputBase-root":{overflow:"hidden"}}}),(0,q.jsx)(A.A,{fullWidth:!0,label:"Description",name:"description",value:i.description,onChange:$,required:!0,multiline:!0,rows:3,placeholder:"Enter a detailed description of the gadget...",sx:{mb:2,"& .MuiInputBase-root":{overflow:"hidden"}}}),(0,q.jsx)(A.A,{fullWidth:!0,label:"Specifications",name:"specifications",value:i.specifications,onChange:$,multiline:!0,rows:4,placeholder:"Enter specifications (one per line)\ne.g.\nDisplay: 6.1-inch Super Retina XDR\nChip: A17 Pro\nStorage: 128GB",helperText:"Enter one specification per line in format: Key: Value",sx:{mb:2,"& .MuiInputBase-root":{overflow:"hidden"}}}),(0,q.jsxs)(b.A,{container:!0,spacing:2,sx:{mt:.5},children:[(0,q.jsx)(b.A,{item:!0,xs:6,children:(0,q.jsx)(A.A,{fullWidth:!0,select:!0,label:"Category",name:"category",value:i.category,onChange:$,required:!0,helperText:i.category&&"accessories"!==i.category?"Variants required for this category":"",sx:{"& .MuiInputBase-root":{overflow:"hidden"}},children:Vr.map(e=>(0,q.jsx)(j.A,{value:e.value,children:e.label},e.value))})}),(0,q.jsx)(b.A,{item:!0,xs:6,children:(0,q.jsx)(A.A,{fullWidth:!0,label:"Brand",name:"brand",value:i.brand,onChange:$,sx:{"& .MuiInputBase-root":{overflow:"hidden"}}})})]}),(0,q.jsxs)(b.A,{container:!0,spacing:2,sx:{mt:.5},children:[(0,q.jsx)(b.A,{item:!0,xs:6,children:(0,q.jsx)(A.A,{fullWidth:!0,label:"Model",name:"model",value:i.model,onChange:$,sx:{"& .MuiInputBase-root":{overflow:"hidden"}}})}),(0,q.jsx)(b.A,{item:!0,xs:6,children:(0,q.jsx)(A.A,{fullWidth:!0,label:"Image URL",name:"image",value:i.image,onChange:$,sx:{"& .MuiInputBase-root":{overflow:"hidden"}}})})]}),(0,q.jsx)(b.A,{container:!0,spacing:2,sx:{mt:.5},children:(0,q.jsx)(b.A,{item:!0,xs:12,md:6,children:(0,q.jsxs)(A.A,{fullWidth:!0,select:!0,label:"Condition",name:"condition",value:i.condition,onChange:$,sx:{"& .MuiInputBase-root":{overflow:"hidden"}},children:[(0,q.jsx)(j.A,{value:"new",children:"New"}),(0,q.jsx)(j.A,{value:"like_new",children:"Like New"}),(0,q.jsx)(j.A,{value:"good",children:"Good"}),(0,q.jsx)(j.A,{value:"fair",children:"Fair"})]})})}),(0,q.jsxs)(b.A,{container:!0,spacing:2,sx:{mt:.5},children:[(0,q.jsxs)(b.A,{item:!0,xs:12,md:8,children:[(0,q.jsxs)(f.A,{variant:"outlined",component:"label",disabled:!t()||c,children:[c?"Uploading...":"Upload Images",(0,q.jsx)("input",{type:"file",accept:"image/*",multiple:!0,hidden:!0,onChange:async e=>{const t=Array.from(e.target.files||[]);if(t.length){u(!0),a(null);try{const e=await Te.QO.uploadImages(t);if(e&&e.success&&Array.isArray(e.images)){const[t,...i]=e.images;s(e=>(0,r.A)((0,r.A)({},e),{},{image:t||e.image,more_img:i.length?i:e.more_img})),a({type:"success",msg:"Uploaded ".concat(e.count||e.images.length," image(s)")})}else a({type:"error",msg:(null===e||void 0===e?void 0:e.error)||"Image upload failed"})}catch(i){a({type:"error",msg:i.message||"Error uploading images"})}finally{u(!1),e.target.value=""}}}})]}),Array.isArray(i.more_img)&&i.more_img.length>0&&(0,q.jsxs)(p.A,{variant:"caption",sx:{ml:2},children:[i.more_img.length," additional image(s) attached"]})]}),(0,q.jsx)(b.A,{item:!0,xs:12,md:4,children:i.image&&(0,q.jsx)(x.A,{sx:{width:80,height:80,borderRadius:1,overflow:"hidden",border:"1px solid #334155"},children:(0,q.jsx)("img",{src:i.image,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover"}})})})]}),(0,q.jsxs)(b.A,{container:!0,spacing:2,sx:{mt:.5},children:[(0,q.jsx)(b.A,{item:!0,xs:12,md:6,children:(0,q.jsx)(A.A,{fullWidth:!0,label:"Stock Quantity",name:"stockQuantity",value:i.stockQuantity,onChange:$,type:"number",sx:{"& .MuiInputBase-root":{overflow:"hidden"}}})}),(0,q.jsx)(b.A,{item:!0,xs:12,md:6,children:(0,q.jsxs)(x.A,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",md:"repeat(4, 1fr)"},gap:1},children:[(0,q.jsx)(f.A,{fullWidth:!0,variant:"contained",disabled:!t()||l,onClick:async()=>{if(t()&&null!==e&&void 0!==e&&e.uid){for(const e of ie)if(!String(i[e]||"").trim())return void a({type:"error",msg:"Missing required field: ".concat(e)});if(Vr.some(e=>e.value===i.category)){d(!0);try{const t={name:i.name,description:i.description,price:0,priceGbp:0,monthlyPrice:0,monthlyPriceGbp:0,image:i.image||null,more_img:Array.isArray(i.more_img)?i.more_img:[],category:i.category,brand:i.brand,model:i.model,condition:i.condition,specifications:te(i.specifications),inStock:i.inStock?1:0,stockQuantity:parseInt(i.stockQuantity||0,10)},r=await Te.QO.adminCreate(e.uid,t);r.success?(a({type:"success",msg:"Created gadget successfully"}),ee(),await Z()):a({type:"error",msg:r.error||"Failed to create gadget"})}catch(r){a({type:"error",msg:r.message||"Error creating gadget"})}finally{d(!1)}}else a({type:"error",msg:"Please select a valid category"})}else a({type:"error",msg:"Admin permissions required"})},children:"Create"}),(0,q.jsx)(f.A,{fullWidth:!0,variant:"outlined",disabled:!t()||l||!h,onClick:()=>(async r=>{if(t()&&null!==e&&void 0!==e&&e.uid){d(!0);try{const t={name:i.name,description:i.description,price:0,priceGbp:0,monthlyPrice:0,monthlyPriceGbp:0,image:i.image||null,more_img:Array.isArray(i.more_img)?i.more_img:[],category:i.category,brand:i.brand,model:i.model,condition:i.condition,specifications:te(i.specifications),inStock:i.inStock?1:0,stockQuantity:parseInt(i.stockQuantity||0,10)},n=await Te.QO.adminUpdate(r,e.uid,t);n.success?(a({type:"success",msg:"Updated gadget successfully"}),ee(),await Z()):a({type:"error",msg:n.error||"Failed to update gadget"})}catch(n){a({type:"error",msg:n.message||"Error updating gadget"})}finally{d(!1)}}else a({type:"error",msg:"Admin permissions required"})})(h),children:"Update Selected"}),(0,q.jsx)(f.A,{fullWidth:!0,color:"error",variant:"outlined",disabled:!t()||l||!h,onClick:()=>re(h),children:"Delete Selected"}),(0,q.jsx)(f.A,{fullWidth:!0,variant:"text",disabled:l&&!!h,onClick:()=>{m(null),ee(),a({type:"success",msg:"Cleared selection"})},children:"Clear"})]})})]}),o&&(0,q.jsx)(p.A,{sx:{mt:2},color:"error"===o.type?"error":"success.main",children:o.msg}),","]}),(0,q.jsxs)(b.A,{item:!0,xs:12,md:6,children:[(0,q.jsx)(p.A,{variant:"h6",gutterBottom:!0,children:"Existing Gadgets"}),(0,q.jsxs)(x.A,{sx:{display:"flex",gap:1,mb:2},children:[(0,q.jsx)(A.A,{fullWidth:!0,placeholder:"Search gadgets by name, brand, or model",value:k,onChange:e=>{P(e.target.value)},InputProps:{startAdornment:(0,q.jsx)(y.A,{position:"start",children:(0,q.jsx)(C.A,{sx:{color:"#94a3b8"}})})},sx:{"& .MuiInputBase-root":{overflow:"hidden"}}}),(0,q.jsx)(f.A,{variant:"text",onClick:()=>P(""),disabled:I||!k,children:"Clear"})]}),(0,q.jsx)(x.A,{sx:{maxHeight:{xs:320,md:520},overflowY:"auto",pr:1},children:(0,q.jsxs)(b.A,{container:!0,spacing:2,children:[(_.length?_:w).map(e=>(0,q.jsx)(b.A,{item:!0,xs:12,children:(0,q.jsxs)(v.A,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,q.jsxs)(x.A,{children:[(0,q.jsx)(p.A,{fontWeight:"medium",children:e.name}),(0,q.jsxs)(p.A,{variant:"body2",color:"text.secondary",children:[e.brand," \u2022 ",e.model," \u2022 ",e.category]})]}),(0,q.jsxs)(x.A,{sx:{display:"flex",gap:1},children:[(0,q.jsx)(f.A,{size:"small",variant:"outlined",disabled:!t()||l,onClick:()=>(e=>{var t,i,r,n,o,l,d,c,u,x;m(e.id);const h=e.specifications&&"object"===typeof e.specifications?Object.entries(e.specifications).map(e=>{let[t,i]=e;return"".concat(t,": ").concat(i)}).join("\n"):"";s({name:e.name||"",description:e.description||"",price:null!==(t=e.price)&&void 0!==t?t:"",priceGbp:null!==(i=e.price_gbp)&&void 0!==i?i:"",monthlyPrice:null!==(r=null!==(n=e.monthlyPrice)&&void 0!==n?n:e.monthly_price)&&void 0!==r?r:"",monthlyPriceGbp:null!==(o=e.monthly_price_gbp)&&void 0!==o?o:"",category:e.category||"",brand:e.brand||"",model:e.model||"",image:e.image||"",condition:e.condition||"new",inStock:!!(null!==(l=e.inStock)&&void 0!==l?l:null!==(d=e.in_stock)&&void 0!==d?d:e.stock>0),stockQuantity:null!==(c=null!==(u=null!==(x=e.stockQuantity)&&void 0!==x?x:e.stock_quantity)&&void 0!==u?u:e.stock)&&void 0!==c?c:0,more_img:Array.isArray(e.more_img)?e.more_img:[],specifications:h}),a({type:"success",msg:"Selected gadget #".concat(e.id," for editing")}),ne(e.id,G)})(e),children:h===e.id?"Selected":"Select"}),(0,q.jsx)(f.A,{size:"small",color:"error",variant:"outlined",disabled:!t()||l,onClick:()=>re(e.id),children:"Delete"})]})]})},e.id)),!(_.length?_:w).length&&(0,q.jsx)(b.A,{item:!0,xs:12,children:(0,q.jsx)(p.A,{variant:"body2",color:"text.secondary",children:"No gadgets found."})})]})})]})]})]}),h&&(0,q.jsxs)(v.A,{sx:{p:3},children:[(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,q.jsxs)(x.A,{children:[(0,q.jsxs)(p.A,{variant:"h6",fontWeight:"bold",children:["Variant Management ","accessories"!==i.category&&(0,q.jsx)(p.A,{component:"span",color:"error.main",variant:"caption",children:"(Required)"})]}),(0,q.jsxs)(p.A,{variant:"body2",color:"text.secondary",children:["Total Stock: ",J," units across ",M.length," variants"]})]}),(0,q.jsxs)(x.A,{sx:{display:"flex",gap:1},children:[(0,q.jsx)(f.A,{size:"small",variant:"outlined",onClick:()=>V(e=>!e),children:G?"Hide Inactive":"Show Inactive"}),(0,q.jsx)(f.A,{size:"small",variant:"text",onClick:()=>ne(),children:"Refresh"})]})]}),"accessories"!==i.category&&0===M.length&&(0,q.jsx)(v.A,{sx:{p:2,mb:2,bgcolor:"rgba(255, 152, 0, 0.1)",border:"1px solid rgba(255, 152, 0, 0.3)"},children:(0,q.jsxs)(p.A,{color:"warning.main",variant:"body2",children:["\u26a0\ufe0f Variants are required for ",i.category||"this category",". Please add at least one variant with pricing and stock."]})}),!t()&&(0,q.jsx)(p.A,{color:"error",sx:{mb:2},children:"Admin permissions required to manage variants."}),(0,q.jsxs)(v.A,{sx:{p:2,mb:3,bgcolor:"rgba(59, 130, 246, 0.05)",border:"1px solid rgba(59, 130, 246, 0.2)",overflow:"hidden"},children:[(0,q.jsx)(p.A,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:O?"Edit Variant #".concat(O):"Add New Variant"}),(0,q.jsxs)(x.A,{sx:{mb:2},children:[(0,q.jsx)(p.A,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:"Quick Storage:"}),(0,q.jsx)(x.A,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:Q.map(e=>(0,q.jsx)(f.A,{size:"small",variant:N.storage===e?"contained":"outlined",onClick:()=>{return t=e,void B(e=>(0,r.A)((0,r.A)({},e),{},{storage:t}));var t},sx:{minWidth:60},children:e},e))})]}),(0,q.jsxs)(x.A,{sx:{mb:2},children:[(0,q.jsx)(p.A,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:"Condition:"}),(0,q.jsx)(x.A,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:Y.map(e=>(0,q.jsx)(f.A,{size:"small",variant:N.condition===e?"contained":"outlined",onClick:()=>{return t=e,void B(e=>(0,r.A)((0,r.A)({},e),{},{condition:t}));var t},color:"new"===e?"success":"like_new"===e?"info":"good"===e?"warning":"inherit",children:"like_new"===e?"Like New":e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),(0,q.jsxs)(b.A,{container:!0,spacing:2,children:[(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,children:(0,q.jsx)(A.A,{fullWidth:!0,label:"Storage",name:"storage",value:N.storage,onChange:se,placeholder:"e.g., 256GB",size:"small",sx:{"& .MuiInputBase-root":{overflow:"hidden"}}})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,children:(0,q.jsxs)(A.A,{fullWidth:!0,select:!0,label:"Condition",name:"condition",value:N.condition,onChange:se,size:"small",sx:{"& .MuiInputBase-root":{overflow:"hidden"}},children:[(0,q.jsx)(j.A,{value:"new",children:"New"}),(0,q.jsx)(j.A,{value:"like_new",children:"Like New"}),(0,q.jsx)(j.A,{value:"good",children:"Good"}),(0,q.jsx)(j.A,{value:"fair",children:"Fair"})]})}),(0,q.jsx)(b.A,{item:!0,xs:6,sm:3,children:(0,q.jsx)(A.A,{fullWidth:!0,label:"Price (MWK)",name:"price",value:N.price,onChange:se,type:"number",size:"small",sx:{"& .MuiInputBase-root":{overflow:"hidden"}}})}),(0,q.jsx)(b.A,{item:!0,xs:6,sm:3,children:(0,q.jsx)(A.A,{fullWidth:!0,label:"Price (GBP)",name:"priceGbp",value:N.priceGbp,onChange:se,type:"number",size:"small",sx:{"& .MuiInputBase-root":{overflow:"hidden"}}})}),(0,q.jsx)(b.A,{item:!0,xs:6,sm:3,children:(0,q.jsx)(A.A,{fullWidth:!0,label:"Stock Qty",name:"stockQuantity",value:N.stockQuantity,onChange:se,type:"number",size:"small",sx:{"& .MuiInputBase-root":{overflow:"hidden"}}})}),(0,q.jsx)(b.A,{item:!0,xs:6,sm:3,children:(0,q.jsx)(A.A,{fullWidth:!0,label:"SKU",name:"sku",value:N.sku,onChange:se,size:"small",sx:{"& .MuiInputBase-root":{overflow:"hidden"}}})}),(0,q.jsx)(b.A,{item:!0,xs:8,sm:4,children:(0,q.jsx)(A.A,{fullWidth:!0,label:"Color Name (optional)",name:"color",value:N.color,onChange:se,placeholder:"e.g., Black Titanium",size:"small",sx:{"& .MuiInputBase-root":{overflow:"hidden"}}})}),(0,q.jsx)(b.A,{item:!0,xs:4,sm:2,children:(0,q.jsx)(A.A,{fullWidth:!0,label:"Hex",name:"colorHex",value:N.colorHex,onChange:se,placeholder:"#000000",size:"small",sx:{"& .MuiInputBase-root":{overflow:"hidden"}},InputProps:{startAdornment:N.colorHex?(0,q.jsx)(x.A,{sx:{width:16,height:16,borderRadius:"50%",bgcolor:N.colorHex,border:"1px solid #ccc",mr:.5}}):null}})}),(0,q.jsx)(b.A,{item:!0,xs:12,sm:6,children:(0,q.jsxs)(x.A,{sx:{display:"flex",gap:1},children:[O?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(f.A,{variant:"contained",disabled:!t()||F,onClick:async()=>{if(t()&&null!==e&&void 0!==e&&e.uid&&h&&O){E(!0);try{const t=await Te.QO.adminUpdateVariant(h,O,e.uid,{color:void 0!==N.color?String(N.color).trim():void 0,colorHex:void 0!==N.colorHex?String(N.colorHex).trim():void 0,storage:String(N.storage).trim(),condition:N.condition||"new",price:String(N.price).trim()?parseFloat(N.price):void 0,priceGbp:String(N.priceGbp||"").trim()?parseFloat(N.priceGbp):void 0,stockQuantity:String(N.stockQuantity).trim()?parseInt(N.stockQuantity,10):void 0,sku:"undefined"!==typeof N.sku?String(N.sku).trim():void 0});t.success?(R({type:"success",msg:"Variant updated successfully"}),oe(),await ne()):R({type:"error",msg:t.error||"Failed to update variant"})}catch(i){R({type:"error",msg:i.message||"Error updating variant"})}finally{E(!1)}}else R({type:"error",msg:"Admin permissions required or no variant selected"})},children:"Update Variant"}),(0,q.jsx)(f.A,{variant:"outlined",onClick:oe,children:"Cancel"})]}):(0,q.jsx)(f.A,{variant:"contained",disabled:!t()||F||!N.storage||!N.price,onClick:async()=>{if(t()&&null!==e&&void 0!==e&&e.uid&&h)if(N.storage&&String(N.price).trim()){E(!0);try{const t=await Te.QO.adminCreateVariant(h,e.uid,{color:N.color?String(N.color).trim():"",colorHex:N.colorHex?String(N.colorHex).trim():"",storage:String(N.storage).trim(),condition:N.condition||"new",price:parseFloat(N.price),priceGbp:N.priceGbp?parseFloat(N.priceGbp):void 0,stockQuantity:N.stockQuantity?parseInt(N.stockQuantity,10):0,sku:N.sku?String(N.sku).trim():""});t.success?(R({type:"success",msg:"Variant created successfully"}),oe(),await ne()):R({type:"error",msg:t.error||"Failed to create variant"})}catch(i){R({type:"error",msg:i.message||"Error creating variant"})}finally{E(!1)}}else R({type:"error",msg:"Storage and price are required"});else R({type:"error",msg:"Admin permissions required"})},children:"Add Variant"}),(0,q.jsx)(f.A,{variant:"text",onClick:oe,children:"Clear"})]})})]}),T&&(0,q.jsx)(p.A,{sx:{mt:2},color:"error"===T.type?"error":"success.main",children:T.msg})]}),(0,q.jsxs)(p.A,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:["Current Variants (",M.length,")"]}),X.length>0?(0,q.jsx)(x.A,{sx:{overflowX:"auto",width:"100%"},children:(0,q.jsxs)(x.A,{sx:{minWidth:600,overflow:"hidden"},children:[(0,q.jsxs)(b.A,{container:!0,spacing:1,sx:{mb:1,px:1},children:[(0,q.jsx)(b.A,{item:!0,xs:2,children:(0,q.jsx)(p.A,{variant:"caption",fontWeight:"bold",color:"text.secondary",children:"STORAGE"})}),(0,q.jsx)(b.A,{item:!0,xs:2,children:(0,q.jsx)(p.A,{variant:"caption",fontWeight:"bold",color:"text.secondary",children:"CONDITION"})}),(0,q.jsx)(b.A,{item:!0,xs:2,children:(0,q.jsx)(p.A,{variant:"caption",fontWeight:"bold",color:"text.secondary",children:"PRICE"})}),(0,q.jsx)(b.A,{item:!0,xs:2,children:(0,q.jsx)(p.A,{variant:"caption",fontWeight:"bold",color:"text.secondary",children:"STOCK"})}),(0,q.jsx)(b.A,{item:!0,xs:4,children:(0,q.jsx)(p.A,{variant:"caption",fontWeight:"bold",color:"text.secondary",children:"ACTIONS"})})]}),M.map(i=>{var r,n,s,o;const a=parseInt(null!==(r=null!==(n=i.stock_quantity)&&void 0!==n?n:i.stockQuantity)&&void 0!==r?r:0,10),l=a<=0,d=null!==(s=null!==(o=i.condition)&&void 0!==o?o:i.condition_status)&&void 0!==s?s:"new";return(0,q.jsx)(v.A,{sx:{mb:1,p:1.5,opacity:l?.6:1,bgcolor:O===i.id?"rgba(59, 130, 246, 0.1)":"background.paper",border:O===i.id?"2px solid #3b82f6":"1px solid transparent",overflow:"hidden"},children:(0,q.jsxs)(b.A,{container:!0,spacing:1,alignItems:"center",children:[(0,q.jsxs)(b.A,{item:!0,xs:2,children:[(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:.5,overflow:"hidden"},children:[i.color_hex&&(0,q.jsx)(x.A,{sx:{width:16,height:16,borderRadius:"50%",bgcolor:i.color_hex,border:"1px solid rgba(255,255,255,0.3)",flexShrink:0}}),(0,q.jsx)(p.A,{variant:"body2",fontWeight:"medium",noWrap:!0,children:i.storage})]}),i.color&&(0,q.jsx)(p.A,{variant:"caption",color:"text.secondary",noWrap:!0,children:i.color})]}),(0,q.jsx)(b.A,{item:!0,xs:2,children:(0,q.jsx)(p.A,{variant:"body2",sx:{px:1,py:.25,borderRadius:1,display:"inline-block",bgcolor:"new"===d?"success.main":"like_new"===d?"info.main":"good"===d?"warning.main":"grey.500",color:"white",fontSize:"0.75rem",overflow:"hidden",textOverflow:"ellipsis"},noWrap:!0,children:"like_new"===d?"Like New":d.charAt(0).toUpperCase()+d.slice(1)})}),(0,q.jsxs)(b.A,{item:!0,xs:2,children:[(0,q.jsxs)(p.A,{variant:"body2",noWrap:!0,children:["MWK ",Number(i.price||0).toLocaleString()]}),i.price_gbp&&(0,q.jsxs)(p.A,{variant:"caption",color:"text.secondary",noWrap:!0,children:["\xa3",Number(i.price_gbp).toFixed(2)]})]}),(0,q.jsx)(b.A,{item:!0,xs:2,children:(0,q.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,q.jsx)(f.A,{size:"small",variant:"outlined",disabled:!t()||F||a<=0,onClick:()=>ae(i.id,-1),sx:{minWidth:28,p:.5},children:"-"}),(0,q.jsx)(p.A,{variant:"body2",fontWeight:"bold",color:l?"error.main":"text.primary",sx:{minWidth:30,textAlign:"center"},children:a}),(0,q.jsx)(f.A,{size:"small",variant:"outlined",disabled:!t()||F,onClick:()=>ae(i.id,1),sx:{minWidth:28,p:.5},children:"+"})]})}),(0,q.jsx)(b.A,{item:!0,xs:4,children:(0,q.jsxs)(x.A,{sx:{display:"flex",gap:.5},children:[(0,q.jsx)(f.A,{size:"small",variant:O===i.id?"contained":"outlined",disabled:!t()||F,onClick:()=>(e=>{var t,i,r,n,s,o,a,l,d,c;U(e.id),B({color:null!==(t=e.color)&&void 0!==t?t:"",colorHex:null!==(i=null!==(r=e.color_hex)&&void 0!==r?r:e.colorHex)&&void 0!==i?i:"",storage:e.storage||"",condition:null!==(n=null!==(s=e.condition)&&void 0!==s?s:e.condition_status)&&void 0!==n?n:"new",price:null!==(o=e.price)&&void 0!==o?o:"",priceGbp:null!==(a=null!==(l=e.price_gbp)&&void 0!==l?l:e.priceGbp)&&void 0!==a?a:"",stockQuantity:null!==(d="undefined"!==typeof e.stock_quantity?e.stock_quantity:e.stockQuantity)&&void 0!==d?d:"",sku:null!==(c=e.sku)&&void 0!==c?c:""}),R({type:"success",msg:"Selected variant #".concat(e.id," for editing")})})(i),children:O===i.id?"Editing":"Edit"}),(0,q.jsx)(f.A,{size:"small",color:"error",variant:"outlined",disabled:!t()||F,onClick:()=>(async i=>{if(t()&&null!==e&&void 0!==e&&e.uid&&h){E(!0);try{const t=await Te.QO.adminDeleteVariant(h,i,e.uid);t.success?(R({type:"success",msg:"Variant deleted successfully"}),await ne()):R({type:"error",msg:t.error||"Failed to delete variant"})}catch(r){R({type:"error",msg:r.message||"Error deleting variant"})}finally{E(!1)}}else R({type:"error",msg:"Admin permissions required"})})(i.id),children:"Delete"})]})})]})},i.id)})]})}):(0,q.jsxs)(v.A,{sx:{p:3,textAlign:"center",bgcolor:"rgba(0,0,0,0.02)"},children:[(0,q.jsx)(p.A,{variant:"body2",color:"text.secondary",children:"No variants yet. Add storage/condition variants above to enable customer selection."}),(0,q.jsx)(p.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:"Tip: For smartphones/tablets, create variants for each storage size and condition combination."})]})]})]})},Kr=()=>(0,q.jsx)(x.A,{sx:{p:3},children:(0,q.jsx)(b.A,{container:!0,spacing:3,children:(0,q.jsx)(b.A,{item:!0,xs:12,md:12,children:(0,q.jsxs)(w.A,{sx:{bgcolor:"rgba(5, 19, 35, 0.6)",border:"1px solid rgba(72, 206, 219, 0.15)",borderRadius:3,height:"100%"},children:[(0,q.jsx)(k.A,{title:"Profile Settings",sx:{"& .MuiCardHeader-title":{color:"#48cedb"},"& .MuiCardHeader-subheader":{color:"rgba(255, 255, 255, 0.7)"}}}),(0,q.jsx)(S.A,{children:(0,q.jsx)(fi,{})})]})})})}),Qr=()=>(0,q.jsxs)(g.A,{children:[(0,q.jsx)(p.A,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"About Dashboard"}),(0,q.jsx)(v.A,{sx:{p:3},children:(0,q.jsx)(p.A,{variant:"body1",children:"About dashboard content will appear here."})})]});function Yr(){const[e,t]=(0,n.useState)(!1),{user:i,userRole:s,isAdmin:o,isSeller:u,isBuyer:h}=((0,a.A)(),(0,L.A)()),g=(0,d.Zp)(),[b,v]=((0,d.zy)(),(0,n.useState)("")),[A,j]=(0,n.useState)([]),[y,f]=(0,n.useState)(!1),w=n.useRef(null),[S,k]=(0,n.useState)(0),C=n.useMemo(()=>{try{return new Intl.DateTimeFormat("en-US",{timeZone:"Africa/Blantyre",weekday:"short",month:"short",day:"numeric",year:"numeric"}).format(new Date)}catch(e){const t=new Date,i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return"".concat(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][t.getDay()],", ").concat(i[t.getMonth()]," ").concat(t.getDate(),", ").concat(t.getFullYear())}},[]),P=e=>{if(!e)return{};try{if("object"===typeof e)return e;const t=String(e).trim();return t?JSON.parse(t):{}}catch(t){return{}}};n.useEffect(()=>{let e=!0;return(async()=>{try{const t=(null===i||void 0===i?void 0:i.uid)||(null===i||void 0===i?void 0:i.id)||null,r=o()?await Te.gH.getAllOrders():t?await Te.gH.getUserOrders(t):null,n=(null===r||void 0===r?void 0:r.orders)||[];let s=0;for(const e of n){const t=P(null===e||void 0===e?void 0:e.notes);if(!!!(null!==t&&void 0!==t&&t.installmentPlan||"installment_deposit"===(null===t||void 0===t?void 0:t.paymentType)||"installment_payment"===(null===t||void 0===t?void 0:t.paymentType)))continue;((null===e||void 0===e?void 0:e.paymentStatus)||(null===e||void 0===e?void 0:e.status)||"").toLowerCase().includes("paid")||(s+=1)}e&&k(s)}catch(t){e&&k(0)}})(),()=>{e=!1}},[i,o]);n.useEffect(()=>{const e=b.trim();return w.current&&(clearTimeout(w.current),w.current=null),e?(w.current=setTimeout(async()=>{try{const i=[{label:"Installments",to:"/dashboard/installments",type:"route"},{label:"Orders",to:"/dashboard/orders",type:"route"},{label:"Analytics",to:"/dashboard/analytics",type:"route"},{label:"Clients",to:"/dashboard/clients",type:"route"}].filter(t=>t.label.toLowerCase().includes(e.toLowerCase()));let n=[];try{const t=await Te.QO.search(e);t&&t.success&&Array.isArray(t.data)&&(n=t.data.slice(0,5))}catch(t){n=[]}const s=[...i,...n.map(e=>(0,r.A)((0,r.A)({},e),{},{type:"gadget"}))];j(s),f(!0)}catch(i){j([]),f(!1)}},300),()=>{w.current&&(clearTimeout(w.current),w.current=null)}):(j([]),void f(!1))},[b]);const I=()=>{t(!e)},W=(0,q.jsxs)(x.A,{sx:{display:"flex",flexDirection:"column",height:"100%",backgroundColor:"#0f172a",overflow:"hidden"},children:[(0,q.jsx)(x.A,{sx:{p:1,display:"flex",alignItems:"center",justifyContent:"center",borderBottom:"1px solid #334155",backgroundColor:"#0f172a",flexShrink:0},children:(0,q.jsx)(x.A,{sx:{display:"inline-flex"},children:(0,q.jsx)(hi.A,{style:{width:"min(140px, 40vw)",height:"auto"}})})}),(0,q.jsx)(x.A,{sx:{flexGrow:1,overflow:"auto",display:"flex",flexDirection:"column"},children:(0,q.jsx)(m.A,{component:"nav",sx:{px:1,py:.8,width:"100%"},children:(0,q.jsx)(ke,{})})}),(0,q.jsx)(x.A,{sx:{p:2,pb:3,borderTop:"1px solid #334155",backgroundColor:"rgba(30, 41, 59, 0.5)",flexShrink:0},children:(0,q.jsxs)(x.A,{sx:{p:2,borderRadius:1.5,backgroundColor:"rgba(59, 130, 246, 0.08)",border:"1px solid rgba(59, 130, 246, 0.2)",transition:"all 0.3s ease","&:hover":{backgroundColor:"rgba(59, 130, 246, 0.12)",border:"1px solid rgba(59, 130, 246, 0.3)"}},children:[(0,q.jsx)(p.A,{variant:"body2",fontWeight:"600",sx:{color:"#f8fafc",mb:.5},children:null!==i&&void 0!==i&&i.displayName?i.displayName:null!==i&&void 0!==i&&i.email?i.email.split("@")[0]:"User"}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"#94a3b8",display:"block",mb:.75,wordBreak:"break-word"},children:(null===i||void 0===i?void 0:i.email)||"user@email.com"}),(0,q.jsx)(p.A,{variant:"caption",sx:{color:"#3b82f6",fontWeight:500,display:"block"},children:null!==i&&void 0!==i&&i.role?i.role.charAt(0).toUpperCase()+i.role.slice(1):"User"})]})})]});return(0,q.jsxs)(l.A,{theme:Rr,children:[(0,q.jsx)(c.Ay,{}),(0,q.jsx)($,{onDrawerToggle:I,dateLabel:C,headerSearch:b,onHeaderSearchChange:e=>{v(e.target.value),y||f(!0)},headerSearchResults:A,onResultClick:e=>{if(f(!1),"route"===e.type&&e.to)g(e.to);else if(e&&e.id)g("/gadgets/".concat(e.id));else if(e&&e.label)g("/gadgets?search=".concat(encodeURIComponent(e.label)));else{const e=b.trim();e&&g("/gadgets?search=".concat(encodeURIComponent(e)))}},pendingInstallments:S,showHeaderSearchResults:y,onSearchFocus:()=>f(!0),onSearchBlur:()=>setTimeout(()=>f(!1),150),onHeaderSearchKeyDown:e=>{if("Enter"===e.key){const e=b.trim();if(e){const t=A&&A[0];t?"route"===t.type&&t.to?g(t.to):t.id?g("/gadgets/".concat(t.id)):g("/gadgets?search=".concat(encodeURIComponent(e))):g("/gadgets?search=".concat(encodeURIComponent(e)))}}}}),(0,q.jsxs)(x.A,{sx:{display:"flex",height:"calc(100vh - 70px)",width:"100%",marginTop:"70px"},children:[(0,q.jsx)(Ur,{variant:"temporary",open:e,onClose:I,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"}},children:W}),(0,q.jsx)(Or,{variant:"permanent",sx:{display:{xs:"none",md:"block"}},children:W}),(0,q.jsx)(x.A,{component:"main",sx:{backgroundColor:"#0f172a",flexGrow:1,overflow:"auto",width:{xs:"100%",md:"calc(100% - ".concat(Tr,"px)")},marginLeft:{xs:0,md:"".concat(Tr,"px")},"& .Mui-focusVisible":{outline:"2px solid #3b82f6",outlineOffset:"2px"}},role:"main","aria-label":"Main content area",children:(0,q.jsx)(x.A,{sx:{mt:{xs:2,md:4},mb:{xs:2,md:4},px:{xs:2,sm:3},height:"auto",overflowY:"auto","& .MuiBox-root":{overflowY:"auto"}},children:(0,q.jsxs)(d.BV,{children:[(0,q.jsx)(d.qh,{index:!0,element:(0,q.jsx)(qr,{})}),(0,q.jsx)(d.qh,{path:"analytics",element:(0,q.jsx)(Pt.j,{children:(0,q.jsx)(Lr,{})})}),(0,q.jsx)(d.qh,{path:"clients",element:(0,q.jsx)(Gr,{})}),(0,q.jsx)(d.qh,{path:"gadgets",element:(0,q.jsx)(Pt.j,{children:(0,q.jsx)(Hr,{})})}),(0,q.jsx)(d.qh,{path:"trade-in",element:(0,q.jsx)(Pt.j,{children:(0,q.jsx)(Pr.default,{})})}),(0,q.jsx)(d.qh,{path:"trade-ins-admin",element:(0,q.jsx)(Pt.j,{children:(0,q.jsx)(Er,{})})}),(0,q.jsx)(d.qh,{path:"subscriptions",element:(0,q.jsx)(Pt.j,{children:(0,q.jsx)(_r,{})})}),(0,q.jsx)(d.qh,{path:"users",element:(0,q.jsx)(Pt.j,{children:(0,q.jsx)(Ct,{})})}),(0,q.jsx)(d.qh,{path:"applications",element:(0,q.jsx)(fr,{})}),(0,q.jsx)(d.qh,{path:"receipts",element:(0,q.jsx)(Cr,{})}),(0,q.jsx)(d.qh,{path:"settings",element:(0,q.jsx)(Kr,{})}),(0,q.jsx)(d.qh,{path:"about",element:(0,q.jsx)(Qr,{})}),(0,q.jsx)(d.qh,{path:"orders",element:(0,q.jsx)(Le,{})}),(0,q.jsx)(d.qh,{path:"installments",element:(0,q.jsx)(et,{})})]})})})]})]})}},86507(e,t,i){i.d(t,{A:()=>d});var r=i(9950),n=i(27321),s=i(98519),o=i(55884),a=i(86633),l=i(44414);const d=(0,r.forwardRef)((e,t)=>{var i,r,d,c,u,x;let{order:h,plan:m}=e;const p=Array.isArray(null===h||void 0===h?void 0:h.items)?h.items:Array.isArray(null===h||void 0===h?void 0:h.cart)?h.cart:[],g=((null===h||void 0===h?void 0:h.currency)||"MWK").toUpperCase(),b=Number(null!==(i=null!==(r=null===m||void 0===m?void 0:m.amountPaid)&&void 0!==r?r:null===h||void 0===h?void 0:h.totalAmount)&&void 0!==i?i:0),v=(null===h||void 0===h?void 0:h.paidAt)||(null===h||void 0===h?void 0:h.paid_at)||(null===h||void 0===h?void 0:h.createdAt)||(null===h||void 0===h?void 0:h.created_at)||null,A=v?new Date(v):new Date,j=e=>{const t="MWK"===g?1:100;return new Intl.NumberFormat("en-US",{style:"currency",currency:g}).format((e||0)/t)},y=e=>{if(!e)return e;try{const t=new URL(e);if("sparkle-pro.co.uk"===(t.hostname||"").replace(/^www\./,"")){let e=t.pathname||"/";return/^\/api\//i.test(e)||(e="/api".concat(e.startsWith("/")?"":"/").concat(e)),"".concat(e).concat(t.search||"")}return e}catch(t){return e}},f={table:{width:"100%",borderCollapse:"collapse",fontSize:"12px"},th:{textAlign:"left",border:"1px solid #ddd",padding:"8px",background:"#f7f7f7"},td:{border:"1px solid #ddd",padding:"8px"},right:{border:"1px solid #ddd",padding:"8px",textAlign:"right"}},w=(0,l.jsx)(n.A,{sx:{background:"#fff",color:"#000",p:12,display:"flex",alignItems:"center",justifyContent:"center",borderBottom:"1px solid #eee"},children:(0,l.jsx)(a.A,{style:{width:120,height:"auto",transform:"none"}})});return(0,l.jsxs)(n.A,{ref:t,sx:{p:0,m:0,background:"#fff",color:"#000"},children:[w,(0,l.jsxs)(n.A,{sx:{p:2},children:[(0,l.jsxs)(s.A,{variant:"h6",sx:{mb:.5},children:["Order #",null!==(d=null===h||void 0===h?void 0:h.id)&&void 0!==d?d:"\u2014"]}),(0,l.jsx)(s.A,{variant:"subtitle2",sx:{mb:1},children:"Summary"}),(0,l.jsx)("table",{style:f.table,children:(0,l.jsxs)("tbody",{children:[(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{style:f.td,children:"Email"}),(0,l.jsx)("td",{style:f.right,children:(null===h||void 0===h?void 0:h.userEmail)||(null===h||void 0===h?void 0:h.email)||(null===h||void 0===h||null===(c=h.customer)||void 0===c?void 0:c.email)||(null===h||void 0===h||null===(u=h.user)||void 0===u?void 0:u.email)||"\u2014"})]}),(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{style:f.td,children:"Paid at"}),(0,l.jsx)("td",{style:f.right,children:A.toLocaleString()})]}),(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{style:f.td,children:"Amount paid"}),(0,l.jsx)("td",{style:f.right,children:j(b)})]})]})}),(0,l.jsx)(o.A,{sx:{my:1}}),(0,l.jsx)(s.A,{variant:"subtitle1",sx:{mt:1,mb:1},children:"Items"}),p&&p.length>0?(0,l.jsxs)("table",{style:f.table,children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{style:f.th,children:"Image"}),(0,l.jsx)("th",{style:f.th,children:"Item"}),(0,l.jsx)("th",{style:f.th,children:"Details"}),(0,l.jsx)("th",{style:f.th,children:"Qty"}),(0,l.jsx)("th",{style:f.th,children:"Price"})]})}),(0,l.jsx)("tbody",{children:p.map((e,t)=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{style:f.td,children:null!==e&&void 0!==e&&e.image?(0,l.jsx)("img",{src:y(e.image),crossOrigin:"anonymous",referrerPolicy:"no-referrer",alt:e.name||e.title||"Item",style:{width:48,height:48,objectFit:"cover",borderRadius:6},onError:e=>{e.currentTarget.style.display="none"}}):"\u2014"}),(0,l.jsx)("td",{style:f.td,children:(0,l.jsx)("strong",{children:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.title)||(null===e||void 0===e?void 0:e.id)||"Item"})}),(0,l.jsx)("td",{style:f.td,children:[null===e||void 0===e?void 0:e.brand,null===e||void 0===e?void 0:e.model,null===e||void 0===e?void 0:e.storage,null===e||void 0===e?void 0:e.condition].filter(Boolean).join(" \u2022 ")||"\u2014"}),(0,l.jsx)("td",{style:f.right,children:Number((null===e||void 0===e?void 0:e.quantity)||1)}),(0,l.jsx)("td",{style:f.right,children:"number"===typeof(null===e||void 0===e?void 0:e.price)?j(Number(e.price)):"\u2014"})]},t))})]}):(0,l.jsx)(s.A,{variant:"body2",color:"text.secondary",children:"No items"}),m&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.A,{sx:{my:1}}),(0,l.jsx)(s.A,{variant:"subtitle1",sx:{mt:1,mb:1},children:"Installment Plan"}),(0,l.jsx)("table",{style:f.table,children:(0,l.jsxs)("tbody",{children:[(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{style:f.td,children:"Weeks"}),(0,l.jsx)("td",{style:f.right,children:null!==(x=m.weeks)&&void 0!==x?x:"\u2014"})]}),(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{style:f.td,children:"Weekly Amount"}),(0,l.jsx)("td",{style:f.right,children:"number"===typeof m.weeklyAmount?j(Number(m.weeklyAmount)):"\u2014"})]}),(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{style:f.td,children:"Total"}),(0,l.jsx)("td",{style:f.right,children:"number"===typeof m.totalAmount?j(Number(m.totalAmount)):"\u2014"})]}),(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{style:f.td,children:"Amount Paid"}),(0,l.jsx)("td",{style:f.right,children:"number"===typeof m.amountPaid?j(Number(m.amountPaid)):"\u2014"})]}),(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{style:f.td,children:"Remaining"}),(0,l.jsx)("td",{style:f.right,children:"number"===typeof m.remainingAmount?j(Number(m.remainingAmount)):"\u2014"})]}),(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{style:f.td,children:"Next Due"}),(0,l.jsx)("td",{style:f.right,children:m.nextDueDate?new Date(m.nextDueDate).toLocaleDateString():"\u2014"})]})]})})]})]})]})})},90641(e,t,i){i.d(t,{$:()=>a,i:()=>o});var r=i(81052),n=i.n(r),s=i(95612);async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"document.pdf",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)return;const r=i.scale||2,o=i.margin||10,a=await n()(e,{scale:r,useCORS:!0,allowTaint:!1,imageTimeout:0,backgroundColor:"#ffffff",scrollY:-window.scrollY}),l=a.toDataURL("image/png"),d=new s.uE("p","mm","a4"),c=d.internal.pageSize.getWidth(),u=d.internal.pageSize.getHeight(),x=e=>.264583*e,h=x(a.width),m=.264583*o,p=c-2*m,g=p,b=x(a.height)*(p/h);d.addImage(l,"PNG",m,m,g,b);const v=u-2*m;let A=b-v;for(;A>0;){d.addPage();const e=m-(b-A);d.addImage(l,"PNG",m,e,g,b),A-=v}d.save(t)}async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return null;const i=t.scale||2,r=t.margin||10,o=await n()(e,{scale:i,useCORS:!0,allowTaint:!1,imageTimeout:0,backgroundColor:"#ffffff",scrollY:-window.scrollY}),a=o.toDataURL("image/png"),l=new s.uE("p","mm","a4"),d=l.internal.pageSize.getWidth(),c=l.internal.pageSize.getHeight(),u=e=>.264583*e,x=u(o.width),h=.264583*r,m=d-2*h,p=m,g=u(o.height)*(m/x);l.addImage(a,"PNG",h,h,p,g);const b=c-2*h;let v=g-b;for(;v>0;){l.addPage();const e=h-(g-v);l.addImage(a,"PNG",h,e,p,g),v-=b}const A=l.output("blob");return URL.createObjectURL(A)}}}]);