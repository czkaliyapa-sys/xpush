"use strict";(self.webpackChunkitsxtrapush=self.webpackChunkitsxtrapush||[]).push([[330],{35330(e,t,o){o.r(t),o.d(t,{default:()=>E});var n=o(9950),r=o(52111),i=o(35218),a=o(42342),s=o(2015),l=o(68057),d=o(36837),c=o(42687),h=o(43824),p=o(42020),m=o(64885),x=o(86057),u=o(6503),g=o(27321),f=o(57559),b=o(66424),y=o(32182),j=o(52517),v=o(31949),w=o(68942),I=o(44414);const M=e=>{let{modelPath:t,scale:r=1,position:s=[0,0,0],rotation:l=[0,0,0],onLoad:d,onError:h,autoRotate:p=!1}=e;const m=(0,n.useRef)(),[u,g]=(0,n.useState)(!1),[f,b]=(0,n.useState)(""),{GLTFLoader:y}=o(15061),j=(0,n.useMemo)(()=>t,[t]),v=(0,i.H)(y,j,e=>{e.setCrossOrigin("anonymous");try{const o=new URL(j);if(/sparkle-pro\.co\.uk$/i.test(o.hostname)){const n=new URL(t,window.location.href).pathname.replace(/[^/]+$/,"");e.setResourcePath("https://".concat(o.host).concat(n)),e.manager.setURLModifier(e=>{try{if(e.startsWith("data:")||e.startsWith("blob:"))return e;if(/^https?:\/\//i.test(e)){const t=new URL(e);if(t.host===o.host){if("/models-proxy"===t.pathname||"/api/models-proxy"===t.pathname)return e;if(t.pathname.startsWith("/api/models/")){const e=decodeURIComponent(t.pathname).replace(/(\.gltf|\.glb|\.obj)\.+$/i,"$1");return"https://".concat(o.host,"/api/models-proxy?url=").concat(encodeURIComponent(e))}if(t.pathname.startsWith("/api/")){const e=t.pathname.replace(/^\/api\//,""),r="".concat(n).concat(e),i=decodeURIComponent(r).replace(/(\.gltf|\.glb|\.obj)\.+$/i,"$1");return"https://".concat(o.host,"/api/models-proxy?url=").concat(encodeURIComponent(i))}}return e}const t=e.replace(/^\//,""),r="".concat(n).concat(t),i=decodeURIComponent(r).replace(/(\.gltf|\.glb|\.obj)\.+$/i,"$1");return"https://".concat(o.host,"/api/models-proxy?url=").concat(encodeURIComponent(i))}catch(t){return e}})}}catch(o){}});if((0,i.F)(e=>{p&&m.current&&!u&&(m.current.rotation.y+=.005)}),(0,n.useEffect)(()=>{if(v)if(null!==v&&void 0!==v&&v.scene)try{if(!v.scene.children||0===v.scene.children.length)throw new Error("Model scene is empty or corrupted");v.scene.traverse(e=>{if(e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0,e.material)){const t=e.material;"number"===typeof t.envMapIntensity&&(t.envMapIntensity=Math.max(1.2,t.envMapIntensity||1.2)),"number"===typeof t.roughness&&(t.roughness=Math.min(.7,Math.max(.2,t.roughness))),"number"===typeof t.metalness&&(t.metalness=Math.min(.5,Math.max(0,t.metalness))),"number"===typeof t.aoMapIntensity&&(t.aoMapIntensity=Math.min(.3,Math.max(0,t.aoMapIntensity))),"number"===typeof t.emissiveIntensity&&(t.emissiveIntensity=Math.max(.2,t.emissiveIntensity||.2)),e.material.needsUpdate=!0}}),d&&d(v.scene),g(!1)}catch(e){console.error("Error processing 3D model:",e),b("Model processing failed: ".concat(e.message)),h&&h(e),g(!0)}else{const e=new Error("Model loaded but contains no 3D scene data");console.error(e),b("Invalid model format - no 3D scene found"),h&&h(e),g(!0)}},[v,null===v||void 0===v?void 0:v.scene,t]),u)return(0,I.jsx)(a.E,{center:!0,children:(0,I.jsxs)(x.A,{severity:"error",sx:{minWidth:250,maxWidth:400,textAlign:"center"},children:[(0,I.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px"},children:"3D Model Error"}),(0,I.jsx)("div",{style:{fontSize:"0.9em",marginBottom:"8px"},children:f||"Failed to load 3D model"}),t&&(0,I.jsxs)("div",{style:{fontSize:"0.7em",color:"#666",wordBreak:"break-all"},children:["Path: ",t]}),(0,I.jsx)("div",{style:{fontSize:"0.8em",marginTop:"8px",fontStyle:"italic"},children:"Switching to 2D view recommended"})]})});try{return(0,I.jsx)(c.o,{children:(0,I.jsx)("primitive",{ref:m,object:v.scene,scale:r,position:s,rotation:l})})}catch(w){return console.error("Error rendering 3D model:",w),(0,I.jsx)(a.E,{center:!0,children:(0,I.jsxs)(x.A,{severity:"error",sx:{minWidth:200},children:[(0,I.jsx)("div",{style:{fontWeight:"bold"},children:"Rendering Error"}),(0,I.jsx)("div",{style:{fontSize:"0.9em",marginTop:"4px"},children:"Failed to display 3D model"})]})})}},S=e=>{let{modelPath:t,scale:o=1,position:r=[0,0,0],rotation:a=[0,0,0],onLoad:s,onError:l,autoRotate:d=!1}=e;const h=(0,n.useRef)(),p=(0,i.H)(w.L,t);return(0,i.F)(()=>{d&&h.current&&(h.current.rotation.y+=.005)}),(0,n.useEffect)(()=>{if(p)try{const e=p;if(!e||!e.children||0===e.children.length)throw new Error("OBJ scene is empty or corrupted");e.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0,e.material&&(e.material.needsUpdate=!0))}),s&&s(e)}catch(e){console.error("Error processing OBJ model:",e),l&&l(e)}},[p,t,s,l]),(0,I.jsx)(c.o,{children:(0,I.jsx)("primitive",{ref:h,object:p,scale:o,position:r,rotation:a})})},R=e=>{let{modelPath:t,scale:o=1,position:n=[0,0,0],rotation:r=[0,0,0],onLoad:i,onError:s,autoRotate:l=!1}=e;if(!(t&&"string"===typeof t&&t.trim().length>0&&(t.toLowerCase().endsWith(".gltf")||t.toLowerCase().endsWith(".glb")||t.toLowerCase().endsWith(".obj")))){const e=t?t.trim()?"Invalid model format (must be .gltf, .glb, or .obj)":"Empty model path":"No model path provided";return(0,I.jsx)(a.E,{center:!0,children:(0,I.jsxs)(x.A,{severity:"warning",sx:{minWidth:250,textAlign:"center"},children:[(0,I.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px"},children:"Model Path Error"}),(0,I.jsx)("div",{style:{fontSize:"0.9em",marginBottom:"8px"},children:e}),t&&(0,I.jsxs)("div",{style:{fontSize:"0.7em",color:"#666",wordBreak:"break-all"},children:["Provided: ",t]}),(0,I.jsx)("div",{style:{fontSize:"0.8em",marginTop:"8px",fontStyle:"italic"},children:"Please use 2D view instead"})]})})}return t.toLowerCase().endsWith(".obj")?(0,I.jsx)(S,{modelPath:t,scale:o,position:n,rotation:r,onLoad:i,onError:s,autoRotate:l}):(0,I.jsx)(M,{modelPath:t,scale:o,position:n,rotation:r,onLoad:i,onError:s,autoRotate:l})},k=e=>{let{gadgetName:t}=e;const o=(0,n.useRef)();return(0,i.F)(e=>{o.current&&(o.current.rotation.y+=.01)}),(0,I.jsxs)(c.o,{children:[(0,I.jsxs)("mesh",{ref:o,castShadow:!0,receiveShadow:!0,children:[(0,I.jsx)("boxGeometry",{args:[2,3,.2]}),(0,I.jsx)("meshStandardMaterial",{color:"#333",metalness:.8,roughness:.2})]}),(0,I.jsx)(a.E,{center:!0,children:(0,I.jsx)("div",{style:{color:"white",textAlign:"center",background:"rgba(0,0,0,0.7)",padding:"10px",borderRadius:"8px",fontSize:"14px"},children:"3D model not present"})})]})},P=()=>{const{active:e,progress:t,loaded:o,total:n,item:r}=(0,d.p)(),i=Number.isFinite(t)?Math.max(0,Math.min(100,t)):0,s=n>0&&i>0;return(0,I.jsx)(a.E,{center:!0,children:(0,I.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",color:"white",background:"rgba(0,0,0,0.7)",padding:"20px",borderRadius:"8px",minWidth:220},children:[(0,I.jsx)(u.A,{variant:s?"determinate":"indeterminate",value:s?i:void 0,sx:{color:"white",mb:1},thickness:4}),(0,I.jsx)("div",{style:{fontSize:"0.95em",marginBottom:4},children:"Loading 3D Model\u2026"}),e&&(0,I.jsxs)("div",{style:{fontSize:"0.85em",opacity:.9},children:[Math.round(i),"% \u2022 ",o,"/",Math.max(n,o)," assets"]}),r&&(0,I.jsx)("div",{style:{fontSize:"0.75em",opacity:.7,marginTop:4,maxWidth:280,textAlign:"center",wordBreak:"break-all"},children:String(r).split("/").slice(-1)[0]})]})})},E=e=>{var t;let{gadgetName:o,gadgetBrand:i="",gadgetModel:a="",gadgetId:d=null,modelPath:c=null,fallbackImage:x,className:u="",height:w="500px",showControls:M=!0,onModelLoad:S=null,onModelError:E=null,enableControls:A=!0,autoRotate:C=!1}=e;const[z,L]=(0,n.useState)(!0),[W,D]=(0,n.useState)(!1),[B,Z]=(0,n.useState)(null),[N,U]=(0,n.useState)(!0),H=(0,n.useRef)(),[F,T]=(0,n.useState)(!1);(0,n.useEffect)(()=>{try{const e="undefined"!==typeof window&&("ontouchstart"in window||navigator&&navigator.maxTouchPoints>0);T(!!e)}catch(e){T(!1)}},[]);const $=(null!==(t=null===B||void 0===B?void 0:B.scale)&&void 0!==t?t:1)<=.2,G=$?.1:.4,O=$?12:30;(0,n.useEffect)(()=>{(async()=>{if(c)return Z({path:c,config:{scale:1,position:[0,0,0],rotation:[0,0,0]}}),void U(!1);if(!o)return D(!0),void U(!1);try{U(!0);const e=await v.A.getBestModelPath(o,i,a);e?(Z(e),D(!1)):(console.warn("No 3D model found for: ".concat(o)),D(!0))}catch(e){console.error("Error loading model info:",e),D(!0),E&&E(e)}finally{U(!1)}})()},[o,i,a,c]);const J=()=>{L(!z)};return z&&(N||B&&B.path)&&!W?(0,I.jsxs)(g.A,{className:u,sx:{height:w,position:"relative",width:"100%",maxWidth:"100%",borderRadius:2,overflow:"hidden",background:"transparent"},children:[(0,I.jsxs)(r.Hl,{ref:H,camera:{position:[0,.2,1],fov:50,near:.01,far:1e3},shadows:!0,style:{background:"transparent",width:"100%",height:"100%"},onError:e=>{console.error("Canvas error:",e),D(!0),E&&E(e)},gl:{toneMappingExposure:1.15},children:[(0,I.jsx)("ambientLight",{intensity:.8}),(0,I.jsx)("spotLight",{position:[10,10,10],angle:.15,penumbra:1,intensity:1.2,castShadow:!0}),(0,I.jsx)("pointLight",{position:[-10,-10,-10],intensity:.7}),(0,I.jsxs)(n.Suspense,{fallback:(0,I.jsx)(P,{}),children:[(0,I.jsx)(s.h,{global:!0,config:{mass:2,tension:500},snap:{mass:4,tension:1500},rotation:[0,0,0],polar:[-Math.PI/4,Math.PI/4],azimuth:[-Math.PI/1.2,Math.PI/1.2],children:N?(0,I.jsx)(P,{}):B&&B.path?(0,I.jsx)(R,{modelPath:B.path,scale:B.scale||1,position:B.position||[0,0,0],rotation:B.rotation||[0,0,0],onLoad:S,onError:e=>{D(!0),E&&E(e)},autoRotate:C}):(0,I.jsx)(k,{gadgetName:o})}),(0,I.jsx)(h._,{position:[0,-.25,0],opacity:.15,scale:8,blur:1.2,far:3}),(0,I.jsxs)(p.OH,{resolution:512,frames:1,children:[(0,I.jsx)(m.O,{form:"ring",intensity:2.2,position:[0,2,5],scale:3,color:"#ffffff"}),(0,I.jsx)(m.O,{intensity:.8,"rotation-x":Math.PI/2,position:[0,6,0],scale:12,color:"#ffffff"}),(0,I.jsx)(m.O,{intensity:.2,position:[-6,2,-4],scale:8,color:"#ffffff"})]}),(0,I.jsx)("hemisphereLight",{skyColor:16777215,groundColor:6710886,intensity:.8}),(0,I.jsx)("directionalLight",{position:[5,5,5],intensity:1,castShadow:!0}),(0,I.jsx)(h._,{position:[0,-.5,0],opacity:.3,scale:10,blur:2,far:4})]}),A&&(0,I.jsx)(l.N,{enablePan:!0,enableZoom:!0,enableRotate:!0,autoRotate:C,autoRotateSpeed:2,zoomSpeed:1.2,minDistance:G,maxDistance:O,target:[0,0,0]})]}),M&&(0,I.jsx)(g.A,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:1,background:"rgba(0,0,0,0.7)",borderRadius:1,p:.5},children:(0,I.jsx)(f.A,{title:"Standard view",children:(0,I.jsx)(b.A,{size:"small",onClick:J,sx:{color:"white"},children:(0,I.jsx)(y.A,{})})})}),(0,I.jsx)(g.A,{sx:{position:"absolute",bottom:8,left:8,background:"rgba(0,0,0,0.7)",color:"white",px:1,py:.5,borderRadius:1,fontSize:"12px"},children:"3D view"}),(0,I.jsx)(g.A,{sx:{position:"absolute",bottom:8,right:8,background:"rgba(0,0,0,0.7)",color:"white",px:1,py:.5,borderRadius:1,fontSize:"10px"},children:F?"Use your finger to drag \u2022 Pinch to zoom":"Drag with mouse \u2022 Scroll to zoom"})]}):(0,I.jsxs)(g.A,{className:u,sx:{height:w,position:"relative",borderRadius:2,overflow:"hidden",background:"linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%)"},children:[(0,I.jsx)("img",{src:x,alt:o,style:{width:"100%",height:"100%",objectFit:"contain",background:"transparent"},onError:e=>{e.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMzMzIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg=="}}),M&&(0,I.jsx)(g.A,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:1,background:"rgba(0,0,0,0.7)",borderRadius:1,p:.5},children:(null===B||void 0===B?void 0:B.path)&&(0,I.jsx)(f.A,{title:"3D view",children:(0,I.jsx)(b.A,{size:"small",onClick:J,sx:{color:"white"},children:(0,I.jsx)(j.A,{})})})}),(0,I.jsx)(g.A,{sx:{position:"absolute",bottom:8,left:8,background:"rgba(0,0,0,0.7)",color:"white",px:1,py:.5,borderRadius:1,fontSize:"12px"},children:"Standard view"}),!N&&(!B||!B.path)&&(0,I.jsx)(g.A,{sx:{position:"absolute",bottom:8,right:8,background:"rgba(255,0,0,0.7)",color:"white",px:1,py:.5,borderRadius:1,fontSize:"12px"},children:"Model not present"})]})}}}]);