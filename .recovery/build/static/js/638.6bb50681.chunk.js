"use strict";(self.webpackChunkitsxtrapush=self.webpackChunkitsxtrapush||[]).push([[638],{33638(e,t,i){i.r(t),i.d(t,{default:()=>vi});var n=i(89379),s=i(9950),r=i(35481),l=i(96195),a=i(7356),o=i(27532),d=i(92994),c=i(5332),u=i(79448),m=i(27321),h=i(97228),x=i(82161),p=i(81393),v=i(98519),g=i(66424),y=i(80975),A=i(43711),j=i(16253),f=i(38796),b=i(82503),w=i(56690),k=i(5352),S=i(66615),P=i(55547),C=i(52036),N=i(46167),D=i(91724),I=i(74106),W=i(89737),M=i(80660),O=i(92860),_=i(10614),T=i(61106),E=i(81211),F=i(4535),L=i(46563),z=i(10873),U=i(62101),q=i(6768),R=i(13746),G=i(47445),V=i(43405),B=i(44414);const Q=()=>{const e=(0,d.Zp)(),t=(0,d.zy)(),{logout:i,userRole:n}=(0,V.A)(),r=(e=>{const t=[{text:"Home",icon:(0,B.jsx)(E.A,{}),path:"/dashboard"},{text:"Settings",icon:(0,B.jsx)(U.A,{}),path:"/dashboard/settings"}],i={admin:[{text:"Analytics",icon:(0,B.jsx)(F.A,{}),path:"/dashboard/analytics"},{text:"Users",icon:(0,B.jsx)(L.A,{}),path:"/dashboard/users"},{text:"Verify Listings",icon:(0,B.jsx)(z.A,{}),path:"/dashboard/verify"},{text:"Gadgets",icon:(0,B.jsx)(G.A,{}),path:"/dashboard/gadgets"},{text:"Orders",icon:(0,B.jsx)(F.A,{}),path:"/dashboard/orders"},{text:"Installments",icon:(0,B.jsx)(z.A,{}),path:"/dashboard/installments"}],seller:[{text:"My Listings",icon:(0,B.jsx)(G.A,{}),path:"/dashboard/listings"},{text:"Add Listing",icon:(0,B.jsx)(z.A,{}),path:"/dashboard/add-listing"},{text:"Orders",icon:(0,B.jsx)(F.A,{}),path:"/dashboard/orders"}],buyer:[{text:"Orders",icon:(0,B.jsx)(F.A,{}),path:"/dashboard/orders"},{text:"Installments",icon:(0,B.jsx)(z.A,{}),path:"/dashboard/installments"}]},n=[...t];return i[e]&&n.splice(1,0,...i[e]),n.push({text:"About",icon:(0,B.jsx)(q.A,{}),path:"/dashboard/about"}),n.push({text:"Sign Out",icon:(0,B.jsx)(R.A,{}),path:"/"}),n})(n||"buyer");return(0,B.jsx)(s.Fragment,{children:r.map(n=>{const s="Sign Out"===n.text,r=e=>{if(!e)return"/";const t=e.replace(/\/+$/,"");return""===t?"/":t},l=r(t.pathname),a=r(n.path),o="/"===a?"/"===l:"/dashboard"===a?"/dashboard"===l:l===a||l.startsWith(a+"/");return(0,B.jsxs)(O.A,{sx:{mx:1,mb:.5,borderRadius:2,backgroundColor:o?"#334155":"transparent","&:hover":{backgroundColor:"#334155"}},onClick:async()=>{"Sign Out"===n.text?(await i(),e("/")):e(n.path)},children:[(0,B.jsx)(_.A,{sx:{color:s?"red":o?"#f8fafc":"#94a3b8",minWidth:40},children:n.icon}),(0,B.jsx)(T.A,{primary:n.text,sx:{"& .MuiListItemText-primary":{color:s?"red":o?"#f8fafc":"#94a3b8",fontWeight:o?500:400}}})]},n.text)})})};var K=i(86057),H=i(6503),J=i(25269),X=i(87631),Y=i(50943),$=i(33588),Z=i(48767),ee=i(39172),te=i(94305),ie=i(80218),ne=i(6732),se=i(65250),re=i(45774);const le=function(e){return(0,B.jsx)(v.A,{component:"h2",variant:"h6",color:"primary",gutterBottom:!0,children:e.children})};var ae=i(19181),oe=i(19676),de=i(69335),ce=i(86507),ue=i(90641);function me(){const{user:e,isAdmin:t}=(0,V.A)(),{formatLocalPrice:i}=(0,de.e)(),[n,r]=(0,s.useState)([]),[l,a]=(0,s.useState)(!1),[o,d]=(0,s.useState)(null),[c,u]=(0,s.useState)(null),[h,x]=(0,s.useState)(null),p=(0,s.useRef)(null),[y,A]=(0,s.useState)(!1),[j,b]=(0,s.useState)(null);return(0,s.useEffect)(()=>{(async()=>{const i=(null===e||void 0===e?void 0:e.uid)||(null===e||void 0===e?void 0:e.id)||null,n=t(),s="admin_system_default"===i,l=n||s;if(l||i){a(!0),d(null);try{const e=l?await ae.gH.getAllOrders():await ae.gH.getUserOrders(i);if(null===e||void 0===e||!e.success)throw new Error((null===e||void 0===e?void 0:e.error)||"Failed to fetch orders");r(e.orders||[])}catch(m){var o;const e=null===m||void 0===m||null===(o=m.response)||void 0===o?void 0:o.status,t=l?"/admin/orders":i?"/orders/user/".concat(i):"/orders/user/:uid";if(console.error("Orders fetch error:",{error:m,status:e,endpointPath:t}),n&&404===e&&i&&!s)try{const e=await ae.gH.getUserOrders(i);null!==e&&void 0!==e&&e.success?(r(e.orders||[]),u("Admin endpoint unavailable; showing your orders only."),d(null)):d((null===e||void 0===e?void 0:e.error)||"Orders API endpoint not found (404) for ".concat(t,"."))}catch(h){console.error("Fallback user orders fetch error:",h),d("Orders API endpoint not found (404) for ".concat(t,"."))}else{var c;let i;i=404===e?"Orders API endpoint not found (404) for ".concat(t,"."):401===e||403===e?"Access denied (".concat(e,"). Please ensure you are logged in with the correct permissions."):e>=500?"Server error (".concat(e,"). Please try again later."):!e&&null!==m&&void 0!==m&&null!==(c=m.message)&&void 0!==c&&c.includes("Network")?"Network error while contacting the API.":(null===m||void 0===m?void 0:m.message)||"Failed to fetch orders",d(i)}}finally{a(!1)}}})()},[e,t]),(0,B.jsxs)(s.Fragment,{children:[(0,B.jsx)(le,{children:t()?"All Orders":"My Orders"}),(0,B.jsxs)(f.A,{sx:{p:2},children:[c&&(0,B.jsx)(K.A,{severity:"warning",sx:{mb:2},children:c}),l&&(0,B.jsx)(m.A,{sx:{display:"flex",justifyContent:"center",p:2},children:(0,B.jsx)(H.A,{})}),o&&(0,B.jsx)(K.A,{severity:"error",sx:{mb:2},children:o}),!l&&!o&&(0,B.jsx)(J.A,{sx:{width:"100%",overflowX:"auto"},children:(0,B.jsxs)(X.A,{size:"small",sx:{minWidth:720},children:[(0,B.jsx)(Y.A,{children:(0,B.jsxs)($.A,{children:[(0,B.jsx)(Z.A,{children:"Order ID"}),t()&&(0,B.jsx)(Z.A,{children:"User"}),(0,B.jsx)(Z.A,{children:"Date"}),(0,B.jsx)(Z.A,{children:"Status"}),(0,B.jsx)(Z.A,{children:"Payment"}),(0,B.jsx)(Z.A,{children:"Items"}),(0,B.jsx)(Z.A,{align:"right",children:"Total"}),(0,B.jsx)(Z.A,{align:"right",children:"Actions"})]})}),(0,B.jsx)(ee.A,{children:0===n.length?(0,B.jsx)($.A,{children:(0,B.jsx)(Z.A,{colSpan:t()?8:7,align:"center",children:"No orders yet."})}):n.map(e=>(0,B.jsxs)($.A,{children:[(0,B.jsxs)(Z.A,{children:["#",e.id]}),t()&&(0,B.jsxs)(Z.A,{children:[(0,B.jsx)(v.A,{variant:"body2",children:e.userEmail||"\u2014"}),e.userName&&(0,B.jsx)(v.A,{variant:"caption",color:"text.secondary",children:e.userName})]}),(0,B.jsx)(Z.A,{children:new Date(e.createdAt).toLocaleString()}),(0,B.jsx)(Z.A,{children:(0,B.jsx)(te.A,{label:e.status||"pending",size:"small"})}),(0,B.jsx)(Z.A,{children:(0,B.jsx)(te.A,{label:e.paymentStatus||"unpaid",color:"paid"===e.paymentStatus?"success":"default",size:"small"})}),(0,B.jsx)(Z.A,{children:Array.isArray(e.items)&&e.items.map((e,t)=>(0,B.jsxs)(m.A,{sx:{display:"flex",gap:1,alignItems:"center",mb:.5},children:[(0,B.jsx)("img",{src:e.image,alt:e.name,style:{width:32,height:32,borderRadius:4}}),(0,B.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,B.jsxs)(v.A,{variant:"body2",children:[e.name," x",e.quantity," (",e.brand," ",e.model,")"]}),(0,B.jsxs)(v.A,{variant:"caption",color:"text.secondary",children:[e.storage?"Storage: ".concat(e.storage):"Storage: \u2014","undefined"!==typeof e.variantId&&null!==e.variantId?" \u2022 Variant #".concat(e.variantId):"","undefined"!==typeof e.unitPrice?" \u2022 Unit: ".concat(i(e.unitPrice)):""]})]})]},t))}),(0,B.jsx)(Z.A,{align:"right",children:i(e.totalAmount)}),(0,B.jsxs)(Z.A,{align:"right",children:[(0,B.jsx)(S.A,{variant:"outlined",size:"small",onClick:async()=>{x(e),setTimeout(async()=>{p.current&&await(0,ue.i)(p.current,"Order-".concat(e.id,".pdf"))},0)},children:"Download PDF"}),(0,B.jsx)(S.A,{variant:"contained",size:"small",sx:{ml:1},onClick:async()=>{x(e),setTimeout(async()=>{if(p.current){const e=await(0,ue.$)(p.current);b(e),A(!0)}},0)},children:"View PDF"})]})]},e.id))})]})}),(0,B.jsx)(m.A,{sx:{position:"absolute",left:-9999,top:-9999},children:h&&(0,B.jsx)(ce.A,{ref:p,order:h})})]}),(0,B.jsxs)(ie.A,{open:y,onClose:()=>{if(A(!1),j){try{URL.revokeObjectURL(j)}catch(e){}b(null)}},fullWidth:!0,maxWidth:"md",children:[(0,B.jsxs)(ne.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:["Order PDF Preview",(0,B.jsx)(g.A,{"aria-label":"close",onClick:()=>{if(A(!1),j){try{URL.revokeObjectURL(j)}catch(e){}b(null)}},children:(0,B.jsx)(re.A,{})})]}),(0,B.jsx)(se.A,{dividers:!0,children:j?(0,B.jsx)("iframe",{title:"Order PDF",src:j,style:{width:"100%",height:"80vh",border:"none"}}):(0,B.jsx)(m.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,B.jsx)(H.A,{})})})]})]})}var he=i(57559),xe=i(98506),pe=i(20615),ve=i(87209),ge=i(65812),ye=i(85935),Ae=i(47371),je=i(31760);function fe(e){var t,i,n,s,r,l,a,o,d,c,u,m;const h=function(e){if(!e)return null;if("object"===typeof e)return e;try{return JSON.parse(e)}catch(t){return null}}(null===e||void 0===e?void 0:e.notes),x=(null===h||void 0===h?void 0:h.installmentPlan)||h||null,p=(null===e||void 0===e?void 0:e.createdAt)||(null===e||void 0===e?void 0:e.created_at),v=(null===e||void 0===e?void 0:e.paidAt)||(null===e||void 0===e?void 0:e.paid_at),g=Number(null!==(t=null!==(i=null===e||void 0===e?void 0:e.totalAmount)&&void 0!==i?i:null===e||void 0===e?void 0:e.total_amount)&&void 0!==t?t:0),y=Number(null!==(n=null!==(s=null===x||void 0===x?void 0:x.depositAmount)&&void 0!==s?s:null===x||void 0===x?void 0:x.deposit)&&void 0!==n?n:0),A=Number(null!==(r=null!==(l=null!==(a=null===x||void 0===x?void 0:x.weeks)&&void 0!==a?a:null===x||void 0===x?void 0:x.durationWeeks)&&void 0!==l?l:null===x||void 0===x?void 0:x.duration)&&void 0!==r?r:0),j=Number(null!==(o=null!==(d=null===x||void 0===x?void 0:x.weeklyAmount)&&void 0!==d?d:null===x||void 0===x?void 0:x.weekly)&&void 0!==o?o:Math.ceil(Math.max(g-y,0)/(A||1))),f=Number(null!==(c=null===x||void 0===x?void 0:x.amountPaid)&&void 0!==c?c:null!==x&&void 0!==x&&x.partials?x.partials.reduce((e,t)=>e+Number((null===t||void 0===t?void 0:t.amount)||0),0)+y:y),b=Math.max(Number(null!==(u=null===x||void 0===x?void 0:x.totalAmount)&&void 0!==u?u:g)-f,0),w=v||p,k=w?new Date(new Date(w).getTime()+7*A*24*60*60*1e3):null,S=b<=0?"paid":"ongoing";return{raw:x,weeks:A,weeklyAmount:j,depositAmount:y,amountPaid:f,remainingAmount:b,totalAmount:Number(null!==(m=null===x||void 0===x?void 0:x.totalAmount)&&void 0!==m?m:g),startDate:w,expiryDate:k,status:S}}const be=e=>{let{open:t,onClose:i,order:n,customerEmail:r,initialPayMode:l="weekly",initialCustomAmount:a=null}=e;const[o,c]=(0,s.useState)(!1),[u,h]=(0,s.useState)(""),[x,p]=(0,s.useState)(l),[g,y]=(0,s.useState)(()=>"number"===typeof a&&a>0?Math.round(a):0),{userProfile:A}=(0,V.A)(),{currency:j}=(0,de.e)(),f=(0,d.Zp)(),k=(0,pe.A)("(max-width:600px)"),P=(0,s.useMemo)(()=>fe(n||{}),[n]),C=Math.round(Number((null===P||void 0===P?void 0:P.weeklyAmount)||0)),N=Math.round(Number((null===P||void 0===P?void 0:P.remainingAmount)||0)),D="paid"===(null===P||void 0===P?void 0:P.status)||C<=0&&N<=0,I="weekly"===x?C:"remaining"===x?N:Math.round(Number(g||0));return t?(0,B.jsxs)(ie.A,{open:t,onClose:i,maxWidth:"sm",fullWidth:!0,disableEscapeKeyDown:!0,ModalProps:{keepMounted:!0,disableEnforceFocus:!0,disableRestoreFocus:!0},PaperProps:{sx:{bgcolor:"#1565c0",color:"white",borderRadius:"20px",maxHeight:"90vh"}},children:[(0,B.jsxs)(ne.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,B.jsx)(je.A,{}),"Pay Installment"]}),(0,B.jsxs)(se.A,{sx:{color:"rgba(255,255,255,0.92)"},children:[(0,B.jsxs)(m.A,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,mb:2},children:[(0,B.jsxs)(m.A,{children:[(0,B.jsx)(v.A,{variant:"caption",sx:{opacity:.8},children:"Weekly amount"}),(0,B.jsxs)(v.A,{variant:"body1",children:["MWK ",C.toLocaleString()]})]}),(0,B.jsxs)(m.A,{children:[(0,B.jsx)(v.A,{variant:"caption",sx:{opacity:.8},children:"Remaining balance"}),(0,B.jsxs)(v.A,{variant:"body1",children:["MWK ",N.toLocaleString()]})]})]}),(0,B.jsxs)(ve.A,{size:"small",sx:{minWidth:180},children:[(0,B.jsx)(ge.A,{sx:{color:"white"},children:"Payment amount"}),(0,B.jsx)(ye.A,{value:x,label:"Payment amount",onChange:e=>p(e.target.value),native:k,sx:k?{bgcolor:"white",color:"#111",borderRadius:1}:{color:"white","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.5)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"white"}},MenuProps:{disablePortal:!0,disableScrollLock:!0,PaperProps:{sx:{bgcolor:"#1565c0",color:"white"}}},children:k?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)("option",{value:"weekly",children:["Weekly installment (MWK ",C.toLocaleString(),")"]}),(0,B.jsxs)("option",{value:"remaining",children:["Pay remaining balance (MWK ",N.toLocaleString(),")"]}),(0,B.jsx)("option",{value:"custom",children:"Pay custom amount"})]}):(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)(w.A,{value:"weekly",children:["Weekly installment (MWK ",C.toLocaleString(),")"]}),(0,B.jsxs)(w.A,{value:"remaining",children:["Pay remaining balance (MWK ",N.toLocaleString(),")"]}),(0,B.jsx)(w.A,{value:"custom",children:"Pay custom amount"})]})})]}),"custom"===x&&(0,B.jsxs)(m.A,{sx:{mt:2},children:[(0,B.jsx)(v.A,{variant:"caption",sx:{opacity:.8},children:"Enter amount (MWK)"}),(0,B.jsx)(b.A,{type:"number",value:g,onChange:e=>y(e.target.value),size:"small",fullWidth:!0,inputProps:{min:0,step:100},sx:{mt:.5,bgcolor:"white",borderRadius:1}}),(0,B.jsxs)(v.A,{variant:"caption",sx:{mt:.5,display:"block"},children:["Max: MWK ",N.toLocaleString()]})]}),u?(0,B.jsx)(v.A,{color:"error",variant:"body2",sx:{mt:2},children:u}):null]}),(0,B.jsxs)(Ae.A,{sx:{p:2},children:[(0,B.jsx)(S.A,{onClick:i,variant:"contained",disabled:o,sx:{bgcolor:"#000",color:"white","&:hover":{bgcolor:"#111"}},children:"Cancel"}),(0,B.jsx)(S.A,{variant:"contained",onClick:async()=>{const e=((null===A||void 0===A?void 0:A.phone)||"").trim();if(/^\+265\d{9}$/.test(e)){if("custom"===x){const e=Math.round(Number(g||0));if(!Number.isFinite(e)||e<=0)return void h("Enter a valid custom amount greater than 0.");if(N>0&&e>N)return void h("Custom amount cannot exceed remaining balance.")}try{c(!0),h("");const e=[{id:"order:".concat(null===n||void 0===n?void 0:n.id),name:"weekly"===x?"Weekly Installment Payment":"remaining"===x?"Final Installment Payment":"Custom Installment Payment",price:Math.round(I),quantity:1}],t={enabled:!0,paymentType:"installment_payment",orderId:null===n||void 0===n?void 0:n.id,weeks:Number((null===P||void 0===P?void 0:P.weeks)||0),weeklyAmount:C,remainingAmount:N,totalAmount:Math.round(Number((null===P||void 0===P?void 0:P.totalAmount)||0)),payAmount:Math.round(I),payMode:x},s={customerEmail:r||null,successUrl:"https://itsxtrapush.com/payment/success",cancelUrl:"https://itsxtrapush.com/payment/cancel",installmentPlan:t,currency:j},l=await ae.a5.createCheckoutSession(e,s);if(null!==l&&void 0!==l&&l.success&&null!==l&&void 0!==l&&l.url){try{localStorage.setItem("xp_lastCheckout",JSON.stringify({items:e,installmentPlan:t,customerEmail:r||null}))}catch(i){}window.location.href=l.url}else if(null!==l&&void 0!==l&&l.url){try{localStorage.setItem("xp_lastCheckout",JSON.stringify({items:e,installmentPlan:t,customerEmail:r||null}))}catch(i){}window.location.href=l.url}else h((null===l||void 0===l?void 0:l.error)||"Failed to create checkout session")}catch(s){var t;console.error("Installment payment checkout failed:",s);const e=null===s||void 0===s||null===(t=s.response)||void 0===t?void 0:t.data;h((null===e||void 0===e?void 0:e.details)||(null===e||void 0===e?void 0:e.error)||(null===s||void 0===s?void 0:s.message)||"Unexpected error")}finally{c(!1)}}else{h("Please add an active phone number (+265 followed by 9 digits) in Profile Settings before making an installment payment.");try{f("/dashboard/settings")}catch(i){}}},disabled:o||D||I<=0,sx:{bgcolor:"#000",color:"white","&:hover":{bgcolor:"#111"}},children:"Proceed"})]})]}):null};var we=i(45418);function ke(e){if(!e)return null;if("object"===typeof e)return e;try{return JSON.parse(e)}catch(t){return null}}function Se(){const{user:e,isAdmin:t,userProfile:i}=(0,V.A)(),{currency:r}=(0,de.e)(),[l,a]=(0,s.useState)([]),[o,c]=(0,s.useState)(!1),[u,h]=(0,s.useState)(null),[x,p]=(0,s.useState)(null),g=(0,d.Zp)(),[y,A]=(0,s.useState)(!1),[j,b]=(0,s.useState)(null),[w,k]=(0,s.useState)(!1),[P,C]=(0,s.useState)({}),[N,D]=(0,s.useState)(null),I=(0,s.useRef)(null),W=(0,we.useReactToPrint)({content:()=>I.current});(0,s.useEffect)(()=>{(async()=>{const i=(null===e||void 0===e?void 0:e.uid)||(null===e||void 0===e?void 0:e.id)||null,n=t(),s="admin_system_default"===i,r=n||s;if(r||i){c(!0),h(null),p(null);try{const e=r?await ae.gH.getAllOrders():await ae.gH.getUserOrders(i);if(null===e||void 0===e||!e.success)throw new Error((null===e||void 0===e?void 0:e.error)||"Failed to fetch installments");{const t=(e.orders||[]).filter(e=>{const t=ke(null===e||void 0===e?void 0:e.notes);return!!(null!==t&&void 0!==t&&t.installmentPlan||"installment_deposit"===(null===t||void 0===t?void 0:t.paymentType)||"installment_payment"===(null===t||void 0===t?void 0:t.paymentType))});a(t);try{const e={};for(const i of t){var l;const t=await ae.hf.getPlanByOrder(i.id);null!==t&&void 0!==t&&t.success&&null!==t&&void 0!==t&&null!==(l=t.data)&&void 0!==l&&l.plan&&(e[i.id]=t.data)}C(e)}catch(u){}}}catch(m){var o;const e=null===m||void 0===m||null===(o=m.response)||void 0===o?void 0:o.status,t=r?"/admin/orders":i?"/orders/user/".concat(i):"/orders/user/:uid";if(console.error("Installments fetch error:",{error:m,status:e,endpointPath:t}),n&&404===e&&i&&!s)try{const e=await ae.gH.getUserOrders(i);if(null!==e&&void 0!==e&&e.success){const t=(e.orders||[]).filter(e=>{const t=ke(null===e||void 0===e?void 0:e.notes);return!!(null!==t&&void 0!==t&&t.installmentPlan||"installment_deposit"===(null===t||void 0===t?void 0:t.paymentType)||"installment_payment"===(null===t||void 0===t?void 0:t.paymentType))});a(t),p("Admin endpoint unavailable; showing your installments only."),h(null)}else h((null===e||void 0===e?void 0:e.error)||"Orders API endpoint not found (404) for ".concat(t,"."))}catch(x){console.error("Fallback installments fetch error:",x),h("Orders API endpoint not found (404) for ".concat(t,"."))}else{var d;let i;i=404===e?"Orders API endpoint not found (404) for ".concat(t,"."):401===e||403===e?"Access denied (".concat(e,"). Please ensure you are logged in with the correct permissions."):e>=500?"Server error (".concat(e,"). Please try again later."):!e&&null!==m&&void 0!==m&&null!==(d=m.message)&&void 0!==d&&d.includes("Network")?"Network error while contacting the API.":(null===m||void 0===m?void 0:m.message)||"Failed to fetch installments",h(i)}}finally{c(!1)}}})()},[e,t]);const M=(0,s.useMemo)(()=>l.map(e=>{const t=function(e){var t,i,n,s,r,l,a,o,d,c,u,m;const h=ke(null===e||void 0===e?void 0:e.notes),x=(null===h||void 0===h?void 0:h.installmentPlan)||h||null,p=(null===e||void 0===e?void 0:e.createdAt)||(null===e||void 0===e?void 0:e.created_at),v=(null===e||void 0===e?void 0:e.paidAt)||(null===e||void 0===e?void 0:e.paid_at),g=Number(null!==(t=null!==(i=null===e||void 0===e?void 0:e.totalAmount)&&void 0!==i?i:null===e||void 0===e?void 0:e.total_amount)&&void 0!==t?t:0),y=Number(null!==(n=null!==(s=null===x||void 0===x?void 0:x.depositAmount)&&void 0!==s?s:null===x||void 0===x?void 0:x.deposit)&&void 0!==n?n:0),A=Number(null!==(r=null!==(l=null!==(a=null===x||void 0===x?void 0:x.weeks)&&void 0!==a?a:null===x||void 0===x?void 0:x.durationWeeks)&&void 0!==l?l:null===x||void 0===x?void 0:x.duration)&&void 0!==r?r:0),j=Number(null!==(o=null!==(d=null===x||void 0===x?void 0:x.weeklyAmount)&&void 0!==d?d:null===x||void 0===x?void 0:x.weekly)&&void 0!==o?o:Math.ceil(Math.max(g-y,0)/(A||1))),f=Number(null!==(c=null===x||void 0===x?void 0:x.amountPaid)&&void 0!==c?c:null!==x&&void 0!==x&&x.partials?x.partials.reduce((e,t)=>e+Number((null===t||void 0===t?void 0:t.amount)||0),0)+y:y),b=Math.max(Number(null!==(u=null===x||void 0===x?void 0:x.totalAmount)&&void 0!==u?u:g)-f,0),w=v||p,k=w?new Date(new Date(w).getTime()+7*A*24*60*60*1e3):null,S=b<=0?"paid":"ongoing";let P=null,C=null,N="unknown",D=0;if("paid"!==S&&w&&A>0){const e=Math.max(0,f-y),t=j>0?j:1;D=Math.min(A,Math.floor(e/t));const i=D+1,n=new Date(w);P=new Date(n.getTime()+7*i*24*60*60*1e3);const s=new Date;C=Math.ceil((P-s)/864e5),N=C<0?"overdue":0===C?"due_today":C<=3?"due_soon":"upcoming"}else"paid"===S&&(N="paid",C=0);return{raw:x,weeks:A,weeklyAmount:j,depositAmount:y,amountPaid:f,remainingAmount:b,totalAmount:Number(null!==(m=null===x||void 0===x?void 0:x.totalAmount)&&void 0!==m?m:g),startDate:w,expiryDate:k,status:S,nextDueDate:P,daysUntilDue:C,dueState:N,paymentsMade:D}}(e),i=P[e.id],n=null===i||void 0===i?void 0:i.plan;var s,r,l,a,o,d;if(n&&(t.startDate=n.start_at||t.startDate,t.expiryDate=n.expiry_at||t.expiryDate,t.nextDueDate=n.next_due_at||t.nextDueDate,t.weeks=Number(null!==(s=n.weeks)&&void 0!==s?s:t.weeks),t.weeklyAmount=Number(null!==(r=n.weekly_amount)&&void 0!==r?r:t.weeklyAmount),t.depositAmount=Number(null!==(l=n.deposit_amount)&&void 0!==l?l:t.depositAmount),t.amountPaid=Number(null!==(a=n.amount_paid)&&void 0!==a?a:t.amountPaid),t.totalAmount=Number(null!==(o=n.total_amount)&&void 0!==o?o:t.totalAmount),t.status=n.status||t.status,t.paymentsMade=Number(null!==(d=n.payments_made)&&void 0!==d?d:t.paymentsMade),t.remainingAmount=Math.max(t.totalAmount-t.amountPaid,0),"paid"!==t.status&&t.nextDueDate)){const e=new Date,i=new Date(t.nextDueDate),n=Math.ceil((i-e)/864e5);t.daysUntilDue=n,t.dueState=n<0?"overdue":0===n?"due_today":n<=3?"due_soon":"upcoming"}return{id:e.id,userEmail:e.userEmail,userName:e.userName,createdAt:e.createdAt,startDate:t.startDate,expiryDate:t.expiryDate,weeks:t.weeks,weeklyAmount:t.weeklyAmount,depositAmount:t.depositAmount,amountPaid:t.amountPaid,remainingAmount:t.remainingAmount,totalAmount:t.totalAmount,status:t.status,nextDueDate:t.nextDueDate,daysUntilDue:t.daysUntilDue,dueState:t.dueState,order:e}}),[l,P]);return(0,B.jsxs)(s.Fragment,{children:[(0,B.jsx)(le,{children:t()?"All Installments":"My Installments"}),(0,B.jsxs)(f.A,{sx:{p:2},children:[x&&(0,B.jsx)(K.A,{severity:"warning",sx:{mb:2},children:x}),o&&(0,B.jsx)(m.A,{sx:{display:"flex",justifyContent:"center",p:2},children:(0,B.jsx)(H.A,{})}),u&&(0,B.jsx)(K.A,{severity:"error",sx:{mb:2},children:u}),!o&&!u&&(0,B.jsx)(J.A,{sx:{width:"100%",overflowX:"auto"},children:(0,B.jsxs)(X.A,{size:"small",sx:{minWidth:720},children:[(0,B.jsx)(Y.A,{children:(0,B.jsxs)($.A,{children:[(0,B.jsx)(Z.A,{children:"Order ID"}),t()&&(0,B.jsx)(Z.A,{children:"User"}),(0,B.jsx)(Z.A,{children:"Start"}),(0,B.jsx)(Z.A,{children:"Expires"}),(0,B.jsx)(Z.A,{children:"Periods"}),(0,B.jsx)(Z.A,{align:"right",children:"Paid"}),(0,B.jsx)(Z.A,{align:"right",children:"Remaining"}),(0,B.jsx)(Z.A,{children:"Next Due"}),(0,B.jsx)(Z.A,{children:"Indicator"}),(0,B.jsx)(Z.A,{align:"right",children:"Progress"}),(0,B.jsx)(Z.A,{align:"right",children:"Time Left"}),(0,B.jsx)(Z.A,{children:"Status"}),(0,B.jsx)(Z.A,{align:"right",children:"Actions"})]})}),(0,B.jsx)(ee.A,{children:0===M.length?(0,B.jsx)($.A,{children:(0,B.jsx)(Z.A,{colSpan:t()?11:10,align:"center",children:"No installments yet."})}):M.map(s=>{var l;return(0,B.jsxs)($.A,{children:[(0,B.jsxs)(Z.A,{children:["#",s.id]}),t()&&(0,B.jsxs)(Z.A,{children:[(0,B.jsx)(v.A,{variant:"body2",children:s.userEmail||"\u2014"}),s.userName&&(0,B.jsx)(v.A,{variant:"caption",color:"text.secondary",children:s.userName})]}),(0,B.jsx)(Z.A,{children:s.startDate?new Date(s.startDate).toLocaleDateString():"\u2014"}),(0,B.jsx)(Z.A,{children:s.expiryDate?new Date(s.expiryDate).toLocaleDateString():"\u2014"}),(0,B.jsxs)(Z.A,{children:[s.weeks||"\u2014"," weeks"]}),(0,B.jsx)(Z.A,{align:"right",children:(0,oe.Xc)(s.amountPaid||0)}),(0,B.jsx)(Z.A,{align:"right",children:(0,oe.Xc)(s.remainingAmount||0)}),(0,B.jsx)(Z.A,{children:s.nextDueDate?new Date(s.nextDueDate).toLocaleDateString():"\u2014"}),(0,B.jsx)(Z.A,{children:"paid"===s.status?(0,B.jsx)(te.A,{label:"Completed",color:"success",size:"small"}):"overdue"===s.dueState?(0,B.jsx)(te.A,{label:"Overdue by ".concat(Math.abs(s.daysUntilDue||0),"d"),color:"error",size:"small"}):"due_today"===s.dueState?(0,B.jsx)(te.A,{label:"Due today",color:"warning",size:"small"}):(0,B.jsx)(te.A,{label:"Due in ".concat(null!==(l=s.daysUntilDue)&&void 0!==l?l:"\u2014","d"),color:"due_soon"===s.dueState?"info":"primary",size:"small"})}),(0,B.jsx)(Z.A,{align:"right",sx:{minWidth:160},children:(()=>{const e=Number(s.totalAmount||0),t=Number(s.amountPaid||0),i=e>0?Math.min(100,Math.max(0,Math.round(t/e*100))):0,n=Number(s.paymentsMade||0),r=Number(s.weeks||0);return(0,B.jsx)(he.A,{title:"Payments: ".concat(n," of ").concat(r," | ").concat(i,"% paid"),arrow:!0,children:(0,B.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,B.jsx)(m.A,{sx:{flexGrow:1},children:(0,B.jsx)(xe.A,{variant:"determinate",value:i,sx:{height:8,borderRadius:999}})}),(0,B.jsxs)(v.A,{variant:"caption",sx:{minWidth:40,textAlign:"right"},children:[i,"%"]})]})})})()}),(0,B.jsx)(Z.A,{align:"right",children:(()=>{if("paid"===s.status)return"\u2014";const e=new Date,t=s.expiryDate?new Date(s.expiryDate):null;if(!t||isNaN(t.getTime()))return"\u2014";const i=Math.ceil((t-e)/864e5);return i>=0?"".concat(i,"d"):"Expired"})()}),(0,B.jsx)(Z.A,{children:"paid"===s.status?(0,B.jsx)(te.A,{label:"Completed",color:"success",size:"small"}):"cancelled"===s.status?(0,B.jsx)(te.A,{label:"Cancelled",color:"error",size:"small"}):(0,B.jsx)(te.A,{label:s.status||"ongoing",color:"warning",size:"small"})}),(0,B.jsx)(Z.A,{align:"right",children:(0,B.jsxs)(m.A,{sx:{display:"flex",gap:1,justifyContent:"flex-end",flexWrap:"wrap"},children:[(0,B.jsx)(S.A,{variant:"contained",size:"small",disabled:"paid"===s.status,onClick:()=>(e=>{b(e.order),A(!0)})(s),children:"Pay weekly"}),(0,B.jsx)(S.A,{variant:"contained",color:"success",size:"small",disabled:"paid"===s.status||Number(s.remainingAmount||0)<=0,onClick:()=>(async t=>{if("paid"!==t.status)try{const n=/^\+265\d{9}$/,l=((null===i||void 0===i?void 0:i.phone)||"").trim();if(!n.test(l)){h("Please add an active phone number (+265 followed by 9 digits) in Profile Settings before making an installment payment.");try{g("/dashboard/settings")}catch(s){}return}const a=Math.round(Number(t.remainingAmount||0));if(!a||a<=0)return void p("No remaining balance to pay.");const o=[{id:"order:".concat(t.id),name:"Final Installment Payment",price:a,quantity:1}],d={enabled:!0,paymentType:"installment_payment",orderId:t.id,weeks:Number(t.weeks||0),weeklyAmount:Math.round(Number(t.weeklyAmount||0)),remainingAmount:a,totalAmount:Math.round(Number(t.totalAmount||0)),payAmount:a,payMode:"remaining"},c={customerEmail:(null===e||void 0===e?void 0:e.email)||null,successUrl:"https://itsxtrapush.com/payment/success",cancelUrl:"https://itsxtrapush.com/payment/cancel",installmentPlan:d,currency:r},u=await ae.a5.createCheckoutSession(o,c);if(null!==u&&void 0!==u&&u.success&&null!==u&&void 0!==u&&u.url){try{localStorage.setItem("xp_lastCheckout",JSON.stringify({items:o,installmentPlan:d,customerEmail:(null===e||void 0===e?void 0:e.email)||null}))}catch(s){}window.location.href=u.url}else if(null!==u&&void 0!==u&&u.url){try{localStorage.setItem("xp_lastCheckout",JSON.stringify({items:o,installmentPlan:d,customerEmail:(null===e||void 0===e?void 0:e.email)||null}))}catch(s){}window.location.href=u.url}else h((null===u||void 0===u?void 0:u.error)||"Failed to create checkout session")}catch(l){var n;console.error("Pay remaining checkout failed:",l);const e=null===l||void 0===l||null===(n=l.response)||void 0===n?void 0:n.data;h((null===e||void 0===e?void 0:e.details)||(null===e||void 0===e?void 0:e.error)||(null===l||void 0===l?void 0:l.message)||"Unexpected error")}})(s),children:"Pay remaining"}),(0,B.jsx)(S.A,{variant:"outlined",size:"small",disabled:"paid"===s.status,onClick:()=>(e=>{b(e.order),A(!0)})(s),children:"Pay custom"}),t()&&(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(S.A,{variant:"outlined",color:"error",size:"small",disabled:w||"paid"===s.status,onClick:()=>(async i=>{if(!t())return;const s=window.prompt("Enter cancellation reason (optional):","Missed payments / revoked by admin");if(null!==s)try{k(!0);const t=(null===e||void 0===e?void 0:e.uid)||(null===e||void 0===e?void 0:e.id)||"admin_system_default",r=await ae.Er.cancelInstallment({orderId:i.id,adminUid:t,reason:s});null!==r&&void 0!==r&&r.success?(p("Installment cancelled and stock restored."),a(e=>e.map(e=>e.id===i.id?(0,n.A)((0,n.A)({},e),{},{status:"cancelled"}):e))):h((null===r||void 0===r?void 0:r.error)||"Failed to cancel installment")}catch(l){var r;const e=null===l||void 0===l||null===(r=l.response)||void 0===r?void 0:r.status;h(403===e?"Admin privileges required to cancel installments.":(null===l||void 0===l?void 0:l.message)||"Failed to cancel installment")}finally{k(!1)}})(s),children:w?"Cancelling\u2026":"Cancel"}),(0,B.jsx)(S.A,{variant:"outlined",color:"primary",size:"small",sx:{ml:1},onClick:()=>(e=>{D(e),setTimeout(()=>{try{W()}catch(e){}},50)})(s),children:"Print"})]})]})})]},s.id)})})]})})]}),(0,B.jsx)(be,{open:y,onClose:()=>{b(null),A(!1)},order:j,customerEmail:null===e||void 0===e?void 0:e.email,initialPayMode:"custom"}),(0,B.jsx)(m.A,{sx:{display:"none"},children:N&&(0,B.jsx)(ce.A,{ref:I,order:N.order,plan:{weeks:N.weeks,weeklyAmount:N.weeklyAmount,totalAmount:N.totalAmount,amountPaid:N.amountPaid,remainingAmount:N.remainingAmount,nextDueDate:N.nextDueDate}})})]})}var Pe=i(55884),Ce=i(85105),Ne=i(35118),De=i(72716),Ie=i(21815),We=i(11481);function Me(){var e,t;const{user:i,isAdmin:r}=(0,V.A)(),[l,a]=(0,s.useState)([]),[o,d]=(0,s.useState)(!1),[c,h]=(0,s.useState)(null),[y,A]=(0,s.useState)(null),[j,k]=(0,s.useState)({role:"",active:"",verifiedSeller:""}),[P,C]=(0,s.useState)(null),[N,D]=(0,s.useState)(!1),I=(null===i||void 0===i?void 0:i.uid)||(null===i||void 0===i?void 0:i.id)||null,W=(0,s.useMemo)(()=>({role:j.role||void 0,active:""===j.active?void 0:"true"===j.active,verifiedSeller:""===j.verifiedSeller?void 0:"true"===j.verifiedSeller,adminUid:I}),[j,I]);(0,s.useEffect)(()=>{if(!r())return;(async()=>{d(!0),h(null),A(null);try{const e=await ae.lu.getAllUsers(W);if(null===e||void 0===e||!e.success)throw new Error((null===e||void 0===e?void 0:e.error)||"Failed to fetch users");a(e.users||e.data||[])}catch(i){var e,t;const n=null===i||void 0===i||null===(e=i.response)||void 0===e?void 0:e.status,s="/admin/users";let r;console.error("Admin users fetch error:",{error:i,status:n,endpointPath:s}),r=404===n?"Users API endpoint not found (404) for ".concat(s,"."):401===n||403===n?"Access denied (".concat(n,"). Please ensure you are logged in with admin permissions."):n>=500?"Server error (".concat(n,"). Please try again later."):!n&&null!==i&&void 0!==i&&null!==(t=i.message)&&void 0!==t&&t.includes("Network")?"Network error while contacting the API.":(null===i||void 0===i?void 0:i.message)||"Failed to fetch users",h(r)}finally{d(!1)}})()},[W,r]);const M=async(e,t)=>{d(!0),h(null);try{var i;let s;if("deactivate"===t)s=await ae.lu.deactivate(e,I,"Admin deactivation");else if("reactivate"===t)s=await ae.lu.reactivate(e,I);else{if("close"!==t)throw new Error("Unknown action");s=await ae.lu.close(e,I,"Account closure by admin")}var n;if(null===(i=s)||void 0===i||!i.success)throw new Error((null===(n=s)||void 0===n?void 0:n.error)||"Action failed");{const e=await ae.lu.getAllUsers(W);a(e.users||e.data||[])}}catch(s){console.error("Admin action error:",s),h((null===s||void 0===s?void 0:s.message)||"Failed to perform action")}finally{d(!1)}};return(0,B.jsxs)(s.Fragment,{children:[(0,B.jsx)(le,{children:"Users"}),(0,B.jsxs)(f.A,{sx:{p:2},children:[(0,B.jsxs)(x.A,{sx:{px:0},children:[(0,B.jsx)(b.A,{select:!0,size:"small",label:"Role",value:j.role,onChange:e=>k(t=>(0,n.A)((0,n.A)({},t),{},{role:e.target.value})),sx:{mr:2,minWidth:180},children:[{value:"",label:"All roles"},{value:"admin",label:"Admin"},{value:"seller",label:"Seller"},{value:"buyer",label:"Buyer"}].map(e=>(0,B.jsx)(w.A,{value:e.value,children:e.label},e.value))}),(0,B.jsx)(b.A,{select:!0,size:"small",label:"Status",value:j.active,onChange:e=>k(t=>(0,n.A)((0,n.A)({},t),{},{active:e.target.value})),sx:{mr:2,minWidth:180},children:[{value:"",label:"All statuses"},{value:"true",label:"Active"},{value:"false",label:"Inactive"}].map(e=>(0,B.jsx)(w.A,{value:e.value,children:e.label},e.value))}),(0,B.jsx)(b.A,{select:!0,size:"small",label:"Seller Verification",value:j.verifiedSeller,onChange:e=>k(t=>(0,n.A)((0,n.A)({},t),{},{verifiedSeller:e.target.value})),sx:{mr:2,minWidth:220},children:[{value:"",label:"All sellers"},{value:"true",label:"Verified sellers only"},{value:"false",label:"Unverified sellers only"}].map(e=>(0,B.jsx)(w.A,{value:e.value,children:e.label},e.value))})]}),(0,B.jsx)(Pe.A,{sx:{my:1}}),o&&(0,B.jsx)(m.A,{sx:{display:"flex",justifyContent:"center",p:2},children:(0,B.jsx)(H.A,{})}),c&&(0,B.jsx)(K.A,{severity:"error",sx:{mb:2},children:c}),!o&&!c&&(0,B.jsx)(J.A,{sx:{width:"100%",overflowX:"auto"},children:(0,B.jsxs)(X.A,{size:"small",sx:{minWidth:720},children:[(0,B.jsx)(Y.A,{children:(0,B.jsxs)($.A,{children:[(0,B.jsx)(Z.A,{children:"UID"}),(0,B.jsx)(Z.A,{children:"Name"}),(0,B.jsx)(Z.A,{children:"Email"}),(0,B.jsx)(Z.A,{children:"Phone"}),(0,B.jsx)(Z.A,{children:"Role"}),(0,B.jsx)(Z.A,{children:"Status"}),(0,B.jsx)(Z.A,{children:"Seller"}),(0,B.jsx)(Z.A,{align:"right",children:"Actions"})]})}),(0,B.jsx)(ee.A,{children:0===l.length?(0,B.jsx)($.A,{children:(0,B.jsx)(Z.A,{colSpan:8,align:"center",children:"No users found."})}):l.map(e=>{var t,i,n,s,r,l,a,o;return(0,B.jsxs)($.A,{hover:!0,children:[(0,B.jsx)(Z.A,{children:e.uid||e.id}),(0,B.jsx)(Z.A,{children:(0,B.jsxs)(Ce.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,B.jsx)(v.A,{variant:"body2",children:e.fullName||e.displayName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"\u2014"}),(0,B.jsx)(he.A,{title:"View info",children:(0,B.jsx)(g.A,{size:"small",onClick:()=>(async e=>{C(null),D(!0);try{const t=await ae.lu.getUserDetail(e.uid||e.id,I);null!==t&&void 0!==t&&t.success?C(t.user||t.data||e):(C(e),A("Could not load full details from API; showing list data."))}catch(t){console.error("User detail load error:",t),C(e),A("Could not load full details from API; showing list data.")}})(e),children:(0,B.jsx)(q.A,{fontSize:"inherit"})})})]})}),(0,B.jsx)(Z.A,{children:e.email||"\u2014"}),(0,B.jsx)(Z.A,{children:e.phone||e.phoneNumber||e.mobile||"\u2014"}),(0,B.jsx)(Z.A,{children:(0,B.jsx)(te.A,{label:e.userRole||e.role||"buyer",size:"small"})}),(0,B.jsx)(Z.A,{children:(0,B.jsx)(te.A,{label:null===(t=null!==(i=e.active)&&void 0!==i?i:e.isActive)||void 0===t||t?"active":"inactive",color:null===(n=null!==(s=e.active)&&void 0!==s?s:e.isActive)||void 0===n||n?"success":"default",size:"small"})}),(0,B.jsx)(Z.A,{children:(0,B.jsx)(te.A,{label:e.isSeller?e.verifiedSeller?"verified":"seller":"\u2014",size:"small"})}),(0,B.jsxs)(Z.A,{align:"right",children:[(0,B.jsx)(he.A,{title:"Deactivate",children:(0,B.jsx)("span",{children:(0,B.jsx)(g.A,{size:"small",onClick:()=>M(e.uid||e.id,"deactivate"),disabled:!1===(null===(r=null!==(l=e.active)&&void 0!==l?l:e.isActive)||void 0===r||r),children:(0,B.jsx)(We.A,{fontSize:"inherit"})})})}),(0,B.jsx)(he.A,{title:"Reactivate",children:(0,B.jsx)("span",{children:(0,B.jsx)(g.A,{size:"small",onClick:()=>M(e.uid||e.id,"reactivate"),disabled:!0===(null===(a=null!==(o=e.active)&&void 0!==o?o:e.isActive)||void 0===a||a),children:(0,B.jsx)(Ie.A,{fontSize:"inherit"})})})}),(0,B.jsx)(he.A,{title:"Close account",children:(0,B.jsx)(g.A,{size:"small",color:"error",onClick:()=>M(e.uid||e.id,"close"),children:(0,B.jsx)(De.A,{fontSize:"inherit"})})})]})]},e.uid||e.id)})})]})})]}),(0,B.jsx)(u.Ay,{anchor:"right",open:N,onClose:()=>D(!1),children:(0,B.jsxs)(m.A,{sx:{width:380,p:2},role:"presentation",children:[(0,B.jsx)(v.A,{variant:"h6",sx:{mb:1},children:"User Details"}),(0,B.jsx)(Pe.A,{sx:{mb:2}}),P?(0,B.jsxs)(p.A,{dense:!0,children:[(0,B.jsx)(Ne.Ay,{children:(0,B.jsx)(T.A,{primary:"UID",secondary:P.uid||P.id})}),(P.fullName||P.displayName||P.firstName||P.lastName)&&(0,B.jsx)(Ne.Ay,{children:(0,B.jsx)(T.A,{primary:"Name",secondary:P.fullName||P.displayName||"".concat(P.firstName||""," ").concat(P.lastName||"").trim()})}),P.email&&(0,B.jsx)(Ne.Ay,{children:(0,B.jsx)(T.A,{primary:"Email",secondary:P.email})}),P.phone&&(0,B.jsx)(Ne.Ay,{children:(0,B.jsx)(T.A,{primary:"Phone",secondary:P.phone})}),(P.address||P.location)&&(0,B.jsx)(Ne.Ay,{children:(0,B.jsx)(T.A,{primary:"Address",secondary:P.address||P.location})}),P.town&&(0,B.jsx)(Ne.Ay,{children:(0,B.jsx)(T.A,{primary:"Town/City",secondary:P.town})}),P.postcode&&(0,B.jsx)(Ne.Ay,{children:(0,B.jsx)(T.A,{primary:"Postcode",secondary:P.postcode})}),(P.userRole||P.role)&&(0,B.jsx)(Ne.Ay,{children:(0,B.jsx)(T.A,{primary:"Role",secondary:P.userRole||P.role})}),"undefined"!==typeof(null!==(e=P.active)&&void 0!==e?e:P.isActive)&&(0,B.jsx)(Ne.Ay,{children:(0,B.jsx)(T.A,{primary:"Status",secondary:(null!==(t=P.active)&&void 0!==t?t:P.isActive)?"Active":"Inactive"})}),P.isSeller&&(0,B.jsx)(Ne.Ay,{children:(0,B.jsx)(T.A,{primary:"Seller",secondary:P.verifiedSeller?"Verified":"Unverified"})}),P.createdAt&&(0,B.jsx)(Ne.Ay,{children:(0,B.jsx)(T.A,{primary:"Created",secondary:new Date(P.createdAt).toLocaleString()})}),P.updatedAt&&(0,B.jsx)(Ne.Ay,{children:(0,B.jsx)(T.A,{primary:"Updated",secondary:new Date(P.updatedAt).toLocaleString()})}),P.lastLogin&&(0,B.jsx)(Ne.Ay,{children:(0,B.jsx)(T.A,{primary:"Last Login",secondary:new Date(P.lastLogin).toLocaleString()})}),P.notes&&(0,B.jsx)(Ne.Ay,{children:(0,B.jsx)(T.A,{primary:"Notes",secondary:P.notes})}),(0,B.jsx)(Pe.A,{sx:{my:1}}),(0,B.jsxs)(Ce.A,{direction:"row",spacing:1,children:[(0,B.jsx)(S.A,{size:"small",variant:"outlined",onClick:()=>M(P.uid||P.id,"deactivate"),children:"Deactivate"}),(0,B.jsx)(S.A,{size:"small",variant:"outlined",onClick:()=>M(P.uid||P.id,"reactivate"),children:"Reactivate"}),(0,B.jsx)(S.A,{size:"small",color:"error",variant:"contained",onClick:()=>M(P.uid||P.id,"close"),children:"Close Account"})]})]}):(0,B.jsx)(m.A,{sx:{display:"flex",justifyContent:"center",p:2},children:(0,B.jsx)(H.A,{})})]})})]})}var Oe=i(375);var _e=i(81095),Te=i(68354),Ee=i(60158),Fe=i(44813),Le=i(10734);function ze(e){let{title:t="Sessions",data:i,headline:n,delta:s,deltaType:r="positive"}=e;const l=(0,a.A)(),o=(0,pe.A)(l.breakpoints.down("sm")),d=(e=>{if(!Array.isArray(e)||0===e.length)return null;const t=e[0]||{};return"value1"in t||"value2"in t||"value3"in t?e:"value"in t?e.map(e=>({name:e.name,value1:Number(e.value||0)})):null})(i)||[],c=d.length>0&&"value2"in d[0],u=d.length>0&&"value3"in d[0];return(0,B.jsx)(P.A,{sx:{height:{xs:300,sm:350,md:400}},children:(0,B.jsxs)(C.A,{sx:{p:{xs:2,sm:3}},children:[(0,B.jsx)(m.A,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:(0,B.jsx)(v.A,{variant:o?"h6":"h5",fontWeight:"bold",children:t})}),(n||s)&&(0,B.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:{xs:1,sm:2},mb:1,flexWrap:{xs:"wrap",sm:"nowrap"}},children:[n&&(0,B.jsx)(v.A,{variant:o?"h5":"h4",fontWeight:"bold",children:n}),"undefined"!==typeof s&&(0,B.jsx)(v.A,{variant:"body2",sx:{color:"negative"===r?"#ef4444":"#22c55e",fontWeight:500},children:s})]}),(0,B.jsx)(v.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Sessions per day for the last 30 days"}),(0,B.jsx)(m.A,{sx:{height:{xs:150,sm:200,md:250}},children:Array.isArray(d)&&d.length?(0,B.jsx)(_e.u,{width:"100%",height:"100%",children:(0,B.jsxs)(Te.Q,{data:d,children:[(0,B.jsxs)("defs",{children:[(0,B.jsxs)("linearGradient",{id:"colorGradient1",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,B.jsx)("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.3}),(0,B.jsx)("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.1})]}),(0,B.jsxs)("linearGradient",{id:"colorGradient2",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,B.jsx)("stop",{offset:"5%",stopColor:"#06b6d4",stopOpacity:.3}),(0,B.jsx)("stop",{offset:"95%",stopColor:"#06b6d4",stopOpacity:.1})]}),(0,B.jsxs)("linearGradient",{id:"colorGradient3",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,B.jsx)("stop",{offset:"5%",stopColor:"#0ea5e9",stopOpacity:.3}),(0,B.jsx)("stop",{offset:"95%",stopColor:"#0ea5e9",stopOpacity:.1})]})]}),(0,B.jsx)(Ee.W,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fill:"#94a3b8",fontSize:o?10:12}}),(0,B.jsx)(Fe.h,{axisLine:!1,tickLine:!1,tick:{fill:"#94a3b8",fontSize:o?10:12},tickFormatter:e=>"".concat(Math.round(e/1e3),"k")}),(0,B.jsx)(Le.G,{type:"monotone",dataKey:"value1",stroke:"#3b82f6",fill:"url(#colorGradient1)",strokeWidth:2}),c&&(0,B.jsx)(Le.G,{type:"monotone",dataKey:"value2",stroke:"#06b6d4",fill:"url(#colorGradient2)",strokeWidth:2}),u&&(0,B.jsx)(Le.G,{type:"monotone",dataKey:"value3",stroke:"#0ea5e9",fill:"url(#colorGradient3)",strokeWidth:2})]})}):(0,B.jsx)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:(0,B.jsx)(v.A,{variant:"body2",color:"text.secondary",children:"No data available"})})})]})})}var Ue=i(80294),qe=i(85706);function Re(e){let{data:t,headline:i,delta:n,deltaType:s="negative",title:r="Page views and downloads"}=e;const l=(0,a.A)(),o=(0,pe.A)(l.breakpoints.down("sm")),d=(e=>{if(!Array.isArray(e)||0===e.length)return null;const t=e[0]||{};return"pageViews"in t||"downloads"in t?e:"value"in t?e.map(e=>({name:e.name,pageViews:Number(e.value||0)})):null})(t),c=Array.isArray(d)&&d.length>0&&"pageViews"in d[0],u=Array.isArray(d)&&d.length>0&&"downloads"in d[0];return(0,B.jsx)(P.A,{sx:{height:{xs:300,sm:350,md:400}},children:(0,B.jsxs)(C.A,{sx:{p:{xs:2,sm:3}},children:[(0,B.jsx)(v.A,{variant:o?"h6":"h5",fontWeight:"bold",gutterBottom:!0,children:r}),(i||n)&&(0,B.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:{xs:1,sm:2},mb:1,flexWrap:{xs:"wrap",sm:"nowrap"}},children:[i&&(0,B.jsx)(v.A,{variant:o?"h5":"h4",fontWeight:"bold",children:i}),"undefined"!==typeof n&&(0,B.jsx)(v.A,{variant:"body2",sx:{color:"negative"===s?"#ef4444":"#22c55e",fontWeight:500},children:n})]}),(0,B.jsx)(v.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Page views and downloads for the last 6 months"}),(0,B.jsx)(m.A,{sx:{height:{xs:150,sm:200,md:250}},children:Array.isArray(d)&&d.length?(0,B.jsx)(_e.u,{width:"100%",height:"100%",children:(0,B.jsxs)(Ue.E,{data:d,barCategoryGap:"20%",children:[(0,B.jsx)(Ee.W,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fill:"#94a3b8",fontSize:o?10:12}}),(0,B.jsx)(Fe.h,{axisLine:!1,tickLine:!1,tick:{fill:"#94a3b8",fontSize:o?10:12},tickFormatter:e=>"".concat(Math.round(e/1e3),"k")}),c&&(0,B.jsx)(qe.y,{dataKey:"pageViews",fill:"#3b82f6",radius:[4,4,0,0]}),u&&(0,B.jsx)(qe.y,{dataKey:"downloads",fill:"#06b6d4",radius:[4,4,0,0]})]})}):(0,B.jsx)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:(0,B.jsx)(v.A,{variant:"body2",color:"text.secondary",children:"No data available"})})})]})})}var Ge=i(80045);const Ve=["idDocument","selfiePhoto","addressProof"],Be=["proofOfPurchase","productPhotos","warrantyInfo"];const Qe=new class{constructor(){this.baseURL="https://sparkle-pro.co.uk/api",this.token=localStorage.getItem("authToken")}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i="".concat(this.baseURL).concat(e),s=(0,n.A)({headers:(0,n.A)((0,n.A)({"Content-Type":"application/json"},this.token&&{Authorization:"Bearer ".concat(this.token)}),t.headers)},t);try{const e=await fetch(i,s);if(!e.ok){const t=await e.json().catch(()=>({}));throw new Error(t.message||"HTTP error! status: ".concat(e.status))}return await e.json()}catch(r){throw console.error("API request failed: ".concat(e),r),r}}async uploadFile(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=new FormData;return s.append("file",t),Object.keys(i).forEach(e=>{s.append(e,i[e])}),this.request(e,{method:"POST",headers:(0,n.A)({},this.token&&{Authorization:"Bearer ".concat(this.token)}),body:s})}async submitSellerVerification(e){const{idDocument:t,selfiePhoto:i,addressProof:s}=e,r=(0,Ge.A)(e,Ve),l=[];t&&l.push(this.uploadFile("/verification/upload-id",t,{type:"id_document"})),i&&l.push(this.uploadFile("/verification/upload-selfie",i,{type:"selfie"})),s&&l.push(this.uploadFile("/verification/upload-address",s,{type:"address_proof"}));const a=await Promise.all(l);return this.request("/verification/seller",{method:"POST",body:JSON.stringify((0,n.A)((0,n.A)({},r),{},{documents:a.map(e=>e.data)}))})}async getSellerVerificationStatus(e){return this.request("/verification/seller/".concat(e))}async updateVerificationStatus(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return this.request("/verification/seller/".concat(e,"/status"),{method:"PUT",body:JSON.stringify({status:t,notes:i})})}async verifyPhone(e){return this.request("/verification/phone/send-code",{method:"POST",body:JSON.stringify({phoneNumber:e})})}async confirmPhoneVerification(e,t){return this.request("/verification/phone/verify-code",{method:"POST",body:JSON.stringify({phoneNumber:e,code:t})})}async verifyEmail(e){return this.request("/verification/email/send-verification",{method:"POST",body:JSON.stringify({email:e})})}async confirmEmailVerification(e){return this.request("/verification/email/confirm",{method:"POST",body:JSON.stringify({token:e})})}async getSellerTier(e){return this.request("/sellers/".concat(e,"/tier"))}async updateSellerTier(e){return this.request("/sellers/".concat(e,"/tier/calculate"),{method:"POST"})}async getTierRequirements(){return this.request("/sellers/tier-requirements")}async getTrustScore(e){return this.request("/sellers/".concat(e,"/trust-score"))}async submitProductAuthenticity(e,t){const{proofOfPurchase:i,productPhotos:s,warrantyInfo:r}=t,l=(0,Ge.A)(t,Be),a=[];i&&a.push(this.uploadFile("/products/upload-proof",i,{productId:e,type:"proof_of_purchase"})),r&&a.push(this.uploadFile("/products/upload-warranty",r,{productId:e,type:"warranty"})),s&&s.length>0&&s.forEach((t,i)=>{a.push(this.uploadFile("/products/upload-photo",t,{productId:e,type:"product_photo",index:i}))});const o=await Promise.all(a);return this.request("/products/".concat(e,"/authenticity"),{method:"POST",body:JSON.stringify((0,n.A)((0,n.A)({},l),{},{documents:o.map(e=>e.data)}))})}async checkIMEI(e){return this.request("/verification/imei-check",{method:"POST",body:JSON.stringify({imeiNumber:e})})}async verifySerialNumber(e,t,i){return this.request("/verification/serial-check",{method:"POST",body:JSON.stringify({serialNumber:e,brand:t,model:i})})}async getProductAuthenticity(e){return this.request("/products/".concat(e,"/authenticity"))}async createEscrowTransaction(e){return this.request("/escrow/create",{method:"POST",body:JSON.stringify(e)})}async getEscrowTransaction(e){return this.request("/escrow/".concat(e))}async updateEscrowStatus(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("/escrow/".concat(e,"/status"),{method:"PUT",body:JSON.stringify((0,n.A)({status:t},i))})}async confirmReceipt(e){return this.request("/escrow/".concat(e,"/confirm-receipt"),{method:"POST"})}async releaseFunds(e){return this.request("/escrow/".concat(e,"/release-funds"),{method:"POST"})}async createDispute(e,t){const i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:[]).map(t=>this.uploadFile("/disputes/upload-evidence",t,{transactionId:e})),n=await Promise.all(i);return this.request("/disputes/create",{method:"POST",body:JSON.stringify({transactionId:e,reason:t,evidence:n.map(e=>e.data)})})}async getUserEscrowTransactions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=new URLSearchParams;return t&&i.append("status",t),this.request("/escrow/user/".concat(e,"?").concat(i.toString()))}async submitSellerReview(e,t,i){return this.request("/reviews/seller",{method:"POST",body:JSON.stringify((0,n.A)({sellerId:e,transactionId:t},i))})}async getSellerReviews(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return this.request("/reviews/seller/".concat(e,"?page=").concat(t,"&limit=").concat(i))}async reportSeller(e,t){const i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:[]).map(t=>this.uploadFile("/reports/upload-evidence",t,{sellerId:e})),n=await Promise.all(i);return this.request("/reports/seller",{method:"POST",body:JSON.stringify({sellerId:e,reason:t,evidence:n.map(e=>e.data)})})}async getSellerStats(e){return this.request("/sellers/".concat(e,"/stats"))}async getPendingVerifications(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";return this.request("/admin/verifications/pending?type=".concat(e))}async getDispute(e){return this.request("/admin/disputes/".concat(e))}async resolveDispute(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.request("/admin/disputes/".concat(e,"/resolve"),{method:"POST",body:JSON.stringify({resolution:t,refundAmount:i})})}async getPlatformStats(){return this.request("/admin/stats")}updateAuthToken(e){this.token=e,localStorage.setItem("authToken",e)}clearAuthToken(){this.token=null,localStorage.removeItem("authToken")}async getSupportedDocumentTypes(){return this.request("/verification/document-types")}async getVerificationRequirements(e){return this.request("/verification/requirements/".concat(e))}async checkFeatureAvailability(e,t){return this.request("/features/availability?feature=".concat(e,"&country=").concat(t))}},{submitSellerVerification:Ke,getSellerVerificationStatus:He,updateVerificationStatus:Je,verifyPhone:Xe,confirmPhoneVerification:Ye,verifyEmail:$e,confirmEmailVerification:Ze,getSellerTier:et,updateSellerTier:tt,getTierRequirements:it,getTrustScore:nt,submitProductAuthenticity:st,checkIMEI:rt,verifySerialNumber:lt,getProductAuthenticity:at,createEscrowTransaction:ot,getEscrowTransaction:dt,updateEscrowStatus:ct,confirmReceipt:ut,releaseFunds:mt,createDispute:ht,getUserEscrowTransactions:xt,submitSellerReview:pt,getSellerReviews:vt,reportSeller:gt,getSellerStats:yt,getPendingVerifications:At,getDispute:jt,resolveDispute:ft,getPlatformStats:bt,updateAuthToken:wt,clearAuthToken:kt,getSupportedDocumentTypes:St,getVerificationRequirements:Pt,checkFeatureAvailability:Ct}=Qe;var Nt=i(16335),Dt=i(67360),It=i(54203),Wt=i(72528);const Mt=e=>{if(!e)return null;if("object"===typeof e)return e;try{return JSON.parse(e)}catch(t){return null}},Ot=["#3b82f6","#22c55e","#ef4444","#06b6d4","#0ea5e9","#a78bfa"],_t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;const i=new Date,n=[];for(let s=t-1;s>=0;s--){const e=new Date(i.getFullYear(),i.getMonth()-s,1),t="".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"));n.push({key:t,label:e.toLocaleString(void 0,{month:"short"}),bought:0,paid:0})}return e.forEach(e=>{const t=null!==e&&void 0!==e&&e.createdAt?new Date(e.createdAt):null;if(!t)return;const i="".concat((s=t).getFullYear(),"-").concat(String(s.getMonth()+1).padStart(2,"0"));var s;const r=n.find(e=>e.key===i);if(!r)return;const l=Array.isArray(e.items)?e.items.reduce((e,t)=>e+(Number(t.quantity)||1),0):1;r.bought+=l;((null===e||void 0===e?void 0:e.paymentStatus)||(null===e||void 0===e?void 0:e.status)||"").toLowerCase().includes("paid")&&(r.paid+=l)}),n.map(e=>{let{label:t,bought:i,paid:n}=e;return{name:t,bought:i,paid:n}})};function Tt(){const{user:e,isAdmin:t}=(0,V.A)(),i=t(),n=(null===e||void 0===e?void 0:e.uid)||(null===e||void 0===e?void 0:e.id)||null,[r,l]=(0,s.useState)(!0),[a,o]=(0,s.useState)(null),[d,c]=(0,s.useState)([]),[u,h]=(0,s.useState)([]),[x,p]=(0,s.useState)([]),[g,y]=(0,s.useState)(null);(0,s.useEffect)(()=>{let e=!0;return(async()=>{l(!0),o(null);let t=!1;try{const e=await ae.QO.getAll();null!==e&&void 0!==e&&e.success?(h(e.gadgets||e.data||[]),t=!0):(h(Array.isArray(e)?e:[]),Array.isArray(e)&&(t=!0))}catch(r){console.warn("Gadgets fetch failed:",null===r||void 0===r?void 0:r.message)}try{var s;let e;i||"admin_system_default"===n?e=await ae.gH.getAllOrders():n&&(e=await ae.gH.getUserOrders(n)),null!==(s=e)&&void 0!==s&&s.success?(c(e.orders||[]),t=!0):Array.isArray(e)&&(c(e),t=!0)}catch(r){console.warn("Orders fetch failed:",null===r||void 0===r?void 0:r.message)}if(i)try{const e=await ae.lu.getAllUsers({});null!==e&&void 0!==e&&e.success?(p(e.users||[]),t=!0):Array.isArray(e)&&(p(e),t=!0)}catch(r){console.warn("Users fetch failed:",null===r||void 0===r?void 0:r.message)}if(i)try{const e=await bt();e&&(e.success||e.data)&&(y(e.data||e.stats||e),t=!0)}catch(a){console.warn("Platform stats fetch failed")}t||o("Failed to load dashboard data"),e&&l(!1)})(),()=>{e=!1}},[i,n]);const A=(0,s.useMemo)(()=>_t(d),[d]),f=(0,s.useMemo)(()=>{const e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;const i=new Map;e.forEach(e=>{(e.items||[]).forEach(e=>{const t=(null===e||void 0===e?void 0:e.name)||"".concat((null===e||void 0===e?void 0:e.brand)||""," ").concat((null===e||void 0===e?void 0:e.model)||"").trim(),n=Number((null===e||void 0===e?void 0:e.quantity)||1);t&&i.set(t,(i.get(t)||0)+n)})});const n=Array.from(i.entries()).map(e=>{let[t,i]=e;return{name:t,value:i}});return n.sort((e,t)=>t.value-e.value),n.slice(0,t)}(d);return e.length>0?e:(u||[]).slice(0,5).map(e=>{var t;return{name:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.model)||"Gadget",value:Number(null!==(t=null===e||void 0===e?void 0:e.stock_quantity)&&void 0!==t?t:0)}})},[d,u]),b=(0,s.useMemo)(()=>(e=>{let t=0,i=0;return e.forEach(e=>{var n,s,r;const l=Number(null!==(n=null!==(s=null!==(r=null===e||void 0===e?void 0:e.stock_quantity)&&void 0!==r?r:null===e||void 0===e?void 0:e.stockQuantity)&&void 0!==s?s:null===e||void 0===e?void 0:e.stock)&&void 0!==n?n:0);("undefined"!==typeof(null===e||void 0===e?void 0:e.in_stock)?1===Number(e.in_stock):l>0)?t+=l||1:i+=1}),[{name:"In stock",value:t},{name:"Out of stock",value:i}]})(u),[u]),w=(0,s.useMemo)(()=>(e=>{let t=0,i=0;return e.forEach(e=>{const n=Mt(null===e||void 0===e?void 0:e.notes);(null!==n&&void 0!==n&&n.installmentPlan||"installment_deposit"===(null===n||void 0===n?void 0:n.paymentType)||"installment_payment"===(null===n||void 0===n?void 0:n.paymentType))&&(((null===e||void 0===e?void 0:e.paymentStatus)||(null===e||void 0===e?void 0:e.status)||"").toLowerCase().includes("paid")?i+=1:t+=1)}),[{name:"Pending",value:t},{name:"Completed",value:i}]})(d),[d]),k=(0,s.useMemo)(()=>(e=>{let t=0,i=0,n=0,s=0,r=null;e.forEach(e=>{var l,a,o,d,c,u,m,h,x,p,v,g,y;const A=Mt(null===e||void 0===e?void 0:e.notes),j=null===A||void 0===A?void 0:A.installmentPlan;if(!j&&"installment_deposit"!==(null===A||void 0===A?void 0:A.paymentType)&&"installment_payment"!==(null===A||void 0===A?void 0:A.paymentType))return;t+=1;const f=Number(null!==(l=null===j||void 0===j?void 0:j.weeks)&&void 0!==l?l:0),b=Number(null!==(a=null!==(o=null===j||void 0===j?void 0:j.weeklyAmount)&&void 0!==o?o:null===j||void 0===j?void 0:j.weekly_amount)&&void 0!==a?a:0),w=Number(null!==(d=null!==(c=null===j||void 0===j?void 0:j.depositAmount)&&void 0!==c?c:null===j||void 0===j?void 0:j.deposit_amount)&&void 0!==d?d:0),k=Number(null!==(u=null!==(m=null===j||void 0===j?void 0:j.paymentsMade)&&void 0!==m?m:null===j||void 0===j?void 0:j.payments_made)&&void 0!==u?u:0),S=Number(null!==(h=null!==(x=null!==(p=null===j||void 0===j?void 0:j.amountPaid)&&void 0!==p?p:null===j||void 0===j?void 0:j.amount_paid)&&void 0!==x?x:w+b*k)&&void 0!==h?h:0),P=Number(null!==(v=null!==(g=null!==(y=null===j||void 0===j?void 0:j.totalAmount)&&void 0!==y?y:null===j||void 0===j?void 0:j.total_amount)&&void 0!==g?g:w+b*f)&&void 0!==v?v:0),C=Math.max(P-S,0);n+=S,i+=P,s+=C;const N=(null===j||void 0===j?void 0:j.expiryDate)||(null===j||void 0===j?void 0:j.expiry_at)||(null===e||void 0===e?void 0:e.expiryDate),D=(null===j||void 0===j?void 0:j.nextDueDate)||(null===j||void 0===j?void 0:j.next_due_at)||(null===e||void 0===e?void 0:e.nextDueDate),I=N||D;if(I){const e=new Date,t=new Date(I),i=Math.ceil((t-e)/864e5);(null==r||i<r)&&(r=i)}});const l=i>0?Math.round(n/i*100):0;return{plans:t,totalAmount:i,amountPaid:n,remainingAmount:s,percent:l,soonestDays:r}})(d),[d]),S=(0,s.useMemo)(()=>{const e={admin:0,seller:0,buyer:0};return(x||[]).forEach(t=>{const i=((null===t||void 0===t?void 0:t.userRole)||(null===t||void 0===t?void 0:t.role)||"").toLowerCase();i.includes("admin")?e.admin+=1:i.includes("seller")?e.seller+=1:e.buyer+=1}),[{name:"Admins",value:e.admin},{name:"Sellers",value:e.seller},{name:"Buyers",value:e.buyer}]},[x]),N=(0,s.useMemo)(()=>{var e;const t=(null===g||void 0===g||null===(e=g.visitors)||void 0===e?void 0:e.daily)||[];if(Array.isArray(t)&&t.length)return t.map(e=>({name:(null===e||void 0===e?void 0:e.day)||"",value:Number((null===e||void 0===e?void 0:e.count)||0)}));if(Array.isArray(x)&&x.length){const e=new Map,t=new Date;for(let i=29;i>=0;i--){const n=new Date(t.getFullYear(),t.getMonth(),t.getDate()-i),s=n.toISOString().slice(0,10),r=n.toLocaleDateString(void 0,{month:"short",day:"numeric"});e.set(s,{name:r,value:0})}return x.forEach(t=>{const i=null!==t&&void 0!==t&&t.createdAt?new Date(t.createdAt):null;if(!i)return;const n=i.toISOString().slice(0,10);e.has(n)&&(e.get(n).value+=1)}),Array.from(e.values())}return[]},[g,x]),D=(0,s.useMemo)(()=>{var e,t,i;const n=(e,t)=>Array.isArray(e)?e.map(e=>{var i,n,s;return{name:(null===e||void 0===e?void 0:e.month)||(null===e||void 0===e?void 0:e.label)||(null===e||void 0===e?void 0:e.day)||"",[t]:Number(null!==(i=null!==(n=null!==(s=null===e||void 0===e?void 0:e.count)&&void 0!==s?s:null===e||void 0===e?void 0:e.value)&&void 0!==n?n:null===e||void 0===e?void 0:e[t])&&void 0!==i?i:0)}}):[],s=(null===g||void 0===g||null===(e=g.pageViews)||void 0===e?void 0:e.monthly)||(null===g||void 0===g||null===(t=g.page_views)||void 0===t?void 0:t.monthly)||(null===g||void 0===g?void 0:g.pageViews)||(null===g||void 0===g?void 0:g.page_views)||[],r=(null===g||void 0===g||null===(i=g.downloads)||void 0===i?void 0:i.monthly)||(null===g||void 0===g?void 0:g.downloads)||[];let l=n(s,"pageViews"),a=n(r,"downloads");const o=!Array.isArray(l)||0===l.length,c=!Array.isArray(a)||0===a.length;if((o||c)&&Array.isArray(d)&&d.length){const e=_t(d,6);l=e.map(e=>({name:e.name,pageViews:Number(e.bought||0)})),a=e.map(e=>({name:e.name,downloads:Number(e.paid||0)}))}const u=Array.from(new Set([...(l||[]).map(e=>e.name),...(a||[]).map(e=>e.name)])).filter(Boolean).map(e=>{var t,i;return{name:e,pageViews:(null===(t=(l||[]).find(t=>t.name===e))||void 0===t?void 0:t.pageViews)||0,downloads:(null===(i=(a||[]).find(t=>t.name===e))||void 0===i?void 0:i.downloads)||0}});return u.length?u:[]},[g,d]);return(0,B.jsxs)(m.A,{sx:{width:"100%"},children:[a&&(0,B.jsx)(K.A,{severity:"error",sx:{mb:2},children:a}),r&&(0,B.jsx)(m.A,{sx:{display:"flex",justifyContent:"center",p:2},children:(0,B.jsx)(H.A,{})}),!r&&(0,B.jsxs)(j.A,{container:!0,spacing:{xs:2,md:3},children:[i&&(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(j.A,{item:!0,xs:12,lg:6,children:(0,B.jsx)(ze,{title:"Visitors",data:N})}),(0,B.jsx)(j.A,{item:!0,xs:12,lg:6,children:(0,B.jsx)(Re,{data:D})}),(0,B.jsx)(j.A,{item:!0,xs:12,md:6,children:(0,B.jsx)(P.A,{children:(0,B.jsxs)(C.A,{children:[(0,B.jsx)(v.A,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Users by role"}),(0,B.jsx)(m.A,{sx:{height:240},children:(0,B.jsx)(_e.u,{width:"100%",height:"100%",children:(0,B.jsxs)(Ue.E,{data:S,children:[(0,B.jsx)(Ee.W,{dataKey:"name",tick:{fill:"#94a3b8"},tickLine:!1,axisLine:!1}),(0,B.jsx)(Fe.h,{tick:{fill:"#94a3b8"},tickLine:!1,axisLine:!1}),(0,B.jsx)(Nt.m,{}),(0,B.jsx)(qe.y,{dataKey:"value",fill:"#3b82f6",radius:[4,4,0,0]})]})})})]})})}),(0,B.jsx)(j.A,{item:!0,xs:12,md:6,children:(0,B.jsx)(P.A,{children:(0,B.jsxs)(C.A,{children:[(0,B.jsx)(v.A,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Gadgets bought vs paid (last 6 months)"}),(0,B.jsx)(m.A,{sx:{height:240},children:(0,B.jsx)(_e.u,{width:"100%",height:"100%",children:(0,B.jsxs)(Ue.E,{data:A,children:[(0,B.jsx)(Ee.W,{dataKey:"name",tick:{fill:"#94a3b8"},tickLine:!1,axisLine:!1}),(0,B.jsx)(Fe.h,{tick:{fill:"#94a3b8"},tickLine:!1,axisLine:!1}),(0,B.jsx)(Nt.m,{}),(0,B.jsx)(qe.y,{dataKey:"bought",stackId:"a",fill:"#06b6d4",radius:[4,4,0,0]}),(0,B.jsx)(qe.y,{dataKey:"paid",stackId:"a",fill:"#22c55e",radius:[4,4,0,0]})]})})})]})})}),(0,B.jsx)(j.A,{item:!0,xs:12,md:6,children:(0,B.jsx)(P.A,{children:(0,B.jsxs)(C.A,{children:[(0,B.jsx)(v.A,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Stock overview"}),(0,B.jsx)(m.A,{sx:{height:240},children:(0,B.jsx)(_e.u,{width:"100%",height:"100%",children:(0,B.jsxs)(Dt.r,{children:[(0,B.jsx)(It.F,{data:b,dataKey:"value",nameKey:"name",innerRadius:60,outerRadius:100,paddingAngle:2,children:b.map((e,t)=>(0,B.jsx)(Wt.f,{fill:Ot[t%Ot.length]},"stock-".concat(t)))}),(0,B.jsx)(Nt.m,{})]})})})]})})})]}),!i&&(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(j.A,{item:!0,xs:12,md:6,children:(0,B.jsx)(P.A,{children:(0,B.jsxs)(C.A,{children:[(0,B.jsx)(v.A,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"My installments overview"}),(0,B.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",gap:1.25},children:[(0,B.jsxs)(v.A,{variant:"body2",color:"text.secondary",children:["Plans: ",k.plans]}),(0,B.jsxs)(v.A,{variant:"body2",color:"text.secondary",children:["Remaining: MWK ",(new Intl.NumberFormat).format(Math.round(k.remainingAmount||0))]}),(0,B.jsxs)(m.A,{children:[(0,B.jsxs)(v.A,{variant:"body2",sx:{mb:.5},children:["Overall progress (",k.percent,"% paid)"]}),(0,B.jsx)(xe.A,{variant:"determinate",value:k.percent,sx:{height:10,borderRadius:5}})]}),"number"===typeof k.soonestDays&&(0,B.jsxs)(v.A,{variant:"caption",color:k.soonestDays<0?"error":"text.secondary",children:["Next due in ",k.soonestDays<0?"".concat(Math.abs(k.soonestDays)," days overdue"):"".concat(k.soonestDays," days")]})]})]})})}),(0,B.jsx)(j.A,{item:!0,xs:12,md:6,children:(0,B.jsx)(P.A,{children:(0,B.jsxs)(C.A,{children:[(0,B.jsx)(v.A,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"My gadgets bought (last 6 months)"}),(0,B.jsx)(m.A,{sx:{height:240},children:(0,B.jsx)(_e.u,{width:"100%",height:"100%",children:(0,B.jsxs)(Ue.E,{data:A,children:[(0,B.jsx)(Ee.W,{dataKey:"name",tick:{fill:"#94a3b8"},tickLine:!1,axisLine:!1}),(0,B.jsx)(Fe.h,{tick:{fill:"#94a3b8"},tickLine:!1,axisLine:!1}),(0,B.jsx)(Nt.m,{}),(0,B.jsx)(qe.y,{dataKey:"bought",fill:"#3b82f6",radius:[4,4,0,0]})]})})})]})})}),(0,B.jsx)(j.A,{item:!0,xs:12,md:6,children:(0,B.jsx)(P.A,{children:(0,B.jsxs)(C.A,{children:[(0,B.jsx)(v.A,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Installments status"}),(0,B.jsx)(m.A,{sx:{height:240},children:(0,B.jsx)(_e.u,{width:"100%",height:"100%",children:(0,B.jsxs)(Dt.r,{children:[(0,B.jsx)(It.F,{data:w,dataKey:"value",nameKey:"name",innerRadius:60,outerRadius:100,paddingAngle:2,children:w.map((e,t)=>(0,B.jsx)(Wt.f,{fill:Ot[t%Ot.length]},"inst-".concat(t)))}),(0,B.jsx)(Nt.m,{})]})})})]})})})]}),(0,B.jsx)(j.A,{item:!0,xs:12,children:(0,B.jsx)(P.A,{children:(0,B.jsxs)(C.A,{children:[(0,B.jsx)(v.A,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Trending gadgets"}),(0,B.jsx)(m.A,{sx:{height:280},children:(0,B.jsx)(_e.u,{width:"100%",height:"100%",children:(0,B.jsxs)(Ue.E,{data:f,children:[(0,B.jsx)(Ee.W,{dataKey:"name",tick:{fill:"#94a3b8"},tickLine:!1,axisLine:!1,interval:0,angle:-10,height:60}),(0,B.jsx)(Fe.h,{tick:{fill:"#94a3b8"},tickLine:!1,axisLine:!1}),(0,B.jsx)(Nt.m,{}),(0,B.jsx)(qe.y,{dataKey:"value",fill:"#0ea5e9",radius:[4,4,0,0]})]})})})]})})})]})]})}var Et=i(86633),Ft=i(5310),Lt=i(71672),zt=i(26309),Ut=i(93570),qt=i(13285);const Rt=(0,l.Ay)(P.A)(e=>{let{theme:t}=e;return{maxWidth:800,margin:"20px auto",padding:t.spacing(2)}}),Gt=(0,l.Ay)(m.A)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",marginBottom:t.spacing(3),gap:t.spacing(2)}}),Vt=()=>{const{user:e,userProfile:t,updateUserProfile:i}=(0,V.A)(),[r,l]=(0,s.useState)(!0),[a,o]=(0,s.useState)(!1),[d,c]=(0,s.useState)(null),[u,h]=(0,s.useState)(!1),[x,p]=(0,s.useState)({fullName:"",email:"",town:"",address:"",postcode:"",phone:""});(0,s.useEffect)(()=>{var i,n,s,r,l,a,o,d;p({fullName:null!==(i=null!==(n=null===t||void 0===t?void 0:t.fullName)&&void 0!==n?n:null===e||void 0===e?void 0:e.displayName)&&void 0!==i?i:"",email:null!==(s=null!==(r=null===t||void 0===t?void 0:t.email)&&void 0!==r?r:null===e||void 0===e?void 0:e.email)&&void 0!==s?s:"",town:null!==(l=null===t||void 0===t?void 0:t.town)&&void 0!==l?l:"",address:null!==(a=null===t||void 0===t?void 0:t.address)&&void 0!==a?a:"",postcode:null!==(o=null===t||void 0===t?void 0:t.postcode)&&void 0!==o?o:"",phone:null!==(d=null===t||void 0===t?void 0:t.phone)&&void 0!==d?d:""})},[t,e]);const y=e=>t=>{p(i=>(0,n.A)((0,n.A)({},i),{},{[e]:t.target.value})),c(null),h(!1)},A=()=>{t&&p({fullName:t.fullName||(null===e||void 0===e?void 0:e.displayName)||"",email:t.email||(null===e||void 0===e?void 0:e.email)||"",town:t.town||"",address:t.address||"",postcode:t.postcode||"",phone:t.phone||""}),l(!1),c(null),h(!1)};return(0,B.jsx)(Rt,{children:(0,B.jsxs)(C.A,{children:[(0,B.jsxs)(Gt,{children:[(0,B.jsx)(Ft.A,{src:null===e||void 0===e?void 0:e.photoURL,sx:{width:80,height:80},children:!(null!==e&&void 0!==e&&e.photoURL)&&(0,B.jsx)(qt.A,{sx:{fontSize:40}})}),(0,B.jsxs)(m.A,{sx:{flex:1},children:[(0,B.jsx)(v.A,{variant:"h5",gutterBottom:!0,children:"Profile Settings"}),(0,B.jsx)(v.A,{variant:"body2",color:"text.secondary",children:"Manage your personal information and preferences"})]}),(0,B.jsx)(g.A,{onClick:()=>r?A():l(!0),color:r?"default":"primary",disabled:a,children:r?(0,B.jsx)(Ut.A,{}):(0,B.jsx)(Lt.A,{})})]}),(0,B.jsx)(Pe.A,{sx:{mb:3}}),d&&(0,B.jsx)(K.A,{severity:"error",sx:{mb:2},children:d}),u&&(0,B.jsx)(K.A,{severity:"success",sx:{mb:2},children:"Profile updated successfully!"}),(0,B.jsxs)(j.A,{container:!0,spacing:3,children:[(0,B.jsx)(j.A,{item:!0,xs:12,md:6,children:(0,B.jsx)(b.A,{fullWidth:!0,label:"Full Name",value:x.fullName,onChange:y("fullName"),disabled:!r||a,margin:"normal"})}),(0,B.jsx)(j.A,{item:!0,xs:12,md:6,children:(0,B.jsx)(b.A,{fullWidth:!0,label:"Email Address",value:x.email,onChange:y("email"),disabled:!0,margin:"normal",helperText:"Email cannot be changed"})}),(0,B.jsx)(j.A,{item:!0,xs:12,md:6,children:(0,B.jsx)(b.A,{fullWidth:!0,label:"Town/City",value:x.town,onChange:y("town"),disabled:!r||a,margin:"normal"})}),(0,B.jsx)(j.A,{item:!0,xs:12,md:6,children:(0,B.jsx)(b.A,{fullWidth:!0,label:"Postcode",value:x.postcode,onChange:y("postcode"),disabled:!r||a,margin:"normal"})}),(0,B.jsx)(j.A,{item:!0,xs:12,children:(0,B.jsx)(b.A,{fullWidth:!0,label:"Address",value:x.address,onChange:y("address"),disabled:!r||a,margin:"normal",multiline:!0,rows:2})}),(0,B.jsx)(j.A,{item:!0,xs:12,md:6,children:(0,B.jsx)(b.A,{fullWidth:!0,label:"Phone Number",value:x.phone,onChange:y("phone"),disabled:!r||a,margin:"normal",placeholder:"+265XXXXXXXXX",helperText:"Format required: +265 followed by 9 digits"})})]}),r&&(0,B.jsxs)(m.A,{sx:{display:"flex",gap:2,mt:3,justifyContent:"flex-end"},children:[(0,B.jsx)(S.A,{onClick:A,disabled:a,variant:"outlined",children:"Cancel"}),(0,B.jsx)(S.A,{onClick:async()=>{o(!0),c(null),h(!1);try{if(!/^\+265\d{9}$/.test((x.phone||"").trim()))return c("Phone must start with +265 followed by 9 digits"),void o(!1);const e=await i(x);e.success?(h(!0),l(!1),setTimeout(()=>h(!1),3e3)):c(e.error||"Failed to update profile")}catch(e){c("An unexpected error occurred")}finally{o(!1)}},disabled:a,variant:"contained",startIcon:a?(0,B.jsx)(H.A,{size:20}):(0,B.jsx)(zt.A,{}),children:a?"Saving...":"Save Changes"})]})]})})};var Bt=i(27522),Qt=i(41680),Kt=i(29920),Ht=i(34244),Jt=i(66427),Xt=i(75497),Yt=i(76088),$t=i(80492),Zt=i(89470),ei=i(32430),ti=i(15672),ii=i(87757);const ni=()=>{const{user:e}=(0,V.A)(),{isMalawi:t}=(0,ti.z)(),[i,r]=(0,s.useState)(!0),[l,a]=(0,s.useState)(!1),[o,d]=(0,s.useState)(null),[c,u]=(0,s.useState)(null),[h,x]=(0,s.useState)(!1),[g,y]=(0,s.useState)(!1),[A,f]=(0,s.useState)(null),[b,w]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{if(null!==e&&void 0!==e&&e.uid)try{const t=await(0,ii.uS)(e.uid);d(t)}catch(t){console.error("Failed to load subscription:",t)}finally{r(!1)}else r(!1)})()},[e]);const k=e=>{f(e),w(!1),y(!0)};if(i)return(0,B.jsx)(P.A,{sx:{mb:3},children:(0,B.jsx)(C.A,{sx:{textAlign:"center",py:4},children:(0,B.jsx)(H.A,{})})});const N=null===o||void 0===o?void 0:o.isActive,D=(null===o||void 0===o?void 0:o.tier)||"plus",I=t?"MWK 6,000/month":"\xa36.00/month",W=t?"MWK 10,000/month":"\xa39.99/month",M=[{icon:(0,B.jsx)(Jt.A,{color:"success"}),text:"Free Unlimited Delivery \u2013 Included with every order"},{icon:(0,B.jsx)(Xt.A,{color:"success"}),text:"Single Gadget Insurance (1 Year) \u2013 Covers ONE laptop, smartphone, or tablet"},{icon:(0,B.jsx)(Yt.A,{sx:{color:"#48cedb"}}),text:"Minor Discounts \u2013 Small savings on selected items"}],O=[{icon:(0,B.jsx)(Jt.A,{sx:{color:"#ffd700"}}),text:"Free Unlimited Delivery \u2013 Included with every order"},{icon:(0,B.jsx)(Xt.A,{sx:{color:"#ffd700"}}),text:"Multiple Gadget Insurance (1 Year Each) \u2013 Covers ALL eligible laptops, smartphones, and tablets"},{icon:(0,B.jsx)(Yt.A,{sx:{color:"#ffd700"}}),text:"Exclusive Discounts \u2013 Members-only deals on all gadgets"},{icon:(0,B.jsx)($t.A,{sx:{color:"#ffd700"}}),text:"Priority Support \u2013 Fast-track customer service"}];return(0,B.jsxs)(B.Fragment,{children:[N?(0,B.jsx)(P.A,{sx:{mb:3,background:"premium"===D?"linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%)":"linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)",border:"premium"===D?"2px solid #ffd700":"2px solid #22c55e"},children:(0,B.jsxs)(C.A,{children:[(0,B.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,B.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,B.jsx)(Yt.A,{sx:{color:"premium"===D?"#ffd700":"#22c55e"}}),(0,B.jsxs)(v.A,{variant:"h6",fontWeight:"bold",children:["Xtrapush ","premium"===D?"Premium":"Plus"]})]}),(0,B.jsx)(te.A,{icon:(0,B.jsx)(Zt.A,{}),label:"Active",color:"success",variant:"filled"})]}),(0,B.jsx)(v.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"premium"===D?"You are enjoying Premium benefits including multiple gadget insurance, free delivery, and exclusive discounts!":"You are enjoying Plus benefits including single gadget insurance, free delivery, and exclusive discounts!"}),(0,B.jsx)(p.A,{dense:!0,sx:{mb:2},children:("premium"===D?O:M).map((e,t)=>(0,B.jsxs)(Ne.Ay,{sx:{py:.5,px:0},children:[(0,B.jsx)(_.A,{sx:{minWidth:36},children:e.icon}),(0,B.jsx)(T.A,{primary:e.text,primaryTypographyProps:{variant:"body2",color:"text.primary"}})]},t))}),c&&(0,B.jsx)(K.A,{severity:"error",sx:{mb:2},children:c}),(0,B.jsxs)(m.A,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:["plus"===D&&(0,B.jsx)(S.A,{variant:"contained",size:"small",onClick:()=>k("premium"),disabled:l,startIcon:(0,B.jsx)(ei.A,{}),sx:{bgcolor:"#ffd700",color:"#000","&:hover":{bgcolor:"#e6c200"}},children:"Upgrade to Premium"}),(0,B.jsx)(S.A,{variant:"outlined",color:"error",size:"small",onClick:()=>x(!0),disabled:l,startIcon:l?(0,B.jsx)(H.A,{size:16}):(0,B.jsx)(Ut.A,{}),children:"Cancel Subscription"})]}),(null===o||void 0===o?void 0:o.updatedAt)&&(0,B.jsxs)(v.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:2},children:["Member since ",new Date(o.updatedAt).toLocaleDateString()]})]})}):(0,B.jsxs)(m.A,{sx:{mb:3},children:[(0,B.jsx)(v.A,{variant:"h6",fontWeight:"bold",sx:{mb:2,color:"text.primary"},children:"Subscription Plans"}),(0,B.jsxs)(v.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Subscribe to unlock free delivery, gadget insurance, and exclusive discounts. ",(0,B.jsx)("strong",{children:"Insurance covers laptops, smartphones, and tablets only."})]}),c&&(0,B.jsx)(K.A,{severity:"error",sx:{mb:2},children:c}),(0,B.jsxs)(j.A,{container:!0,spacing:2,children:[(0,B.jsx)(j.A,{item:!0,xs:12,md:6,children:(0,B.jsx)(P.A,{sx:{height:"100%",background:"linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)",border:"2px solid #48cedb"},children:(0,B.jsxs)(C.A,{children:[(0,B.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,B.jsx)(Yt.A,{sx:{color:"#48cedb"}}),(0,B.jsx)(v.A,{variant:"h6",fontWeight:"bold",children:"Xtrapush Plus"})]}),(0,B.jsx)(v.A,{variant:"h5",fontWeight:"bold",sx:{mb:2,color:"#48cedb"},children:I}),(0,B.jsx)(p.A,{dense:!0,sx:{mb:2},children:M.map((e,t)=>(0,B.jsxs)(Ne.Ay,{sx:{py:.25,px:0},children:[(0,B.jsx)(_.A,{sx:{minWidth:32},children:e.icon}),(0,B.jsx)(T.A,{primary:e.text,primaryTypographyProps:{variant:"caption",color:"text.primary"}})]},t))}),(0,B.jsx)(S.A,{variant:"contained",fullWidth:!0,onClick:()=>k("plus"),disabled:l,startIcon:l?(0,B.jsx)(H.A,{size:16}):(0,B.jsx)(Yt.A,{}),sx:{bgcolor:"#48cedb","&:hover":{bgcolor:"#3ba8b8"}},children:"Subscribe to Plus"})]})})}),(0,B.jsx)(j.A,{item:!0,xs:12,md:6,children:(0,B.jsx)(P.A,{sx:{height:"100%",background:"linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%)",border:"2px solid #ffd700"},children:(0,B.jsxs)(C.A,{children:[(0,B.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,B.jsx)(Yt.A,{sx:{color:"#ffd700"}}),(0,B.jsx)(v.A,{variant:"h6",fontWeight:"bold",children:"Xtrapush Premium"}),(0,B.jsx)(te.A,{label:"Best Value",size:"small",sx:{bgcolor:"#ffd700",color:"#000",fontWeight:600}})]}),(0,B.jsx)(v.A,{variant:"h5",fontWeight:"bold",sx:{mb:2,color:"#b8860b"},children:W}),(0,B.jsx)(p.A,{dense:!0,sx:{mb:2},children:O.map((e,t)=>(0,B.jsxs)(Ne.Ay,{sx:{py:.25,px:0},children:[(0,B.jsx)(_.A,{sx:{minWidth:32},children:e.icon}),(0,B.jsx)(T.A,{primary:e.text,primaryTypographyProps:{variant:"caption",color:"text.primary"}})]},t))}),(0,B.jsx)(S.A,{variant:"contained",fullWidth:!0,onClick:()=>k("premium"),disabled:l,startIcon:l?(0,B.jsx)(H.A,{size:16}):(0,B.jsx)(Yt.A,{}),sx:{bgcolor:"#ffd700",color:"#000","&:hover":{bgcolor:"#e6c200"}},children:"Subscribe to Premium"})]})})})]})]}),(0,B.jsxs)(ie.A,{open:g,onClose:()=>y(!1),children:[(0,B.jsxs)(ne.A,{children:["Subscribe to Xtrapush ","premium"===A?"Premium":"Plus"]}),(0,B.jsxs)(se.A,{children:[(0,B.jsxs)(Bt.A,{sx:{mb:2},children:["You are about to subscribe to ",(0,B.jsxs)("strong",{children:["Xtrapush ","premium"===A?"Premium":"Plus"]})," for"," ",(0,B.jsx)("strong",{children:"premium"===A?W:I}),"."]}),(0,B.jsxs)(m.A,{sx:{bgcolor:"rgba(0,0,0,0.04)",p:2,borderRadius:1,mb:2},children:[(0,B.jsx)(v.A,{variant:"body2",sx:{mb:1,fontWeight:600},children:"premium"===A?"Premium Benefits:":"Plus Benefits:"}),(0,B.jsxs)(v.A,{variant:"body2",component:"ul",sx:{pl:2,m:0},children:[(0,B.jsx)("li",{children:"Free unlimited delivery on all orders"}),(0,B.jsx)("li",{children:"premium"===A?"Multiple gadget insurance (1 year each) \u2013 covers all laptops, smartphones, and tablets":"Single gadget insurance (1 year) \u2013 covers one laptop, smartphone, or tablet"}),(0,B.jsx)("li",{children:"premium"===A?"Exclusive member discounts on all gadgets":"Minor discounts on selected items"}),"premium"===A&&(0,B.jsx)("li",{children:"Priority customer support"})]})]}),(0,B.jsx)(Qt.A,{control:(0,B.jsx)(Kt.A,{checked:b,onChange:e=>w(e.target.checked),color:"primary"}),label:(0,B.jsxs)(v.A,{variant:"body2",children:["I have read and agree to the"," ",(0,B.jsx)(Ht.A,{href:"/terms",target:"_blank",sx:{color:"#48cedb"},children:"subscription terms and insurance policy"}),". I understand that gadget insurance covers laptops, smartphones, and tablets only."]})})]}),(0,B.jsxs)(Ae.A,{children:[(0,B.jsx)(S.A,{onClick:()=>y(!1),children:"Cancel"}),(0,B.jsx)(S.A,{onClick:()=>{y(!1),(async i=>{if(null!==e&&void 0!==e&&e.uid&&null!==e&&void 0!==e&&e.email)if(b){a(!0),u(null);try{const n=await(0,ii.Ky)({userUid:e.uid,customerEmail:e.email,successUrl:window.location.origin+"/dashboard?subscription=success",currency:t?"MWK":"GBP",tier:i});null!==n&&void 0!==n&&n.checkout_url?window.location.href=n.checkout_url:u("Failed to start subscription. Please try again.")}catch(n){console.error("Subscription error:",n),u("Failed to start subscription. Please try again.")}finally{a(!1)}}else u("Please agree to the terms and conditions");else u("Please log in to subscribe")})(A)},variant:"contained",disabled:!b||l,sx:{bgcolor:"premium"===A?"#ffd700":"#48cedb",color:"premium"===A?"#000":"#fff","&:hover":{bgcolor:"premium"===A?"#e6c200":"#3ba8b8"}},children:l?"Processing...":"Confirm Subscription"})]})]}),(0,B.jsxs)(ie.A,{open:h,onClose:()=>x(!1),children:[(0,B.jsx)(ne.A,{children:"Cancel Subscription?"}),(0,B.jsx)(se.A,{children:(0,B.jsxs)(Bt.A,{children:["Are you sure you want to cancel your Xtrapush ","premium"===D?"Premium":"Plus"," subscription? You will lose access to free insurance and delivery benefits."]})}),(0,B.jsxs)(Ae.A,{children:[(0,B.jsx)(S.A,{onClick:()=>x(!1),children:"Keep Subscription"}),(0,B.jsx)(S.A,{onClick:async()=>{a(!0),u(null);try{await(0,ii.M2)(e.uid),d(e=>(0,n.A)((0,n.A)({},e),{},{isActive:!1,status:"CANCELED"})),x(!1)}catch(t){console.error("Cancel error:",t),u("Failed to cancel subscription. Please try again.")}finally{a(!1)}},color:"error",disabled:l,children:l?"Cancelling...":"Cancel Subscription"})]})]})]})},si=280,ri=(0,r.A)({palette:{mode:"dark",primary:{main:"#3b82f6"},background:{default:"#0f172a",paper:"#1e293b"},text:{primary:"#f8fafc",secondary:"#94a3b8"}},breakpoints:{values:{xs:0,sm:600,md:900,lg:1200,xl:1536}},components:{MuiPaper:{styleOverrides:{root:{backgroundColor:"#1e293b",border:"1px solid #334155"}}},MuiCard:{styleOverrides:{root:{backgroundColor:"#1e293b",border:"1px solid #334155"}}}}}),li=(0,l.Ay)(h.A,{shouldForwardProp:e=>"open"!==e})(e=>{let{theme:t}=e;return{zIndex:t.zIndex.drawer+1,backgroundColor:"#0f172a",borderBottom:"1px solid #334155",boxShadow:"none",[t.breakpoints.up("md")]:{marginLeft:si,width:"calc(100% - ".concat(si,"px)")}}}),ai=(0,l.Ay)(u.Ay)(e=>{let{theme:t}=e;return{[t.breakpoints.up("md")]:{"& .MuiDrawer-paper":{position:"relative",whiteSpace:"nowrap",width:si,backgroundColor:"#0f172a",borderRight:"1px solid #334155",boxSizing:"border-box"}}}}),oi=(0,l.Ay)(u.Ay)(e=>{let{theme:t}=e;return{[t.breakpoints.down("md")]:{"& .MuiDrawer-paper":{width:si,backgroundColor:"#0f172a",borderRight:"1px solid #334155",boxSizing:"border-box"}}}}),di=(0,l.Ay)(P.A)(e=>{let{theme:t}=e;return{backgroundColor:"#1e293b",border:"1px solid #334155",margin:t.spacing(2),marginTop:"auto",[t.breakpoints.down("md")]:{margin:t.spacing(1)}}}),ci=()=>{const[e,t]=s.useState(null);s.useEffect(()=>{let e=!0;return(async()=>{try{const i=await bt();i&&(i.success||i.data)&&e&&t(i.data||i.stats||i)}catch(i){}})(),()=>{e=!1}},[]);const i=s.useMemo(()=>{var t;return((null===e||void 0===e||null===(t=e.visitors)||void 0===t?void 0:t.daily)||[]).map(e=>({name:(null===e||void 0===e?void 0:e.day)||"",value:Number((null===e||void 0===e?void 0:e.count)||0)}))},[e]),n=s.useMemo(()=>{var t,i,n;const s=(e,t)=>Array.isArray(e)?e.map(e=>{var i,n,s;return{name:(null===e||void 0===e?void 0:e.month)||(null===e||void 0===e?void 0:e.label)||(null===e||void 0===e?void 0:e.day)||"",[t]:Number(null!==(i=null!==(n=null!==(s=null===e||void 0===e?void 0:e.count)&&void 0!==s?s:null===e||void 0===e?void 0:e.value)&&void 0!==n?n:null===e||void 0===e?void 0:e[t])&&void 0!==i?i:0)}}):[],r=(null===e||void 0===e||null===(t=e.pageViews)||void 0===t?void 0:t.monthly)||(null===e||void 0===e||null===(i=e.page_views)||void 0===i?void 0:i.monthly)||(null===e||void 0===e?void 0:e.pageViews)||(null===e||void 0===e?void 0:e.page_views)||[],l=(null===e||void 0===e||null===(n=e.downloads)||void 0===n?void 0:n.monthly)||(null===e||void 0===e?void 0:e.downloads)||[],a=s(r,"pageViews"),o=s(l,"downloads");return Array.from(new Set([...a.map(e=>e.name),...o.map(e=>e.name)])).filter(Boolean).map(e=>{var t,i;return{name:e,pageViews:(null===(t=a.find(t=>t.name===e))||void 0===t?void 0:t.pageViews)||0,downloads:(null===(i=o.find(t=>t.name===e))||void 0===i?void 0:i.downloads)||0}})},[e]);return(0,B.jsxs)(A.A,{children:[(0,B.jsx)(v.A,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Analytics Dashboard"}),(0,B.jsxs)(f.A,{sx:{p:3,mb:3},children:[(0,B.jsx)(v.A,{variant:"h6",gutterBottom:!0,children:"Performance Metrics"}),(0,B.jsxs)(j.A,{container:!0,spacing:3,children:[(0,B.jsx)(j.A,{item:!0,xs:12,md:6,children:(0,B.jsx)(ze,{title:"Visitors",data:i})}),(0,B.jsx)(j.A,{item:!0,xs:12,md:6,children:(0,B.jsx)(Re,{data:n})})]})]})]})},ui=()=>(0,B.jsxs)(A.A,{children:[(0,B.jsx)(v.A,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Clients Management"}),(0,B.jsx)(f.A,{sx:{p:3},children:(0,B.jsx)(v.A,{variant:"body1",children:"Client management dashboard content will appear here."})})]}),mi=[{value:"smartphone",label:"Smartphones"},{value:"tablet",label:"Tablets"},{value:"laptop",label:"Laptops"},{value:"desktop",label:"Desktops"},{value:"gaming",label:"Gaming"},{value:"audio",label:"Audio"},{value:"wearable",label:"Wearables"},{value:"productivity",label:"Productivity"},{value:"accessories",label:"Accessories"}],hi=()=>{const{user:e,isAdmin:t}=(0,V.A)(),[i,r]=(0,s.useState)({name:"",description:"",category:"",brand:"",model:"",image:"",inStock:!0,stockQuantity:0,condition:"new",more_img:[],specifications:""}),[l,a]=(0,s.useState)(null),[o,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)(!1),[h,x]=(0,s.useState)(null),[p,g]=(0,s.useState)([]),[y,P]=(0,s.useState)(""),[C,N]=(0,s.useState)(!1),[I,W]=(0,s.useState)([]),[M,O]=(0,s.useState)([]),[_,T]=(0,s.useState)({color:"",colorHex:"",storage:"",condition:"new",price:"",priceGbp:"",stockQuantity:"",sku:""}),[E,F]=(0,s.useState)(!1),[L,z]=(0,s.useState)(null),[U,q]=(0,s.useState)(null),[R,G]=(0,s.useState)(!1),[Q,K]=(0,s.useState)(!1),[H]=(0,s.useState)(["64GB","128GB","256GB","512GB","1TB"]),[J]=(0,s.useState)(["new","like_new","good","fair"]),X=s.useMemo(()=>[...new Set(M.map(e=>e.storage).filter(Boolean))],[M]),Y=(s.useMemo(()=>[...new Set(M.map(e=>e.condition||e.condition_status).filter(Boolean))],[M]),s.useMemo(()=>M.reduce((e,t)=>e+parseInt(t.stock_quantity||t.stockQuantity||0,10),0),[M])),$=async()=>{try{const e=await ae.QO.getAll({limit:50});e.success&&g(e.data||[])}catch(e){console.error(e)}};s.useEffect(()=>{$()},[]);const Z=e=>{const{name:t,value:i}=e.target;r(e=>(0,n.A)((0,n.A)({},e),{},{[t]:i}))};s.useEffect(()=>{let e;return e=setTimeout(async()=>{if(y.trim()){N(!0);try{const e=await ae.QO.search(y.trim());e.success&&W(Array.isArray(e.data)?e.data:[])}catch(e){console.error("Search error",e)}finally{N(!1)}}else W([])},300),()=>clearTimeout(e)},[y]);const ee=()=>r({name:"",description:"",category:"",brand:"",model:"",image:"",inStock:!0,stockQuantity:0,condition:"new",more_img:[],specifications:""}),te=e=>{if(!e||"string"!==typeof e)return{};const t={};return e.split("\n").forEach(e=>{const i=e.indexOf(":");if(i>0){const n=e.substring(0,i).trim(),s=e.substring(i+1).trim();n&&s&&(t[n]=s)}}),t},ie=["name","description","category","brand","model"],ne=async i=>{if(t()&&null!==e&&void 0!==e&&e.uid){d(!0);try{const t=await ae.QO.adminDelete(i,e.uid);t.success?(a({type:"success",msg:"Deleted gadget successfully"}),await $()):a({type:"error",msg:t.error||"Failed to delete gadget"})}catch(n){a({type:"error",msg:n.message||"Error deleting gadget"})}finally{d(!1)}}else a({type:"error",msg:"Admin permissions required"})},se=async function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R;if(i&&t()&&null!==e&&void 0!==e&&e.uid)try{F(!0);const t=await ae.QO.adminGetVariants(i,e.uid,{includeInactive:n});t.success?O(Array.isArray(t.data)?t.data:[]):z({type:"error",msg:t.error||"Failed to load variants"})}catch(s){z({type:"error",msg:s.message||"Error loading variants"})}finally{F(!1)}};s.useEffect(()=>{h&&se(h,R)},[h,R]);const re=e=>{const{name:t,value:i}=e.target;T(e=>(0,n.A)((0,n.A)({},e),{},{[t]:i}))},le=()=>{T({color:"",colorHex:"",storage:"",condition:"new",price:"",priceGbp:"",stockQuantity:"",sku:""}),q(null)},oe=async(i,n)=>{var s;if(!t()||null===e||void 0===e||!e.uid||!h)return void z({type:"error",msg:"Admin permissions required"});const r=M.find(e=>e.id===i);let l=(null!==(s="undefined"!==typeof(null===r||void 0===r?void 0:r.stock_quantity)?r.stock_quantity:null===r||void 0===r?void 0:r.stockQuantity)&&void 0!==s?s:0)+n;l<0&&(l=0),F(!0);try{const t=await ae.QO.adminUpdateVariant(h,i,e.uid,{stockQuantity:l});t.success?(z({type:"success",msg:"Stock updated to ".concat(l)}),await se()):z({type:"error",msg:t.error||"Failed to update stock"})}catch(a){z({type:"error",msg:a.message||"Error updating stock"})}finally{F(!1)}};return(0,B.jsxs)(A.A,{children:[(0,B.jsx)(v.A,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Gadgets Management"}),(0,B.jsxs)(f.A,{sx:{p:3,mb:3},children:[!t()&&(0,B.jsx)(v.A,{color:"error",sx:{mb:2},children:"Admin permissions required to manage gadgets."}),(0,B.jsxs)(j.A,{container:!0,spacing:2,children:[(0,B.jsxs)(j.A,{item:!0,xs:12,md:6,children:[(0,B.jsx)(b.A,{fullWidth:!0,label:"Name",name:"name",value:i.name,onChange:Z,required:!0,sx:{mb:2}}),(0,B.jsx)(b.A,{fullWidth:!0,label:"Description",name:"description",value:i.description,onChange:Z,required:!0,multiline:!0,rows:3,placeholder:"Enter a detailed description of the gadget...",sx:{mb:2}}),(0,B.jsx)(b.A,{fullWidth:!0,label:"Specifications",name:"specifications",value:i.specifications,onChange:Z,multiline:!0,rows:4,placeholder:"Enter specifications (one per line)\ne.g.\nDisplay: 6.1-inch Super Retina XDR\nChip: A17 Pro\nStorage: 128GB",helperText:"Enter one specification per line in format: Key: Value",sx:{mb:2}}),(0,B.jsxs)(j.A,{container:!0,spacing:2,sx:{mt:.5},children:[(0,B.jsx)(j.A,{item:!0,xs:6,children:(0,B.jsx)(b.A,{fullWidth:!0,select:!0,label:"Category",name:"category",value:i.category,onChange:Z,required:!0,helperText:i.category&&"accessories"!==i.category?"Variants required for this category":"",children:mi.map(e=>(0,B.jsx)(w.A,{value:e.value,children:e.label},e.value))})}),(0,B.jsx)(j.A,{item:!0,xs:6,children:(0,B.jsx)(b.A,{fullWidth:!0,label:"Brand",name:"brand",value:i.brand,onChange:Z})})]}),(0,B.jsxs)(j.A,{container:!0,spacing:2,sx:{mt:.5},children:[(0,B.jsx)(j.A,{item:!0,xs:6,children:(0,B.jsx)(b.A,{fullWidth:!0,label:"Model",name:"model",value:i.model,onChange:Z})}),(0,B.jsx)(j.A,{item:!0,xs:6,children:(0,B.jsx)(b.A,{fullWidth:!0,label:"Image URL",name:"image",value:i.image,onChange:Z})})]}),(0,B.jsx)(j.A,{container:!0,spacing:2,sx:{mt:.5},children:(0,B.jsx)(j.A,{item:!0,xs:12,md:6,children:(0,B.jsxs)(b.A,{fullWidth:!0,select:!0,label:"Condition",name:"condition",value:i.condition,onChange:Z,children:[(0,B.jsx)(w.A,{value:"new",children:"New"}),(0,B.jsx)(w.A,{value:"like_new",children:"Like New"}),(0,B.jsx)(w.A,{value:"good",children:"Good"}),(0,B.jsx)(w.A,{value:"fair",children:"Fair"})]})})}),(0,B.jsxs)(j.A,{container:!0,spacing:2,sx:{mt:.5},children:[(0,B.jsxs)(j.A,{item:!0,xs:12,md:8,children:[(0,B.jsxs)(S.A,{variant:"outlined",component:"label",disabled:!t()||c,children:[c?"Uploading...":"Upload Images",(0,B.jsx)("input",{type:"file",accept:"image/*",multiple:!0,hidden:!0,onChange:async e=>{const t=Array.from(e.target.files||[]);if(t.length){u(!0),a(null);try{const e=await ae.QO.uploadImages(t);if(e&&e.success&&Array.isArray(e.images)){const[t,...i]=e.images;r(e=>(0,n.A)((0,n.A)({},e),{},{image:t||e.image,more_img:i.length?i:e.more_img})),a({type:"success",msg:"Uploaded ".concat(e.count||e.images.length," image(s)")})}else a({type:"error",msg:(null===e||void 0===e?void 0:e.error)||"Image upload failed"})}catch(i){a({type:"error",msg:i.message||"Error uploading images"})}finally{u(!1),e.target.value=""}}}})]}),Array.isArray(i.more_img)&&i.more_img.length>0&&(0,B.jsxs)(v.A,{variant:"caption",sx:{ml:2},children:[i.more_img.length," additional image(s) attached"]})]}),(0,B.jsx)(j.A,{item:!0,xs:12,md:4,children:i.image&&(0,B.jsx)(m.A,{sx:{width:80,height:80,borderRadius:1,overflow:"hidden",border:"1px solid #334155"},children:(0,B.jsx)("img",{src:i.image,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover"}})})})]}),(0,B.jsxs)(j.A,{container:!0,spacing:2,sx:{mt:.5},children:[(0,B.jsx)(j.A,{item:!0,xs:12,md:6,children:(0,B.jsx)(b.A,{fullWidth:!0,label:"Stock Quantity",name:"stockQuantity",value:i.stockQuantity,onChange:Z,type:"number"})}),(0,B.jsx)(j.A,{item:!0,xs:12,md:6,children:(0,B.jsxs)(m.A,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",md:"repeat(4, 1fr)"},gap:1},children:[(0,B.jsx)(S.A,{fullWidth:!0,variant:"contained",disabled:!t()||o,onClick:async()=>{if(t()&&null!==e&&void 0!==e&&e.uid){for(const e of ie)if(!String(i[e]||"").trim())return void a({type:"error",msg:"Missing required field: ".concat(e)});if(mi.some(e=>e.value===i.category)){d(!0);try{const t={name:i.name,description:i.description,price:0,priceGbp:0,monthlyPrice:0,monthlyPriceGbp:0,image:i.image||null,more_img:Array.isArray(i.more_img)?i.more_img:[],category:i.category,brand:i.brand,model:i.model,condition:i.condition,specifications:te(i.specifications),inStock:i.inStock?1:0,stockQuantity:parseInt(i.stockQuantity||0,10)},n=await ae.QO.adminCreate(e.uid,t);n.success?(a({type:"success",msg:"Created gadget successfully"}),ee(),await $()):a({type:"error",msg:n.error||"Failed to create gadget"})}catch(n){a({type:"error",msg:n.message||"Error creating gadget"})}finally{d(!1)}}else a({type:"error",msg:"Please select a valid category"})}else a({type:"error",msg:"Admin permissions required"})},children:"Create"}),(0,B.jsx)(S.A,{fullWidth:!0,variant:"outlined",disabled:!t()||o||!h,onClick:()=>(async n=>{if(t()&&null!==e&&void 0!==e&&e.uid){d(!0);try{const t={name:i.name,description:i.description,price:0,priceGbp:0,monthlyPrice:0,monthlyPriceGbp:0,image:i.image||null,more_img:Array.isArray(i.more_img)?i.more_img:[],category:i.category,brand:i.brand,model:i.model,condition:i.condition,specifications:te(i.specifications),inStock:i.inStock?1:0,stockQuantity:parseInt(i.stockQuantity||0,10)},s=await ae.QO.adminUpdate(n,e.uid,t);s.success?(a({type:"success",msg:"Updated gadget successfully"}),ee(),await $()):a({type:"error",msg:s.error||"Failed to update gadget"})}catch(s){a({type:"error",msg:s.message||"Error updating gadget"})}finally{d(!1)}}else a({type:"error",msg:"Admin permissions required"})})(h),children:"Update Selected"}),(0,B.jsx)(S.A,{fullWidth:!0,color:"error",variant:"outlined",disabled:!t()||o||!h,onClick:()=>ne(h),children:"Delete Selected"}),(0,B.jsx)(S.A,{fullWidth:!0,variant:"text",disabled:o&&!!h,onClick:()=>{x(null),ee(),a({type:"success",msg:"Cleared selection"})},children:"Clear"})]})})]}),l&&(0,B.jsx)(v.A,{sx:{mt:2},color:"error"===l.type?"error":"success.main",children:l.msg})]}),(0,B.jsxs)(j.A,{item:!0,xs:12,md:6,children:[(0,B.jsx)(v.A,{variant:"h6",gutterBottom:!0,children:"Existing Gadgets"}),(0,B.jsxs)(m.A,{sx:{display:"flex",gap:1,mb:2},children:[(0,B.jsx)(b.A,{fullWidth:!0,placeholder:"Search gadgets by name, brand, or model",value:y,onChange:e=>{P(e.target.value)},InputProps:{startAdornment:(0,B.jsx)(k.A,{position:"start",children:(0,B.jsx)(D.A,{sx:{color:"#94a3b8"}})})}}),(0,B.jsx)(S.A,{variant:"text",onClick:()=>P(""),disabled:C||!y,children:"Clear"})]}),(0,B.jsx)(m.A,{sx:{maxHeight:{xs:320,md:520},overflowY:"auto",pr:1},children:(0,B.jsxs)(j.A,{container:!0,spacing:2,children:[(I.length?I:p).map(e=>(0,B.jsx)(j.A,{item:!0,xs:12,children:(0,B.jsxs)(f.A,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,B.jsxs)(m.A,{children:[(0,B.jsx)(v.A,{fontWeight:"medium",children:e.name}),(0,B.jsxs)(v.A,{variant:"body2",color:"text.secondary",children:[e.brand," \u2022 ",e.model," \u2022 ",e.category]})]}),(0,B.jsxs)(m.A,{sx:{display:"flex",gap:1},children:[(0,B.jsx)(S.A,{size:"small",variant:"outlined",disabled:!t()||o,onClick:()=>(e=>{var t,i,n,s,l,o,d,c,u,m;x(e.id);const h=e.specifications&&"object"===typeof e.specifications?Object.entries(e.specifications).map(e=>{let[t,i]=e;return"".concat(t,": ").concat(i)}).join("\n"):"";r({name:e.name||"",description:e.description||"",price:null!==(t=e.price)&&void 0!==t?t:"",priceGbp:null!==(i=e.price_gbp)&&void 0!==i?i:"",monthlyPrice:null!==(n=null!==(s=e.monthlyPrice)&&void 0!==s?s:e.monthly_price)&&void 0!==n?n:"",monthlyPriceGbp:null!==(l=e.monthly_price_gbp)&&void 0!==l?l:"",category:e.category||"",brand:e.brand||"",model:e.model||"",image:e.image||"",condition:e.condition||"new",inStock:!!(null!==(o=e.inStock)&&void 0!==o?o:null!==(d=e.in_stock)&&void 0!==d?d:e.stock>0),stockQuantity:null!==(c=null!==(u=null!==(m=e.stockQuantity)&&void 0!==m?m:e.stock_quantity)&&void 0!==u?u:e.stock)&&void 0!==c?c:0,more_img:Array.isArray(e.more_img)?e.more_img:[],specifications:h}),a({type:"success",msg:"Selected gadget #".concat(e.id," for editing")}),se(e.id,R)})(e),children:h===e.id?"Selected":"Select"}),(0,B.jsx)(S.A,{size:"small",color:"error",variant:"outlined",disabled:!t()||o,onClick:()=>ne(e.id),children:"Delete"})]})]})},e.id)),!(I.length?I:p).length&&(0,B.jsx)(j.A,{item:!0,xs:12,children:(0,B.jsx)(v.A,{variant:"body2",color:"text.secondary",children:"No gadgets found."})})]})})]})]})]}),h&&(0,B.jsxs)(f.A,{sx:{p:3},children:[(0,B.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,B.jsxs)(m.A,{children:[(0,B.jsxs)(v.A,{variant:"h6",fontWeight:"bold",children:["Variant Management ","accessories"!==i.category&&(0,B.jsx)(v.A,{component:"span",color:"error.main",variant:"caption",children:"(Required)"})]}),(0,B.jsxs)(v.A,{variant:"body2",color:"text.secondary",children:["Total Stock: ",Y," units across ",M.length," variants"]})]}),(0,B.jsxs)(m.A,{sx:{display:"flex",gap:1},children:[(0,B.jsx)(S.A,{size:"small",variant:"outlined",onClick:()=>G(e=>!e),children:R?"Hide Inactive":"Show Inactive"}),(0,B.jsx)(S.A,{size:"small",variant:"text",onClick:()=>se(),children:"Refresh"})]})]}),"accessories"!==i.category&&0===M.length&&(0,B.jsx)(f.A,{sx:{p:2,mb:2,bgcolor:"rgba(255, 152, 0, 0.1)",border:"1px solid rgba(255, 152, 0, 0.3)"},children:(0,B.jsxs)(v.A,{color:"warning.main",variant:"body2",children:["\u26a0\ufe0f Variants are required for ",i.category||"this category",". Please add at least one variant with pricing and stock."]})}),!t()&&(0,B.jsx)(v.A,{color:"error",sx:{mb:2},children:"Admin permissions required to manage variants."}),(0,B.jsxs)(f.A,{sx:{p:2,mb:3,bgcolor:"rgba(59, 130, 246, 0.05)",border:"1px solid rgba(59, 130, 246, 0.2)"},children:[(0,B.jsx)(v.A,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:U?"Edit Variant #".concat(U):"Add New Variant"}),(0,B.jsxs)(m.A,{sx:{mb:2},children:[(0,B.jsx)(v.A,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:"Quick Storage:"}),(0,B.jsx)(m.A,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:H.map(e=>(0,B.jsx)(S.A,{size:"small",variant:_.storage===e?"contained":"outlined",onClick:()=>{return t=e,void T(e=>(0,n.A)((0,n.A)({},e),{},{storage:t}));var t},sx:{minWidth:60},children:e},e))})]}),(0,B.jsxs)(m.A,{sx:{mb:2},children:[(0,B.jsx)(v.A,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:"Condition:"}),(0,B.jsx)(m.A,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:J.map(e=>(0,B.jsx)(S.A,{size:"small",variant:_.condition===e?"contained":"outlined",onClick:()=>{return t=e,void T(e=>(0,n.A)((0,n.A)({},e),{},{condition:t}));var t},color:"new"===e?"success":"like_new"===e?"info":"good"===e?"warning":"inherit",children:"like_new"===e?"Like New":e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),(0,B.jsxs)(j.A,{container:!0,spacing:2,children:[(0,B.jsx)(j.A,{item:!0,xs:12,sm:6,children:(0,B.jsx)(b.A,{fullWidth:!0,label:"Storage",name:"storage",value:_.storage,onChange:re,placeholder:"e.g., 256GB",size:"small"})}),(0,B.jsx)(j.A,{item:!0,xs:12,sm:6,children:(0,B.jsxs)(b.A,{fullWidth:!0,select:!0,label:"Condition",name:"condition",value:_.condition,onChange:re,size:"small",children:[(0,B.jsx)(w.A,{value:"new",children:"New"}),(0,B.jsx)(w.A,{value:"like_new",children:"Like New"}),(0,B.jsx)(w.A,{value:"good",children:"Good"}),(0,B.jsx)(w.A,{value:"fair",children:"Fair"})]})}),(0,B.jsx)(j.A,{item:!0,xs:6,sm:3,children:(0,B.jsx)(b.A,{fullWidth:!0,label:"Price (MWK)",name:"price",value:_.price,onChange:re,type:"number",size:"small"})}),(0,B.jsx)(j.A,{item:!0,xs:6,sm:3,children:(0,B.jsx)(b.A,{fullWidth:!0,label:"Price (GBP)",name:"priceGbp",value:_.priceGbp,onChange:re,type:"number",size:"small"})}),(0,B.jsx)(j.A,{item:!0,xs:6,sm:3,children:(0,B.jsx)(b.A,{fullWidth:!0,label:"Stock Qty",name:"stockQuantity",value:_.stockQuantity,onChange:re,type:"number",size:"small"})}),(0,B.jsx)(j.A,{item:!0,xs:6,sm:3,children:(0,B.jsx)(b.A,{fullWidth:!0,label:"SKU",name:"sku",value:_.sku,onChange:re,size:"small"})}),(0,B.jsx)(j.A,{item:!0,xs:8,sm:4,children:(0,B.jsx)(b.A,{fullWidth:!0,label:"Color Name (optional)",name:"color",value:_.color,onChange:re,placeholder:"e.g., Black Titanium",size:"small"})}),(0,B.jsx)(j.A,{item:!0,xs:4,sm:2,children:(0,B.jsx)(b.A,{fullWidth:!0,label:"Hex",name:"colorHex",value:_.colorHex,onChange:re,placeholder:"#000000",size:"small",InputProps:{startAdornment:_.colorHex?(0,B.jsx)(m.A,{sx:{width:16,height:16,borderRadius:"50%",bgcolor:_.colorHex,border:"1px solid #ccc",mr:.5}}):null}})}),(0,B.jsx)(j.A,{item:!0,xs:12,sm:6,children:(0,B.jsxs)(m.A,{sx:{display:"flex",gap:1},children:[U?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(S.A,{variant:"contained",disabled:!t()||E,onClick:async()=>{if(t()&&null!==e&&void 0!==e&&e.uid&&h&&U){F(!0);try{const t=await ae.QO.adminUpdateVariant(h,U,e.uid,{color:void 0!==_.color?String(_.color).trim():void 0,colorHex:void 0!==_.colorHex?String(_.colorHex).trim():void 0,storage:String(_.storage).trim(),condition:_.condition||"new",price:String(_.price).trim()?parseFloat(_.price):void 0,priceGbp:String(_.priceGbp||"").trim()?parseFloat(_.priceGbp):void 0,stockQuantity:String(_.stockQuantity).trim()?parseInt(_.stockQuantity,10):void 0,sku:"undefined"!==typeof _.sku?String(_.sku).trim():void 0});t.success?(z({type:"success",msg:"Variant updated successfully"}),le(),await se()):z({type:"error",msg:t.error||"Failed to update variant"})}catch(i){z({type:"error",msg:i.message||"Error updating variant"})}finally{F(!1)}}else z({type:"error",msg:"Admin permissions required or no variant selected"})},children:"Update Variant"}),(0,B.jsx)(S.A,{variant:"outlined",onClick:le,children:"Cancel"})]}):(0,B.jsx)(S.A,{variant:"contained",disabled:!t()||E||!_.storage||!_.price,onClick:async()=>{if(t()&&null!==e&&void 0!==e&&e.uid&&h)if(_.storage&&String(_.price).trim()){F(!0);try{const t=await ae.QO.adminCreateVariant(h,e.uid,{color:_.color?String(_.color).trim():"",colorHex:_.colorHex?String(_.colorHex).trim():"",storage:String(_.storage).trim(),condition:_.condition||"new",price:parseFloat(_.price),priceGbp:_.priceGbp?parseFloat(_.priceGbp):void 0,stockQuantity:_.stockQuantity?parseInt(_.stockQuantity,10):0,sku:_.sku?String(_.sku).trim():""});t.success?(z({type:"success",msg:"Variant created successfully"}),le(),await se()):z({type:"error",msg:t.error||"Failed to create variant"})}catch(i){z({type:"error",msg:i.message||"Error creating variant"})}finally{F(!1)}}else z({type:"error",msg:"Storage and price are required"});else z({type:"error",msg:"Admin permissions required"})},children:"Add Variant"}),(0,B.jsx)(S.A,{variant:"text",onClick:le,children:"Clear"})]})})]}),L&&(0,B.jsx)(v.A,{sx:{mt:2},color:"error"===L.type?"error":"success.main",children:L.msg})]}),(0,B.jsxs)(v.A,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:["Current Variants (",M.length,")"]}),X.length>0?(0,B.jsx)(m.A,{sx:{overflowX:"auto"},children:(0,B.jsxs)(m.A,{sx:{minWidth:600},children:[(0,B.jsxs)(j.A,{container:!0,spacing:1,sx:{mb:1,px:1},children:[(0,B.jsx)(j.A,{item:!0,xs:2,children:(0,B.jsx)(v.A,{variant:"caption",fontWeight:"bold",color:"text.secondary",children:"STORAGE"})}),(0,B.jsx)(j.A,{item:!0,xs:2,children:(0,B.jsx)(v.A,{variant:"caption",fontWeight:"bold",color:"text.secondary",children:"CONDITION"})}),(0,B.jsx)(j.A,{item:!0,xs:2,children:(0,B.jsx)(v.A,{variant:"caption",fontWeight:"bold",color:"text.secondary",children:"PRICE"})}),(0,B.jsx)(j.A,{item:!0,xs:2,children:(0,B.jsx)(v.A,{variant:"caption",fontWeight:"bold",color:"text.secondary",children:"STOCK"})}),(0,B.jsx)(j.A,{item:!0,xs:4,children:(0,B.jsx)(v.A,{variant:"caption",fontWeight:"bold",color:"text.secondary",children:"ACTIONS"})})]}),M.map(i=>{var n,s,r,l;const a=parseInt(null!==(n=null!==(s=i.stock_quantity)&&void 0!==s?s:i.stockQuantity)&&void 0!==n?n:0,10),o=a<=0,d=null!==(r=null!==(l=i.condition)&&void 0!==l?l:i.condition_status)&&void 0!==r?r:"new";return(0,B.jsx)(f.A,{sx:{mb:1,p:1.5,opacity:o?.6:1,bgcolor:U===i.id?"rgba(59, 130, 246, 0.1)":"background.paper",border:U===i.id?"2px solid #3b82f6":"1px solid transparent"},children:(0,B.jsxs)(j.A,{container:!0,spacing:1,alignItems:"center",children:[(0,B.jsxs)(j.A,{item:!0,xs:2,children:[(0,B.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[i.color_hex&&(0,B.jsx)(m.A,{sx:{width:16,height:16,borderRadius:"50%",bgcolor:i.color_hex,border:"1px solid rgba(255,255,255,0.3)",flexShrink:0}}),(0,B.jsx)(v.A,{variant:"body2",fontWeight:"medium",children:i.storage})]}),i.color&&(0,B.jsx)(v.A,{variant:"caption",color:"text.secondary",children:i.color})]}),(0,B.jsx)(j.A,{item:!0,xs:2,children:(0,B.jsx)(v.A,{variant:"body2",sx:{px:1,py:.25,borderRadius:1,display:"inline-block",bgcolor:"new"===d?"success.main":"like_new"===d?"info.main":"good"===d?"warning.main":"grey.500",color:"white",fontSize:"0.75rem"},children:"like_new"===d?"Like New":d.charAt(0).toUpperCase()+d.slice(1)})}),(0,B.jsxs)(j.A,{item:!0,xs:2,children:[(0,B.jsxs)(v.A,{variant:"body2",children:["MWK ",Number(i.price||0).toLocaleString()]}),i.price_gbp&&(0,B.jsxs)(v.A,{variant:"caption",color:"text.secondary",children:["\xa3",Number(i.price_gbp).toFixed(2)]})]}),(0,B.jsx)(j.A,{item:!0,xs:2,children:(0,B.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,B.jsx)(S.A,{size:"small",variant:"outlined",disabled:!t()||E||a<=0,onClick:()=>oe(i.id,-1),sx:{minWidth:28,p:.5},children:"-"}),(0,B.jsx)(v.A,{variant:"body2",fontWeight:"bold",color:o?"error.main":"text.primary",sx:{minWidth:30,textAlign:"center"},children:a}),(0,B.jsx)(S.A,{size:"small",variant:"outlined",disabled:!t()||E,onClick:()=>oe(i.id,1),sx:{minWidth:28,p:.5},children:"+"})]})}),(0,B.jsx)(j.A,{item:!0,xs:4,children:(0,B.jsxs)(m.A,{sx:{display:"flex",gap:.5},children:[(0,B.jsx)(S.A,{size:"small",variant:U===i.id?"contained":"outlined",disabled:!t()||E,onClick:()=>(e=>{var t,i,n,s,r,l,a,o,d,c;q(e.id),T({color:null!==(t=e.color)&&void 0!==t?t:"",colorHex:null!==(i=null!==(n=e.color_hex)&&void 0!==n?n:e.colorHex)&&void 0!==i?i:"",storage:e.storage||"",condition:null!==(s=null!==(r=e.condition)&&void 0!==r?r:e.condition_status)&&void 0!==s?s:"new",price:null!==(l=e.price)&&void 0!==l?l:"",priceGbp:null!==(a=null!==(o=e.price_gbp)&&void 0!==o?o:e.priceGbp)&&void 0!==a?a:"",stockQuantity:null!==(d="undefined"!==typeof e.stock_quantity?e.stock_quantity:e.stockQuantity)&&void 0!==d?d:"",sku:null!==(c=e.sku)&&void 0!==c?c:""}),z({type:"success",msg:"Selected variant #".concat(e.id," for editing")})})(i),children:U===i.id?"Editing":"Edit"}),(0,B.jsx)(S.A,{size:"small",color:"error",variant:"outlined",disabled:!t()||E,onClick:()=>(async i=>{if(t()&&null!==e&&void 0!==e&&e.uid&&h){F(!0);try{const t=await ae.QO.adminDeleteVariant(h,i,e.uid);t.success?(z({type:"success",msg:"Variant deleted successfully"}),await se()):z({type:"error",msg:t.error||"Failed to delete variant"})}catch(n){z({type:"error",msg:n.message||"Error deleting variant"})}finally{F(!1)}}else z({type:"error",msg:"Admin permissions required"})})(i.id),children:"Delete"})]})})]})},i.id)})]})}):(0,B.jsxs)(f.A,{sx:{p:3,textAlign:"center",bgcolor:"rgba(0,0,0,0.02)"},children:[(0,B.jsx)(v.A,{variant:"body2",color:"text.secondary",children:"No variants yet. Add storage/condition variants above to enable customer selection."}),(0,B.jsx)(v.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:"Tip: For smartphones/tablets, create variants for each storage size and condition combination."})]})]})]})},xi=()=>(0,B.jsxs)(A.A,{children:[(0,B.jsx)(v.A,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Profile Settings"}),(0,B.jsx)(Vt,{}),(0,B.jsx)(m.A,{sx:{mt:3},children:(0,B.jsx)(ni,{})})]}),pi=()=>(0,B.jsxs)(A.A,{children:[(0,B.jsx)(v.A,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"About Dashboard"}),(0,B.jsx)(f.A,{sx:{p:3},children:(0,B.jsx)(v.A,{variant:"body1",children:"About dashboard content will appear here."})})]});function vi(){const[e,t]=(0,s.useState)(!1),i=(0,a.A)(),{user:r,userRole:l,isAdmin:u,isSeller:h,isBuyer:j}=(0,V.A)(),f=(0,d.Zp)(),w=(0,d.zy)(),[S,P]=(0,s.useState)(""),[O,_]=(0,s.useState)([]),[T,E]=(0,s.useState)(!1),F=s.useRef(null),[L,z]=(0,s.useState)(0),U=s.useMemo(()=>{try{return new Intl.DateTimeFormat("en-US",{timeZone:"Africa/Blantyre",weekday:"short",month:"short",day:"numeric",year:"numeric"}).format(new Date)}catch(e){const t=new Date,i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return"".concat(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][t.getDay()],", ").concat(i[t.getMonth()]," ").concat(t.getDate(),", ").concat(t.getFullYear())}},[]),q=e=>{if(!e)return{};try{if("object"===typeof e)return e;const t=String(e).trim();return t?JSON.parse(t):{}}catch(t){return{}}};s.useEffect(()=>{let e=!0;return(async()=>{try{const t=(null===r||void 0===r?void 0:r.uid)||(null===r||void 0===r?void 0:r.id)||null,i=u()?await ae.gH.getAllOrders():t?await ae.gH.getUserOrders(t):null,n=(null===i||void 0===i?void 0:i.orders)||[];let s=0;for(const e of n){const t=q(null===e||void 0===e?void 0:e.notes);if(!!!(null!==t&&void 0!==t&&t.installmentPlan||"installment_deposit"===(null===t||void 0===t?void 0:t.paymentType)||"installment_payment"===(null===t||void 0===t?void 0:t.paymentType)))continue;((null===e||void 0===e?void 0:e.paymentStatus)||(null===e||void 0===e?void 0:e.status)||"").toLowerCase().includes("paid")||(s+=1)}e&&z(s)}catch(t){e&&z(0)}})(),()=>{e=!1}},[r,u]);s.useEffect(()=>{const e=S.trim();return F.current&&(clearTimeout(F.current),F.current=null),e?(F.current=setTimeout(async()=>{try{const i=[{label:"Installments",to:"/dashboard/installments",type:"route"},{label:"Orders",to:"/dashboard/orders",type:"route"},{label:"Analytics",to:"/dashboard/analytics",type:"route"},{label:"Clients",to:"/dashboard/clients",type:"route"}].filter(t=>t.label.toLowerCase().includes(e.toLowerCase()));let s=[];try{const t=await ae.QO.search(e);t&&t.success&&Array.isArray(t.data)&&(s=t.data.slice(0,5))}catch(t){s=[]}const r=[...i,...s.map(e=>(0,n.A)((0,n.A)({},e),{},{type:"gadget"}))];_(r),E(!0)}catch(i){_([]),E(!1)}},300),()=>{F.current&&(clearTimeout(F.current),F.current=null)}):(_([]),void E(!1))},[S]);const R=()=>{t(!e)},G=(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(m.A,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,B.jsx)(m.A,{sx:{display:"inline-flex"},children:(0,B.jsx)(Et.A,{style:{width:"min(140px, 40vw)",height:"auto"}})})}),(0,B.jsx)(p.A,{component:"nav",sx:{px:1},children:(0,B.jsx)(Q,{})}),(0,B.jsx)(di,{children:(0,B.jsx)(C.A,{children:(0,B.jsxs)(m.A,{children:[(0,B.jsx)(v.A,{variant:"body1",fontWeight:"bold",gutterBottom:!0,children:null!==r&&void 0!==r&&r.displayName?r.displayName:null!==r&&void 0!==r&&r.email?r.email.split("@")[0]:"User"}),(0,B.jsx)(v.A,{variant:"body2",color:"text.secondary",children:(null===r||void 0===r?void 0:r.email)||"user@email.com"})]})})})]});return(0,B.jsx)(o.A,{theme:ri,children:(0,B.jsxs)(m.A,{sx:{display:"flex"},children:[(0,B.jsx)(c.Ay,{}),(0,B.jsx)(li,{position:"fixed",children:(0,B.jsxs)(x.A,{sx:{pr:"24px",flexWrap:{xs:"wrap"}},children:[(0,B.jsx)(g.A,{edge:"start",color:"inherit","aria-label":"open drawer",onClick:R,sx:{marginRight:"36px",[i.breakpoints.up("md")]:{display:"none"}},children:(0,B.jsx)(N.A,{})}),(0,B.jsxs)(m.A,{sx:{flexGrow:1,minWidth:0,display:"flex",alignItems:"center",gap:{xs:1,sm:2},flex:{xs:"1 1 100%",sm:"1 1 auto"}},children:[(0,B.jsx)(g.A,{color:"inherit",onClick:()=>f("/"),sx:{mr:1,"&:hover":{backgroundColor:"#1e293b"}},children:(0,B.jsx)(M.A,{})}),(e=>{const t=w.pathname||"",i=t.startsWith("/dashboard/")&&t.split("/")[2]||"",n=null!==(e={"":"Home",analytics:"Analytics",clients:"Clients",gadgets:"Gadgets",users:"Users",settings:"Settings",about:"About",orders:"Orders",installments:"Installments",verify:"Verify Listings",listings:"My Listings","add-listing":"Add Listing"}[i])&&void 0!==e?e:i?i.charAt(0).toUpperCase()+i.slice(1):"Home";return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(v.A,{variant:"body2",color:"text.secondary",noWrap:!0,children:"Dashboard"}),(0,B.jsx)(v.A,{variant:"body2",color:"text.secondary",sx:{display:{xs:"none",sm:"block"}},noWrap:!0,children:">"}),(0,B.jsx)(v.A,{variant:"body2",color:"text.primary",noWrap:!0,sx:{maxWidth:{xs:"60%",sm:"none"}},children:n})]})})()]}),(0,B.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:{xs:1,sm:2},flex:{xs:"1 1 100%",sm:"0 0 auto"},justifyContent:{xs:"space-between",sm:"flex-start"},flexWrap:{xs:"wrap",sm:"nowrap"}},children:[(0,B.jsxs)(m.A,{sx:{position:"relative",flex:{xs:"1 1 100%",sm:"0 0 auto"},minWidth:0},children:[(0,B.jsx)(b.A,{placeholder:"Search...",size:"small",sx:{width:{xs:"100%",sm:200,md:300},"& .MuiOutlinedInput-root":{backgroundColor:"#1e293b","& fieldset":{borderColor:"#334155"},"&:hover fieldset":{borderColor:"#475569"}}},value:S,onChange:e=>{P(e.target.value),T||E(!0)},onKeyDown:e=>{if("Enter"===e.key){const e=S.trim();if(e){const t=O&&O[0];t?"route"===t.type&&t.to?f(t.to):t.id?f("/gadgets/".concat(t.id)):f("/gadgets?search=".concat(encodeURIComponent(e))):f("/gadgets?search=".concat(encodeURIComponent(e)))}}},onFocus:()=>E(!0),onBlur:()=>setTimeout(()=>E(!1),150),InputProps:{startAdornment:(0,B.jsx)(k.A,{position:"start",children:(0,B.jsx)(D.A,{sx:{color:"#94a3b8"}})})}}),T&&O.length>0&&(0,B.jsx)(m.A,{sx:{position:"absolute",top:"100%",left:0,zIndex:2e3,mt:.5,width:{xs:"100%",sm:240,md:320},maxHeight:300,overflowY:"auto",backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:1,boxShadow:"0 10px 25px rgba(0,0,0,0.35)"},children:O.map((e,t)=>(0,B.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:1,px:1.5,py:1,cursor:"pointer","&:hover":{backgroundColor:"#0f172a"}},onMouseDown:e=>e.preventDefault(),onClick:()=>(e=>{if(E(!1),"route"===e.type&&e.to)f(e.to);else if(e&&e.id)f("/gadgets/".concat(e.id));else if(e&&e.label)f("/gadgets?search=".concat(encodeURIComponent(e.label)));else{const e=S.trim();e&&f("/gadgets?search=".concat(encodeURIComponent(e)))}})(e),children:[(0,B.jsx)(v.A,{variant:"body2",sx:{color:"#f8fafc"},children:"route"===e.type?"Go to ".concat(e.label):e.name||e.label||"View item"}),e.brand&&(0,B.jsxs)(v.A,{variant:"caption",sx:{color:"#94a3b8"},children:["\u2022 ",e.brand]})]},"".concat(e.type,"-").concat(e.id||e.to||e.label,"-").concat(t)))})]}),(0,B.jsxs)(m.A,{sx:{display:{xs:"none",sm:"flex"},alignItems:"center",gap:1.5,px:2,py:.75,backgroundColor:"#1e293b",borderRadius:999,border:"1px solid #334155"},children:[(0,B.jsx)(W.A,{sx:{fontSize:16,color:"#94a3b8"}}),(0,B.jsx)(v.A,{variant:"body2",sx:{fontWeight:500},children:U})]}),(0,B.jsx)(g.A,{color:"inherit",onClick:()=>f("/dashboard/installments"),"aria-label":"View pending installments",sx:{ml:{xs:0,sm:0}},children:(0,B.jsx)(y.A,{badgeContent:L,color:L>0?"error":"default",children:(0,B.jsx)(I.A,{})})})]})]})}),(0,B.jsx)(oi,{variant:"temporary",open:e,onClose:R,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"}},children:G}),(0,B.jsx)(ai,{variant:"permanent",sx:{display:{xs:"none",md:"block"}},children:G}),(0,B.jsxs)(m.A,{component:"main",sx:{backgroundColor:"#0f172a",flexGrow:1,height:"100vh",overflow:"auto",width:{xs:"100%",md:"calc(100% - ".concat(si,"px)")}},children:[(0,B.jsx)(x.A,{}),(0,B.jsx)(A.A,{maxWidth:"xl",sx:{mt:{xs:2,md:4},mb:{xs:2,md:4},px:{xs:2,sm:3}},children:(0,B.jsxs)(d.BV,{children:[(0,B.jsx)(d.qh,{index:!0,element:(0,B.jsx)(Tt,{})}),(0,B.jsx)(d.qh,{path:"analytics",element:(0,B.jsx)(Oe.j,{children:(0,B.jsx)(ci,{})})}),(0,B.jsx)(d.qh,{path:"clients",element:(0,B.jsx)(ui,{})}),(0,B.jsx)(d.qh,{path:"gadgets",element:(0,B.jsx)(Oe.j,{children:(0,B.jsx)(hi,{})})}),(0,B.jsx)(d.qh,{path:"users",element:(0,B.jsx)(Oe.j,{children:(0,B.jsx)(Me,{})})}),(0,B.jsx)(d.qh,{path:"settings",element:(0,B.jsx)(xi,{})}),(0,B.jsx)(d.qh,{path:"about",element:(0,B.jsx)(pi,{})}),(0,B.jsx)(d.qh,{path:"orders",element:(0,B.jsx)(me,{})}),(0,B.jsx)(d.qh,{path:"installments",element:(0,B.jsx)(Se,{})})]})})]})]})})}},86507(e,t,i){i.d(t,{A:()=>d});var n=i(9950),s=i(27321),r=i(98519),l=i(55884),a=i(86633),o=i(44414);const d=(0,n.forwardRef)((e,t)=>{var i,n,d,c,u,m;let{order:h,plan:x}=e;const p=Array.isArray(null===h||void 0===h?void 0:h.items)?h.items:Array.isArray(null===h||void 0===h?void 0:h.cart)?h.cart:[],v=((null===h||void 0===h?void 0:h.currency)||"MWK").toUpperCase(),g=Number(null!==(i=null!==(n=null===x||void 0===x?void 0:x.amountPaid)&&void 0!==n?n:null===h||void 0===h?void 0:h.totalAmount)&&void 0!==i?i:0),y=(null===h||void 0===h?void 0:h.paidAt)||(null===h||void 0===h?void 0:h.paid_at)||(null===h||void 0===h?void 0:h.createdAt)||(null===h||void 0===h?void 0:h.created_at)||null,A=y?new Date(y):new Date,j=e=>{const t="MWK"===v?1:100;return new Intl.NumberFormat("en-US",{style:"currency",currency:v}).format((e||0)/t)},f=e=>{if(!e)return e;try{const t=new URL(e);if("sparkle-pro.co.uk"===(t.hostname||"").replace(/^www\./,"")){let e=t.pathname||"/";return/^\/api\//i.test(e)||(e="/api".concat(e.startsWith("/")?"":"/").concat(e)),"".concat(e).concat(t.search||"")}return e}catch(t){return e}},b={table:{width:"100%",borderCollapse:"collapse",fontSize:"12px"},th:{textAlign:"left",border:"1px solid #ddd",padding:"8px",background:"#f7f7f7"},td:{border:"1px solid #ddd",padding:"8px"},right:{border:"1px solid #ddd",padding:"8px",textAlign:"right"}},w=(0,o.jsx)(s.A,{sx:{background:"#fff",color:"#000",p:12,display:"flex",alignItems:"center",justifyContent:"center",borderBottom:"1px solid #eee"},children:(0,o.jsx)(a.A,{style:{width:120,height:"auto",transform:"none"}})});return(0,o.jsxs)(s.A,{ref:t,sx:{p:0,m:0,background:"#fff",color:"#000"},children:[w,(0,o.jsxs)(s.A,{sx:{p:2},children:[(0,o.jsxs)(r.A,{variant:"h6",sx:{mb:.5},children:["Order #",null!==(d=null===h||void 0===h?void 0:h.id)&&void 0!==d?d:"\u2014"]}),(0,o.jsx)(r.A,{variant:"subtitle2",sx:{mb:1},children:"Summary"}),(0,o.jsx)("table",{style:b.table,children:(0,o.jsxs)("tbody",{children:[(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{style:b.td,children:"Email"}),(0,o.jsx)("td",{style:b.right,children:(null===h||void 0===h?void 0:h.userEmail)||(null===h||void 0===h?void 0:h.email)||(null===h||void 0===h||null===(c=h.customer)||void 0===c?void 0:c.email)||(null===h||void 0===h||null===(u=h.user)||void 0===u?void 0:u.email)||"\u2014"})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{style:b.td,children:"Paid at"}),(0,o.jsx)("td",{style:b.right,children:A.toLocaleString()})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{style:b.td,children:"Amount paid"}),(0,o.jsx)("td",{style:b.right,children:j(g)})]})]})}),(0,o.jsx)(l.A,{sx:{my:1}}),(0,o.jsx)(r.A,{variant:"subtitle1",sx:{mt:1,mb:1},children:"Items"}),p&&p.length>0?(0,o.jsxs)("table",{style:b.table,children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{style:b.th,children:"Image"}),(0,o.jsx)("th",{style:b.th,children:"Item"}),(0,o.jsx)("th",{style:b.th,children:"Details"}),(0,o.jsx)("th",{style:b.th,children:"Qty"}),(0,o.jsx)("th",{style:b.th,children:"Price"})]})}),(0,o.jsx)("tbody",{children:p.map((e,t)=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{style:b.td,children:null!==e&&void 0!==e&&e.image?(0,o.jsx)("img",{src:f(e.image),crossOrigin:"anonymous",referrerPolicy:"no-referrer",alt:e.name||e.title||"Item",style:{width:48,height:48,objectFit:"cover",borderRadius:6},onError:e=>{e.currentTarget.style.display="none"}}):"\u2014"}),(0,o.jsx)("td",{style:b.td,children:(0,o.jsx)("strong",{children:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.title)||(null===e||void 0===e?void 0:e.id)||"Item"})}),(0,o.jsx)("td",{style:b.td,children:[null===e||void 0===e?void 0:e.brand,null===e||void 0===e?void 0:e.model,null===e||void 0===e?void 0:e.storage,null===e||void 0===e?void 0:e.condition].filter(Boolean).join(" \u2022 ")||"\u2014"}),(0,o.jsx)("td",{style:b.right,children:Number((null===e||void 0===e?void 0:e.quantity)||1)}),(0,o.jsx)("td",{style:b.right,children:"number"===typeof(null===e||void 0===e?void 0:e.price)?j(Number(e.price)):"\u2014"})]},t))})]}):(0,o.jsx)(r.A,{variant:"body2",color:"text.secondary",children:"No items"}),x&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(l.A,{sx:{my:1}}),(0,o.jsx)(r.A,{variant:"subtitle1",sx:{mt:1,mb:1},children:"Installment Plan"}),(0,o.jsx)("table",{style:b.table,children:(0,o.jsxs)("tbody",{children:[(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{style:b.td,children:"Weeks"}),(0,o.jsx)("td",{style:b.right,children:null!==(m=x.weeks)&&void 0!==m?m:"\u2014"})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{style:b.td,children:"Weekly Amount"}),(0,o.jsx)("td",{style:b.right,children:"number"===typeof x.weeklyAmount?j(Number(x.weeklyAmount)):"\u2014"})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{style:b.td,children:"Total"}),(0,o.jsx)("td",{style:b.right,children:"number"===typeof x.totalAmount?j(Number(x.totalAmount)):"\u2014"})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{style:b.td,children:"Amount Paid"}),(0,o.jsx)("td",{style:b.right,children:"number"===typeof x.amountPaid?j(Number(x.amountPaid)):"\u2014"})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{style:b.td,children:"Remaining"}),(0,o.jsx)("td",{style:b.right,children:"number"===typeof x.remainingAmount?j(Number(x.remainingAmount)):"\u2014"})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{style:b.td,children:"Next Due"}),(0,o.jsx)("td",{style:b.right,children:x.nextDueDate?new Date(x.nextDueDate).toLocaleDateString():"\u2014"})]})]})})]})]})]})})},90641(e,t,i){i.d(t,{$:()=>a,i:()=>l});var n=i(81052),s=i.n(n),r=i(95612);async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"document.pdf",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)return;const n=i.scale||2,l=i.margin||10,a=await s()(e,{scale:n,useCORS:!0,allowTaint:!1,imageTimeout:0,backgroundColor:"#ffffff",scrollY:-window.scrollY}),o=a.toDataURL("image/png"),d=new r.uE("p","mm","a4"),c=d.internal.pageSize.getWidth(),u=d.internal.pageSize.getHeight(),m=e=>.264583*e,h=m(a.width),x=.264583*l,p=c-2*x,v=p,g=m(a.height)*(p/h);d.addImage(o,"PNG",x,x,v,g);const y=u-2*x;let A=g-y;for(;A>0;){d.addPage();const e=x-(g-A);d.addImage(o,"PNG",x,e,v,g),A-=y}d.save(t)}async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return null;const i=t.scale||2,n=t.margin||10,l=await s()(e,{scale:i,useCORS:!0,allowTaint:!1,imageTimeout:0,backgroundColor:"#ffffff",scrollY:-window.scrollY}),a=l.toDataURL("image/png"),o=new r.uE("p","mm","a4"),d=o.internal.pageSize.getWidth(),c=o.internal.pageSize.getHeight(),u=e=>.264583*e,m=u(l.width),h=.264583*n,x=d-2*h,p=x,v=u(l.height)*(x/m);o.addImage(a,"PNG",h,h,p,v);const g=c-2*h;let y=v-g;for(;y>0;){o.addPage();const e=h-(v-y);o.addImage(a,"PNG",h,e,p,v),y-=g}const A=o.output("blob");return URL.createObjectURL(A)}}}]);