"use strict";(self.webpackChunkitsxtrapush=self.webpackChunkitsxtrapush||[]).push([[382],{31810(e,i,o){o.d(i,{j:()=>t});const t=[{id:"lilongwe-service",name:"Lilongwe Service Area",address:"Lilongwe, Malawi (Mobile Service)",hours:["Monday - Saturday: 9:00 AM - 5:00 PM"],places:{google:"https://www.google.com/maps/search/?api=1&query=Lilongwe+Malawi"},region:"Malawi",emoji:"\ud83c\uddf2\ud83c\uddfc"},{id:"northamptonshire-service",name:"Northamptonshire Service Area",address:"Northamptonshire, UK (Mobile Service)",hours:["Monday - Saturday: 9:00 AM - 5:00 PM"],places:{google:"https://www.google.com/maps/search/?api=1&query=Northamptonshire+UK"},region:"UK",emoji:"\ud83c\uddec\ud83c\udde7"}]},31949(e,i,o){o.d(i,{A:()=>n});const t=new class{constructor(){this.modelMappings={"macbook pro m4":{folder:"macbook_pro_m3_16_inch_2024",files:["scene.gltf"],scale:.12,position:[0,-.5,0],rotation:[0,0,0]},"macbook m4":{folder:"macbook_pro_m3_16_inch_2024",files:["scene.gltf"],scale:.12,position:[0,-.5,0]},"macbook pro 2021":{folder:"2021_macbook_pro_16_m1_pro__m1_max",files:["scene.gltf"],scale:.12,position:[0,-.5,0]},"macbook 2021":{folder:"2021_macbook_pro_16_m1_pro__m1_max",files:["scene.gltf"],scale:.12,position:[0,-.5,0]},"2021 macbook pro 16":{folder:"2021_macbook_pro_16_m1_pro__m1_max",files:["scene.gltf"],scale:.12,position:[0,-.5,0]},"iphone 17 pro":{folder:"iphone-17-pro",files:["source/iphone 17_4.glb"],scale:.1,position:[0,0,0]},"iphone 17 pro max":{folder:"iphone_17_pro_max_model",files:["scene.gltf"],scale:.1,position:[0,0,0]},"apple iphone 17 pro max":{folder:"iphone_17_pro_max_model",files:["scene.gltf"],scale:.1,position:[0,0,0]},"iphone 16 pro max":{folder:"iphone_16_pro_max",files:["scene.gltf"],scale:.1,position:[0,0,0]},"iphone 16 pro":{folder:"iphone_16_pro_max",files:["scene.gltf"],scale:.1,position:[0,0,0]},"iphone 16":{folder:"iphone-16-free",files:["source/1b338ec19f15ad72904b/1b338ec19f15ad72904b.gltf"],scale:.1,position:[0,0,0],rotation:[0,0,0]},"iphone 17":{folder:"iphone-16-free",files:["source/1b338ec19f15ad72904b (1)/1b338ec19f15ad72904b (1).gltf"],scale:.1,position:[0,0,0],rotation:[0,0,0]},"apple iphone 17":{folder:"iphone-16-free",files:["source/1b338ec19f15ad72904b (1)/1b338ec19f15ad72904b (1).gltf"],scale:.1,position:[0,0,0],rotation:[0,0,0]},"iphone 15 pro max":{folder:"iphone_15_pro_max",files:["scene.gltf"],scale:.1,position:[0,0,0]},"apple iphone 15 pro max":{folder:"iphone_15_pro_max",files:["scene.gltf"],scale:.1,position:[0,0,0]},"iphone 15":{folder:"iphone_15",files:["scene.gltf"],scale:.1,position:[0,0,0]},"apple iphone 15":{folder:"iphone_15",files:["scene.gltf"],scale:.1,position:[0,0,0]},"iphone 14 pro":{folder:"iphone-14-pro",files:["source/model.zip"],scale:.1,position:[0,0,0],needsConversion:!0},"iphone 14 pro max":{folder:"iphone_14_pro_max",files:["scene.gltf"],scale:.1,position:[0,0,0]},"apple iphone 14 pro max":{folder:"iphone_14_pro_max",files:["scene.gltf"],scale:.1,position:[0,0,0]},"iphone 14":{folder:"iphone_14",files:["scene.gltf"],scale:.1,position:[0,0,0]},"apple iphone 14":{folder:"iphone_14",files:["scene.gltf"],scale:.1,position:[0,0,0]},"iphone 13 pro max":{folder:"apple_iphone_13_pro_max",files:["scene.gltf"],scale:.1,position:[0,0,0],rotation:[0,0,0]},"iphone 13":{folder:"iphone_13_concept",files:["scene.gltf"],scale:.05,position:[0,0,0]},"apple iphone 13":{folder:"iphone_13_concept",files:["scene.gltf"],scale:.05,position:[0,0,0]},"samsung galaxy s25":{folder:"samsung-s25-ultra-free",files:["source/samsung_s24_ultra.glb"],scale:.1,position:[0,0,0]},"samsung s25 ultra":{folder:"samsung-s25-ultra-free",files:["source/samsung_s24_ultra.glb"],scale:.1,position:[0,0,0]},"samsung s25":{folder:"samsung-s25",files:["source/SAMSUNG S25/SAMSUNG S25.gltf"],scale:.1,position:[0,0,0]},"samsung galaxy a14":{folder:"SAMSUNG Galaxy A14 5G",files:["SAMSUNG Galaxy A14 5G/GLTF/GLTF/SAMSUNG Galaxy A14 5G.gltf"],scale:.81,position:[0,0,0]},"galaxy a14":{folder:"SAMSUNG Galaxy A14 5G",files:["SAMSUNG Galaxy A14 5G/GLTF/GLTF/SAMSUNG Galaxy A14 5G.gltf"],scale:.81,position:[0,0,0]},"samsung galaxy s23 ultra":{folder:"samsung-s25-ultra-free",files:["source/samsung_s24_ultra.glb"],scale:.1,position:[0,0,0]},"s23 ultra":{folder:"samsung-s25-ultra-free",files:["source/samsung_s24_ultra.glb"],scale:.1,position:[0,0,0]},"samsung s24":{folder:"samsung-s25",files:["source/SAMSUNG S25/SAMSUNG S25.gltf"],scale:.1,position:[0,0,0]},"asus tuf gaming":{folder:"asus_rog_strix_scar_17_2023_g733_gaming_laptop",files:["scene.gltf"],scale:.12,position:[0,-.5,0]},"asus tuf f15":{folder:"asus_rog_strix_scar_17_2023_g733_gaming_laptop",files:["scene.gltf"],scale:.12,position:[0,-.5,0]},"asus rog strix":{folder:"asus_rog_strix_scar_17_2023_g733_gaming_laptop",files:["scene.gltf"],scale:.12,position:[0,-.5,0]},"hp omen":{folder:"hp_omen_laptop",files:["scene.gltf","e.bin"],scale:1,position:[0,-.5,0]},"hp 14s":{folder:"hp_14s-dq2622tu_laptop",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"hp laptop 14s":{folder:"hp_14s-dq2622tu_laptop",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"lenovo ideapad":{folder:"lenovo_ideapad",files:["scene.gltf"],scale:1,position:[0,-.5,0],rotation:[0,0,0]},lenovo:{folder:"lenovo",files:["source/two283.fbx"],scale:1,position:[0,-.5,0]},"acer nitro 5":{folder:"acer-nitro-5-laptop",files:["source/Acer Nitro 5 AN515-57.glb"],scale:.25,position:[0,-.5,0]},"msi monitor 27":{folder:"msi_optix_mag271cr_27",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"msi optix mag271cr 27":{folder:"msi_optix_mag271cr_27",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"nvidia rtx 2070":{folder:"geforce_rtx_2070_founders_edition",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"geforce rtx 2070":{folder:"geforce_rtx_2070_founders_edition",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"nvidea rtx 2070":{folder:"geforce_rtx_2070_founders_edition",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"nvidia rtx 3060":{folder:"geforce_rtx_3060_ti_founders_edition",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"geforce rtx 3060":{folder:"geforce_rtx_3060_ti_founders_edition",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"nvidea rtx 3060":{folder:"geforce_rtx_3060_ti_founders_edition",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"redmi note 14":{folder:"redmi_note_14__realistic_smartphone_3d_model",files:["scene.gltf"],scale:.1,position:[0,0,0]},"vivo x80":{folder:"vivo-x80",files:["source/vivo_x80without_extra_textures.glb"],scale:.1,position:[0,0,0]},"nintendo switch":{folder:"nintendo_switch",files:["scene.gltf"],scale:1,position:[0,-.5,0]},ps5:{folder:"ps5",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"dual shock 5":{folder:"playstation_5_dualsense",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"xbox controller":{folder:"xbox_controller",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"xbox series x":{folder:"xbox_one_s",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"dualshock 5":{folder:"playstation_5_dualsense",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"dualshock 5 sony":{folder:"playstation_5_dualsense",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"dualshock 4 sony":{folder:"game_controller-_version_1",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"dualshock 4":{folder:"game_controller-_version_1",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"dual shock 4":{folder:"game_controller-_version_1",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"sony playstation 4":{folder:"ps4",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"playstation 4":{folder:"ps4",files:["scene.gltf"],scale:1,position:[0,-.5,0]},ps4:{folder:"ps4",files:["scene.gltf"],scale:1,position:[0,-.5,0]},"gaming pc":{folder:"gaming-pc-with-animated-textures-that-wont-work",files:["source/model.gltf"],scale:1,position:[0,-1,0]}},this.searchAliases={macbook:["macbook pro","macbook air","mac book"],iphone:["apple iphone","iphone pro","iphone max"],samsung:["galaxy","samsung galaxy"],asus:["asus tuf","asus rog","tuf gaming"],hp:["hewlett packard","hp laptop"],lenovo:["thinkpad","ideapad"],acer:["acer laptop","nitro"],xiaomi:["redmi","mi"],gaming:["gaming laptop","gaming pc","gaming computer"]}}getModelConfig(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const t=[e,"".concat(i," ").concat(o),"".concat(i," ").concat(e),o].filter(Boolean);for(const n of t){const e=this.normalizeSearchTerm(n);if(this.modelMappings[e])return this.modelMappings[e];const i=this.findFuzzyMatch(e);if(i)return i}return null}normalizeSearchTerm(e){return e.toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim()}findFuzzyMatch(e){const i=e.split(" "),o=["macbook","iphone","apple","samsung","galaxy","asus","hp","lenovo","legion","acer","xiaomi","redmi","vivo","gaming"].filter(e=>i.includes(e)),t=Object.entries(this.modelMappings).filter(e=>{let[i]=e;if(0===o.length)return!0;const t=i.split(" ");return o.some(e=>t.includes(e))});for(const[n,l]of t){const e=n.split(" ");if(i.filter(i=>e.some(e=>e.includes(i)||i.includes(e))).length>=.7*Math.min(i.length,e.length))return l}return null}getModelPaths(e){if(!e)return[];const i="https://www.sparkle-pro.co.uk/api/models".replace(/\/$/,""),o="".concat(i,"/").concat(e.folder),t=[];for(let n of e.files){const e=String(n).trim().replace(/(\.gltf|\.glb|\.obj)\.+$/i,"$1");if(e.endsWith(".glb"))t.push("".concat(o,"/").concat(e));else if(e.endsWith(".gltf"))t.push("".concat(o,"/").concat(e));else if(e.endsWith(".obj"))t.push("".concat(o,"/").concat(e));else if(e.endsWith(".zip")||e.endsWith(".7z")||e.endsWith(".fbx")){const i=e.replace(/\.(zip|7z|fbx)$/i,".glb");t.push("".concat(o,"/").concat(i));const n=e.replace(/\.(zip|7z|fbx)$/i,".gltf");t.push("".concat(o,"/").concat(n))}}return t.push("".concat(o,"/scene.glb"),"".concat(o,"/model.glb"),"".concat(o,"/source/scene.glb"),"".concat(o,"/source/model.glb")),t.push("".concat(o,"/scene.gltf"),"".concat(o,"/model.gltf"),"".concat(o,"/source/scene.gltf"),"".concat(o,"/source/model.gltf")),[...new Set(t)]}async checkModelExists(e){try{if(!e.endsWith(".gltf")&&!e.endsWith(".glb")&&!e.endsWith(".obj"))return!1;let t;try{let o=e;try{const i=new URL(e);if(/sparkle-pro\.co\.uk$/i.test(i.hostname)){const e=i.pathname+(i.search||""),t=decodeURIComponent(e).replace(/(\.gltf|\.glb|\.obj)\.+$/i,"$1");o="https://".concat(i.host,"/api/models-proxy?url=").concat(encodeURIComponent(t))}}catch(i){}t=await fetch(o,{method:"HEAD",mode:"cors",cache:"no-store"})}catch(o){return!1}if(!t.ok)return!1;const n=t.headers.get("content-type");return!n||!n.includes("text/html")}catch(t){return!1}}validateModelConfig(e){if(!e||!e.folder||!e.files)return!1;return!!e.files.some(e=>e.endsWith(".gltf")||e.endsWith(".glb")||e.endsWith(".obj"))||(console.warn("No valid GLTF/GLB files in model config:",e),!1)}async getBestModelPath(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{const t=this.getModelConfig(e,i,o);if(!t)return console.log("No model configuration found for: ".concat(e)),null;if(!this.validateModelConfig(t))return console.warn("Invalid model configuration for: ".concat(e)),null;if(t.needsConversion)return console.log('Model for "'.concat(e,'" needs conversion from FBX/ZIP/7z to GLTF format. Falling back to 2D image.')),null;const n=this.getModelPaths(t).filter(e=>e.endsWith(".gltf")||e.endsWith(".glb")||e.endsWith(".obj"));if(0===n.length)return console.warn("No valid GLTF/GLB files found for: ".concat(e)),null;for(const i of n){if(await this.checkModelExists(i))return console.log('Found valid 3D model for "'.concat(e,'": ').concat(i)),{path:i,config:t,scale:t.scale||1,position:t.position||[0,0,0],rotation:t.rotation||[0,0,0]}}return console.warn("No accessible 3D model files found for: ".concat(e)),null}catch(t){return console.error('Error getting model path for "'.concat(e,'":'),t),null}}getAvailableModels(){return Object.keys(this.modelMappings)}searchModels(e){const i=this.normalizeSearchTerm(e).split(" ");return Object.keys(this.modelMappings).filter(e=>{const o=this.normalizeSearchTerm(e);return i.some(e=>o.includes(e))})}updateMappingsFromDatabase(e){e.forEach(e=>{if(e.has_3d_model&&e.model3d_path){const i=this.normalizeSearchTerm(e.name);if(this.modelMappings[i]={folder:e.model3d_path,files:Array.isArray(e.model3d_files)?e.model3d_files:["scene.gltf"],scale:e.model3d_scale||1,position:Array.isArray(e.model3d_position)?e.model3d_position:[0,0,0],rotation:Array.isArray(e.model3d_rotation)?e.model3d_rotation:[0,0,0],config:e.model3d_config||{}},e.brand&&e.model){const o=this.normalizeSearchTerm("".concat(e.brand," ").concat(e.model));this.modelMappings[o]=this.modelMappings[i]}}})}getModelConfigFromGadget(e){return e&&e.has_3d_model&&e.model3d_path?{folder:e.model3d_path,files:Array.isArray(e.model3d_files)?e.model3d_files:["scene.gltf"],scale:e.model3d_scale||1,position:Array.isArray(e.model3d_position)?e.model3d_position:[0,0,0],rotation:Array.isArray(e.model3d_rotation)?e.model3d_rotation:[0,0,0],config:e.model3d_config||{}}:null}hasModel(e){return e&&e.has_3d_model&&e.model3d_path}},n=t},96382(e,i,o){o.r(i),o.d(i,{default:()=>ce});var t=o(89379),n=o(9950),l=o(38006),s=o(92994),r=o(45530),a=o(68484),c=o(79482),d=o(96469),u=o(6503),g=o(86057),p=o(27321),h=o(87209),f=o(65812),m=o(85935),x=o(56690),b=o(82024),v=o(55948),y=o(24514),j=o(38796),_=o(98519),A=o(4143),w=o(9940),S=o(79697),k=o(16253),M=o(82503),C=o(22403),N=o(80218),I=o(6732),P=o(65250),W=o(47371),O=o(4159),F=o.n(O),G=o(43405),D=o(31810),R=o(44414);const z=e=>{var i,o;let{gadgetId:l,gadgetName:a,onBookingComplete:c}=e;const[d,b]=(0,n.useState)(F()().add(1,"day").format("YYYY-MM-DD")),[v,y]=(0,n.useState)(""),[O,z]=(0,n.useState)([]),[B,E]=(0,n.useState)(!1),[T,Y]=(0,n.useState)(!1),[L,U]=(0,n.useState)(!1),[q,H]=(0,n.useState)(null),[Q,$]=(0,n.useState)(!1),[V,K]=(0,n.useState)((null===(i=D.j[0])||void 0===i?void 0:i.id)||""),[Z,X]=(0,n.useState)(0),[J,ee]=(0,n.useState)(!1),{isAuthenticated:ie,user:oe}=(0,G.A)(),te=d;(0,n.useEffect)(()=>{ie&&null!==oe&&void 0!==oe&&oe.id&&ne()},[ie,null===oe||void 0===oe?void 0:oe.id]);const ne=async()=>{try{const e=await r.lW.getUserActive(null===oe||void 0===oe?void 0:oe.id);null!==e&&void 0!==e&&e.success&&(ee(e.hasActive),e.hasActive&&H("You already have an active appointment. Please complete or cancel it first."))}catch(e){console.error("Error checking active appointments:",e)}};(0,n.useEffect)(()=>{if(!d||!V)return;(async()=>{U(!0),H(null);try{const e=await r.lW.getAvailableSlots(d,V);if(null!==e&&void 0!==e&&e.success){const i=e.slots||[];z(i);0===F()(d).day()?H("Appointments are not available on Sundays. Please select a different date."):0===i.length&&H("No available slots for this date. Please choose another date.")}else H((null===e||void 0===e?void 0:e.message)||"Failed to load available time slots");y("")}catch(e){console.error("Error fetching available slots:",e),H("Failed to load available time slots. Please try again.")}finally{U(!1)}})()},[d,V]);const le=F()().add(1,"day").format("YYYY-MM-DD"),se=F()().add(90,"day").format("YYYY-MM-DD"),re=F()(d),ae=0===re.day();return(0,R.jsxs)(j.A,{elevation:3,sx:{p:3,mb:4,borderRadius:2,background:"linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)"},children:[(0,R.jsx)(_.A,{variant:"h5",component:"h2",gutterBottom:!0,sx:{fontWeight:"bold",color:"#333",display:"flex",alignItems:"center",gap:1},children:"\ud83d\udcc5 Schedule a Viewing"}),(0,R.jsxs)(_.A,{variant:"body2",sx:{mb:2,color:"#666"},children:["Book an appointment to view the ",(0,R.jsx)("strong",{children:a})," in person at our mobile van."]}),J&&(0,R.jsx)(g.A,{severity:"warning",sx:{mb:2},children:"You have an active appointment. Complete or cancel it before booking another viewing."}),q&&(0,R.jsx)(g.A,{severity:"error",sx:{mb:2},onClose:()=>H(null),children:q}),Q&&(0,R.jsx)(g.A,{severity:"success",sx:{mb:2},children:"\u2705 Your appointment has been booked successfully! Check your email for confirmation details."}),(0,R.jsxs)(A.A,{activeStep:Z,sx:{mb:3},children:[(0,R.jsx)(w.A,{children:(0,R.jsx)(S.A,{children:"Select Date"})}),(0,R.jsx)(w.A,{children:(0,R.jsx)(S.A,{children:"Select Time"})}),(0,R.jsx)(w.A,{children:(0,R.jsx)(S.A,{children:"Confirm"})})]}),(0,R.jsxs)(k.A,{container:!0,spacing:3,children:[(0,R.jsx)(k.A,{item:!0,xs:12,md:6,children:(0,R.jsxs)(p.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,R.jsx)(M.A,{label:"Select Date",type:"date",value:d,onChange:e=>{b(e.target.value),X(0)},inputProps:{min:le,max:se},fullWidth:!0,helperText:"Business hours: Monday-Saturday, 9 AM-5 PM",disabled:J}),(0,R.jsxs)(h.A,{fullWidth:!0,sx:{my:1},disabled:J,children:[(0,R.jsx)(f.A,{id:"location-label",children:"Meeting Location"}),(0,R.jsx)(m.A,{labelId:"location-label",id:"location-select",value:V,label:"Meeting Location",onChange:e=>{K(e.target.value),y(""),X(0)},children:D.j.map(e=>(0,R.jsx)(x.A,{value:e.id,children:e.name},e.id))})]}),(0,R.jsxs)(_.A,{variant:"caption",sx:{color:"#666"},children:[(0,R.jsx)(s.N_,{to:"/find-us",style:{color:"#48CEDB",textDecoration:"none",fontWeight:"bold"},children:"\ud83d\udccd Find Us"})," for location details and directions."]})]})}),(0,R.jsx)(k.A,{item:!0,xs:12,md:6,children:(0,R.jsxs)(p.A,{sx:{display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",gap:2},children:[(0,R.jsxs)(p.A,{children:[(0,R.jsx)(_.A,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"bold"},children:re.format("dddd, MMMM D, YYYY")}),ae&&(0,R.jsx)(g.A,{severity:"info",sx:{mb:1},children:"\u26a0\ufe0f Appointments not available on Sundays"})]}),L?(0,R.jsx)(p.A,{sx:{display:"flex",justifyContent:"center",my:2},children:(0,R.jsx)(u.A,{size:24})}):!ae&&O.length>0?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(h.A,{fullWidth:!0,sx:{my:1},disabled:J,children:[(0,R.jsx)(f.A,{id:"time-slot-label",children:"Select Time"}),(0,R.jsx)(m.A,{labelId:"time-slot-label",id:"time-slot-select",value:v,label:"Select Time",onChange:e=>{y(e.target.value),X(1)},children:O.map(e=>(0,R.jsx)(x.A,{value:e,children:F()("2000-01-01 ".concat(e)).format("h:mm A")},e))})]}),(0,R.jsx)(C.A,{variant:"contained",color:"success",fullWidth:!0,disabled:!v||T||J,onClick:()=>{ie?J?H("You already have an active appointment."):v?E(!0):H("Please select a time slot"):H("Please sign in to book an appointment")},sx:{mt:1,fontWeight:"bold"},children:T?(0,R.jsx)(u.A,{size:20}):"\u2713 Book Appointment"})]}):!ae&&(0,R.jsx)(g.A,{severity:"info",sx:{my:2},children:"No available slots for this date. Please try another date."})]})})]}),(0,R.jsxs)(N.A,{open:B,onClose:()=>E(!1),maxWidth:"sm",fullWidth:!0,children:[(0,R.jsx)(I.A,{sx:{fontWeight:"bold",color:"#48CEDB"},children:"\u2713 Confirm Your Booking"}),(0,R.jsx)(P.A,{sx:{mt:1},children:(0,R.jsxs)(p.A,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[(0,R.jsxs)(p.A,{children:[(0,R.jsx)(_.A,{variant:"caption",sx:{color:"#666"},children:"Gadget"}),(0,R.jsx)(_.A,{variant:"body1",sx:{fontWeight:"bold"},children:a})]}),(0,R.jsxs)(p.A,{children:[(0,R.jsx)(_.A,{variant:"caption",sx:{color:"#666"},children:"Date & Time"}),(0,R.jsxs)(_.A,{variant:"body1",sx:{fontWeight:"bold"},children:[F()(d).format("dddd, MMMM D, YYYY")," at ",F()("2000-01-01 ".concat(v)).format("h:mm A")]})]}),(0,R.jsxs)(p.A,{children:[(0,R.jsx)(_.A,{variant:"caption",sx:{color:"#666"},children:"Location"}),(0,R.jsx)(_.A,{variant:"body1",sx:{fontWeight:"bold"},children:null===(o=D.j.find(e=>e.id===V))||void 0===o?void 0:o.name})]}),(0,R.jsx)(p.A,{sx:{background:"#f0f0f0",p:1.5,borderRadius:1,mt:1},children:(0,R.jsxs)(_.A,{variant:"caption",sx:{color:"#666"},children:["A confirmation email will be sent to ",(0,R.jsx)("strong",{children:null===oe||void 0===oe?void 0:oe.email})]})})]})}),(0,R.jsxs)(W.A,{children:[(0,R.jsx)(C.A,{onClick:()=>E(!1),color:"primary",children:"Cancel"}),(0,R.jsx)(C.A,{onClick:async()=>{Y(!0),H(null);try{var e;const i=(null===(e=D.j.find(e=>e.id===V))||void 0===e?void 0:e.name)||"",o={gadgetId:l,gadgetName:a,appointmentDate:te,appointmentTime:v,locationId:V,locationName:i,userId:null===oe||void 0===oe?void 0:oe.id,userName:(null===oe||void 0===oe?void 0:oe.displayName)||(null===oe||void 0===oe?void 0:oe.name)||(null===oe||void 0===oe?void 0:oe.email)||"Customer",userEmail:(null===oe||void 0===oe?void 0:oe.email)||""},n=await r.lW.create(o);if(null===n||void 0===n||!n.success)throw new Error((null===n||void 0===n?void 0:n.error)||"Failed to create appointment");$(!0),E(!1),H(null),y(""),b(F()().add(1,"day").format("YYYY-MM-DD")),X(0),ee(!0),c&&c((0,t.A)((0,t.A)({},o),{},{appointmentId:n.appointmentId}))}catch(i){console.error("Error booking appointment:",i),H(i.message||"Failed to book appointment. Please try again.")}finally{Y(!1)}},color:"success",variant:"contained",disabled:T,sx:{fontWeight:"bold"},children:T?(0,R.jsx)(u.A,{size:20}):"Confirm Booking"})]})]})]})};o(19676);var B=o(69335),E=o(18069),T=o(31949),Y=o(43529),L=o(85105),U=o(55547),q=o(52036),H=o(55884),Q=o(17153),$=o(98506),V=o(5310),K=o(57559),Z=o(66424),X=o(80727),J=o(50169),ee=o(80432),ie=o(24184),oe=o(76088),te=o(72990),ne=o(86146),le=o(53291);function se(e){let{gadgetId:i}=e;const{isAuthenticated:o,user:a}=(0,G.A)(),c=(0,s.Zp)(),[d,u]=(0,n.useState)(!0),[g,b]=(0,n.useState)(null),[v,y]=(0,n.useState)(!1),[j,A]=(0,n.useState)([]),[w,S]=(0,n.useState)(null),[k,N]=(0,n.useState)(0),[I,P]=(0,n.useState)("recent"),[W,O]=(0,n.useState)("all"),[F,D]=(0,n.useState)(""),[z,B]=(0,n.useState)(0),[E,T]=(0,n.useState)({}),[Y,se]=(0,n.useState)({}),[re,ae]=(0,n.useState)({}),ce=o&&z>0&&F.trim().length>0,de=async()=>{u(!0),b(null);try{const e=await r.QO.getReviews(i);if(null!==e&&void 0!==e&&e.success){const i=e.data||{},o=Array.isArray(i.reviews)?i.reviews:[];A(o);const t="undefined"!==typeof i.averageRating?i.averageRating:null,n="undefined"!==typeof i.count?i.count:void 0;if(null!==t&&"undefined"!==typeof n)S(t),N(Number(n)||0);else{const e=o.map(e=>Number(e.rating)).filter(e=>Number.isFinite(e)&&e>0),i=e.length,t=i>0?(e.reduce((e,i)=>e+i,0)/i).toFixed(1):null;S(t?Number(t):null),N(i)}}else b("Failed to load reviews")}catch(e){b("Failed to load reviews")}finally{u(!1)}};(0,n.useEffect)(()=>{i&&de()},[i]);const ue=async(e,i)=>{if(o)try{await r.QO.reactToReview(e,{userUid:null===a||void 0===a?void 0:a.uid,reaction:i}),await de()}catch(t){}else c("/signin")},ge=((0,n.useMemo)(()=>null===w?"No ratings yet":"".concat(w," out of 5 (").concat(k," rating").concat(1===k?"":"s",")"),[w,k]),(0,n.useMemo)(()=>{if(0===j.length)return{5:0,4:0,3:0,2:0,1:0};const e={5:0,4:0,3:0,2:0,1:0};return j.forEach(i=>{const o=Number(i.rating);o>=1&&o<=5&&e[o]++}),e},[j])),pe=(0,n.useMemo)(()=>{let e=[...j];if("all"!==W){const i=parseInt(W);e=e.filter(e=>Number(e.rating)===i)}return e.sort((e,i)=>"recent"===I?new Date(i.createdAt)-new Date(e.createdAt):"highest"===I?Number(i.rating)-Number(e.rating):"lowest"===I?Number(e.rating)-Number(i.rating):"helpful"===I?(i.likesCount||0)-(e.likesCount||0):0),e},[j,I,W]),he=e=>e.split("*")[0].split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2);return(0,R.jsxs)(p.A,{sx:{mt:4,px:{xs:2,sm:3,md:4},py:3,bgcolor:"rgba(15, 23, 42, 0.6)",borderRadius:3,backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.1)"},children:[(0,R.jsxs)(p.A,{sx:{mb:4},children:[(0,R.jsxs)(L.A,{direction:"row",alignItems:"center",spacing:1,sx:{mb:2},children:[(0,R.jsx)(oe.A,{sx:{color:"#ffd700",fontSize:32}}),(0,R.jsx)(_.A,{variant:"h4",sx:{color:"#fff",fontWeight:"bold"},children:"Reviews & Ratings"})]}),(0,R.jsx)(U.A,{sx:{bgcolor:"rgba(30, 41, 59, 0.8)",borderRadius:2,border:"1px solid rgba(255,255,255,0.15)"},children:(0,R.jsx)(q.A,{children:(0,R.jsxs)(L.A,{direction:{xs:"column",md:"row"},spacing:4,divider:(0,R.jsx)(H.A,{orientation:"vertical",flexItem:!0,sx:{bgcolor:"rgba(255,255,255,0.1)"}}),children:[(0,R.jsxs)(p.A,{sx:{flex:1,textAlign:"center"},children:[(0,R.jsx)(_.A,{variant:"h2",sx:{color:"#fff",fontWeight:"bold",mb:1},children:null!==w?w.toFixed(1):"0.0"}),(0,R.jsx)(Q.A,{value:w||0,readOnly:!0,precision:.1,size:"large",sx:{"& .MuiRating-iconFilled":{color:"#ffd700"},"& .MuiRating-iconEmpty":{color:"rgba(255,255,255,0.2)"}}}),(0,R.jsxs)(_.A,{variant:"body2",sx:{color:"#94a3b8",mt:1},children:[k," ",1===k?"review":"reviews"]})]}),(0,R.jsx)(p.A,{sx:{flex:2},children:[5,4,3,2,1].map(e=>{const i=ge[e]||0,o=k>0?i/k*100:0;return(0,R.jsxs)(L.A,{direction:"row",alignItems:"center",spacing:2,sx:{mb:1,cursor:"pointer","&:hover":{bgcolor:"rgba(255,255,255,0.05)"},borderRadius:1,px:1,py:.5},onClick:()=>O(e.toString()),children:[(0,R.jsxs)(_.A,{variant:"body2",sx:{color:"#fff",minWidth:60},children:[e," ",(0,R.jsx)(oe.A,{sx:{fontSize:14,color:"#ffd700",verticalAlign:"middle"}})]}),(0,R.jsx)(p.A,{sx:{flex:1},children:(0,R.jsx)($.A,{variant:"determinate",value:o,sx:{height:8,borderRadius:1,bgcolor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{bgcolor:e>=4?"#10b981":e>=3?"#fbbf24":"#ef4444",borderRadius:1}}})}),(0,R.jsxs)(_.A,{variant:"body2",sx:{color:"#94a3b8",minWidth:80,textAlign:"right"},children:[i," ",1===i?"review":"reviews"]})]},e)})})]})})})]}),(0,R.jsx)(U.A,{sx:{bgcolor:"rgba(30, 41, 59, 0.8)",borderRadius:2,border:"1px solid rgba(255,255,255,0.15)",mb:4},children:(0,R.jsxs)(q.A,{children:[(0,R.jsx)(_.A,{variant:"h6",sx:{color:"#fff",mb:2,fontWeight:600},children:"\u270d\ufe0f Write Your Review"}),(0,R.jsxs)(L.A,{spacing:2,children:[(0,R.jsxs)(p.A,{children:[(0,R.jsx)(_.A,{variant:"body2",sx:{color:"#94a3b8",mb:1},children:"Your Rating *"}),(0,R.jsx)(Q.A,{value:z,onChange:(e,i)=>B(i||0),size:"large",sx:{"& .MuiRating-iconFilled":{color:"#ffd700"},"& .MuiRating-iconHover":{color:"#ffeb3b"},"& .MuiRating-iconEmpty":{color:"rgba(255,255,255,0.2)"}}})]}),(0,R.jsx)(M.A,{value:F,onChange:e=>D(e.target.value),placeholder:o?"Share your experience with this product...":"Please sign in to write a review",fullWidth:!0,multiline:!0,rows:4,disabled:!o||v,sx:{"& .MuiInputBase-root":{bgcolor:"rgba(255,255,255,0.9)",color:"#000",borderRadius:2,fontSize:"0.95rem"},"& .MuiInputBase-root.Mui-disabled":{bgcolor:"rgba(255,255,255,0.5)",color:"#666"},"& .MuiInputBase-input::placeholder":{color:"#666",opacity:.7},"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.3)"},"& .MuiOutlinedInput-root:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(72,206,219,0.5)"},"& .MuiOutlinedInput-root.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#48CEDB",borderWidth:2}}}),(0,R.jsxs)(L.A,{direction:"row",spacing:2,justifyContent:"flex-end",children:[!o&&(0,R.jsx)(C.A,{variant:"outlined",onClick:()=>c("/signin"),sx:{color:"#48CEDB",borderColor:"#48CEDB",textTransform:"none","&:hover":{borderColor:"#39B9C7",bgcolor:"rgba(72,206,219,0.1)"}},children:"Sign In to Review"}),o&&(0,R.jsx)(C.A,{variant:"contained",onClick:async()=>{if(o){if(ce){y(!0),b(null);try{await r.QO.createReview(i,{userUid:null===a||void 0===a?void 0:a.uid,comment:F.trim(),rating:z}),D(""),B(0),await de()}catch(n){var e,t;b((null===n||void 0===n||null===(e=n.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Failed to post review")}finally{y(!1)}}}else c("/signin")},disabled:!ce||v,startIcon:v?null:(0,R.jsx)(oe.A,{}),sx:{bgcolor:"#48CEDB",color:"#fff",px:3,py:1,fontWeight:600,borderRadius:2,textTransform:"none",fontSize:"1rem","&:hover":{bgcolor:"#39B9C7",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(72,206,219,0.4)"},"&.Mui-disabled":{bgcolor:"rgba(72,206,219,0.3)",color:"rgba(255,255,255,0.6)"},transition:"all 0.2s"},children:v?"Posting...":"Post Review"})]}),g&&(0,R.jsxs)(_.A,{variant:"caption",sx:{color:"#ef4444",mt:1},children:["\u274c ",g]})]})]})}),(0,R.jsxs)(L.A,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:3},children:[(0,R.jsxs)(h.A,{size:"small",sx:{minWidth:200},children:[(0,R.jsx)(f.A,{sx:{color:"#94a3b8"},children:"Filter by Rating"}),(0,R.jsxs)(m.A,{value:W,label:"Filter by Rating",onChange:e=>O(e.target.value),startAdornment:(0,R.jsx)(te.A,{sx:{color:"#94a3b8",mr:1}}),sx:{color:"#fff","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.2)"},"& .MuiSvgIcon-root":{color:"#fff"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.3)"}},MenuProps:{PaperProps:{sx:{bgcolor:"#1e293b",color:"#fff"}}},children:[(0,R.jsx)(x.A,{value:"all",children:"All Ratings"}),(0,R.jsx)(x.A,{value:"5",children:"5 Stars"}),(0,R.jsx)(x.A,{value:"4",children:"4 Stars"}),(0,R.jsx)(x.A,{value:"3",children:"3 Stars"}),(0,R.jsx)(x.A,{value:"2",children:"2 Stars"}),(0,R.jsx)(x.A,{value:"1",children:"1 Star"})]})]}),(0,R.jsxs)(h.A,{size:"small",sx:{minWidth:200},children:[(0,R.jsx)(f.A,{sx:{color:"#94a3b8"},children:"Sort By"}),(0,R.jsxs)(m.A,{value:I,label:"Sort By",onChange:e=>P(e.target.value),sx:{color:"#fff","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.2)"},"& .MuiSvgIcon-root":{color:"#fff"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.3)"}},MenuProps:{PaperProps:{sx:{bgcolor:"#1e293b",color:"#fff"}}},children:[(0,R.jsx)(x.A,{value:"recent",children:"Most Recent"}),(0,R.jsx)(x.A,{value:"highest",children:"Highest Rated"}),(0,R.jsx)(x.A,{value:"lowest",children:"Lowest Rated"}),(0,R.jsx)(x.A,{value:"helpful",children:"Most Helpful"})]})]}),"all"!==W&&(0,R.jsx)(C.A,{variant:"outlined",size:"small",onClick:()=>O("all"),sx:{color:"#94a3b8",borderColor:"rgba(255,255,255,0.2)",textTransform:"none","&:hover":{borderColor:"rgba(255,255,255,0.3)",bgcolor:"rgba(255,255,255,0.05)"}},children:"Clear Filter"})]}),d?(0,R.jsx)(p.A,{sx:{textAlign:"center",py:4},children:(0,R.jsx)(_.A,{sx:{color:"#94a3b8"},children:"Loading reviews..."})}):0===pe.length?(0,R.jsxs)(p.A,{sx:{textAlign:"center",py:4},children:[(0,R.jsx)(_.A,{sx:{color:"#94a3b8",mb:2},children:"all"!==W?"No ".concat(W,"-star reviews yet."):"No reviews yet. Be the first to review!"}),"all"!==W&&(0,R.jsx)(C.A,{variant:"outlined",onClick:()=>O("all"),sx:{color:"#48CEDB",borderColor:"#48CEDB",textTransform:"none"},children:"View All Reviews"})]}):(0,R.jsx)(L.A,{spacing:3,children:(0,R.jsx)(le.N,{children:pe.map((e,i)=>{var n,s;return(0,R.jsx)(l.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3,delay:.05*i},children:(0,R.jsx)(U.A,{sx:{bgcolor:"rgba(30, 41, 59, 0.5)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:2,"&:hover":{bgcolor:"rgba(30, 41, 59, 0.7)",border:"1px solid rgba(255,255,255,0.2)"},transition:"all 0.2s"},children:(0,R.jsx)(q.A,{children:(0,R.jsxs)(L.A,{direction:"row",spacing:2,children:[(0,R.jsx)(V.A,{sx:{bgcolor:"#48CEDB",width:48,height:48,fontWeight:"bold"},children:he(e.userMasked)}),(0,R.jsxs)(p.A,{sx:{flex:1},children:[(0,R.jsxs)(L.A,{direction:"row",justifyContent:"space-between",alignItems:"flex-start",sx:{mb:1},children:[(0,R.jsxs)(p.A,{children:[(0,R.jsxs)(L.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,R.jsx)(_.A,{variant:"subtitle1",sx:{color:"#fff",fontWeight:600},children:e.userMasked}),(0,R.jsx)(K.A,{title:"Verified Purchase",children:(0,R.jsx)(ie.A,{sx:{fontSize:16,color:"#10b981"}})})]}),(0,R.jsx)(_.A,{variant:"caption",sx:{color:"#94a3b8"},children:new Date(e.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]}),(0,R.jsx)(Q.A,{value:e.rating||0,readOnly:!0,size:"small",sx:{"& .MuiRating-iconFilled":{color:"#ffd700"},"& .MuiRating-iconEmpty":{color:"rgba(255,255,255,0.2)"}}})]}),(0,R.jsx)(_.A,{variant:"body1",sx:{color:"#e2e8f0",mb:2,lineHeight:1.7},children:e.comment}),(0,R.jsxs)(L.A,{direction:"row",spacing:2,alignItems:"center",sx:{mb:2},children:[(0,R.jsx)(K.A,{title:"Helpful",children:(0,R.jsx)(Z.A,{size:"small",onClick:()=>ue(e.id,"like"),sx:{color:"#94a3b8","&:hover":{color:"#10b981",bgcolor:"rgba(16,185,129,0.1)"}},children:(0,R.jsx)(J.A,{fontSize:"small"})})}),(0,R.jsx)(_.A,{variant:"caption",sx:{color:"#94a3b8"},children:e.likesCount||0}),(0,R.jsx)(K.A,{title:"Not Helpful",children:(0,R.jsx)(Z.A,{size:"small",onClick:()=>ue(e.id,"dislike"),sx:{color:"#94a3b8","&:hover":{color:"#ef4444",bgcolor:"rgba(239,68,68,0.1)"}},children:(0,R.jsx)(ee.A,{fontSize:"small"})})}),(0,R.jsx)(_.A,{variant:"caption",sx:{color:"#94a3b8"},children:e.dislikesCount||0}),(0,R.jsx)(H.A,{orientation:"vertical",flexItem:!0,sx:{bgcolor:"rgba(255,255,255,0.1)"}}),(0,R.jsxs)(C.A,{size:"small",startIcon:(0,R.jsx)(ne.A,{}),onClick:()=>ae(i=>(0,t.A)((0,t.A)({},i),{},{[e.id]:!i[e.id]})),sx:{color:"#48CEDB",textTransform:"none","&:hover":{bgcolor:"rgba(72,206,219,0.1)"}},children:["Reply ",(null===(n=e.replies)||void 0===n?void 0:n.length)>0&&"(".concat(e.replies.length,")")]})]}),(0,R.jsxs)(X.A,{in:re[e.id]||e.replies&&e.replies.length>0,children:[e.replies&&e.replies.length>0&&(0,R.jsx)(p.A,{sx:{pl:3,borderLeft:"2px solid rgba(72,206,219,0.3)",mb:2},children:e.replies.map(e=>(0,R.jsx)(p.A,{sx:{mb:2},children:(0,R.jsxs)(L.A,{direction:"row",spacing:1.5,children:[(0,R.jsx)(V.A,{sx:{bgcolor:"#94a3b8",width:32,height:32,fontSize:"0.875rem"},children:he(e.userMasked)}),(0,R.jsxs)(p.A,{sx:{flex:1},children:[(0,R.jsx)(_.A,{variant:"caption",sx:{color:"#fff",fontWeight:600},children:e.userMasked}),(0,R.jsx)(_.A,{variant:"caption",sx:{color:"#94a3b8",ml:1},children:new Date(e.createdAt).toLocaleDateString()}),(0,R.jsx)(_.A,{variant:"body2",sx:{color:"#cbd5e1",mt:.5},children:e.comment})]})]})},e.id))}),o&&(0,R.jsxs)(L.A,{direction:"row",spacing:1,sx:{mt:2},children:[(0,R.jsx)(M.A,{value:E[e.id]||"",onChange:i=>T(o=>(0,t.A)((0,t.A)({},o),{},{[e.id]:i.target.value})),placeholder:"Write a reply...",fullWidth:!0,size:"small",disabled:!!Y[e.id],sx:{"& .MuiInputBase-root":{bgcolor:"rgba(255,255,255,0.9)",color:"#000",borderRadius:1},"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.2)"}}}),(0,R.jsx)(C.A,{variant:"contained",onClick:()=>(async e=>{if(!o)return void c("/signin");const i=(E[e]||"").trim();if(i){se(i=>(0,t.A)((0,t.A)({},i),{},{[e]:!0}));try{await r.QO.replyToReview(e,{userUid:null===a||void 0===a?void 0:a.uid,comment:i}),T(i=>(0,t.A)((0,t.A)({},i),{},{[e]:""})),await de()}catch(n){}finally{se(i=>(0,t.A)((0,t.A)({},i),{},{[e]:!1}))}}})(e.id),disabled:!(null!==(s=E[e.id])&&void 0!==s&&s.trim())||!!Y[e.id],sx:{bgcolor:"#48CEDB",minWidth:80,textTransform:"none","&:hover":{bgcolor:"#39B9C7"},"&.Mui-disabled":{bgcolor:"rgba(72,206,219,0.3)",color:"rgba(255,255,255,0.6)"}},children:Y[e.id]?"Sending...":"Reply"})]})]})]})]})})})},e.id)})})})]})}var re=o(29040);const ae=n.lazy(()=>Promise.all([o.e(782),o.e(330)]).then(o.bind(o,35330))),ce=()=>{var e,i;const o=(0,s.Zp)(),[j]=(0,n.useState)("Gadgets"),[_,A]=(0,n.useState)(!1),{id:w,category:S,slug:k}=(0,s.g)(),M=k?(0,d.Ze)("/gadgets/".concat(S,"/").concat(k)):w,[C,N]=(0,n.useState)(null),[I,P]=(0,n.useState)(!0),[W,O]=(0,n.useState)(null),[F,D]=(0,n.useState)(0),[L,U]=(0,n.useState)("2d"),[q,H]=(0,n.useState)(0),[Q,$]=(0,n.useState)(!1),{isAuthenticated:V,user:K}=(0,G.A)(),{addToCart:Z}=(0,E._$)(),{formatLocalPrice:X,currency:J,isInMalawi:ee,loading:ie}=(0,B.e)(),[oe,te]=(0,n.useState)(!1),[ne,le]=(0,n.useState)(""),[ce,de]=(0,n.useState)(!1),[ue,ge]=(0,n.useState)(!1),[pe,he]=(0,n.useState)(!1),fe=(0,n.useRef)(null),[me,xe]=(0,n.useState)([]),[be,ve]=(0,n.useState)([]),[ye,je]=(0,n.useState)([]),[_e,Ae]=(0,n.useState)([]),[we,Se]=(0,n.useState)(""),[ke,Me]=(0,n.useState)(""),[Ce,Ne]=(0,n.useState)("new"),[Ie,Pe]=(0,n.useState)(void 0),[We,Oe]=(0,n.useState)(0),[Fe,Ge]=(0,n.useState)(null),De={new:"New",like_new:"Like New",good:"Good",fair:"Fair"},Re={New:"new","Like New":"like_new",Good:"good",Fair:"fair"},ze=["new","like_new","good","fair"],Be=!(null===C||void 0===C||!C.category)&&["smartphones","tablets","laptops","phones","mobile","iphone","samsung","ipad"].some(e=>C.category.toLowerCase().includes(e.toLowerCase())),Ee=n.useMemo(()=>{if(0===me.length)return ye;const e=new Set;return me.forEach(i=>{var o;parseInt(null!==(o=i.stock_quantity)&&void 0!==o?o:0,10)>0&&e.add(i.storage)}),ye.filter(i=>e.has(i))},[me,ye]),Te=n.useMemo(()=>{if(0===me.length)return _e;const e=ke?me.filter(e=>e.storage===ke):me,i=new Set;return e.forEach(e=>{var o;parseInt(null!==(o=e.stock_quantity)&&void 0!==o?o:0,10)>0&&i.add(e.condition_status)}),_e.filter(e=>{const o=Re[e];return i.has(o)})},[me,ke,_e]),Ye=(n.useMemo(()=>{var e;if(null!==Fe)return Fe>0;if(!ke)return!0;const i=me.find(e=>e.storage===ke&&e.condition_status===Ce);return!!i&&parseInt(null!==(e=i.stock_quantity)&&void 0!==e?e:0,10)>0},[me,ke,Ce,Fe]),e=>"string"===typeof e?parseFloat(e.replace(/[^0-9.-]+/g,""))||0:Number(e)||0),Le={hidden:{},show:{transition:{delayChildren:.12,staggerChildren:.08}}},Ue={hidden:{opacity:0,y:8},show:{opacity:1,y:0,transition:{duration:.35,ease:[.22,1,.36,1]}}},qe={hidden:{opacity:0,y:12,scale:.98},show:{opacity:1,y:0,scale:1,transition:{type:"spring",stiffness:240,damping:22}}};(0,n.useEffect)(()=>{w&&(async()=>{try{P(!0);const n=await r.QO.getById(w);if(n.success){const l=n.data;N(l);const s=Array.isArray(l.variants)?l.variants.map(e=>{var i;return(0,t.A)((0,t.A)({},e),{},{color:e.color||null,color_hex:e.color_hex||e.colorHex||null,condition_status:null!==(i=e.condition_status)&&void 0!==i?i:e.condition,stock_quantity:"undefined"!==typeof e.stock_quantity?e.stock_quantity:e.stockQuantity,is_active:"undefined"!==typeof e.is_active?e.is_active:e.active,price_gbp:e.price_gbp||e.priceGbp||null})}).filter(e=>{var i;return 1===(null!==(i=null===e||void 0===e?void 0:e.is_active)&&void 0!==i?i:1)&&"poor"!==String(e.condition_status)}):[];if(xe(s),s.length>0){var e,i;const o=new Map;s.forEach(e=>{e.color&&o.set(e.color,{color:e.color,colorHex:e.color_hex||null})});const t=Array.from(o.values());ve(t);const n=Array.from(new Set(s.map(e=>String(e.storage)).filter(Boolean)));je(n);const r=Array.from(new Set(s.map(e=>String(e.condition_status)).filter(Boolean))).filter(e=>ze.includes(e)),a=r.map(e=>De[e]).filter(Boolean);Ae(a);const c=t.length>0?t[0].color:"",d=n[0]||"",u=r.includes(String(l.condition||l.condition_status))?String(l.condition||l.condition_status):r[0]||"new";Se(c),Me(d),Ne(u);let g=null;c&&d&&(g=s.find(e=>String(e.color)===String(c)&&String(e.storage)===String(d)&&String(e.condition_status)===String(u))),!g&&d&&(g=s.find(e=>String(e.storage)===String(d)&&String(e.condition_status)===String(u))),g||(g=s.find(e=>String(e.condition_status)===String(u)));const p=Ye(ee?g?g.price_mwk||g.price:l.price_mwk||l.priceMwk||l.price:g?g.price_gbp||g.price:l.price_gbp||l.priceGbp||l.price/2358);Oe(p),Pe((null===(e=g)||void 0===e?void 0:e.id)||void 0);const h=g?Math.max(0,parseInt(null!==(i=g.stock_quantity)&&void 0!==i?i:0,10)||0):null;Ge(h)}else{ve([]),je([]),Ae([]),Se(""),Me(""),Ne(String(l.condition||l.condition_status||"new"));const e=ee?l.price_mwk||l.priceMwk||l.price:l.price_gbp||l.priceGbp||l.price/2358;Oe(Ye(e)),Pe(void 0),Ge(null)}try{const e=localStorage.getItem("xp_analytics_sid"),i=null===l||void 0===l?void 0:l.id;if(e&&i&&fe.current!==i){const o={productId:i,name:null===l||void 0===l?void 0:l.name,brand:null===l||void 0===l?void 0:l.brand,model:null===l||void 0===l?void 0:l.model,category:null===l||void 0===l?void 0:l.category,price:Ye(null===l||void 0===l?void 0:l.price),condition:String((null===l||void 0===l?void 0:l.condition)||(null===l||void 0===l?void 0:l.condition_status)||"")};await(0,re.yM)(e,"view_product",o),fe.current=i}}catch(o){}}else O("Gadget not found")}catch(n){console.error("Error fetching gadget:",n),O("Failed to load gadget details")}finally{P(!1)}})()},[M]);const[He,Qe]=(0,n.useState)(null);if((0,n.useEffect)(()=>{if(!C)return;const e=(0,d.wV)(C.name,C.brand,C.category),i=(0,d.wJ)(C.name,C.brand,C.description,We),o=(0,d.j$)((0,t.A)((0,t.A)({},C),{},{price:We})),n=(0,d.KQ)("/gadgets/".concat(C.id));Qe({title:e,description:i,canonical:n,ogImage:C.image,structuredData:o}),document.title=e},[C,w]),I)return(0,R.jsx)("div",{className:"deep bg-primary w-full overflow-hidden min-h-screen flex items-center justify-center",children:(0,R.jsxs)("div",{className:"flex flex-col items-center",children:[(0,R.jsx)(u.A,{sx:{color:"white",mb:2},size:60}),(0,R.jsx)("div",{className:"text-white text-xl",children:"Loading gadget details..."})]})});if(W||!C)return(0,R.jsx)("div",{className:"deep bg-primary w-full overflow-hidden min-h-screen flex items-center justify-center",children:(0,R.jsxs)("div",{className:"flex flex-col items-center",children:[(0,R.jsx)(g.A,{severity:"error",sx:{mb:2},children:W||"Gadget not found"}),(0,R.jsx)(s.N_,{to:"/gadgets",className:"text-lg text-blue-400 hover:underline",onClick:e=>{e.preventDefault(),o("/gadgets")},children:"\u2190 Return to Gadgets"})]})});const $e=()=>{const e=e=>{if(null===e||void 0===e)return null;if("number"===typeof e&&Number.isFinite(e))return e;if("string"===typeof e){const i=e.match(/-?\d+/);if(i){const e=parseInt(i[0],10);return Number.isFinite(e)?e:null}return null}return null},i=[null===C||void 0===C?void 0:C.stock_quantity,null===C||void 0===C?void 0:C.stockQuantity,null===C||void 0===C?void 0:C.stock];let o=null;for(const a of i){const i=e(a);if(null!==i){o=i;break}}null===o&&(o="undefined"!==typeof(null===C||void 0===C?void 0:C.in_stock)?C.in_stock?1:0:"undefined"!==typeof(null===C||void 0===C?void 0:C.inStock)&&C.inStock?1:0);const t=o;if(!(t>0))return void alert("This item is currently out of stock.");const n=ke||void 0,l=We||Ye(C.price),s=Ce||C.condition||C.condition_status||"new",r=null!==Fe&&void 0!==Fe?Fe:t;Z({id:C.id,title:C.name,price:l,image:C.image,number:r,brand:C.brand||"",condition:s,storage:n,color:we||void 0,variantId:Ie,description:C.description||"",specifications:C.specifications||null}),le("Item added to cart!"),te(!0)},Ve=(e,i,o)=>{if(0===me.length)return null;if(e&&i){const t=me.find(t=>String(t.color)===String(e)&&String(t.storage)===String(i)&&String(t.condition_status)===String(o));if(t)return t}if(i){const e=me.find(e=>String(e.storage)===String(i)&&String(e.condition_status)===String(o));if(e)return e}if(e){const i=me.find(i=>String(i.color)===String(e)&&String(i.condition_status)===String(o));if(i)return i}return me.find(e=>String(e.condition_status)===String(o))},Ke=e=>{var i;const o=Ye(ee?e?e.price_mwk||e.price:C.price_mwk||C.priceMwk||C.price:e?e.price_gbp||e.price:C.price_gbp||C.priceGbp||C.price);Oe(o),Pe((null===e||void 0===e?void 0:e.id)||void 0);const t=e?Math.max(0,parseInt(null!==(i=e.stock_quantity)&&void 0!==i?i:0,10)||0):null;Ge(t)};return(0,R.jsxs)(R.Fragment,{children:[He&&(0,R.jsx)(c.A,(0,t.A)({},He)),(0,R.jsx)(l.P.div,{className:"deep bg-primary w-full min-h-screen overflow-hidden",initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.98},transition:{duration:.35,ease:[.22,1,.36,1]},children:(0,R.jsx)("div",{className:"".concat(a.A.paddingX," ").concat(a.A.flexCenter),children:(0,R.jsxs)("div",{className:"".concat(a.A.boxWidth),children:[(0,R.jsxs)("section",{className:"flex flex-col items-center text-center p-6 sm:p-12 gap-8",children:[(0,R.jsx)("h1",{className:"text-white text-3xl sm:text-4xl md:text-5xl mb-4",children:C.name}),(0,R.jsx)(s.N_,{to:"/gadgets",className:"text-lg text-blue-400 hover:underline mb-4",onClick:e=>{e.preventDefault(),o("/gadgets")},children:"\u2190 Return to Gadgets"}),(0,R.jsx)("div",{className:"w-[95%] sm:w-[90%] md:w-[92%] lg:w-[90%] xl:w-[85%] max-w-6xl mx-auto",children:(0,R.jsxs)(l.P.div,{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-start",variants:{hidden:{},show:{transition:{staggerChildren:.08,when:"beforeChildren"}}},initial:"hidden",animate:"show",children:[(0,R.jsxs)(l.P.div,{className:"rounded-lg overflow-hidden shadow-lg",variants:{hidden:{opacity:0,x:-32,y:8,scale:.98},show:{opacity:1,x:0,y:0,scale:1,transition:{duration:.5,ease:[.22,1,.36,1]}}},children:[(0,R.jsx)("div",{className:"flex justify-center mb-4",children:(0,R.jsxs)("div",{className:"bg-gray-800 rounded-lg p-1 flex",children:[(0,R.jsx)("button",{onClick:()=>U("2d"),className:"px-4 py-2 rounded-md transition ".concat("2d"===L?"bg-blue-700 text-white":"text-gray-300 hover:text-white"),children:"Normal View"}),(0,R.jsx)("button",{onClick:async()=>{if(C){de(!0);try{const e=await T.A.getBestModelPath(null===C||void 0===C?void 0:C.name,null===C||void 0===C?void 0:C.brand,null===C||void 0===C?void 0:C.model);e&&e.path?(ge(!1),U("3d")):(ge(!0),U("missing"))}catch(e){ge(!0),U("missing")}finally{de(!1)}}},className:"px-4 py-2 rounded-md transition ".concat("3d"===L?"bg-blue-700 text-white":"text-gray-300 hover:text-white"," ").concat(ce?"opacity-50 cursor-wait":""," ").concat(T.A.hasModel(C)||T.A.getModelConfig(null===C||void 0===C?void 0:C.name,null===C||void 0===C?void 0:C.brand,null===C||void 0===C?void 0:C.model)?"":"opacity-50 cursor-not-allowed"),"aria-disabled":ce||!(T.A.hasModel(C)||T.A.getModelConfig(null===C||void 0===C?void 0:C.name,null===C||void 0===C?void 0:C.brand,null===C||void 0===C?void 0:C.model)),children:"Detailed View"})]})}),"3d"===L&&(0,R.jsx)("div",{className:"text-gray-400 text-sm text-center mb-4",role:"status","aria-live":"polite",children:"Note: This 3D model is licensed and sourced from Sketchfab. It\u2019s provided for visual reference only and may not perfectly represent the actual product."}),"missing"===L?(0,R.jsx)("div",{className:"h-[400px] flex items-center justify-center rounded-lg bg-gray-800 text-gray-200 shadow-lg",children:"Sorry , Detailed View is not available for this Gadget"}):"2d"===L?(0,R.jsx)(l.P.img,{src:C.more_img&&C.more_img[F]||C.image,alt:"".concat(C.name," view ").concat(F+1),className:"w-full h-auto rounded-lg shadow-lg",layoutId:"gadget-media-".concat(C.id),initial:{scale:1},animate:{scale:1},transition:{duration:.3}}):(0,R.jsx)(l.P.div,{className:"h-[700px] md:h-[800px] rounded-lg overflow-hidden shadow-lg",layoutId:"gadget-media-".concat(C.id),children:(0,R.jsx)(n.Suspense,{fallback:(0,R.jsx)("div",{className:"flex items-center justify-center w-full h-full text-gray-300",children:"Loading 3D view\u2026"}),children:(0,R.jsx)(ae,{gadgetName:C.name,gadgetBrand:C.brand,gadgetModel:C.model,fallbackImage:C.image,className:"w-full h-full",onModelError:()=>{ge(!0),U("missing")}})})}),"2d"===L&&C.more_img&&C.more_img.length>1&&(0,R.jsxs)("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4 mt-4",children:[(0,R.jsx)("button",{onClick:()=>{const e=C.more_img||[C.image];D(i=>(i-1+e.length)%e.length)},className:"px-6 py-2 rounded bg-blue-700 text-white hover:bg-black transition shadow-lg",children:"Prev"}),(0,R.jsx)("button",{onClick:()=>{const e=C.more_img||[C.image];D(i=>(i+1)%e.length)},className:"px-6 py-2 rounded bg-blue-700 text-white hover:bg-black transition shadow-lg",children:"Next"})]})]}),(0,R.jsxs)(l.P.div,{className:"bg-gray-900 rounded-xl p-6 shadow-xl text-left md:sticky md:top-24",variants:{hidden:{opacity:0,x:32,y:8,scale:.98},show:{opacity:1,x:0,y:0,scale:1,transition:{duration:.5,ease:[.22,1,.36,1],delay:.04}}},children:[(0,R.jsxs)(l.P.div,{className:"flex flex-col gap-4",variants:Le,children:[(0,R.jsxs)(l.P.p,{className:"text-gray-400",variants:Ue,children:["Brand: ",(0,R.jsx)("span",{className:"text-white",children:C.brand})]}),(0,R.jsxs)(l.P.p,{className:"text-gray-400",variants:Ue,children:["Model: ",(0,R.jsx)("span",{className:"text-white",children:C.model})]}),(0,R.jsxs)(l.P.p,{className:"text-gray-400",variants:Ue,children:["Category: ",(0,R.jsx)("span",{className:"text-white",children:C.category})]}),(be.length>0||Be&&0===me.length)&&(0,R.jsx)(p.A,{sx:{mt:1},children:(0,R.jsxs)(h.A,{size:"small",sx:{minWidth:160},children:[(0,R.jsx)(f.A,{sx:{color:0===be.length?"rgba(255,255,255,0.5)":"white"},children:"Color"}),(0,R.jsx)(m.A,{value:be.length>0&&(we||(null===(e=be[0])||void 0===e?void 0:e.color))||"",label:"Color",onChange:e=>(e=>{if(Se(e),0===me.length){Pe(void 0),Ge(null);const e=Ye(ee?C.price_mwk||C.priceMwk||C.price:C.price_gbp||C.priceGbp||C.price);return void Oe(e)}const i=Ve(e,ke,Ce);Ke(i)})(e.target.value),disabled:be.length<=1,displayEmpty:!0,sx:{color:0===be.length?"rgba(255,255,255,0.5)":"white","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.3)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"white"},"&.Mui-disabled":{color:"rgba(255,255,255,0.5)","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.15)"}}},MenuProps:{PaperProps:{sx:{bgcolor:"#1565c0",color:"white"}}},children:0===be.length?(0,R.jsx)(x.A,{value:"",disabled:!0,children:"Not specified"}):be.map(e=>(0,R.jsx)(x.A,{value:e.color,children:(0,R.jsxs)(p.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.colorHex&&(0,R.jsx)(p.A,{sx:{width:16,height:16,borderRadius:"50%",backgroundColor:e.colorHex,border:"1px solid rgba(255,255,255,0.3)"}}),e.color]})},e.color))})]})}),(_e.length>0||Be&&0===me.length)&&(0,R.jsx)(p.A,{sx:{mt:1},children:(0,R.jsxs)(h.A,{size:"small",sx:{minWidth:160},children:[(0,R.jsx)(f.A,{sx:{color:0===_e.length?"rgba(255,255,255,0.5)":"white"},children:"Condition"}),(0,R.jsx)(m.A,{value:_e.length>0&&De[Ce]||"New",label:"Condition",onChange:e=>(e=>{const i=Re[e]||e;if(Ne(i),0===me.length){Pe(void 0),Ge(null);const e=Ye(ee?C.price_mwk||C.priceMwk||C.price:C.price_gbp||C.priceGbp||C.price);return void Oe(e)}const o=Ve(we,ke,i);Ke(o)})(e.target.value),disabled:_e.length<=1,sx:{color:0===_e.length?"rgba(255,255,255,0.5)":"white","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.3)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"white"},"&.Mui-disabled":{color:"rgba(255,255,255,0.5)","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.15)"}}},MenuProps:{PaperProps:{sx:{bgcolor:"#1565c0",color:"white"}}},children:0===Te.length?(0,R.jsx)(x.A,{value:"New",disabled:!0,children:"New"}):Te.map(e=>{const i=Re[e],o=me.some(e=>{var o;return e.condition_status===i&&(!ke||e.storage===ke)&&parseInt(null!==(o=e.stock_quantity)&&void 0!==o?o:0,10)>0});return(0,R.jsx)(x.A,{value:e,sx:{opacity:o?1:.5,"&::after":o?{}:{content:'" (Out of stock)"',fontSize:"0.75rem",ml:1,color:"rgba(255,255,255,0.5)"}},children:e},e)})})]})}),(Ee.length>0||ye.length>0||Be&&0===me.length)&&(0,R.jsx)(p.A,{sx:{mt:1},children:(0,R.jsxs)(h.A,{size:"small",sx:{minWidth:160},children:[(0,R.jsx)(f.A,{sx:{color:0===Ee.length?"rgba(255,255,255,0.5)":"white"},children:"Storage"}),(0,R.jsx)(m.A,{value:Ee.length>0?ke||Ee[0]:ye.length>0?ye[0]:"",label:"Storage",onChange:e=>(e=>{if(Me(e),0===me.length){Pe(void 0),Ge(null);const e=Ye(ee?C.price_mwk||C.priceMwk||C.price:C.price_gbp||C.priceGbp||C.price);return void Oe(e)}const i=me.filter(i=>i.storage===e),o=i.some(e=>{var i;return e.condition_status===Ce&&parseInt(null!==(i=e.stock_quantity)&&void 0!==i?i:0,10)>0});let t=Ce;if(!o&&i.length>0){const e=i.find(e=>{var i;return parseInt(null!==(i=e.stock_quantity)&&void 0!==i?i:0,10)>0});e&&(t=e.condition_status,Ne(t))}const n=Ve(we,e,t);Ke(n)})(e.target.value),disabled:Ee.length<=1&&ye.length<=1,displayEmpty:!0,sx:{color:0===Ee.length?"rgba(255,255,255,0.5)":"white","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.3)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"white"},"&.Mui-disabled":{color:"rgba(255,255,255,0.5)","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.15)"}}},MenuProps:{PaperProps:{sx:{bgcolor:"#1565c0",color:"white"}}},children:0===ye.length?(0,R.jsx)(x.A,{value:"",disabled:!0,children:"Not specified"}):ye.map(e=>{const i=me.some(i=>{var o;return i.storage===e&&parseInt(null!==(o=i.stock_quantity)&&void 0!==o?o:0,10)>0});return(0,R.jsxs)(x.A,{value:e,disabled:!i,sx:{opacity:i?1:.5},children:[e,i?"":" (Out of stock)"]},e)})})]})})]}),(()=>{const e=e=>{if(null===e||void 0===e)return null;if("number"===typeof e&&Number.isFinite(e))return e;if("string"===typeof e){const i=e.match(/-?\d+/);if(i){const e=parseInt(i[0],10);return Number.isFinite(e)?e:null}return null}return null},i=[null===C||void 0===C?void 0:C.stock_quantity,null===C||void 0===C?void 0:C.stockQuantity,null===C||void 0===C?void 0:C.stock];let o=null;for(const l of i){const i=e(l);if(null!==i){o=i;break}}null===o&&(o="undefined"!==typeof(null===C||void 0===C?void 0:C.in_stock)?C.in_stock?1:0:"undefined"!==typeof(null===C||void 0===C?void 0:C.inStock)&&C.inStock?1:0);const t=o>0,n=o<0,s=o>0;return(0,R.jsxs)(l.P.div,{className:"mt-4 flex flex-col gap-3",variants:Le,children:[!n&&(0,R.jsxs)(l.P.p,{className:"text-gray-400",variants:Ue,children:["Price:",(0,R.jsxs)("span",{className:"text-white text-2xl font-bold ml-2",children:["From ",(()=>{if(!t)return"Coming Soon";if(We){if(ee){const e="string"===typeof We?parseFloat(We.replace(/[^0-9.]/g,"")):Number(We);if(Number.isFinite(e))return"MWK ".concat(Math.round(e).toLocaleString("en-US"))}return X(We)}const e=Ye(ee?C.price_mwk||C.priceMwk||C.price:C.price_gbp||C.priceGbp||C.price/2358);return ee?"MWK ".concat(Math.round(e).toLocaleString("en-US")):X(e)})()]})]}),(0,R.jsxs)(l.P.p,{className:"text-gray-400",variants:Ue,children:["Stock:",(0,R.jsx)("span",{className:t?"text-green-500 ml-2":"text-yellow-400 ml-2",children:(null!==Fe&&void 0!==Fe?Fe:o)>0?"In Stock":"Coming Soon"})]}),s&&(0,R.jsx)(l.P.button,{variants:qe,whileHover:{scale:1.03},whileTap:{scale:.98},onClick:$e,className:"px-6 py-3 rounded-lg text-white font-bold shadow-lg transition bg-blue-700 hover:bg-blue-800",children:"Add to Cart"}),s&&(0,R.jsx)(l.P.button,{variants:qe,whileHover:{scale:1.03},whileTap:{scale:.98},onClick:()=>he(!0),className:"px-6 py-3 rounded-lg text-white font-bold shadow-lg transition bg-blue-700 hover:bg-blue-800",children:"Pay in installments"})]})})()]})]})}),(0,R.jsxs)(p.A,{sx:{width:"100%",maxWidth:"4xl",mb:4},children:[(0,R.jsx)(p.A,{sx:{borderBottom:1,borderColor:"divider"},children:(0,R.jsxs)(b.A,{value:q,onChange:(e,i)=>H(i),variant:"fullWidth",sx:{"& .MuiTab-root":{color:"rgba(255,255,255,0.7)"},"& .Mui-selected":{color:"white"},"& .MuiTabs-indicator":{backgroundColor:"#3f51b5"}},children:[(0,R.jsx)(v.A,{label:"Product Details"}),(0,R.jsx)(v.A,{label:"Schedule Viewing",disabled:0===(()=>{if(!C)return 0;const e=e=>{if(null===e||void 0===e)return null;if("number"===typeof e&&Number.isFinite(e))return e;if("string"===typeof e){const i=e.match(/-?\d+/);if(i){const e=parseInt(i[0],10);return Number.isFinite(e)?e:null}return null}return null},i=[null===C||void 0===C?void 0:C.stock_quantity,null===C||void 0===C?void 0:C.stockQuantity,null===C||void 0===C?void 0:C.stock];let o=null;for(const t of i){const i=e(t);if(null!==i){o=i;break}}return null===o&&(o="undefined"!==typeof(null===C||void 0===C?void 0:C.in_stock)?C.in_stock?1:0:"undefined"!==typeof(null===C||void 0===C?void 0:C.inStock)&&C.inStock?1:0),Math.max(0,o)})()})]})}),(0,R.jsx)("div",{role:"tabpanel",hidden:0!==q,children:0===q&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)("div",{className:"w-full max-w-4xl mt-4 mx-auto",children:[(0,R.jsxs)("div",{className:"text-left",children:[(0,R.jsx)("h2",{className:"text-white text-xl mb-4",children:"Description"}),(0,R.jsx)("p",{className:"text-gray-300",children:C.description})]}),C.specifications&&(0,R.jsxs)("div",{className:"mt-8 text-left",children:[(0,R.jsx)("h2",{className:"text-white text-xl mb-4",children:"Specifications"}),(0,R.jsx)("div",{className:"text-gray-300 grid grid-cols-1 md:grid-cols-2 gap-2",children:Object.entries(C.specifications).map(e=>{let[i,o]=e,t="";try{t=null===o||void 0===o?"N/A":Array.isArray(o)?o.join(", "):"object"===typeof o?Object.entries(o).map(e=>{let[i,o]=e;return"".concat(i,": ").concat(o)}).join(", "):String(o)}catch(W){console.warn("Error processing specification:",i,o,W),t="Unable to display"}return(0,R.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,R.jsxs)("span",{className:"font-medium capitalize",children:[i.replace(/([A-Z])/g," $1"),":"]}),(0,R.jsx)("span",{className:"text-right max-w-md",children:t})]},i)})})]})]}),(0,R.jsx)("div",{className:"mt-10 w-full mx-auto",children:(0,R.jsx)(se,{gadgetId:C.id})})]})}),(0,R.jsx)("div",{role:"tabpanel",hidden:1!==q,children:1===q&&(0,R.jsx)("div",{className:"mt-4",children:C&&(0,R.jsx)(R.Fragment,{children:V?(0,R.jsx)(R.Fragment,{children:((e,i,o)=>{const t=Math.max(0,parseInt(null!==(e=null!==(i=null!==(o=null===C||void 0===C?void 0:C.stock_quantity)&&void 0!==o?o:null===C||void 0===C?void 0:C.stockQuantity)&&void 0!==i?i:null===C||void 0===C?void 0:C.stock)&&void 0!==e?e:0,10)||0);return(0,R.jsx)(R.Fragment,{children:t>0?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(g.A,{severity:"success",sx:{mb:2},children:"\u2713 Item in stock - You can schedule a viewing appointment to see it in person at our mobile van!"}),(0,R.jsx)(z,{gadgetId:C.id,gadgetName:C.name,onBookingComplete:e=>{$(!0),le("\u2713 Appointment booked! Confirmation sent to ".concat(e.userEmail)),te(!0)}})]}):(0,R.jsx)(g.A,{severity:"warning",sx:{mb:2},children:"\u274c This item is currently out of stock and cannot be scheduled for viewing. Please check back soon or subscribe to notifications."})})})()}):(0,R.jsxs)(g.A,{severity:"info",sx:{mb:2},children:["\u2139\ufe0f Please sign in to schedule a viewing appointment. ",(0,R.jsx)(s.N_,{to:"/signin",className:"text-blue-400 hover:underline",children:"Sign in here"})]})})})})]})]}),C&&(0,R.jsx)(Y.A,{open:pe,onClose:()=>he(!1),item:{id:C.id,name:C.name,price:We||Ye(C.price_gbp||C.priceGbp||C.price/2358),priceGbp:We||Ye(C.price_gbp||C.priceGbp||C.price/2358),image:C.image,condition:Ce||C.condition||C.condition_status||"new",storage:ke||void 0,variantId:Ie,description:C.description||"",specifications:C.specifications||null},customerEmail:null!==(i=null===K||void 0===K?void 0:K.email)&&void 0!==i?i:null}),(0,R.jsx)(y.A,{open:oe,autoHideDuration:3e3,onClose:()=>te(!1),children:(0,R.jsx)(g.A,{onClose:()=>te(!1),severity:"success",children:ne})})]})})})]})}}}]);